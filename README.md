<ul>
  <li><strong>Chapter 1: Introduction to DevOps and CI/CD Principles</strong>
    <ul>
      <li><a href="#chapter-1.1">Understanding the DevOps Culture and Philosophy</a></li>
      <li><a href="#chapter-1.2">Key Principles of Continuous Integration and Continuous Delivery (CI/CD)</a></li>
      <li><a href="#chapter-1.3">Exploring the "Acme Webshop" Case Study: Current Development Challenges</a></li>
      <li><a href="#chapter-1.4">Introduction to Version Control Systems and Git Essentials</a></li>
      <li><a href="#chapter-1.5">Setting Up Your Local Development Environment for DevOps Practice</a></li>
    </ul>
  </li>
  
  <li><strong>Chapter 2: Establishing a Robust Continuous Integration Pipeline</strong>
    <ul>
      <li><a href="#chapter-2.1">Source Code Management with Git and Branching Strategies</a></li>
      <li><a href="#chapter-2.2">Introduction to Jenkins: Installation and Initial Configuration</a></li>
      <li><a href="#chapter-2.3">Crafting Your First Jenkins Declarative Pipeline for a Simple Application</a></li>
      <li><a href="#chapter-2.4">Automating Build Processes and Dependency Management</a></li>
      <li><a href="#chapter-2.5">Implementing Automated Unit and Integration Testing in CI</a></li>
	  <li><a href="#chapter-2.6">Integrating Static Code Analysis and Quality Gates</a></li>
    </ul>
  </li>
  
  <li><strong>Chapter 3: Continuous Delivery and Automated Deployment Strategies</strong>
    <ul>
      <li><a href="#chapter-3.1">Managing Build Artifacts and Package Repositories</a></li>
      <li><a href="#chapter-3.2">Advanced Jenkins Pipelines: Parameterized Builds and Shared Libraries</a></li>
      <li><a href="#chapter-3.3">Defining Deployment Environments with Infrastructure as Code (Terraform)</a></li>
      <li><a href="#chapter-3.4">Implementing Automated Deployments to Staging Environments</a></li>
      <li><a href="#chapter-3.5">Exploring Blue/Green and Canary Deployment Patterns</a></li>
	  <li><a href="#chapter-3.6">Rollback Strategies and Post-Deployment Verification</a></li>
    </ul>
  </li>
  
  <li><strong>Chapter 4: Containerization and Orchestration in CI/CD Workflows</strong>
    <ul>
      <li><a href="#chapter-4.1">Docker Fundamentals: Creating and Managing Container Images</a></li>
      <li><a href="#chapter-4.2">Containerizing the "Acme Webshop" Application for Portability</a></li>
      <li><a href="#chapter-4.3">Integrating Docker Image Builds into Jenkins Pipelines</a></li>
      <li><a href="#chapter-4.4">Introduction to Kubernetes: Orchestrating Containerized Applications</a></li>
      <li><a href="#chapter-4.5">Deploying Containerized Applications to Kubernetes using Jenkins</a></li>
	  <li><a href="#chapter-4.6">Managing Container Registries and Image Versioning</a></li>
    </ul>
  </li>
  
  <li><strong>Chapter 5: Monitoring, Feedback, and Security in the DevOps Pipeline</strong>
    <ul>
      <li><a href="#chapter-5.1">Implementing Centralized Logging and Log Management Solutions</a></li>
      <li><a href="#chapter-5.2">Monitoring Application Performance and Infrastructure Health</a></li>
      <li><a href="#chapter-5.3">Setting Up Alerting and Notification Systems for CI/CD Events</a></li>
      <li><a href="#chapter-5.4">Integrating Security Scans (SAST) into the Build Pipeline</a></li>
      <li><a href="#chapter-5.5">Understanding Dynamic Application Security Testing (DAST) Principles</a></li>
	  <li><a href="#chapter-5.6">Establishing Feedback Loops for Continuous Improvement and Learning</a></li>
    </ul>
  </li>
  
  <li><strong>Chapter 6: Advanced CI/CD Practices and Pipeline Optimization</strong>
    <ul>
      <li><a href="#chapter-6.1">Pipeline as Code with Groovy DSL and Complex Shared Libraries</a></li>
      <li><a href="#chapter-6.2">Scaling Jenkins for Enterprise Environments with Distributed Builds</a></li>
      <li><a href="#chapter-6.3">Implementing Multi-Branch and Pull Request-Driven Pipelines</a></li>
      <li><a href="#chapter-6.4">Advanced Deployment Automation and Release Management Techniques</a></li>
      <li><a href="#chapter-6.5">Securing the CI/CD Pipeline End-to-End</a></li>
	  <li><a href="#chapter-6.6">Disaster Recovery and High Availability for Your CI/CD System</a></li>
    </ul>
  </li>
</ul>


<div id="chapter-1">

<div id="chapter-1.1">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Understanding the DevOps Culture and Philosophy</h1><p>In the rapidly evolving landscape of software development, simply having efficient tools is no longer enough to achieve continuous innovation and deliver value at speed. The true differentiator lies in how teams collaborate, communicate, and approach problem-solving. This lesson delves into the foundational aspect of modern software delivery: the DevOps culture and philosophy. Understanding this paradigm shift is crucial, as it underpins every technical practice and tool you will learn throughout this course, especially as we move towards mastering Continuous Integration and Continuous Deployment (CI/CD). Without a deep appreciation for the cultural transformation, even the most sophisticated CI/CD pipelines can falter. Here, we will explore the core tenets of this philosophy, its historical context, and why embracing it is indispensable for any organization aiming for high performance and sustained success in today's digital world.</p>
<h2>The Genesis of DevOps: Bridging the Divide</h2>
<p>Before diving into the specifics of DevOps culture, it's essential to understand its origins and the problems it sought to solve. Historically, software development and IT operations were often distinct and siloed departments, each with different goals, metrics, and even conflicting incentives.</p>
<h3>The "Wall of Confusion"</h3>
<p>The traditional model often created a metaphorical "Wall of Confusion" between Development (Dev) and Operations (Ops) teams.</p>
<ul>
<li><strong>Development Teams</strong> were typically focused on introducing new features, innovating, and delivering changes quickly. Their metrics often revolved around features shipped, code quality, and project timelines.</li>
<li><strong>Operations Teams</strong> were focused on stability, reliability, and security of production systems. Their metrics centered on uptime, incident rates, and change success rates.</li>
</ul>
<p>This divergence frequently led to friction:</p>
<ul>
<li><strong>Example 1 (Real-world):</strong> A development team finishes a new feature and proudly declares it "done." When it's handed over to operations for deployment, unexpected issues arise due to environmental differences, missing dependencies, or configurations not tested in development. Operations then blames development for "throwing code over the wall," while development blames operations for "not understanding the new features." This leads to delays, finger-pointing, and a breakdown of trust.</li>
<li><strong>Example 2 (Real-world):</strong> A critical security patch needs to be deployed urgently. Operations wants to apply it immediately to all servers. Development, having several ongoing feature branches, fears the patch might break their work or introduce regressions, pushing back against rapid deployment without extensive testing, which would delay the security fix.</li>
<li><strong>Hypothetical Scenario:</strong> Imagine a financial trading platform where the development team rapidly builds new algorithmic trading strategies. Each new strategy requires specific hardware optimizations and intricate network configurations. The operations team, responsible for maintaining the stability of the entire trading infrastructure, struggles to keep up with the constant, undocumented changes. They frequently find themselves firefighting production issues stemming from new deployments, leading to downtime and significant financial losses, all while development wonders why their innovative features aren't reaching production faster.</li>
</ul>
<h3>The Birth of a Movement</h3>
<p>The term "DevOps" emerged around 2007-2009, born from the recognition that these traditional silos were detrimental to delivering value efficiently and reliably. It was inspired by Lean manufacturing principles and Agile software development, aiming to extend collaboration beyond the development team to include operations and other stakeholders throughout the entire software delivery lifecycle.</p>
<h2>Core Pillars of DevOps Culture and Philosophy</h2>
<p>DevOps is not a technology, a tool, or even a specific job title; it's a <em>culture</em> and a <em>philosophy</em>. It's about changing mindsets, fostering collaboration, and adopting practices that enable faster, more reliable software delivery. A common framework used to describe the key aspects of DevOps is "CALMS": Culture, Automation, Lean, Measurement, and Sharing. For this lesson, we will focus heavily on "Culture" as the overarching theme, while briefly touching upon how it enables the other pillars.</p>
<h3>1. Culture: Collaboration, Trust, and Shared Responsibility</h3>
<p>At its heart, DevOps is about breaking down the walls between teams and fostering a culture of shared goals, mutual respect, and collective ownership.</p>
<h4>Breaking Down Silos</h4>
<ul>
<li><strong>Concept:</strong> Moving away from isolated "Dev" and "Ops" teams to cross-functional teams that collectively own the entire software lifecycle, from conception to production and beyond.</li>
<li><strong>Real-world Example 1:</strong> In a large e-commerce company, instead of a separate "Platform Team" and "Product Feature Teams," a "Payment Processing Team" might include developers, QA engineers, and operations specialists. This team is responsible for developing new payment methods, ensuring their quality, and maintaining their stability in production. When a production issue arises, the entire team collaborates to diagnose and fix it, rather than just operations.</li>
<li><strong>Real-world Example 2:</strong> A major streaming service adopts a "you build it, you run it" philosophy. Developers are no longer just writing code; they are also involved in deploying their applications, monitoring them in production, and responding to incidents. This directly embeds operational concerns into the development process, fostering empathy and a deeper understanding of system reliability.</li>
<li><strong>Hypothetical Scenario:</strong> A healthcare startup building a patient management portal used to have distinct teams for UI/UX, backend development, database administration, and infrastructure. This led to delays as each team waited for others to complete their tasks. By adopting a DevOps culture, they reorganized into "Service Teams," where a single team owns the patient registration service end-to-end, from the user interface to the underlying database and infrastructure. This team now has diverse skill sets and collaborates continuously, vastly speeding up new feature delivery and issue resolution.</li>
</ul>
<h4>Psychological Safety</h4>
<ul>
<li><strong>Concept:</strong> Creating an environment where individuals feel safe to speak up, share ideas, admit mistakes, and experiment without fear of blame or punishment. This is crucial for learning and continuous improvement.</li>
<li><strong>Real-world Example 1 (Blameless Post-Mortems):</strong> After a major production outage at a large social media company, instead of trying to find who made the mistake, the team conducts a "blameless post-mortem." The focus is on <em>what</em> happened, <em>why</em> the systems failed, and <em>how</em> to prevent similar issues in the future, rather than identifying and punishing individuals. This encourages honesty and transparency, leading to more effective learning and systemic improvements.</li>
<li><strong>Real-world Example 2 (Experimentation):</strong> A major online retailer encourages small, frequent experiments with new features or infrastructure changes. Teams are empowered to try new things, knowing that if an experiment doesn't work out, it's considered a learning opportunity, not a failure that will result in reprimand. This fosters innovation and rapid iteration.</li>
<li><strong>Hypothetical Scenario:</strong> A startup developing a mobile game encourages its developers to deploy new game features to a small subset of users (canary release) even if they are not 100% confident in the feature's immediate success. The understanding is that valuable data will be collected, and if the feature performs poorly, it can be quickly rolled back or iterated upon. Management supports this approach, viewing "failed" experiments as critical data points for future success, rather than individual developer failures.</li>
</ul>
<h4>Shared Responsibility and Ownership</h4>
<ul>
<li><strong>Concept:</strong> Everyone involved in the software delivery process takes collective ownership of the product's success and reliability, from ideation through development, deployment, and ongoing operation.</li>
<li><strong>Real-world Example 1:</strong> In a SaaS company, developers are not only writing code but are also on-call to support their applications in production. This direct responsibility encourages them to write more robust, observable, and stable code, as they are the ones who will be paged if it breaks.</li>
<li><strong>Real-world Example 2:</strong> Quality Assurance (QA) is "shifted left" in a DevOps environment. Instead of a separate QA team at the end of the process, developers are encouraged to write automated tests (unit, integration, end-to-end) as part of their development process. QA engineers might become "test automation specialists" embedded within development teams, coaching and enabling developers to build quality in from the start.</li>
<li><strong>Hypothetical Scenario:</strong> An autonomous vehicle software company implements a safety-critical system. The development team writes the core logic, but the operations team collaborates closely from the design phase, defining monitoring requirements and deployment strategies that ensure the system's absolute reliability and safety. Both teams share the burden of proving and maintaining the system's integrity, even participating in joint simulations and stress tests.</li>
</ul>
<h3>2. Automation: The Enabler of Speed and Reliability</h3>
<p>While not strictly a cultural aspect, the embrace of automation is a fundamental philosophical shift driven by DevOps culture. It's about performing repeatable tasks reliably and quickly, freeing humans for more complex, creative problem-solving.</p>
<ul>
<li><strong>Concept:</strong> Automating repetitive, manual tasks across the entire software delivery pipeline, including building, testing, deploying, and even infrastructure provisioning.</li>
<li><strong>Real-world Example 1 (Automated Testing):</strong> Instead of manually testing every new feature, a financial institution builds a suite of automated unit, integration, and end-to-end tests that run every time new code is committed. This drastically reduces the time to validate changes and catches regressions early.</li>
<li><strong>Real-world Example 2 (Infrastructure as Code - IaC):</strong> A cloud provider leverages IaC tools to define their entire infrastructure (servers, networks, databases) as code. This allows them to provision identical environments repeatedly, ensuring consistency between development, staging, and production, and eliminating "it worked on my machine" issues.</li>
<li><strong>Hypothetical Scenario:</strong> A space exploration agency develops software for mission control. Manual deployments used to take days, involving complex checklists and prone to human error, jeopardizing mission timelines. By adopting automation, they now use scripts and pipelines to deploy software updates to ground stations and even simulation environments in minutes, ensuring consistency and drastically reducing the risk of errors during critical operations.</li>
</ul>
<h3>3. Lean Principles: Eliminating Waste and Maximizing Flow</h3>
<p>DevOps strongly aligns with Lean manufacturing principles, focusing on optimizing the flow of work and eliminating waste.</p>
<ul>
<li><strong>Concept:</strong> Identifying and removing non-value-adding activities, reducing batch sizes, and optimizing the entire value stream to deliver features to users faster and more efficiently.</li>
<li><strong>Real-world Example 1 (Small Batch Sizes):</strong> Instead of releasing large software updates quarterly with hundreds of features, a social media company opts for daily or even hourly small releases. Each release contains only a few changes, making it easier to identify and fix issues if they arise, and reducing the risk associated with each deployment.</li>
<li><strong>Real-world Example 2 (Reducing Handoffs):</strong> A logistics company redesigns its software delivery process to minimize the number of times work passes from one team to another (handoffs). They achieve this by having cross-functional teams with end-to-end ownership, directly reducing communication overhead and potential for errors.</li>
<li><strong>Hypothetical Scenario:</strong> An online education platform used to have a lengthy approval process for every code change, involving multiple layers of management sign-offs, often taking weeks. By embracing Lean principles, they streamlined the process, empowering teams with more autonomy and using automated quality gates. This eliminated significant "waiting waste" and allowed them to deliver new course features to students much faster.</li>
</ul>
<h3>4. Measurement: Data-Driven Decision Making</h3>
<p>A core tenet of DevOps culture is using data to understand performance, identify bottlenecks, and drive continuous improvement.</p>
<ul>
<li><strong>Concept:</strong> Collecting and analyzing metrics throughout the software delivery lifecycle and in production to gain insights into system health, team performance, and business impact.</li>
<li><strong>Real-world Example 1 (Deployment Frequency):</strong> A leading technology company tracks metrics like deployment frequency (how often code is deployed to production), lead time for changes (time from commit to production), mean time to recover (MTTR), and change failure rate. They use these metrics to assess the health of their delivery pipeline and identify areas for improvement.</li>
<li><strong>Real-world Example 2 (Application Performance Monitoring):</strong> A cloud-native startup uses sophisticated monitoring tools to track application response times, error rates, and resource utilization in real-time. This allows them to proactively identify performance degradation, troubleshoot issues quickly, and ensure a high-quality user experience.</li>
<li><strong>Hypothetical Scenario:</strong> A game development studio, instead of relying solely on user reviews, implements in-game analytics to track player engagement, feature usage, and conversion rates for in-app purchases. This data provides objective insights, allowing them to make data-driven decisions about which features to prioritize, which aspects of the game need improvement, and how to optimize player retention, rather than just guessing.</li>
</ul>
<h3>5. Sharing: Knowledge Dissemination and Feedback Loops</h3>
<p>DevOps emphasizes open communication, knowledge sharing, and continuous feedback to foster a learning organization.</p>
<ul>
<li><strong>Concept:</strong> Facilitating knowledge transfer between teams, sharing best practices, lessons learned, and creating mechanisms for continuous feedback throughout the entire delivery process.</li>
<li><strong>Real-world Example 1 (Internal Tech Talks/Guilds):</strong> A large enterprise organizes regular "DevOps Days" or internal "Guilds" where engineers from different teams share their experiences, present new tools or techniques, and discuss challenges and solutions. This breaks down knowledge silos and promotes cross-pollination of ideas.</li>
<li><strong>Real-world Example 2 (Feedback in CI/CD):</strong> A software company integrates automated feedback into their CI/CD pipeline. Developers receive immediate notifications if their code commit breaks a build, fails tests, or introduces security vulnerabilities, allowing them to address issues while the context is fresh.</li>
<li><strong>Hypothetical Scenario:</strong> A rapidly growing FinTech company implements a "wiki-first" approach for documentation, ensuring all knowledge—from architecture diagrams to incident runbooks—is readily accessible and collectively maintained. They also schedule weekly "learning lunches" where teams present their current challenges and successful solutions, fostering an environment where no one "hoards" knowledge.</li>
</ul>
<h2>Real-World Application: The Transformative Impact of DevOps Culture</h2>
<p>The adoption of DevOps culture is not merely about buzzwords; it has tangible, transformative impacts on organizations across industries.</p>
<h3>Example 1: Financial Services Sector Transformation</h3>
<p>Historically, banks and financial institutions were known for their slow, risk-averse, and highly regulated IT environments. Deployments were infrequent (often quarterly or even annually), heavily manual, and prone to errors. This led to significant lead times for new features, making it difficult to respond to market changes or compete with agile FinTech startups.
By adopting a DevOps culture, many financial services firms have undergone a radical transformation. They started by:</p>
<ul>
<li><strong>Breaking down silos:</strong> Integrating compliance and security teams early into the development process, rather than treating them as gatekeepers at the end.</li>
<li><strong>Fostering shared responsibility:</strong> Developers became more accountable for the production health of their applications, leading to better quality code and robust monitoring.</li>
<li><strong>Embracing blameless culture:</strong> Post-mortems shifted from fault-finding to systemic improvement, leading to more resilient systems.</li>
<li><strong>Enabling automation:</strong> Automating large parts of their testing, compliance checks, and deployment pipelines, allowing for much more frequent, smaller releases.
The result is that some banks now perform hundreds of deployments per day, significantly reducing the time to market for new products, enhancing security by rapidly patching vulnerabilities, and improving customer satisfaction through continuous innovation, all while maintaining strict regulatory compliance.</li>
</ul>
<h3>Example 2: E-commerce and Retail Agility</h3>
<p>The e-commerce sector is intensely competitive, with consumer expectations constantly rising for new features, personalized experiences, and flawless performance. Traditional software development cycles were too slow to keep pace.
Retailers adopting DevOps culture observed similar benefits:</p>
<ul>
<li><strong>Customer-centricity:</strong> A culture of rapid feedback loops (Measurement and Sharing) allowed teams to quickly understand customer behavior and adapt their offerings.</li>
<li><strong>Experimentation mindset:</strong> Teams were empowered to deploy small, experimental features (e.g., A/B tests for checkout flows) to subsets of users, gather data, and iterate quickly without fear of massive failure. This accelerated learning and innovation.</li>
<li><strong>Operational excellence:</strong> Developers and operations collaborated closely to build highly scalable and resilient platforms capable of handling massive traffic spikes during peak sales seasons (e.g., Black Friday), preventing costly outages that could severely impact revenue and brand reputation.
This cultural shift has enabled major online retailers to continuously deploy new features, optimize user experiences, and maintain high availability, directly contributing to their market leadership.</li>
</ul>
<h2>Exercises and Practice Activities</h2>
<p>These exercises are designed to help you internalize the concepts of DevOps culture and philosophy.</p>
<ol>
<li>
<p><strong>Scenario Analysis: The "Wall of Confusion" Revisited</strong>
Imagine you are a technical lead at a company facing constant friction between development and operations teams. Describe three specific scenarios you might observe that are symptoms of the "Wall of Confusion." For each scenario, explain how a shift in DevOps culture (referencing at least two CALMS principles like Collaboration, Shared Responsibility, Psychological Safety, or Lean) could mitigate or resolve the issue.</p>
</li>
<li>
<p><strong>DevOps Cultural Assessment</strong>
Consider a past or current project you've worked on (or a hypothetical one if you have no work experience). Evaluate the team's culture against the five CALMS principles (Culture, Automation, Lean, Measurement, Sharing). For each principle:</p>
<ul>
<li>Rate your team's current adherence (e.g., 1-5, with 5 being excellent).</li>
<li>Provide one concrete example of how your team demonstrated this principle (or failed to).</li>
<li>Suggest one actionable step that could improve adherence to that principle within your team.</li>
</ul>
</li>
<li>
<p><strong>Blameless Post-Mortem Design</strong>
A critical production issue occurred last night, causing a 2-hour outage for a key customer-facing application. Your manager has asked you to lead the post-mortem. Outline the agenda for a <em>blameless</em> post-mortem meeting. What are the key questions you would ask? What kind of data would you seek? What specific cultural norms would you enforce during the meeting to ensure it remains constructive and focuses on learning rather than blame?</p>
</li>
</ol>
  
</div>

<div id="chapter-1.2">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Key Principles of Continuous Integration and Continuous Delivery (CI/CD)</h1><p>Continuous Integration (CI) and Continuous Delivery (CD) are fundamental practices in modern software development that aim to streamline and improve the software release process. CI focuses on frequently merging code changes into a central repository and automatically verifying builds, while CD extends this by ensuring that software can be released to production reliably at any time.</p>
<h2>Core Principles of Continuous Integration (CI)</h2>
<p>Continuous Integration is a development practice where developers integrate code into a shared repository frequently, preferably several times a day. Each integration is then verified by an automated build and automated tests. This approach significantly reduces integration problems and allows teams to develop cohesive software more rapidly.</p>
<h3>Version Control System (VCS) as the Single Source of Truth</h3>
<p>At the heart of CI is the use of a robust Version Control System (VCS), such as Git, where all developers commit their code changes. This repository serves as the single source of truth for the project, ensuring that everyone is working from the latest codebase. Frequent commits to this central repository prevent large, complex merge conflicts that arise when developers work in isolation for extended periods.</p>
<ul>
<li><strong>Real-world example:</strong> A development team at a financial institution uses Git for their core banking application. Every time a developer completes a feature or bug fix, they commit their changes to a central Git repository. This ensures that all changes are tracked, and any developer can pull the latest version of the code, preventing situations where different developers are working on outdated versions of the codebase.</li>
<li><strong>Hypothetical scenario:</strong> Imagine a small startup building a new social media platform. Developers <code>Alice</code>, <code>Bob</code>, and <code>Charlie</code> are each working on different features (user profiles, news feed, messaging). If they didn't use a central VCS, <code>Alice</code> might be developing against a version of the code that <code>Bob</code> changed weeks ago, leading to significant rework and conflict resolution when they finally try to combine their work. With Git, they frequently push their changes to a main branch, ensuring everyone has the most up-to-date context.</li>
</ul>
<h3>Automating the Build Process</h3>
<p>Once code is committed to the VCS, the next principle of CI is to automate the build process. This involves compiling the source code into an executable application, resolving dependencies, and packaging it. Automation ensures consistency and repeatability, eliminating manual errors and saving developer time. Tools like Maven, Gradle, npm, or dotnet CLI are commonly used for this purpose, depending on the programming language and ecosystem.</p>
<ul>
<li><strong>Real-world example:</strong> An e-commerce company uses an automated build process for their web application. After a developer pushes code to the main branch, a CI server automatically fetches the code, downloads all necessary libraries (e.g., using <code>npm install</code> for a Node.js project), compiles the TypeScript files into JavaScript, and bundles the assets (CSS, images). This build process creates a deployable artifact, such as a Docker image or a WAR file.</li>
<li><strong>Hypothetical scenario:</strong> Consider a team developing a mobile game. Their automated build script not only compiles the game engine code but also integrates game assets (textures, sounds, models), ensuring they are correctly linked and packaged into a deployable <code>.apk</code> or <code>.ipa</code> file. Without automation, a developer might forget to include a specific asset or use an incorrect build configuration, leading to a broken game build.</li>
</ul>
<h3>Implementing Automated Tests</h3>
<p>Automated testing is a cornerstone of CI. After a successful build, a suite of automated tests (unit tests, integration tests) is executed immediately. These tests quickly detect if new changes have introduced regressions or broken existing functionality. Early detection of defects dramatically reduces the cost and effort of fixing them, as the context of the change is still fresh in the developer's mind.</p>
<ul>
<li><strong>Real-world example:</strong> A software company developing an API for a logistics system integrates automated unit and integration tests into their CI pipeline. When a developer pushes a change to the <code>calculate-route</code> endpoint, the CI server automatically runs thousands of tests. These tests verify the routing algorithm, check for correct error handling, and ensure integration with external mapping services. If any test fails, the build is marked as broken, and the developer is notified.</li>
<li><strong>Hypothetical scenario:</strong> A team building a project management tool includes automated tests for their user authentication module. After a code commit, the CI system runs tests to verify that users can register, log in, reset passwords, and that unauthorized access attempts are correctly blocked. If a recent change inadvertently broke the password reset functionality, the automated tests would immediately flag it, preventing this critical bug from reaching later stages.</li>
</ul>
<h3>Immediate Feedback and Fast Failure</h3>
<p>A critical aspect of CI is providing immediate feedback to developers when a build or test fails. This prompt notification allows developers to address issues quickly, often within minutes of introducing them. The principle of "fast failure" means identifying problems as early as possible in the development cycle, which is far more efficient than discovering them later during manual testing or, worse, in production.</p>
<ul>
<li><strong>Real-world example:</strong> At a software-as-a-service (SaaS) company, when a developer commits code that causes a test to fail, the CI server immediately sends an email notification and a message to a team chat channel (e.g., Slack or Microsoft Teams). The notification includes details about the failed test, allowing the developer to identify the problematic code segment and fix it rapidly. This prevents a broken build from lingering and affecting other team members.</li>
<li><strong>Hypothetical scenario:</strong> A developer working on a backend service pushes a small change. The automated build fails because of a missing dependency. The CI system, configured for fast feedback, instantly notifies the developer via their IDE or a desktop notification. The developer can then quickly correct the <code>pom.xml</code> or <code>package.json</code> file and re-commit, resolving the issue within minutes, rather than having to wait hours for a nightly build to fail.</li>
</ul>
<h2>Core Principles of Continuous Delivery (CD)</h2>
<p>Continuous Delivery extends Continuous Integration by ensuring that software can be released to production reliably at any time. It's not just about building and testing; it's about having a deployment pipeline that can take a validated build artifact and deliver it to various environments, including production, with minimal human intervention.</p>
<h3>Maintaining a Deployable Artifact</h3>
<p>A central tenet of CD is that the CI process should produce a deployable artifact that is immutable and can be promoted through various environments. This means that the exact same artifact that passed tests in the development or staging environment is the one that gets deployed to production. This eliminates "works on my machine" issues and ensures consistency across environments.</p>
<ul>
<li><strong>Real-world example:</strong> A large online retailer's CI pipeline generates a Docker image for their microservices. Once this Docker image is successfully built and tested, it is tagged with a unique version number and pushed to a container registry. This exact Docker image is then used for deployments to staging, pre-production, and ultimately, production environments. This guarantees that no code changes or build environment differences occur between stages.</li>
<li><strong>Hypothetical scenario:</strong> A team developing an enterprise application packages their software as a <code>.jar</code> file (for Java) or a NuGet package (for .NET). After the CI pipeline builds this package and runs all tests, this specific <code>.jar</code> or NuGet package becomes the "deployable artifact." It is then stored in an artifact repository, ready to be deployed without further modifications. If manual changes were allowed after CI, it could lead to different versions being deployed to different environments, making debugging and consistency extremely difficult.</li>
</ul>
<h3>Automating the Deployment Pipeline</h3>
<p>Continuous Delivery pipelines are fully automated, from code commit to deployment in any environment. This automation covers not only the build and test steps but also the deployment itself, configuration management, and environment provisioning. Automated deployments reduce manual errors, accelerate the release process, and make deployments a routine, low-risk operation.</p>
<ul>
<li><strong>Real-world example:</strong> A FinTech company uses an automated deployment pipeline for their trading platform. When a new feature is merged, the pipeline automatically triggers, builds the application, runs tests, and then deploys the validated artifact to a staging environment. After automated smoke tests in staging, it can then be manually approved for deployment to production, which itself is an automated process, typically involving rolling updates to minimize downtime.</li>
<li><strong>Hypothetical scenario:</strong> An online education platform uses an automated pipeline to deploy updates to their learning management system. A developer pushes code; the CI stage builds and tests it. Then, the CD stage automatically deploys the new version to a quality assurance (QA) environment for further testing. If QA approves, a single click (or automated trigger based on a schedule) initiates the deployment to production, involving tasks like database migrations, server updates, and service restarts, all orchestrated without human intervention beyond the initial approval.</li>
</ul>
<h3>Deploying to Production with Confidence</h3>
<p>The ultimate goal of CD is to enable teams to deploy to production frequently and confidently, often multiple times a day. This confidence comes from the rigorous automation of the CI/CD pipeline, including comprehensive testing, consistent environments, and validated artifacts. Deployments become a non-event rather than a high-stress, risky operation.</p>
<ul>
<li><strong>Real-world example:</strong> A major technology company that operates several online services deploys new features and bug fixes to production hundreds of times a day. Their confidence stems from a highly mature CI/CD pipeline that includes extensive automated testing, canary deployments, and automated rollback capabilities. Each deployment is small and incremental, reducing the blast radius of any potential issue.</li>
<li><strong>Hypothetical scenario:</strong> A gaming studio uses CD to release small patches and content updates for their online multiplayer game. Instead of large, infrequent updates that disrupt players, they deploy minor changes multiple times a week. This is possible because their CD pipeline ensures each patch is thoroughly tested against various game clients and server configurations, making each release a low-risk event that improves player experience without major downtime.</li>
</ul>
<h2>Relationship Between CI and CD</h2>
<p>CI is a prerequisite for CD. Without continuous integration, the stream of code changes would be too inconsistent and error-prone to automate reliable deployments. CD builds upon CI by extending the automation further down the pipeline, transforming a consistently integrated codebase into a consistently deliverable product. The "Acme Webshop" will leverage both CI and CD principles to transform its development challenges into a streamlined, efficient release process. The current manual and infrequent deployments are a prime target for these principles.</p>
<h2>Exercises and Practice Activities</h2>
<ol>
<li><strong>Identify CI/CD Gaps:</strong> Consider a software project you are familiar with (it can be hypothetical). List at least three activities in its development and release process that are currently manual and could be automated using CI/CD principles. For each, describe how automating it would align with a specific CI or CD principle.
<ul>
<li><em>Example:</em> Manual code merging -&gt; Automate with VCS and frequent commits (CI principle: VCS as Single Source of Truth).</li>
</ul>
</li>
<li><strong>Artifact Immutability:</strong> Explain why it is crucial that the "deployable artifact" generated by the CI pipeline remains unchanged as it moves through different environments (e.g., staging to production). What risks arise if the artifact is modified or rebuilt at a later stage? Provide a concrete example.</li>
<li><strong>Fast Feedback Scenario:</strong> Describe a scenario where a broken build in a CI pipeline (e.g., failed tests) would save significant time and resources compared to discovering the same issue during manual testing later in the development cycle. Detail the steps involved and the benefits of early detection.</li>
</ol>
  
</div>

<div id="chapter-1.3">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Exploring the "Acme Webshop" Case Study: Current Development Challenges</h1><p>This lesson examines the current development challenges faced by "Acme Webshop," a hypothetical e-commerce application. By understanding these challenges, we establish a practical context for applying DevOps principles and CI/CD methodologies discussed throughout this course. The focus here is on identifying common pain points in traditional software development lifecycles that CI/CD aims to resolve.</p>
<h2>Acme Webshop: An Overview</h2>
<p>Acme Webshop is a mature, monolithic e-commerce application built to handle product catalogs, user authentication, shopping carts, and order processing. It has been developed over several years by a growing team of developers. The application serves a significant customer base, and new features and bug fixes are regularly required to maintain its competitive edge and address market demands. The current technology stack includes a Java backend, a relational database, and a JavaScript-based frontend.</p>
<h2>Development Pain Points and Bottlenecks</h2>
<p>The current development process at Acme Webshop is experiencing several significant challenges that hinder agility, increase time-to-market, and frequently lead to operational issues. These pain points are typical of environments lacking robust CI/CD practices.</p>
<h3>Manual and Inconsistent Build Processes</h3>
<p>One of the primary challenges at Acme Webshop is the manual nature of its build process. When a developer finishes writing code, they manually trigger a build on their local machine or a shared build server. This process often involves running a series of scripts and commands specific to the developer's environment.</p>
<ul>
<li><strong>Example 1: Manual Dependency Management:</strong> A new developer joins the team and pulls the Acme Webshop codebase. To build the application, they first need to manually download and install specific versions of Java Development Kit (JDK), Maven, and various other libraries. Without a standardized process, they might install incorrect versions, leading to "works on my machine" issues. One developer might have JDK 11, while another uses JDK 17, and the build fails only for one of them due to subtle API changes or compiler differences.</li>
<li><strong>Example 2: Inconsistent Build Scripts:</strong> Different developers might use slightly different commands or build scripts to compile the application and package it. For instance, one developer might use <code>mvn clean install -DskipTests</code> to speed up their local build, while another uses <code>mvn package</code>. When these disparate approaches eventually merge, the official release build, run by a single designated engineer, often fails due to missing steps or incorrect configurations that were overlooked in individual environments. This leads to time-consuming troubleshooting to reconcile build environments.</li>
<li><strong>Hypothetical Scenario:</strong> Imagine the Acme Webshop team decides to upgrade a critical library. Each developer updates their local configuration. However, because there's no central, automated build definition, some developers might forget to update a specific environment variable or a configuration file that the build process relies on. This leads to some local builds succeeding while others fail without a clear reason, consuming valuable developer time in debugging environmental differences rather than code issues.</li>
</ul>
<h3>Lack of Automated Testing</h3>
<p>Acme Webshop currently relies heavily on manual testing, which occurs late in the development cycle, typically after significant features have been integrated.</p>
<ul>
<li><strong>Example 1: Regression Test Burden:</strong> After every major feature release, a dedicated QA team at Acme Webshop spends days or even weeks manually clicking through the entire application to ensure existing functionalities (like adding items to the cart, user login, order placement) have not been broken by new code. This extensive manual regression testing significantly delays releases. A bug introduced in the payment gateway by a new discount feature might only be discovered a week after development, requiring the development team to switch contexts back to old code, delaying other tasks.</li>
<li><strong>Example 2: Developer Testing Gaps:</strong> Developers are encouraged to perform local unit tests, but there's no enforcement or automated mechanism to run these tests consistently or to a required coverage level. As a result, critical code paths might have no associated tests, or tests might be outdated. A developer might introduce a bug in the product search function, and because there are no automated unit tests specifically covering this functionality, the bug is not caught until manual QA testing much later.</li>
<li><strong>Hypothetical Scenario:</strong> A new feature for gift card redemption is developed. Developers write some basic local tests, but these tests only cover the "happy path" (successful redemption). They miss an edge case where a gift card has expired. This bug is only found during manual acceptance testing by the QA team just before a planned release, causing a last-minute scramble to fix and re-test, pushing back the release date.</li>
</ul>
<h3>Infrequent and Risky Deployments</h3>
<p>Deployments at Acme Webshop are infrequent, typically occurring once every few weeks or even months. Each deployment is a high-stakes event.</p>
<ul>
<li><strong>Example 1: "Big Bang" Deployments:</strong> Due to the long development cycles and infrequent releases, each deployment bundles many new features and bug fixes. This "big bang" approach makes it incredibly difficult to pinpoint the source of a problem when issues arise in production. If the webshop goes down after a major deployment, the team has to sift through weeks or months of code changes from multiple developers to identify the breaking change, often leading to prolonged outages.</li>
<li><strong>Example 2: Manual Deployment Steps:</strong> The deployment process itself is largely manual and involves a sequence of steps performed by a designated operations engineer. These steps include connecting to servers, copying build artifacts, restarting application servers, and updating database schemas. A misstep, like deploying an incorrect configuration file for the production environment instead of the staging one, can lead to immediate production outages.</li>
<li><strong>Hypothetical Scenario:</strong> The Acme Webshop team plans a major release for a holiday sale. The deployment involves upgrading the database schema, deploying the new application version, and updating cached data. During the manual deployment, the operations engineer accidentally skips a step to clear a specific Redis cache, leading to users seeing outdated product prices from the previous version. This goes unnoticed until customers start complaining, causing panic and a rapid, emergency rollback which disrupts service during a critical sales period.</li>
</ul>
<h3>Poor Collaboration Between Development and Operations</h3>
<p>The Acme Webshop team experiences a significant divide between developers and operations personnel. This organizational silo contributes to many of the aforementioned challenges.</p>
<ul>
<li><strong>Example 1: "Throw It Over the Wall":</strong> Developers complete their features and then "throw" the code over to the operations team for deployment, often with insufficient documentation or understanding of operational requirements. When the application behaves unexpectedly in production, developers might claim "it works on my machine," while operations complains about unstable code. For instance, developers might use a logging library that writes logs to a local file system, assuming operations will just collect them. However, the operations team has a centralized logging system that requires a different configuration, leading to a period where production logs are not being collected, hindering incident response.</li>
<li><strong>Example 2: Blame Culture During Incidents:</strong> When a production issue occurs, the focus often shifts to assigning blame rather than collaboratively resolving the problem. Developers might point to infrastructure, while operations might point to application code. This dynamic delays resolution. If the webshop's database experiences slow queries after a deployment, operations might blame new, inefficient SQL queries from developers, while developers might blame insufficient database resources provisioned by operations, prolonging the root cause analysis.</li>
<li><strong>Hypothetical Scenario:</strong> The Acme Webshop experiences a performance degradation after a recent product catalog update. Developers believe their code is optimized, while the operations team reports high CPU usage on the application servers. Instead of working together to analyze application metrics, database performance, and server logs simultaneously, each team investigates in isolation, using different tools and metrics, which delays the identification that a new image resizing service introduced by developers is consuming excessive resources without proper configuration by operations.</li>
</ul>
<h2>Impact of Current Challenges</h2>
<p>These development challenges translate directly into negative business outcomes for Acme Webshop:</p>
<ul>
<li><strong>Slow Time to Market:</strong> New features take a long time to reach customers, allowing competitors to gain an advantage.</li>
<li><strong>Increased Risk of Deployment Failures:</strong> Each deployment carries a high risk of introducing bugs or causing outages, leading to customer dissatisfaction and potential revenue loss.</li>
<li><strong>Reduced Developer Productivity:</strong> Developers spend excessive time on manual tasks, debugging environment issues, and fixing problems late in the cycle, rather than building new features.</li>
<li><strong>Higher Operational Costs:</strong> Frequent production incidents and the need for dedicated manual QA and deployment teams increase operational overhead.</li>
<li><strong>Decreased Morale:</strong> The constant pressure, blame culture, and repetitive manual work can lead to burnout and decreased job satisfaction for both development and operations teams.</li>
</ul>
<h2>Exercises and Practice Activities</h2>
<ol>
<li><strong>Challenge Identification:</strong> Reflect on a past or current project you've been involved in. Identify at least three specific development challenges or pain points that mirror those described for Acme Webshop. For each challenge, describe:
<ul>
<li>What was the challenge?</li>
<li>How did it manifest (e.g., specific issues, delays, conflicts)?</li>
<li>What was the impact on the project or team?</li>
<li>How might an automated approach (related to CI/CD) have helped mitigate it?</li>
</ul>
</li>
<li><strong>Process Mapping (Simplified):</strong> Imagine you are a developer at Acme Webshop. Outline the typical steps you would take from finishing a code change to seeing it deployed to production, given the challenges described. Be specific about manual steps, waiting times, and handoffs. For example: "Code committed -&gt; Local build -&gt; Request manual QA -&gt; Wait for QA -&gt; QA finds bug -&gt; Fix bug -&gt; ...".</li>
<li><strong>Impact Analysis:</strong> Choose one of the core challenges (e.g., infrequent deployments). Describe in detail how this challenge could directly lead to <em>three</em> different negative business outcomes for Acme Webshop beyond what was explicitly mentioned (e.g., loss of customer trust, legal issues, missed revenue opportunities).</li>
</ol>
<h2>Real-World Application</h2>
<p>The challenges faced by Acme Webshop are not unique; they represent common hurdles in organizations adopting modern software development practices.</p>
<ul>
<li><strong>Legacy Enterprises:</strong> Many large, established enterprises with complex, monolithic applications experience similar issues. They often have departmental silos, long-standing manual processes, and significant technical debt. For instance, a major financial institution might take months to deploy updates to its core banking system due to stringent manual compliance checks, extensive manual regression testing across various interconnected systems, and a fear of disrupting critical services. The risk of error in these "big bang" deployments is extremely high.</li>
<li><strong>Startups with Rapid Growth:</strong> Even rapidly growing startups can fall into these traps if they don't establish solid practices early. A startup might initially prioritize speed over process, leading to a build-up of technical debt and manual steps. As their user base and team grow, their once-nimble deployment process becomes cumbersome. For example, a fast-growing social media app might initially have developers manually pushing code to production servers. As the team expands and multiple features are in development concurrently, these manual pushes become error-prone, leading to frequent site instability and a reactive "firefighting" culture.</li>
</ul>
<p>These examples highlight that regardless of company size or industry, the absence of streamlined, automated processes like those offered by CI/CD inevitably leads to inefficiencies, increased risk, and slower innovation.</p>
  
</div>

<div id="chapter-1.4">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Introduction to Version Control Systems and Git Essentials</h1><p>Software development, especially in a team environment, requires effective ways to track changes, collaborate, and maintain different versions of code. Version Control Systems (VCS) provide the tools to manage these critical aspects, acting as a historical record of every modification made to a project. Git is the most prevalent distributed version control system today, enabling developers to work independently on features while seamlessly integrating their contributions.</p>
<h2>Understanding Version Control Systems (VCS)</h2>
<p>A Version Control System is a category of software tools that helps a software team manage changes to source code over time. VCS keeps track of every modification to the code in a special kind of database. If a mistake is made, developers can turn back the clock and compare earlier versions of the code to help fix the mistake while minimizing disruption to all team members.</p>
<p>There are primarily two types of Version Control Systems:</p>
<h3>Centralized Version Control Systems (CVCS)</h3>
<p>In a Centralized Version Control System, all developers "check out" files from a central server. All changes made by individual developers are then "committed" back to this central server. This server stores the entire history of the project.</p>
<p><strong>Examples:</strong> Subversion (SVN), CVS, Perforce.</p>
<p><strong>Real-world Example:</strong> Consider a team of graphic designers working on a brochure using a CVCS. Each designer checks out the main design file, makes their edits, and then commits it back. The central server holds the authoritative version. If one designer's changes break the layout, others might not be able to work until the issue is resolved on the central file.</p>
<p><strong>Hypothetical Scenario:</strong> Imagine the "Acme Webshop" development team in its early days, before adopting modern DevOps practices. They might have used a CVCS where all code was stored on a single server. A developer working on the product catalog feature checks out the <code>product-page.html</code> file, makes changes, and commits them. If the central server goes down, no one can check out code, commit changes, or view history.</p>
<h3>Distributed Version Control Systems (DVCS)</h3>
<p>Distributed Version Control Systems operate differently. Clients (developers) don't just check out the latest snapshot of the files; they mirror the <em>entire repository</em>, including its full history. This means every developer's local machine has a complete copy of the project. When a developer commits changes, those changes are first recorded in their <em>local</em> repository. To share changes with others, developers "push" their local changes to a shared remote repository (often hosted on platforms like GitHub or GitLab), and "pull" changes from the remote repository to get updates from others.</p>
<p><strong>Examples:</strong> Git, Mercurial.</p>
<p><strong>Real-world Example:</strong> Think of a writing team collaborating on a novel. With a DVCS like Git, each writer has a full copy of the novel on their computer, including all previous drafts. They can work offline, make changes, and save them locally. When they connect to the internet, they can synchronize their local copy with the main shared copy, merging their contributions with others. If the main shared copy becomes unavailable, each writer still has their complete copy and can continue working.</p>
<p><strong>Hypothetical Scenario:</strong> The "Acme Webshop" team, having embraced modern practices, now uses Git. A developer working on the payment gateway integration can clone the entire "Acme Webshop" repository to their local machine. They can make hundreds of commits locally for testing and iterative development without affecting the central shared repository. Only when their feature is complete and stable do they push their changes to the central repository for review and integration. If the central Git server experiences an outage, developers can still work on their local copies and push changes once the server is restored.</p>
<h2>Git Essentials: Basic Concepts and Workflow</h2>
<p>Git is the most widely adopted DVCS. Understanding its fundamental concepts is crucial for any modern development workflow.</p>
<h3>Repository (Repo)</h3>
<p>A repository is a directory containing all the project files, along with the complete history of changes, branches, and metadata managed by Git. Repositories can be local (on your machine) or remote (on a server like GitHub).</p>
<h3>Commit</h3>
<p>A commit represents a snapshot of your project at a specific point in time. Each commit has a unique identifier (a SHA-1 hash), an author, a commit message explaining the changes, and a timestamp. Commits are the building blocks of a project's history in Git.</p>
<h3>Branch</h3>
<p>A branch is essentially an independent line of development. When you create a branch, you're creating a new path where you can make changes without affecting the main (often called <code>main</code> or <code>master</code>) branch. This allows multiple developers to work on different features or bug fixes concurrently without stepping on each other's toes.</p>
<h3>Head</h3>
<p><code>HEAD</code> is a pointer to the tip of the current branch. It always refers to the latest commit on the branch you are currently working on. When you switch branches, <code>HEAD</code> moves to point to the latest commit of the new branch.</p>
<h3>The Staging Area (Index)</h3>
<p>Git introduces an intermediate step between your working directory and your repository, called the staging area (or index). Before you commit changes, you explicitly add files to the staging area. This allows you to group related changes into a single commit, rather than committing every change in your working directory.</p>
<h2>Basic Git Workflow</h2>
<p>The typical Git workflow involves a few fundamental steps:</p>
<ol>
<li>
<p><strong>Initialize a Repository / Clone an Existing One:</strong></p>
<ul>
<li>To start a new project with Git: <code>git init</code></li>
<li>To get a copy of an existing project from a remote server: <code>git clone [repository_url]</code></li>
</ul>
</li>
<li>
<p><strong>Make Changes to Files:</strong> Modify existing files or add new ones in your working directory.</p>
</li>
<li>
<p><strong>Stage Changes:</strong> Use <code>git add</code> to move modified or new files from your working directory to the staging area. This prepares them for the next commit.</p>
<ul>
<li><code>git add &lt;filename&gt;</code>: Stages a specific file.</li>
<li><code>git add .</code>: Stages all changes in the current directory and its subdirectories.</li>
</ul>
</li>
<li>
<p><strong>Commit Changes:</strong> Use <code>git commit</code> to record the staged changes into your local repository. A commit message is essential for describing the changes made.</p>
<ul>
<li><code>git commit -m "Your descriptive commit message"</code></li>
</ul>
</li>
<li>
<p><strong>Push Changes (for remote repositories):</strong> If you are working with a remote repository, use <code>git push</code> to upload your local commits to the remote server.</p>
<ul>
<li><code>git push origin &lt;branch_name&gt;</code>: Pushes changes to the remote named <code>origin</code> on the specified branch.</li>
</ul>
</li>
<li>
<p><strong>Pull Changes (for remote repositories):</strong> Use <code>git pull</code> to fetch changes from the remote repository and merge them into your current local branch.</p>
<ul>
<li><code>git pull origin &lt;branch_name&gt;</code>: Fetches and merges changes from the remote named <code>origin</code> on the specified branch.</li>
</ul>
</li>
</ol>
<h2>Practical Examples and Demonstrations</h2>
<p>Let's walk through a practical scenario for the "Acme Webshop" project. Imagine you're a developer tasked with adding a <code>README.md</code> file to the webshop's repository and making a small update to an existing file.</p>
<h3>Initializing a New Git Repository</h3>
<p>First, create a new directory for our project and initialize a Git repository within it.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Create a new directory for the Acme Webshop project</span></span>
<span class="line"><span style="color:#6F42C1">mkdir</span><span style="color:#032F62"> acme-webshop</span></span>
<span class="line"><span style="color:#005CC5">cd</span><span style="color:#032F62"> acme-webshop</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Initialize a new Git repository in the current directory</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> init</span></span></code></pre></div></div></div>
<p>The <code>git init</code> command creates a hidden <code>.git</code> directory, which is where Git stores all the history and metadata for your project.</p>
<h3>Creating and Staging a New File</h3>
<p>Now, let's create a <code>README.md</code> file for the project.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Create a README.md file</span></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "# Acme Webshop"</span><span style="color:#D73A49"> &gt;</span><span style="color:#032F62"> README.md</span></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> ""</span><span style="color:#D73A49"> &gt;&gt;</span><span style="color:#032F62"> README.md</span></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "This repository contains the source code for the Acme Webshop application."</span><span style="color:#D73A49"> &gt;&gt;</span><span style="color:#032F62"> README.md</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Check the status of your Git repository</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> status</span></span></code></pre></div></div></div>
<p>The <code>git status</code> command will show <code>README.md</code> as an "untracked file." This means Git sees the file but isn't yet tracking its changes. To tell Git to start tracking it, we add it to the staging area.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Add README.md to the staging area</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> add</span><span style="color:#032F62"> README.md</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Check status again</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> status</span></span></code></pre></div></div></div>
<p>Now, <code>git status</code> will show <code>README.md</code> under "Changes to be committed," indicating it's staged and ready for the next commit.</p>
<h3>Making the First Commit</h3>
<p>With the <code>README.md</code> file staged, we can now commit it to our local repository.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Commit the staged changes with a descriptive message</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> commit</span><span style="color:#005CC5"> -m</span><span style="color:#032F62"> "Initial commit: Add README.md file"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Check status after commit</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> status</span></span></code></pre></div></div></div>
<p>After the commit, <code>git status</code> will report "nothing to commit, working tree clean." This means all changes in your working directory have been committed.</p>
<h3>Modifying an Existing File and Committing</h3>
<p>Let's simulate having an existing file, say <code>index.html</code>, and then modify it.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Create a dummy index.html file</span></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "&lt;!DOCTYPE html&gt;"</span><span style="color:#D73A49"> &gt;</span><span style="color:#032F62"> index.html</span></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "&lt;html&gt;&lt;head&gt;&lt;title&gt;Acme Webshop&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;Welcome to Acme!&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;"</span><span style="color:#D73A49"> &gt;&gt;</span><span style="color:#032F62"> index.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Add and commit index.html</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> add</span><span style="color:#032F62"> index.html</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> commit</span><span style="color:#005CC5"> -m</span><span style="color:#032F62"> "Add basic index.html page"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Now, modify index.html</span></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "    &lt;p&gt;Your one-stop shop for everything you need!&lt;/p&gt;"</span><span style="color:#D73A49"> &gt;&gt;</span><span style="color:#032F62"> index.html</span></span></code></pre></div></div></div>
<p>Now, check the status:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> status</span></span></code></pre></div></div></div>
<p>Git will show <code>index.html</code> as "modified" and "not staged for commit." We need to stage and commit this change.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Stage the modified index.html</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> add</span><span style="color:#032F62"> index.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Commit the changes</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> commit</span><span style="color:#005CC5"> -m</span><span style="color:#032F62"> "Update index.html with welcome message"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># View the commit history</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> log</span><span style="color:#005CC5"> --oneline</span></span></code></pre></div></div></div>
<p>The <code>git log --oneline</code> command shows a concise history of your commits, including their SHA-1 hashes and commit messages.</p>
<h2>Exercises and Practice Activities</h2>
<p>To solidify your understanding of basic Git operations, complete the following exercises:</p>
<ol>
<li>
<p><strong>Initialize a Project and Create Files:</strong></p>
<ul>
<li>Create a new directory named <code>my-acme-feature</code>.</li>
<li>Navigate into <code>my-acme-feature</code>.</li>
<li>Initialize a new Git repository within <code>my-acme-feature</code>.</li>
<li>Create a file named <code>products.js</code> with some dummy JavaScript code (e.g., <code>const products = [];</code>).</li>
<li>Add <code>products.js</code> to the staging area and commit it with the message "Initial products file."</li>
<li>Create another file named <code>styles.css</code> with some basic CSS (e.g., <code>body { font-family: sans-serif; }</code>).</li>
<li>Add <code>styles.css</code> to the staging area and commit it with the message "Add basic styles."</li>
</ul>
</li>
<li>
<p><strong>Modify and Commit Existing Files:</strong></p>
<ul>
<li>Modify <code>products.js</code> to add an example product: <code>const products = [{ id: 1, name: 'Laptop' }];</code>.</li>
<li>Modify <code>styles.css</code> to add a new rule: <code>h1 { color: #333; }</code>.</li>
<li>Use <code>git status</code> to see the modified files.</li>
<li>Stage <em>only</em> the changes in <code>products.js</code> and commit it with the message "Add example product."</li>
<li>Verify with <code>git status</code> that <code>styles.css</code> is still modified but not committed.</li>
<li>Stage and commit the changes in <code>styles.css</code> with the message "Improve heading color."</li>
</ul>
</li>
<li>
<p><strong>View History:</strong></p>
<ul>
<li>Use <code>git log --oneline</code> to view the commit history for <code>my-acme-feature</code>. How many commits are there? What are their messages?</li>
<li>Try <code>git log</code> (without <code>--oneline</code>) to see more detailed information about each commit.</li>
</ul>
</li>
</ol>
<h2>Real-World Application</h2>
<p>Git's role extends beyond individual development. In a team setting, particularly for continuous integration and deployment (CI/CD), Git serves as the single source of truth for the application's code.</p>
<p><strong>Example 1: Feature Development for Acme Webshop</strong>
A team member at Acme Webshop is assigned to develop a new "customer review" feature. They would typically:</p>
<ol>
<li><strong>Clone</strong> the main Acme Webshop repository to their local machine.</li>
<li><strong>Create a new branch</strong> specifically for the customer review feature (e.g., <code>git checkout -b feature/customer-reviews</code>).</li>
<li>Work on their feature, making frequent <strong>commits</strong> to their local branch as they progress.</li>
<li>Once the feature is complete and tested locally, they <strong>push</strong> their feature branch to a remote Git hosting service (like GitHub or GitLab).</li>
<li>They then initiate a "pull request" (a mechanism to propose changes and ask others to review them) for their feature branch to be <strong>merged</strong> into the main development branch. This ensures code quality and team collaboration.</li>
</ol>
<p><strong>Example 2: Bug Fix for a Production Issue</strong>
Suppose the Acme Webshop has a critical bug in production related to the checkout process.</p>
<ol>
<li>An urgent <code>hotfix</code> branch would be created from the production-ready code.</li>
<li>A developer would clone the repository, check out this <code>hotfix</code> branch, and quickly implement the fix.</li>
<li>The fix would be committed locally.</li>
<li>The <code>hotfix</code> branch would then be pushed to the remote repository and potentially merged directly into the main and production branches to deploy the fix rapidly. This prevents the bug from impacting customers further.</li>
</ol>
  
</div>

<div id="chapter-1.5">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Setting Up Your Local Development Environment for DevOps Practice</h1><p>Setting up a local development environment is a foundational step for effective DevOps practice. This involves configuring your workstation with the necessary tools to develop, test, and interact with various components of a CI/CD pipeline before deploying them. A well-prepared local environment mirrors aspects of the production or staging environments, allowing for early detection of issues and faster feedback cycles.</p>
<h2>Core Tooling for a DevOps Environment</h2>
<p>A typical local DevOps environment requires a set of fundamental tools that support various stages of the software development lifecycle, from code creation to local testing and interaction with remote services.</p>
<h3>Operating System and Command Line Interface (CLI)</h3>
<p>The choice of operating system (OS) often dictates the available tools and their installation methods. Popular choices include macOS, Windows (especially with Windows Subsystem for Linux - WSL), and various Linux distributions. A robust command-line interface is crucial for interacting with development tools, version control systems, and cloud providers.</p>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>macOS:</strong> Built-in Terminal application, often enhanced with tools like <code>iTerm2</code>. Package management is handled by <code>Homebrew</code>.</li>
<li><strong>Windows:</strong>
<ul>
<li><strong>WSL 2 (Windows Subsystem for Linux 2):</strong> Provides a full Linux environment directly on Windows, offering access to Linux command-line tools and utilities. This is the recommended approach for modern DevOps practices on Windows.</li>
<li><strong>PowerShell / Command Prompt:</strong> Native Windows command-line environments.</li>
<li><strong>Git Bash:</strong> A Git-specific shell that provides a Unix-like command-line experience on Windows.</li>
</ul>
</li>
<li><strong>Linux (e.g., Ubuntu, Fedora):</strong> Standard <code>bash</code> or <code>zsh</code> shells. Package management through <code>apt</code> (Debian/Ubuntu) or <code>dnf</code>/<code>yum</code> (Fedora/RHEL).</li>
</ul>
<p><strong>Hypothetical Scenario:</strong>
A developer at Acme Webshop, working on a new payment gateway integration, uses a macOS machine. They rely on <code>iTerm2</code> for multiple terminal tabs and <code>Homebrew</code> to install <code>git</code>, <code>docker</code>, and <code>kubectl</code>. When developing, they use command-line utilities to manage Git repositories, build Docker images locally, and interact with a local Kubernetes cluster for testing.</p>
<h3>Version Control System (Git)</h3>
<p>Git is the industry standard for version control. It enables tracking changes to code, collaborating with teams, and managing different versions of a project.</p>
<p><strong>Concepts:</strong></p>
<ul>
<li><strong>Repository:</strong> The core of Git, storing all files and their revision history.</li>
<li><strong>Commit:</strong> A snapshot of changes at a specific point in time.</li>
<li><strong>Branch:</strong> A parallel line of development that can be merged back into the main codebase.</li>
<li><strong>Remote:</strong> A shared repository, typically hosted on platforms like GitHub, GitLab, or Bitbucket.</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Installing Git:</strong>
<ul>
<li><strong>macOS (Homebrew):</strong> <code>brew install git</code></li>
<li><strong>Windows (WSL/Ubuntu):</strong> <code>sudo apt update &amp;&amp; sudo apt install git</code></li>
<li><strong>Windows (Git for Windows installer):</strong> Download and run the installer from git-scm.com.</li>
</ul>
</li>
<li><strong>Basic Git Commands:</strong>
<ul>
<li><code>git clone &lt;repository-url&gt;</code>: Copies a remote repository to your local machine.</li>
<li><code>git add .</code>: Stages all changes for the next commit.</li>
<li><code>git commit -m "Descriptive message"</code>: Records staged changes to the repository.</li>
<li><code>git push origin &lt;branch-name&gt;</code>: Uploads local commits to a remote repository.</li>
<li><code>git pull origin &lt;branch-name&gt;</code>: Downloads changes from a remote repository.</li>
</ul>
</li>
</ul>
<h3>Integrated Development Environment (IDE) / Code Editor</h3>
<p>An IDE or code editor provides a rich environment for writing, debugging, and managing code. Modern editors often have extensive plugin ecosystems to support various languages and development workflows.</p>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Visual Studio Code (VS Code):</strong> A lightweight yet powerful cross-platform code editor with extensive language support and a vast marketplace of extensions for Git integration, Docker, Kubernetes, various programming languages (e.g., Python, Node.js, Java), and more.</li>
<li><strong>IntelliJ IDEA (Ultimate Edition):</strong> A comprehensive Java IDE that also supports many other languages through plugins. It offers robust features for enterprise-level development, including advanced refactoring, debugging, and integration with build tools.</li>
<li><strong>PyCharm:</strong> A dedicated Python IDE from JetBrains, providing advanced features for Python development, web frameworks, and data science.</li>
<li><strong>Vim/Neovim or Emacs:</strong> Highly configurable text editors popular among experienced developers for their efficiency and extensibility, often used for command-line-based development.</li>
</ul>
<h2>Programming Language Runtimes and Package Managers</h2>
<p>Depending on the applications you'll be working with, you'll need the respective programming language runtimes and their associated package managers installed locally.</p>
<h3>Node.js and npm/yarn</h3>
<p>For JavaScript-based front-end and back-end applications.</p>
<p><strong>Concepts:</strong></p>
<ul>
<li><strong>Node.js Runtime:</strong> Executes JavaScript code outside a web browser.</li>
<li><strong>npm (Node Package Manager) / yarn:</strong> Tools for managing project dependencies (libraries and frameworks).</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Installing Node.js (via <code>nvm</code> - Node Version Manager):</strong> <code>nvm install --lts</code> (installs the latest LTS version). <code>nvm</code> is preferred as it allows switching between Node.js versions.</li>
<li><strong>Acme Webshop Scenario:</strong> The Acme Webshop's front-end is built with React. Developers use <code>npm</code> to install dependencies like <code>react</code>, <code>react-router-dom</code>, and build tools.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Navigate to your front-end project directory</span></span>
<span class="line"><span style="color:#005CC5">cd</span><span style="color:#032F62"> acme-webshop/frontend</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Install all dependencies listed in package.json</span></span>
<span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Start the development server</span></span>
<span class="line"><span style="color:#6F42C1">npm</span><span style="color:#032F62"> start</span></span></code></pre></div></div></div>
</li>
</ul>
<h3>Python and pip/conda</h3>
<p>For Python-based applications, scripts, and automation.</p>
<p><strong>Concepts:</strong></p>
<ul>
<li><strong>Python Interpreter:</strong> Executes Python code.</li>
<li><strong>pip (Pip Installs Packages):</strong> The standard package installer for Python.</li>
<li><strong>conda:</strong> A cross-platform package and environment manager, often used for data science and complex dependency management.</li>
<li><strong>Virtual Environments:</strong> Isolated Python environments to manage project-specific dependencies without conflicts.</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Installing Python (via <code>pyenv</code> or OS package manager):</strong> <code>pyenv install 3.9.12</code> (using <code>pyenv</code> for version management).</li>
<li><strong>Creating and Activating a Virtual Environment:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Create a new virtual environment named 'acme-env'</span></span>
<span class="line"><span style="color:#6F42C1">python3</span><span style="color:#005CC5"> -m</span><span style="color:#032F62"> venv</span><span style="color:#032F62"> acme-env</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Activate the virtual environment (Linux/macOS)</span></span>
<span class="line"><span style="color:#005CC5">source</span><span style="color:#032F62"> acme-env/bin/activate</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Activate the virtual environment (Windows PowerShell)</span></span>
<span class="line"><span style="color:#005CC5">.</span><span style="color:#24292E">\</span><span style="color:#032F62">acme-env</span><span style="color:#24292E">\</span><span style="color:#032F62">Scripts</span><span style="color:#24292E">\</span><span style="color:#032F62">Activate.ps1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Install dependencies</span></span>
<span class="line"><span style="color:#6F42C1">pip</span><span style="color:#032F62"> install</span><span style="color:#032F62"> Flask</span><span style="color:#032F62"> requests</span><span style="color:#032F62"> gunicorn</span></span></code></pre></div></div></div>
</li>
<li><strong>Acme Webshop Scenario:</strong> The Acme Webshop's API gateway uses Flask (Python). Developers create a virtual environment, install Flask and other required libraries, and run the API locally for testing.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">python</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># acme-api/app.py</span></span>
<span class="line"><span style="color:#D73A49">from</span><span style="color:#24292E"> flask </span><span style="color:#D73A49">import</span><span style="color:#24292E"> Flask, jsonify</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">app </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Flask(</span><span style="color:#005CC5">__name__</span><span style="color:#24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">@app.route</span><span style="color:#24292E">(</span><span style="color:#032F62">'/'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> hello_world</span><span style="color:#24292E">():</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> jsonify(</span><span style="color:#E36209">message</span><span style="color:#D73A49">=</span><span style="color:#032F62">"Welcome to Acme Webshop API!"</span><span style="color:#24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">if</span><span style="color:#005CC5"> __name__</span><span style="color:#D73A49"> ==</span><span style="color:#032F62"> '__main__'</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    app.run(</span><span style="color:#E36209">debug</span><span style="color:#D73A49">=</span><span style="color:#005CC5">True</span><span style="color:#24292E">)</span></span></code></pre></div></div></div>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># From the acme-api directory after activating venv</span></span>
<span class="line"><span style="color:#6F42C1">python</span><span style="color:#032F62"> app.py</span></span></code></pre></div></div></div>
</li>
</ul>
<h3>Java Development Kit (JDK) and Maven/Gradle</h3>
<p>For Java-based enterprise applications.</p>
<p><strong>Concepts:</strong></p>
<ul>
<li><strong>JDK (Java Development Kit):</strong> Provides the tools necessary to develop Java applications, including the Java Runtime Environment (JRE) and the Java compiler (<code>javac</code>).</li>
<li><strong>Maven / Gradle:</strong> Build automation tools for Java projects, managing dependencies, compiling code, running tests, and packaging applications.</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Installing JDK (via <code>sdkman</code> - SDK Manager):</strong> <code>sdk install java 17.0.7-tem</code> (installs a specific version of Java). <code>sdkman</code> simplifies managing multiple SDKs.</li>
<li><strong>Acme Webshop Scenario:</strong> The main order processing service for Acme Webshop is a Spring Boot application built with Maven. Developers install the JDK, then use Maven to build and run the application locally.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Navigate to the Java service directory</span></span>
<span class="line"><span style="color:#005CC5">cd</span><span style="color:#032F62"> acme-webshop/order-service</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Build the project, resolve dependencies, and run tests</span></span>
<span class="line"><span style="color:#6F42C1">mvn</span><span style="color:#032F62"> clean</span><span style="color:#032F62"> install</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Run the Spring Boot application locally</span></span>
<span class="line"><span style="color:#6F42C1">mvn</span><span style="color:#032F62"> spring-boot:run</span></span></code></pre></div></div></div>
</li>
</ul>
<h2>Containerization Tools (Docker Desktop)</h2>
<p>Containerization has become a cornerstone of modern DevOps, providing consistent environments across development, testing, and production. Docker Desktop is the most common tool for local container development.</p>
<p><strong>Concepts:</strong></p>
<ul>
<li><strong>Container:</strong> A lightweight, standalone, executable package of software that includes everything needed to run an application: code, runtime, system tools, system libraries, and settings.</li>
<li><strong>Image:</strong> A read-only template with instructions for creating a Docker container.</li>
<li><strong>Dockerfile:</strong> A text file that contains all the commands a user could call on the command line to assemble an image.</li>
<li><strong>Docker Engine:</strong> The core component that runs and manages containers.</li>
<li><strong>Docker Desktop:</strong> An application for macOS, Windows, and Linux that includes Docker Engine, Docker CLI client, Docker Compose, Kubernetes, and other tools.</li>
</ul>
<p><strong>Examples:</strong></p>
<ul>
<li><strong>Installing Docker Desktop:</strong> Download and install from the official Docker website (docker.com/products/docker-desktop). This provides the Docker Engine, CLI, and integration with your OS.</li>
<li><strong>Building a Docker Image for Acme Webshop:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">dockerfile</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># acme-webshop/frontend/Dockerfile</span></span>
<span class="line"><span style="color:#D73A49">FROM</span><span style="color:#24292E"> node:18-alpine # Base image with Node.js</span></span>
<span class="line"><span style="color:#D73A49">WORKDIR</span><span style="color:#24292E"> /app # Set working directory inside the container</span></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> package*.json ./ # Copy package.json and package-lock.json</span></span>
<span class="line"><span style="color:#D73A49">RUN</span><span style="color:#24292E"> npm install # Install dependencies</span></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> . . # Copy the rest of the application code</span></span>
<span class="line"><span style="color:#D73A49">CMD</span><span style="color:#24292E"> [</span><span style="color:#032F62">"npm"</span><span style="color:#24292E">, </span><span style="color:#032F62">"start"</span><span style="color:#24292E">] # Command to run the application</span></span>
<span class="line"><span style="color:#D73A49">EXPOSE</span><span style="color:#24292E"> 3000 # Expose port 3000</span></span></code></pre></div></div></div>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># From the acme-webshop/frontend directory</span></span>
<span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> build</span><span style="color:#005CC5"> -t</span><span style="color:#032F62"> acme-frontend:1.0</span><span style="color:#032F62"> .</span><span style="color:#6A737D"> # Build the image</span></span>
<span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 3000:3000</span><span style="color:#032F62"> acme-frontend:1.0</span><span style="color:#6A737D"> # Run the container, mapping port 3000</span></span></code></pre></div></div></div>
</li>
<li><strong>Running a Local Database Container:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> --name</span><span style="color:#032F62"> acme-db</span><span style="color:#005CC5"> -e</span><span style="color:#032F62"> POSTGRES_PASSWORD=mysecretpassword</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 5432:5432</span><span style="color:#005CC5"> -d</span><span style="color:#032F62"> postgres:13</span><span style="color:#6A737D"> # Run PostgreSQL</span></span></code></pre></div></div></div>
This command starts a PostgreSQL database in a container, sets a password, maps the container's port 5432 to the host's port 5432, and runs it in detached mode. This allows developers to have a clean, isolated database instance for local testing without installing PostgreSQL directly on their machine.</li>
</ul>
<h2>Exercises and Practice Activities</h2>
<p>These exercises will help you set up and familiarize yourself with the essential tools discussed.</p>
<h3>Exercise 1: Setting up Git and your First Repository</h3>
<ol>
<li><strong>Install Git:</strong> Follow the instructions for your operating system to install Git.</li>
<li><strong>Configure Git:</strong> Set your global user name and email.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> config</span><span style="color:#005CC5"> --global</span><span style="color:#032F62"> user.name</span><span style="color:#032F62"> "Your Name"</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> config</span><span style="color:#005CC5"> --global</span><span style="color:#032F62"> user.email</span><span style="color:#032F62"> "your.email@example.com"</span></span></code></pre></div></div></div>
</li>
<li><strong>Create a Local Repository:</strong>
<ul>
<li>Create a new directory named <code>my-devops-project</code>.</li>
<li>Navigate into <code>my-devops-project</code>.</li>
<li>Initialize a new Git repository: <code>git init</code></li>
</ul>
</li>
<li><strong>Add a File and Commit:</strong>
<ul>
<li>Create a file named <code>README.md</code> inside <code>my-devops-project</code> with some content (e.g., "My first DevOps project repository.").</li>
<li>Add the file to the staging area: <code>git add README.md</code></li>
<li>Commit the changes: <code>git commit -m "Initial commit with README"</code></li>
</ul>
</li>
<li><strong>View History:</strong> Check the commit history: <code>git log</code></li>
</ol>
<h3>Exercise 2: Installing and Using a Programming Language Runtime</h3>
<p>Choose one of the following based on your interest:</p>
<p><strong>Option A: Node.js and npm</strong></p>
<ol>
<li><strong>Install <code>nvm</code>:</strong> Follow instructions at <code>https://github.com/nvm-sh/nvm</code> to install Node Version Manager.</li>
<li><strong>Install Node.js LTS:</strong> Use <code>nvm install --lts</code> and <code>nvm use --lts</code> to install and activate the latest Long Term Support version.</li>
<li><strong>Create a Simple Node.js Project:</strong>
<ul>
<li>Create a directory <code>my-node-app</code>.</li>
<li>Navigate into it and initialize a new Node.js project: <code>npm init -y</code></li>
<li>Create a file <code>app.js</code> with the content:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">javascript</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// app.js</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> http</span><span style="color:#D73A49"> =</span><span style="color:#6F42C1"> require</span><span style="color:#24292E">(</span><span style="color:#032F62">'http'</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> hostname</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> '127.0.0.1'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> port</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> 3000</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">const</span><span style="color:#005CC5"> server</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> http.</span><span style="color:#6F42C1">createServer</span><span style="color:#24292E">((</span><span style="color:#E36209">req</span><span style="color:#24292E">, </span><span style="color:#E36209">res</span><span style="color:#24292E">) </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  res.statusCode </span><span style="color:#D73A49">=</span><span style="color:#005CC5"> 200</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">  res.</span><span style="color:#6F42C1">setHeader</span><span style="color:#24292E">(</span><span style="color:#032F62">'Content-Type'</span><span style="color:#24292E">, </span><span style="color:#032F62">'text/plain'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">  res.</span><span style="color:#6F42C1">end</span><span style="color:#24292E">(</span><span style="color:#032F62">'Hello from my Node.js app!</span><span style="color:#005CC5">\n</span><span style="color:#032F62">'</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">server.</span><span style="color:#6F42C1">listen</span><span style="color:#24292E">(port, hostname, () </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  console.</span><span style="color:#6F42C1">log</span><span style="color:#24292E">(</span><span style="color:#032F62">`Server running at http://${</span><span style="color:#24292E">hostname</span><span style="color:#032F62">}:${</span><span style="color:#24292E">port</span><span style="color:#032F62">}/`</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">});</span></span></code></pre></div></div></div>
</li>
<li>Run the application: <code>node app.js</code></li>
<li>Verify by opening <code>http://localhost:3000</code> in your browser.</li>
</ul>
</li>
</ol>
<p><strong>Option B: Python and pip</strong></p>
<ol>
<li><strong>Install Python:</strong> If not already installed, use your OS package manager (e.g., <code>sudo apt install python3 python3-venv</code> on Ubuntu) or <code>pyenv</code>.</li>
<li><strong>Create and Activate a Virtual Environment:</strong>
<ul>
<li>Create a directory <code>my-python-app</code>.</li>
<li>Navigate into it.</li>
<li>Create a virtual environment: <code>python3 -m venv venv</code></li>
<li>Activate it: <code>source venv/bin/activate</code> (Linux/macOS) or <code>.\venv\Scripts\Activate.ps1</code> (Windows PowerShell).</li>
</ul>
</li>
<li><strong>Install a Package and Create a Simple Script:</strong>
<ul>
<li>Install the <code>requests</code> library: <code>pip install requests</code></li>
<li>Create a file <code>main.py</code> with the content:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">python</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># main.py</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> requests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> fetch_example</span><span style="color:#24292E">():</span></span>
<span class="line"><span style="color:#D73A49">    try</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        response </span><span style="color:#D73A49">=</span><span style="color:#24292E"> requests.get(</span><span style="color:#032F62">"http://httpbin.org/get"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">        response.raise_for_status() </span><span style="color:#6A737D"># Raise an exception for HTTP errors</span></span>
<span class="line"><span style="color:#005CC5">        print</span><span style="color:#24292E">(</span><span style="color:#032F62">"Successfully fetched data:"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#005CC5">        print</span><span style="color:#24292E">(response.json())</span></span>
<span class="line"><span style="color:#D73A49">    except</span><span style="color:#24292E"> requests.exceptions.RequestException </span><span style="color:#D73A49">as</span><span style="color:#24292E"> e:</span></span>
<span class="line"><span style="color:#005CC5">        print</span><span style="color:#24292E">(</span><span style="color:#D73A49">f</span><span style="color:#032F62">"Error fetching data: </span><span style="color:#005CC5">{</span><span style="color:#24292E">e</span><span style="color:#005CC5">}</span><span style="color:#032F62">"</span><span style="color:#24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">if</span><span style="color:#005CC5"> __name__</span><span style="color:#D73A49"> ==</span><span style="color:#032F62"> "__main__"</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    fetch_example()</span></span></code></pre></div></div></div>
</li>
<li>Run the script: <code>python main.py</code></li>
<li>Deactivate the virtual environment when done: <code>deactivate</code></li>
</ul>
</li>
</ol>
<h3>Exercise 3: Installing Docker Desktop and Running a Container</h3>
<ol>
<li><strong>Install Docker Desktop:</strong> Download and install Docker Desktop for your operating system from <code>docker.com/products/docker-desktop</code>. Ensure it is running.</li>
<li><strong>Verify Docker Installation:</strong> Open your terminal and run <code>docker --version</code> and <code>docker ps</code>. You should see version information and an empty list of running containers, respectively.</li>
<li><strong>Run a Basic Container:</strong>
<ul>
<li>Run a simple Nginx web server in a container:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> --name</span><span style="color:#032F62"> my-nginx</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 8080:80</span><span style="color:#005CC5"> -d</span><span style="color:#032F62"> nginx:latest</span></span></code></pre></div></div></div>
This command downloads the latest Nginx image, runs it in a container named <code>my-nginx</code>, maps port 8080 on your host to port 80 in the container, and runs it in detached mode.</li>
<li>Open <code>http://localhost:8080</code> in your browser to verify Nginx is running.</li>
<li>List running containers: <code>docker ps</code></li>
<li>Stop and remove the container:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> stop</span><span style="color:#032F62"> my-nginx</span></span>
<span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> rm</span><span style="color:#032F62"> my-nginx</span></span></code></pre></div></div></div>
</li>
</ul>
</li>
</ol>
  
</div>

</div>

<div id="chapter-2">

<div id="chapter-2.1">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Source Code Management with Git and Branching Strategies</h1><p>Source Code Management, specifically with Git, is a cornerstone of modern software development and Continuous Integration. It provides the foundation for collaboration, version control, and the ability to track changes throughout the software lifecycle. Effective Git usage, combined with well-defined branching strategies, ensures that development teams can work concurrently on different features, bug fixes, and releases without interfering with each other's progress, while maintaining a stable codebase. This distributed version control system allows for offline work, efficient merging, and a comprehensive history of every change made to the project.</p>
<h2>Fundamental Git Concepts for CI</h2>
<p>Git is a distributed version control system that enables multiple developers to work on the same codebase simultaneously. Understanding its core components is essential for establishing a robust CI pipeline.</p>
<h3>Repository (Repo)</h3>
<p>A Git repository is a digital storage location for your project, containing all the files and the entire history of changes. Each developer has a complete local copy of the repository, including its history. This distributed nature is a key differentiator from centralized version control systems.</p>
<p><strong>Example 1: Initializing a Local Repository</strong>
To start tracking changes for a new project, you initialize a Git repository in your project directory.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#005CC5">cd</span><span style="color:#032F62"> my-acme-webshop-project</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> init</span></span></code></pre></div></div></div>
<p>This command creates a hidden <code>.git</code> directory, which stores all the necessary objects and metadata for Git to manage the project's history.</p>
<p><strong>Example 2: Cloning a Remote Repository</strong>
When joining an existing project, you typically clone the remote repository.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> clone</span><span style="color:#032F62"> https://github.com/acme-corp/webshop.git</span></span></code></pre></div></div></div>
<p>This command downloads a complete copy of the remote <code>webshop</code> repository, including all its branches and commit history, to your local machine.</p>
<h3>Commit</h3>
<p>A commit is a snapshot of your repository at a specific point in time. It represents a set of changes saved to the repository's history, typically associated with a specific logical change (e.g., adding a feature, fixing a bug). Each commit has a unique SHA-1 hash, a commit message, an author, and a timestamp.</p>
<p><strong>Example 1: Making a Simple Commit</strong>
After modifying files, you stage them and then commit.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> add</span><span style="color:#032F62"> index.html</span><span style="color:#032F62"> style.css</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> commit</span><span style="color:#005CC5"> -m</span><span style="color:#032F62"> "Add basic layout for homepage"</span></span></code></pre></div></div></div>
<p>The <code>git add</code> command stages the changes, marking them for inclusion in the next commit. The <code>git commit</code> command then creates the commit with the provided message.</p>
<p><strong>Example 2: Viewing Commit History</strong>
To understand the evolution of the project, you can view the commit history.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> log</span><span style="color:#005CC5"> --oneline</span></span></code></pre></div></div></div>
<p>This command displays a concise view of the commit history, showing each commit's hash and message.</p>
<h3>Branch</h3>
<p>A branch in Git is essentially an independent line of development. It allows developers to diverge from the main codebase to work on new features or bug fixes without affecting the stability of the main project. When the work on a branch is complete and stable, it can be merged back into the main branch.</p>
<p><strong>Example 1: Creating and Switching Branches</strong>
To start working on a new feature for the Acme Webshop, you create a new branch.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> branch</span><span style="color:#032F62"> feature/user-profile</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> checkout</span><span style="color:#032F62"> feature/user-profile</span></span></code></pre></div></div></div>
<p>Alternatively, you can create and switch in one command:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> checkout</span><span style="color:#005CC5"> -b</span><span style="color:#032F62"> feature/user-profile</span></span></code></pre></div></div></div>
<p>This creates a new branch named <code>feature/user-profile</code> and then switches your working directory to reflect the state of that branch.</p>
<p><strong>Example 2: Listing Branches</strong>
To see all local branches in your repository:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> branch</span></span></code></pre></div></div></div>
<p>This command lists all local branches, with an asterisk indicating the currently active branch.</p>
<h3>Merge</h3>
<p>Merging is the process of integrating changes from one branch into another. Git attempts to combine the changes automatically. If changes in the same part of a file conflict, a merge conflict occurs, requiring manual resolution.</p>
<p><strong>Example 1: Merging a Feature Branch</strong>
After completing the <code>feature/user-profile</code>, you merge it into the <code>main</code> branch.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> checkout</span><span style="color:#032F62"> main</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> merge</span><span style="color:#032F62"> feature/user-profile</span></span></code></pre></div></div></div>
<p>This command integrates all commits from <code>feature/user-profile</code> into <code>main</code>. If no conflicts occur, Git performs a fast-forward merge or a three-way merge, depending on the history.</p>
<p><strong>Example 2: Resolving a Merge Conflict</strong>
If <code>main</code> and <code>feature/user-profile</code> both modified the same line in <code>index.html</code>, a conflict arises. Git marks the conflicted areas in the file.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">html</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#B31D28;font-style:italic">&lt;&lt;&lt;&lt;&lt;&lt;&lt;</span><span style="color:#24292E"> HEAD</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">p</span><span style="color:#24292E">&gt;Welcome to our awesome webshop!&lt;/</span><span style="color:#22863A">p</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">=======</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">p</span><span style="color:#24292E">&gt;Welcome, [User Name]!&lt;/</span><span style="color:#22863A">p</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&gt;&gt;&gt;&gt;&gt;&gt;&gt; feature/user-profile</span></span></code></pre></div></div></div>
<p>You would manually edit <code>index.html</code> to combine the desired changes, then stage and commit the resolution.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># ... manually edit index.html ...</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> add</span><span style="color:#032F62"> index.html</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> commit</span><span style="color:#005CC5"> -m</span><span style="color:#032F62"> "Resolve merge conflict for user profile feature"</span></span></code></pre></div></div></div>
<h3>Remote Repository</h3>
<p>A remote repository is a version of your project hosted on the internet or a network. It serves as a central point for collaboration, allowing multiple developers to share their changes. Common remote hosting services include GitHub, GitLab, and Bitbucket.</p>
<p><strong>Example 1: Pushing Changes to a Remote</strong>
After committing changes locally, you push them to the remote repository.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> push</span><span style="color:#032F62"> origin</span><span style="color:#032F62"> main</span></span></code></pre></div></div></div>
<p>This command sends your local <code>main</code> branch's commits to the <code>main</code> branch on the <code>origin</code> remote.</p>
<p><strong>Example 2: Pulling Changes from a Remote</strong>
To update your local repository with changes from the remote:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> pull</span><span style="color:#032F62"> origin</span><span style="color:#032F62"> main</span></span></code></pre></div></div></div>
<p>This command fetches changes from the <code>main</code> branch of the <code>origin</code> remote and attempts to merge them into your local <code>main</code> branch.</p>
<h2>Branching Strategies</h2>
<p>Branching strategies provide a structured approach to using branches within a team, defining how branches are created, named, and merged. These strategies are crucial for maintaining code quality, enabling parallel development, and ensuring a stable release cycle within a CI/CD environment.</p>
<h3>GitFlow Branching Strategy</h3>
<p>GitFlow is a widely adopted branching model designed for larger teams and projects with well-defined release cycles. It introduces two primary long-lived branches: <code>master</code> (or <code>main</code>) and <code>develop</code>, and several supporting branches for features, releases, and hotfixes.</p>
<ul>
<li><strong><code>main</code> (or <code>master</code>) Branch</strong>: This branch always represents the production-ready code. Commits to this branch are typically only made from <code>release</code> or <code>hotfix</code> branches, ensuring its stability. Tags are often used here to mark specific releases.</li>
<li><strong><code>develop</code> Branch</strong>: This branch integrates all the completed features for the next release. Feature branches are merged into <code>develop</code>. It's the integration branch for ongoing development.</li>
<li><strong><code>feature</code> Branches</strong>: Created from <code>develop</code> for individual features. Developers work in isolation on these branches and merge them back into <code>develop</code> once the feature is complete and reviewed.
<ul>
<li><strong>Naming Convention</strong>: <code>feature/&lt;feature-name&gt;</code> (e.g., <code>feature/add-checkout-page</code>)</li>
</ul>
</li>
<li><strong><code>release</code> Branches</strong>: Created from <code>develop</code> when a set of features is ready for a new release. These branches are used for final testing, bug fixing, and preparing metadata (version numbers). Once stable, they are merged into both <code>main</code> and <code>develop</code>.
<ul>
<li><strong>Naming Convention</strong>: <code>release/&lt;version&gt;</code> (e.g., <code>release/1.2.0</code>)</li>
</ul>
</li>
<li><strong><code>hotfix</code> Branches</strong>: Created directly from <code>main</code> to address critical bugs in production. Once fixed, they are merged into both <code>main</code> and <code>develop</code>.
<ul>
<li><strong>Naming Convention</strong>: <code>hotfix/&lt;description&gt;</code> (e.g., <code>hotfix/fix-payment-bug</code>)</li>
</ul>
</li>
</ul>
<p><strong>Hypothetical Scenario: Acme Webshop using GitFlow</strong></p>
<ol>
<li><strong>Initial Setup</strong>: The <code>main</code> branch holds the current production webshop code. A <code>develop</code> branch is created from <code>main</code>.</li>
<li><strong>Feature Development</strong>: A developer starts working on a "Product Recommendation Engine". They create a <code>feature/product-recommendation</code> branch from <code>develop</code>. After completing the feature, they merge it back into <code>develop</code>.</li>
<li><strong>Preparing a Release</strong>: When multiple features (e.g., Product Recommendation, Improved Search) are ready, a <code>release/2.0.0</code> branch is created from <code>develop</code>. QA performs testing on this branch. Any bugs found are fixed directly on <code>release/2.0.0</code>.</li>
<li><strong>Releasing</strong>: Once <code>release/2.0.0</code> is stable, it's merged into <code>main</code> (and tagged as <code>v2.0.0</code>) and also merged back into <code>develop</code> to ensure <code>develop</code> has the latest fixes.</li>
<li><strong>Hotfix</strong>: A critical bug is reported in the production <code>main</code> branch (e.g., payment gateway issue). A <code>hotfix/payment-gateway-fix</code> branch is created directly from <code>main</code>. The fix is applied, and then this branch is merged into <code>main</code> (and tagged <code>v2.0.1</code>) and also into <code>develop</code>.</li>
</ol>
<p><strong>Real-world Example: Large Enterprise Software</strong>
Many large enterprise applications with strict release cycles (e.g., monthly, quarterly) use GitFlow. For instance, a company developing an ERP system might use GitFlow to manage concurrent development of new modules, bug fixes, and scheduled major and minor releases, ensuring that the production branch is always stable and easily revertible.</p>
<h3>GitHub Flow Branching Strategy</h3>
<p>GitHub Flow is a simpler, lightweight branching strategy suitable for projects with continuous delivery where deployments happen frequently. It has only one long-lived branch: <code>main</code> (or <code>master</code>). All development happens on short-lived feature branches that are branched directly from <code>main</code> and merged back via Pull Requests.</p>
<ul>
<li><strong><code>main</code> (or <code>master</code>) Branch</strong>: This branch is always deployable. Any code pushed to <code>main</code> should be production-ready.</li>
<li><strong>Feature Branches</strong>: Created directly from <code>main</code> for any new work (features, bug fixes, experiments).
<ul>
<li><strong>Naming Convention</strong>: Descriptive, like <code>add-user-login</code> or <code>fix-database-connection</code>.</li>
</ul>
</li>
<li><strong>Pull Requests (PRs)</strong>: Used to propose changes from a feature branch back to <code>main</code>. PRs facilitate code review, automated testing (via CI), and discussion before merging. Once approved and all checks pass, the feature branch is merged into <code>main</code> and then typically deleted.</li>
</ul>
<p><strong>Hypothetical Scenario: Acme Webshop using GitHub Flow</strong></p>
<ol>
<li><strong>Initial State</strong>: The <code>main</code> branch holds the deployable production code for the Acme Webshop.</li>
<li><strong>New Feature</strong>: A developer needs to add a "wishlist" feature. They create a branch <code>add-wishlist-feature</code> directly from <code>main</code>.</li>
<li><strong>Development and Push</strong>: The developer works on the <code>add-wishlist-feature</code> branch, committing changes regularly, and pushes these changes to the remote branch.</li>
<li><strong>Pull Request</strong>: Once the feature is complete, the developer opens a Pull Request from <code>add-wishlist-feature</code> to <code>main</code>.</li>
<li><strong>Review and CI</strong>: Team members review the code. The CI pipeline automatically runs tests, static analysis, and builds the application for the <code>add-wishlist-feature</code> branch.</li>
<li><strong>Merge and Deploy</strong>: After code review approval and all CI checks pass, the PR is merged into <code>main</code>. A new CI/CD pipeline is triggered, building and deploying the updated <code>main</code> branch to production. The <code>add-wishlist-feature</code> branch is then deleted.</li>
</ol>
<p><strong>Real-world Example: SaaS Applications</strong>
Companies developing Software-as-a-Service (SaaS) applications with daily or even continuous deployments often use GitHub Flow. For example, a marketing automation platform that needs to release small, incremental updates frequently throughout the day would benefit from GitHub Flow's simplicity and direct path to deployment.</p>
<h3>GitLab Flow Branching Strategy</h3>
<p>GitLab Flow combines aspects of GitFlow and GitHub Flow, aiming for a balance between simplicity and structure. It typically uses <code>main</code> (or <code>master</code>) as the production branch, but it introduces environment branches (like <code>staging</code>, <code>pre-production</code>) or release branches for more complex deployment scenarios, especially when continuous delivery isn't feasible for all environments.</p>
<ul>
<li><strong><code>main</code> Branch</strong>: Always production-ready.</li>
<li><strong>Feature Branches</strong>: Short-lived branches created from <code>main</code> for new features or bug fixes, merged back into <code>main</code> via Merge Requests (GitLab's equivalent of Pull Requests).</li>
<li><strong>Environment Branches (Optional)</strong>: For more complex CI/CD, dedicated branches like <code>staging</code>, <code>pre-production</code>, or <code>production</code> might exist. Changes flow from <code>main</code> to <code>staging</code>, then <code>staging</code> to <code>pre-production</code>, and finally <code>pre-production</code> to <code>production</code> after testing.</li>
<li><strong>Release Branches (Optional)</strong>: Similar to GitFlow's release branches but often simpler, used for preparing a specific version.</li>
</ul>
<p><strong>Hypothetical Scenario: Acme Webshop using GitLab Flow with Environment Branches</strong></p>
<ol>
<li><strong>Branches</strong>: <code>main</code> (production), <code>staging</code>, <code>develop</code>.</li>
<li><strong>Feature Development</strong>: A developer creates <code>feature/new-search-filter</code> from <code>develop</code>. After completion, it's merged into <code>develop</code> via a Merge Request.</li>
<li><strong>Integration</strong>: <code>develop</code> is then merged into <code>staging</code>.</li>
<li><strong>Staging Testing</strong>: QA tests on the <code>staging</code> environment. Any issues are fixed in <code>develop</code> and then merged into <code>staging</code> again.</li>
<li><strong>Pre-production</strong>: Once <code>staging</code> is stable, it's merged into <code>main</code>. Then <code>main</code> is merged into the <code>production</code> environment.</li>
<li><strong>Deployment</strong>: The deployment pipeline automatically deploys <code>develop</code> to the development environment, <code>staging</code> to the staging environment, and <code>main</code> to the production environment.</li>
</ol>
<p><strong>Real-world Example: Regulated Industries</strong>
Organizations in regulated industries (e.g., finance, healthcare) that require stringent testing and approvals for changes moving between environments often adopt GitLab Flow with environment branches. This allows for clear segregation of code versions destined for different stages of the release process, providing necessary checkpoints before reaching production.</p>
<h3>Choosing a Strategy</h3>
<p>The "best" branching strategy depends on the team's size, project complexity, release frequency, and regulatory requirements.</p>
<ul>
<li><strong>GitFlow</strong>: Best for projects with distinct release cycles, versioned releases, and potentially longer integration phases. Offers strict control and separation.</li>
<li><strong>GitHub Flow</strong>: Ideal for continuous delivery, smaller teams, or projects prioritizing rapid, frequent deployments directly from <code>main</code>. Simpler and less overhead.</li>
<li><strong>GitLab Flow</strong>: A flexible option that can adapt from simple continuous delivery to more structured multi-environment deployments. Good for teams needing more control than GitHub Flow but less rigidity than GitFlow.</li>
</ul>
<h2>Practical Examples and Demonstrations</h2>
<p>Let's walk through a series of Git commands illustrating a typical development workflow, preparing students for building automated pipelines around these actions. We will assume the Acme Webshop project is already initialized and connected to a remote repository.</p>
<h3>Scenario: Implementing a New Product Page for Acme Webshop</h3>
<p><strong>1. Ensure Your <code>main</code> Branch is Up-to-Date</strong></p>
<p>Before starting new work, always pull the latest changes from the remote <code>main</code> branch to avoid working on stale code.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> checkout</span><span style="color:#032F62"> main</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> pull</span><span style="color:#032F62"> origin</span><span style="color:#032F62"> main</span></span></code></pre></div></div></div>
<p><em>Explanation</em>:</p>
<ul>
<li><code>git checkout main</code>: Switches your local repository to the <code>main</code> branch.</li>
<li><code>git pull origin main</code>: Fetches changes from the <code>main</code> branch on the <code>origin</code> remote and merges them into your local <code>main</code> branch.</li>
</ul>
<p><strong>2. Create a New Feature Branch</strong></p>
<p>Based on GitHub Flow for simplicity, we'll create a feature branch directly from <code>main</code>.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> checkout</span><span style="color:#005CC5"> -b</span><span style="color:#032F62"> feature/new-product-page</span></span></code></pre></div></div></div>
<p><em>Explanation</em>:</p>
<ul>
<li><code>git checkout -b feature/new-product-page</code>: Creates a new branch named <code>feature/new-product-page</code> and immediately switches to it.</li>
</ul>
<p><strong>3. Develop the Feature: Make Changes and Commit</strong></p>
<p>Now, simulate making changes to add a new product page.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Create a new file for the product page</span></span>
<span class="line"><span style="color:#6F42C1">touch</span><span style="color:#032F62"> src/templates/product-page.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Add some content to the new file (simulate editing)</span></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "&lt;h1&gt;Product Detail&lt;/h1&gt;&lt;p&gt;Description of a new product.&lt;/p&gt;"</span><span style="color:#D73A49"> &gt;</span><span style="color:#032F62"> src/templates/product-page.html</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Modify an existing file (e.g., add a link to the new page)</span></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> '&lt;a href="/products/new"&gt;New Product Page&lt;/a&gt;'</span><span style="color:#D73A49"> &gt;&gt;</span><span style="color:#032F62"> src/templates/index.html</span></span></code></pre></div></div></div>
<p>After making changes, stage and commit them.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> add</span><span style="color:#032F62"> src/templates/product-page.html</span><span style="color:#032F62"> src/templates/index.html</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> commit</span><span style="color:#005CC5"> -m</span><span style="color:#032F62"> "FEAT: Implement basic structure for new product page"</span></span></code></pre></div></div></div>
<p><em>Explanation</em>:</p>
<ul>
<li><code>git add &lt;files&gt;</code>: Stages the modified or new files, preparing them for the next commit.</li>
<li><code>git commit -m "..."</code>: Creates a new commit with the staged changes and the specified message.</li>
</ul>
<p><strong>4. Push the Feature Branch to the Remote</strong></p>
<p>To share your work and allow for code review (via a Pull Request on GitHub/GitLab), push your feature branch to the remote.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> push</span><span style="color:#005CC5"> -u</span><span style="color:#032F62"> origin</span><span style="color:#032F62"> feature/new-product-page</span></span></code></pre></div></div></div>
<p><em>Explanation</em>:</p>
<ul>
<li><code>git push</code>: Sends your local commits to the remote repository.</li>
<li><code>-u origin feature/new-product-page</code>: Sets the upstream (tracking) branch, so subsequent <code>git push</code> or <code>git pull</code> commands from this branch don't require specifying the remote and branch.</li>
</ul>
<p><strong>5. Simulate a Pull Request / Merge Request (Conceptual)</strong></p>
<p>At this stage, in a real-world scenario, you would go to your Git hosting service (GitHub, GitLab, Bitbucket) and create a Pull Request (PR) from <code>feature/new-product-page</code> into <code>main</code>. This is where CI systems like Jenkins come into play, automatically running tests on your feature branch's code before it's merged.</p>
<p><strong>6. Merge the Feature Branch (After Review and CI Success)</strong></p>
<p>Once the PR is approved and all CI checks pass, the feature branch is merged into <code>main</code>. This is often done directly through the Git hosting service's UI, which then performs the merge commit. For demonstration purposes, we'll simulate a local merge.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> checkout</span><span style="color:#032F62"> main</span><span style="color:#6A737D"> # Switch back to the main branch</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> pull</span><span style="color:#032F62"> origin</span><span style="color:#032F62"> main</span><span style="color:#6A737D"> # Ensure main is up-to-date before merging</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> merge</span><span style="color:#005CC5"> --no-ff</span><span style="color:#032F62"> feature/new-product-page</span><span style="color:#005CC5"> -m</span><span style="color:#032F62"> "MERGE: Merge feature/new-product-page into main"</span></span></code></pre></div></div></div>
<p><em>Explanation</em>:</p>
<ul>
<li><code>git merge --no-ff</code>: Performs a three-way merge, even if a fast-forward merge is possible. This creates a merge commit, explicitly showing that a merge occurred, which is good practice for history tracking.</li>
<li><code>-m "..."</code>: Provides the commit message for the merge commit.</li>
</ul>
<p><strong>7. Push the Merged <code>main</code> Branch to Remote</strong></p>
<p>After merging locally, push the updated <code>main</code> branch to the remote. This makes the new product page available in the central repository, triggering CI/CD pipelines for <code>main</code>.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> push</span><span style="color:#032F62"> origin</span><span style="color:#032F62"> main</span></span></code></pre></div></div></div>
<p><strong>8. Clean Up (Delete Feature Branch)</strong></p>
<p>After successfully merging, the feature branch is typically no longer needed and can be deleted locally and remotely.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> branch</span><span style="color:#005CC5"> -d</span><span style="color:#032F62"> feature/new-product-page</span><span style="color:#6A737D"> # Delete local branch</span></span>
<span class="line"><span style="color:#6F42C1">git</span><span style="color:#032F62"> push</span><span style="color:#032F62"> origin</span><span style="color:#005CC5"> --delete</span><span style="color:#032F62"> feature/new-product-page</span><span style="color:#6A737D"> # Delete remote branch</span></span></code></pre></div></div></div>
<p><em>Explanation</em>:</p>
<ul>
<li><code>git branch -d</code>: Deletes the local branch if it has been fully merged. Use <code>-D</code> (force delete) if not fully merged.</li>
<li><code>git push origin --delete</code>: Deletes the specified branch on the remote.</li>
</ul>
<p>This workflow illustrates how Git commands are used in a typical development cycle, creating clear points for integration and collaboration, which are essential for CI pipelines.</p>
<h2>Exercises and Practice Activities</h2>
<p>These exercises build on the Acme Webshop scenario and reinforce the Git concepts and branching strategies discussed.</p>
<ol>
<li>
<p><strong>Repository Setup and Initial Commit:</strong></p>
<ul>
<li>Create a new directory named <code>acme-webshop-v2</code>.</li>
<li>Initialize a new Git repository within this directory.</li>
<li>Create two files: <code>index.html</code> with a simple "Welcome to Acme Webshop V2" message, and <code>README.md</code> with a project description.</li>
<li>Add these files to the staging area and make your first commit with an appropriate message.</li>
<li>View your commit history using <code>git log --oneline</code>.</li>
</ul>
</li>
<li>
<p><strong>Feature Development with a New Branch:</strong></p>
<ul>
<li>Imagine you need to add a "shopping cart" feature. Create a new branch called <code>feature/add-shopping-cart</code> from your <code>main</code> branch.</li>
<li>On this new branch, create a file named <code>cart.html</code> with basic HTML content (e.g., "Your Shopping Cart").</li>
<li>Modify <code>index.html</code> to include a link to <code>cart.html</code>.</li>
<li>Commit these changes to the <code>feature/add-shopping-cart</code> branch.</li>
<li>Switch back to your <code>main</code> branch and verify that <code>cart.html</code> and the link are <em>not</em> present.</li>
<li>Switch back to <code>feature/add-shopping-cart</code> and verify they <em>are</em> present.</li>
</ul>
</li>
<li>
<p><strong>Simulating a Concurrent Change and Merge Conflict:</strong></p>
<ul>
<li>While on your <code>feature/add-shopping-cart</code> branch, modify <code>index.html</code> again, perhaps changing the welcome message to "Welcome to the <em>new</em> Acme Webshop V2!". Commit this change.</li>
<li>Switch to your <code>main</code> branch.</li>
<li><em>Without merging your feature branch</em>, modify <code>index.html</code> in the <code>main</code> branch. Change the welcome message to "Acme Webshop V2 - Your one-stop shop!". Commit this change to <code>main</code>.</li>
<li>Now, try to merge <code>feature/add-shopping-cart</code> into <code>main</code>. What happens? Resolve the merge conflict in <code>index.html</code> by combining both changes (e.g., "Welcome to the <em>new</em> Acme Webshop V2 - Your one-stop shop!").</li>
<li>Stage and commit the merge resolution.</li>
</ul>
</li>
<li>
<p><strong>Implementing a Hotfix with GitFlow Mentality (Local Practice):</strong></p>
<ul>
<li>Assume your <code>main</code> branch represents production. A critical bug is found: the title in <code>index.html</code> is wrong.</li>
<li>From <code>main</code>, create a new branch <code>hotfix/fix-title-bug</code>.</li>
<li>On this <code>hotfix</code> branch, correct the title in <code>index.html</code>.</li>
<li>Commit this change to <code>hotfix/fix-title-bug</code>.</li>
<li>Merge <code>hotfix/fix-title-bug</code> into <code>main</code>.</li>
<li><em>Crucially</em>, also merge <code>hotfix/fix-title-bug</code> into your (simulated) <code>develop</code> branch (if you had one, otherwise into the <code>feature/add-shopping-cart</code> branch for this exercise to ensure all ongoing work gets the fix).</li>
<li>Delete the <code>hotfix/fix-title-bug</code> branch locally.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-2.2">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Introduction to Jenkins: Installation and Initial Configuration</h1><p>Continuous Integration (CI) is a core practice in modern software development, and Jenkins stands as a leading open-source automation server for implementing CI/CD pipelines. This lesson introduces Jenkins, covering its installation process and the initial configuration steps necessary to establish a foundational CI environment.</p>
<h2>Understanding Jenkins</h2>
<p>Jenkins is a self-contained, open-source automation server that facilitates Continuous Integration and Continuous Delivery. It automates parts of the software development process related to building, testing, and deploying, making it easier for developers to integrate changes to the project frequently and consistently. The primary goal of Jenkins is to monitor a version control system (like Git), detect changes, and then automatically perform a series of steps (e.g., compile code, run tests, package applications) to ensure the changes are valid and ready for further deployment.</p>
<p>For example, imagine a team working on the "Acme Webshop" application. Without Jenkins, each developer might manually build and test their code before merging it, leading to inconsistencies, missed errors, and long integration cycles. With Jenkins, every time a developer pushes code to the repository, Jenkins automatically fetches the code, builds the application, and runs a suite of tests, immediately notifying the team of any issues.</p>
<p>Another example is a mobile application development team. When a new feature branch is merged into the <code>develop</code> branch, Jenkins can be configured to not only build the application for both iOS and Android but also run UI tests on simulators and then potentially upload the builds to an internal testing distribution service. This automation drastically reduces the manual effort and speeds up the feedback loop.</p>
<p>A hypothetical scenario involves a small startup developing a new social media platform. They have limited resources and need to iterate quickly. By using Jenkins to automate their build and test processes, they can ensure that their main codebase is always in a releasable state, even with daily code contributions from multiple developers. This continuous validation prevents integration problems from accumulating and saves significant time that would otherwise be spent on debugging complex merge conflicts or broken builds.</p>
<h2>Jenkins Installation</h2>
<p>Jenkins can be installed in various ways, including as a standalone application, a Docker container, or via package managers. For this lesson, we will focus on installing Jenkins on a Linux system (specifically Ubuntu) using its package manager, which is a common and straightforward method.</p>
<h3>Prerequisites for Jenkins Installation</h3>
<p>Before installing Jenkins, ensure your system meets the following requirements:</p>
<ul>
<li><strong>Java Development Kit (JDK):</strong> Jenkins requires Java to run. OpenJDK 11 or 17 are recommended.</li>
<li><strong>Sufficient Resources:</strong> At least 256 MB of RAM (512 MB recommended) and 1 GB of disk space (10 GB recommended for Jenkins home directory).</li>
</ul>
<p>To install OpenJDK 11 on Ubuntu:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt</span><span style="color:#032F62"> update</span><span style="color:#6A737D"> # Update the package list</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt</span><span style="color:#032F62"> install</span><span style="color:#032F62"> openjdk-11-jdk</span><span style="color:#005CC5"> -y</span><span style="color:#6A737D"> # Install OpenJDK 11</span></span>
<span class="line"><span style="color:#6F42C1">java</span><span style="color:#005CC5"> -version</span><span style="color:#6A737D"> # Verify Java installation</span></span></code></pre></div></div></div>
<h3>Step-by-Step Installation on Ubuntu</h3>
<ol>
<li>
<p><strong>Add the Jenkins APT repository key:</strong> Jenkins packages are signed with a GPG key. You need to add this key to your system to verify the authenticity of the packages.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt</span><span style="color:#032F62"> update</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt</span><span style="color:#032F62"> install</span><span style="color:#032F62"> ca-certificates</span><span style="color:#032F62"> curl</span><span style="color:#032F62"> gnupg</span><span style="color:#005CC5"> -y</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> mkdir</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> /etc/apt/keyrings</span></span>
<span class="line"><span style="color:#6F42C1">curl</span><span style="color:#005CC5"> -fsSL</span><span style="color:#032F62"> https://pkg.jenkins.io/debian-stable/jenkins.io-2023.key</span><span style="color:#D73A49"> |</span><span style="color:#6F42C1"> sudo</span><span style="color:#032F62"> gpg</span><span style="color:#005CC5"> --dearmor</span><span style="color:#005CC5"> -o</span><span style="color:#032F62"> /etc/apt/keyrings/jenkins.gpg</span></span></code></pre></div></div></div>
</li>
<li>
<p><strong>Add the Jenkins APT repository to your system's sources:</strong> This tells your system where to find the Jenkins packages.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "deb [signed-by=/etc/apt/keyrings/jenkins.gpg] https://pkg.jenkins.io/debian-stable binary/"</span><span style="color:#D73A49"> |</span><span style="color:#6F42C1"> sudo</span><span style="color:#032F62"> tee</span><span style="color:#032F62"> /etc/apt/sources.list.d/jenkins.list</span><span style="color:#D73A49"> &gt;</span><span style="color:#032F62"> /dev/null</span></span></code></pre></div></div></div>
</li>
<li>
<p><strong>Update your package list and install Jenkins:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt</span><span style="color:#032F62"> update</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt</span><span style="color:#032F62"> install</span><span style="color:#032F62"> jenkins</span><span style="color:#005CC5"> -y</span></span></code></pre></div></div></div>
</li>
<li>
<p><strong>Start and Enable Jenkins Service:</strong> Jenkins is usually started automatically after installation. You can check its status and ensure it starts on boot.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> systemctl</span><span style="color:#032F62"> start</span><span style="color:#032F62"> jenkins</span><span style="color:#6A737D"> # Start the Jenkins service</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> systemctl</span><span style="color:#032F62"> enable</span><span style="color:#032F62"> jenkins</span><span style="color:#6A737D"> # Enable Jenkins to start on boot</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> systemctl</span><span style="color:#032F62"> status</span><span style="color:#032F62"> jenkins</span><span style="color:#6A737D"> # Check the status of the Jenkins service</span></span></code></pre></div></div></div>
<p>The <code>systemctl status jenkins</code> command should show <code>active (running)</code>.</p>
</li>
</ol>
<h2>Initial Jenkins Configuration</h2>
<p>After installation, Jenkins needs an initial setup through a web interface. This involves unlocking Jenkins, installing recommended plugins, and creating the first administrator user.</p>
<h3>Accessing the Jenkins Web Interface</h3>
<p>By default, Jenkins runs on port <code>8080</code>. Open your web browser and navigate to <code>http://YOUR_SERVER_IP_OR_HOSTNAME:8080</code>.</p>
<p>You will be greeted with an "Unlock Jenkins" page.</p>
<h3>Unlocking Jenkins</h3>
<p>Jenkins requires an initial administrator password, which is generated during installation and stored in a file on the server.</p>
<ol>
<li>
<p><strong>Retrieve the initial administrator password:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> cat</span><span style="color:#032F62"> /var/lib/jenkins/secrets/initialAdminPassword</span></span></code></pre></div></div></div>
<p>Copy the alphanumeric string displayed in the terminal.</p>
</li>
<li>
<p><strong>Paste the password:</strong> Enter this password into the "Administrator password" field on the Jenkins unlock page and click "Continue".</p>
</li>
</ol>
<h3>Installing Plugins</h3>
<p>Jenkins' functionality is heavily extended through plugins. During the initial setup, you will be given two options:</p>
<ul>
<li><strong>Install suggested plugins:</strong> This is the recommended option for most users. It installs a set of commonly used plugins that cover basic CI/CD functionalities like Git integration, pipeline steps, and build tools.</li>
<li><strong>Select plugins to install:</strong> This allows you to manually choose which plugins to install. This option is suitable if you have specific needs or want to minimize the number of installed plugins.</li>
</ul>
<p>For a robust CI pipeline for the "Acme Webshop", selecting "Install suggested plugins" is appropriate as it includes essential tools for version control, build management, and basic pipeline orchestration. Click "Install suggested plugins". Jenkins will then download and install these plugins, which may take a few minutes.</p>
<h3>Creating the First Admin User</h3>
<p>After plugin installation, you will be prompted to create the first administrator user.</p>
<ol>
<li>Fill in the required details: <strong>Username</strong>, <strong>Password</strong>, <strong>Confirm password</strong>, <strong>Full name</strong>, and <strong>E-mail address</strong>.</li>
<li>Click "Save and Finish".</li>
</ol>
<h3>Instance Configuration</h3>
<p>The next step is to configure the Jenkins URL.</p>
<ol>
<li>The default URL will likely be <code>http://YOUR_SERVER_IP_OR_HOSTNAME:8080</code>. If you plan to access Jenkins via a specific domain or proxy, update this URL accordingly.</li>
<li>Click "Save and Finish".</li>
</ol>
<p>You should now see the Jenkins dashboard, indicating that the initial configuration is complete.</p>
<h2>Exercises and Practice Activities</h2>
<ol>
<li>
<p><strong>Verify Jenkins Service:</strong></p>
<ul>
<li>Log in to your Ubuntu server.</li>
<li>Execute <code>sudo systemctl restart jenkins</code>.</li>
<li>Wait a few seconds, then execute <code>sudo systemctl status jenkins</code>.</li>
<li>Confirm that the Jenkins service is <code>active (running)</code>. If not, troubleshoot the installation steps.</li>
</ul>
</li>
<li>
<p><strong>Access Jenkins from a Different Machine:</strong></p>
<ul>
<li>If your Jenkins server is a virtual machine or a cloud instance, ensure that port <code>8080</code> is open in its firewall rules (e.g., AWS Security Groups, Azure Network Security Groups, <code>ufw</code> on Ubuntu).</li>
<li>Try accessing Jenkins from your local machine's web browser using the server's public IP address or hostname.</li>
</ul>
</li>
<li>
<p><strong>Explore Installed Plugins:</strong></p>
<ul>
<li>Navigate to <code>Manage Jenkins</code> &gt; <code>Plugins</code> &gt; <code>Installed plugins</code> on your Jenkins dashboard.</li>
<li>Browse through the list of plugins that were installed with the "Install suggested plugins" option. Identify plugins related to Git, Maven (a common build tool), and Pipeline. This observation will be helpful when we craft our first pipeline.</li>
</ul>
</li>
<li>
<p><strong>Change Jenkins Admin Password:</strong></p>
<ul>
<li>Log in to Jenkins with the administrator user you created.</li>
<li>Go to your user icon (top right) &gt; <code>Configure</code>.</li>
<li>Locate the "Password" section and change your password.</li>
<li>Log out and then log back in with the new password to confirm the change.</li>
</ul>
</li>
</ol>
<h2>Real-World Application</h2>
<p>Consider a development team at "Acme Corp" building the "Acme Webshop". They have multiple developers pushing code to a central Git repository. Before Jenkins, developers would manually build their code and run tests on their local machines. This led to:</p>
<ul>
<li><strong>"Works on my machine" syndrome:</strong> Code that passed tests locally failed when integrated due to environment differences.</li>
<li><strong>Delayed feedback:</strong> Integration issues were only discovered hours or days after code was merged, making them harder to fix.</li>
<li><strong>Inconsistent deployments:</strong> Manual build steps meant that the production build might differ slightly from developer builds.</li>
</ul>
<p>By installing and configuring Jenkins, Acme Corp can now automate these steps. Every time a developer pushes code to their Git branch, Jenkins automatically triggers a build job for the "Acme Webshop" application. This job compiles the Java code, runs JUnit tests, and creates a WAR file artifact. If any step fails, Jenkins immediately sends a notification to the development team, allowing them to address issues quickly. This proactive approach significantly reduces integration risks and ensures that the main codebase is always stable. This automated feedback loop is critical for maintaining a high pace of development and delivering features efficiently.</p>
<p>This initial setup forms the foundation for building a robust CI pipeline for the "Acme Webshop". The installed plugins and the administrative access prepare the environment for creating jobs and pipelines that will automate the build, test, and potentially deploy processes.</p>
  
</div>

<div id="chapter-2.3">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Crafting Your First Jenkins Declarative Pipeline for a Simple Application</h1><p>Jenkins Declarative Pipelines offer a modern, structured approach to defining CI/CD workflows as code. This allows for versioning, reviewing, and managing your pipeline definitions alongside your application code, promoting consistency and repeatability across projects. A Declarative Pipeline is built using a predefined syntax that simplifies the creation of complex pipelines, making them easier to read and understand compared to older Scripted Pipelines. This lesson focuses on constructing your first Declarative Pipeline to automate the build process for a simple application, establishing the foundation for robust Continuous Integration.</p>
<h2>Understanding Jenkins Declarative Pipeline Syntax</h2>
<p>Jenkins Declarative Pipelines are defined in a <code>Jenkinsfile</code> within your project's repository. The syntax is Groovy-based but highly structured, providing a domain-specific language (DSL) for defining stages, steps, and post-build actions. The core components of a Declarative Pipeline include <code>pipeline</code>, <code>agent</code>, <code>stages</code>, <code>stage</code>, and <code>steps</code>.</p>
<h3><code>pipeline</code> Block</h3>
<p>The <code>pipeline</code> block is the outermost block in a Declarative Pipeline, encapsulating the entire workflow. Every Declarative Pipeline must start with this block.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// This is the main pipeline block</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#6A737D">    // All other pipeline elements go inside here</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h3><code>agent</code> Section</h3>
<p>The <code>agent</code> section specifies where the entire pipeline or a specific stage will execute. It determines the Jenkins executor (a node or a Docker container) on which the build process runs.</p>
<ul>
<li><strong><code>any</code></strong>: Executes the pipeline or stage on any available agent. This is suitable for simple cases where specific environment requirements are minimal.</li>
<li><strong><code>none</code></strong>: Indicates that no global agent is allocated, and each <code>stage</code> must define its own <code>agent</code>. This is common for pipelines that require different environments for different stages.</li>
<li><strong><code>label</code></strong>: Executes on a specific agent identified by a label. This is useful for targeting agents with specific capabilities (e.g., agents with particular compilers or operating systems).
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">agent {</span></span>
<span class="line"><span style="color:#24292E">    label </span><span style="color:#032F62">'linux-build-server'</span><span style="color:#6A737D"> // Executes on an agent with the label 'linux-build-server'</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
<li><strong><code>docker</code></strong>: Runs the pipeline or stage inside a Docker container. This ensures a consistent build environment, isolating the build from the host system.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">agent {</span></span>
<span class="line"><span style="color:#24292E">    docker {</span></span>
<span class="line"><span style="color:#24292E">        image </span><span style="color:#032F62">'maven:3.8.1-jdk-11'</span><span style="color:#6A737D"> // Uses the specified Docker image</span></span>
<span class="line"><span style="color:#24292E">        args </span><span style="color:#032F62">'-v /tmp:/tmp'</span><span style="color:#6A737D">      // Mounts a volume (optional arguments for docker run)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
</ul>
<h3><code>stages</code> and <code>stage</code> Blocks</h3>
<p>The <code>stages</code> block contains one or more <code>stage</code> blocks. Each <code>stage</code> block represents a logical division of the pipeline, such as "Build", "Test", or "Deploy". Stages are executed sequentially.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">stages {</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// A stage named 'Build'</span></span>
<span class="line"><span style="color:#6A737D">        // Steps for the build stage go here</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// A stage named 'Test'</span></span>
<span class="line"><span style="color:#6A737D">        // Steps for the test stage go here</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h3><code>steps</code> Block</h3>
<p>Inside each <code>stage</code> block, the <code>steps</code> block defines the sequence of commands or actions to be executed for that stage. These steps can be shell commands, Jenkins built-in steps, or calls to shared library functions.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">'Starting build...'</span><span style="color:#6A737D">           // Jenkins built-in step to print a message</span></span>
<span class="line"><span style="color:#24292E">        sh </span><span style="color:#032F62">'mvn clean install -DskipTests'</span><span style="color:#6A737D"> // Executes a shell command</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h3><code>post</code> Section</h3>
<p>The <code>post</code> section defines actions that run after the pipeline or a specific stage has completed, regardless of its success or failure. This is useful for cleanup, sending notifications, or archiving artifacts.</p>
<ul>
<li><strong><code>always</code></strong>: Runs regardless of the pipeline's status.</li>
<li><strong><code>success</code></strong>: Runs only if the pipeline or stage succeeded.</li>
<li><strong><code>failure</code></strong>: Runs only if the pipeline or stage failed.</li>
<li><strong><code>unstable</code></strong>: Runs if the pipeline or stage is marked as unstable (e.g., failing tests but successful build).</li>
<li><strong><code>changed</code></strong>: Runs if the current pipeline run's status is different from the previous run's status.</li>
</ul>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">post {</span></span>
<span class="line"><span style="color:#24292E">    always {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">'Pipeline finished.'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    success {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">'Pipeline successful!'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    failure {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">'Pipeline failed, sending notification...'</span></span>
<span class="line"><span style="color:#6A737D">        // Add notification steps here</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h3>Directives: <code>environment</code>, <code>options</code>, <code>parameters</code>, <code>tools</code></h3>
<p>Declarative Pipelines also support various directives to configure pipeline behavior:</p>
<ul>
<li><strong><code>environment</code></strong>: Defines environment variables for the entire pipeline or a specific stage.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    environment {</span></span>
<span class="line"><span style="color:#005CC5">        BUILD_TOOL_VERSION</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> '3.8.1'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            environment {</span></span>
<span class="line"><span style="color:#005CC5">                MAVEN_OPTS</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> '-Xmx1024m'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">"mvn clean install -Dmaven.version=${BUILD_TOOL_VERSION}"</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
<li><strong><code>options</code></strong>: Configures pipeline-specific options like <code>timestamps</code>, <code>skipDefaultCheckout</code>, etc.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    options {</span></span>
<span class="line"><span style="color:#24292E">        timestamps() </span><span style="color:#6A737D">// Prepends all console output with the time at which the line was emitted</span></span>
<span class="line"><span style="color:#24292E">        skipDefaultCheckout() </span><span style="color:#6A737D">// Skips the default SCM checkout for the pipeline</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
<li><strong><code>parameters</code></strong>: Defines input parameters for manual pipeline runs.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    parameters {</span></span>
<span class="line"><span style="color:#24292E">        string(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'BRANCH_TO_BUILD'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'The Git branch to build'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">        booleanParam(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'RUN_TESTS'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'Whether to run unit tests'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">BRANCH_TO_BUILD</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when { expression { params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">RUN_TESTS</span><span style="color:#D73A49"> ==</span><span style="color:#005CC5"> true</span><span style="color:#24292E"> } }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
<li><strong><code>tools</code></strong>: Auto-installs tools (like Maven, JDK, Git) configured in Jenkins global tool configuration.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    tools {</span></span>
<span class="line"><span style="color:#24292E">        maven </span><span style="color:#032F62">'M3_8_1'</span><span style="color:#6A737D"> // Refers to a Maven installation named 'M3_8_1' in Jenkins global config</span></span>
<span class="line"><span style="color:#24292E">        jdk </span><span style="color:#032F62">'JDK_11'</span><span style="color:#6A737D">   // Refers to a JDK installation named 'JDK_11'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span><span style="color:#6A737D"> // Maven and JDK will be available in the PATH</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
</ul>
<h2>Crafting a Jenkins Declarative Pipeline for the Acme Webshop Backend</h2>
<p>Let's apply these concepts to create a <code>Jenkinsfile</code> for the Acme Webshop backend application. Assume the backend is a simple Java Maven project. This pipeline will perform basic CI steps: checking out code, building the application, and running unit tests.</p>
<p>First, ensure your Jenkins instance has the necessary tools configured (Maven, JDK) and an agent capable of running Java builds. In Module 1, you set up your local development environment, which included Git. In the previous lesson of this module, you installed Jenkins and performed initial configuration. For this lesson, we assume Jenkins is running and accessible.</p>
<h3>Example: Basic CI Pipeline for Acme Webshop Backend</h3>
<p>Create a file named <code>Jenkinsfile</code> at the root of your Acme Webshop backend Git repository with the following content:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for the Acme Webshop Backend (Java Maven Project)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#6A737D">    // Defines where the pipeline will run.</span></span>
<span class="line"><span style="color:#6A737D">    // 'any' means Jenkins will use any available agent.</span></span>
<span class="line"><span style="color:#6A737D">    // For a real-world scenario, you might use 'label' to target specific build agents</span></span>
<span class="line"><span style="color:#6A737D">    // or 'docker' to ensure a consistent build environment with 'maven:3.8.1-jdk-11'.</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Defines global environment variables for the entire pipeline.</span></span>
<span class="line"><span style="color:#6A737D">    // This example sets a variable for the Maven build command.</span></span>
<span class="line"><span style="color:#24292E">    environment {</span></span>
<span class="line"><span style="color:#6A737D">        // MAVEN_OPTS is often used to allocate more memory to Maven,</span></span>
<span class="line"><span style="color:#6A737D">        // preventing out-of-memory errors for larger projects.</span></span>
<span class="line"><span style="color:#005CC5">        MAVEN_OPTS</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "-Xmx1024m -XX:MaxPermSize=512m"</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Configures options for the pipeline.</span></span>
<span class="line"><span style="color:#6A737D">    // 'timestamps()' adds timestamps to each line of console output,</span></span>
<span class="line"><span style="color:#6A737D">    // which helps in debugging and understanding execution times.</span></span>
<span class="line"><span style="color:#24292E">    options {</span></span>
<span class="line"><span style="color:#24292E">        timestamps()</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // The 'stages' block defines the sequence of logical steps in your CI/CD pipeline.</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 1: Build ---</span></span>
<span class="line"><span style="color:#6A737D">        // This stage is responsible for compiling the source code and packaging the application.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Building the Acme Webshop Backend application...'</span></span>
<span class="line"><span style="color:#6A737D">                // Executes a Maven command to clean the project, compile, and package it.</span></span>
<span class="line"><span style="color:#6A737D">                // '-DskipTests' is used here because tests will be run in a separate stage.</span></span>
<span class="line"><span style="color:#6A737D">                // In a production setup, it's common to build without skipping tests,</span></span>
<span class="line"><span style="color:#6A737D">                // and then run tests explicitly in a 'Test' stage for clearer separation and reporting.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install -DskipTests'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 2: Test ---</span></span>
<span class="line"><span style="color:#6A737D">        // This stage executes unit and integration tests to ensure code quality and functionality.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Running unit and integration tests...'</span></span>
<span class="line"><span style="color:#6A737D">                // Executes the Maven 'test' goal, which runs all tests defined in the project.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 3: Archive Artifacts ---</span></span>
<span class="line"><span style="color:#6A737D">        // This stage archives the build output (e.g., JAR/WAR file) so it can be used by downstream stages</span></span>
<span class="line"><span style="color:#6A737D">        // (like deployment) or downloaded manually.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Archive Artifacts'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Archiving build artifacts...'</span></span>
<span class="line"><span style="color:#6A737D">                // 'archiveArtifacts' is a Jenkins built-in step.</span></span>
<span class="line"><span style="color:#6A737D">                // 'artifacts: '**/*.jar'' specifies that all JAR files found in the workspace</span></span>
<span class="line"><span style="color:#6A737D">                // (recursively, thanks to '**') should be archived.</span></span>
<span class="line"><span style="color:#6A737D">                // 'fingerprint: true' ensures that the archived artifacts are "fingerprinted,"</span></span>
<span class="line"><span style="color:#6A737D">                // allowing Jenkins to track where they were produced and where they are used,</span></span>
<span class="line"><span style="color:#6A737D">                // which is important for traceability in complex pipelines.</span></span>
<span class="line"><span style="color:#24292E">                archiveArtifacts </span><span style="color:#005CC5">artifacts</span><span style="color:#24292E">: </span><span style="color:#032F62">'**/*.jar'</span><span style="color:#24292E">, </span><span style="color:#005CC5">fingerprint</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // The 'post' block defines actions to be executed after the main pipeline stages complete,</span></span>
<span class="line"><span style="color:#6A737D">    // regardless of whether the pipeline succeeded or failed.</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#6A737D">        // 'always' block runs in all cases (success, failure, unstable, aborted).</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Pipeline finished.'</span></span>
<span class="line"><span style="color:#6A737D">            // 'deleteDir()' is a cleanup step to remove the workspace directory after the build.</span></span>
<span class="line"><span style="color:#6A737D">            // This ensures that the next build starts with a clean slate and prevents</span></span>
<span class="line"><span style="color:#6A737D">            // accumulation of old files, which can cause issues or consume disk space.</span></span>
<span class="line"><span style="color:#6A737D">            // This is especially important for shared build agents.</span></span>
<span class="line"><span style="color:#24292E">            deleteDir()</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // 'success' block runs only if all stages completed successfully.</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Acme Webshop Backend CI pipeline completed successfully!'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // 'failure' block runs only if any stage in the pipeline failed.</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Acme Webshop Backend CI pipeline failed!'</span></span>
<span class="line"><span style="color:#6A737D">            // You might add steps here to send notifications (e.g., email, Slack).</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h3>Explanation of the Acme Webshop Backend Pipeline Steps</h3>
<ol>
<li><strong><code>agent any</code></strong>: The pipeline will run on any available Jenkins agent. For the Acme Webshop, this could be your local Jenkins agent initially.</li>
<li><strong><code>environment</code></strong>: Sets <code>MAVEN_OPTS</code> to provide more memory to the Maven process, which can be critical for larger projects to avoid build failures due to memory constraints.</li>
<li><strong><code>options { timestamps() }</code></strong>: Configures the pipeline to prepend timestamps to all console output, making it easier to track the duration of individual steps.</li>
<li><strong><code>stage('Build')</code></strong>:
<ul>
<li><code>echo 'Building the Acme Webshop Backend application...'</code>: Prints a message to the console.</li>
<li><code>sh 'mvn clean install -DskipTests'</code>: Executes a shell command to perform a Maven build.
<ul>
<li><code>clean</code>: Deletes the target directory.</li>
<li><code>install</code>: Compiles the source code, runs tests (if not skipped), and packages the compiled code into a JAR/WAR file, then installs it into the local Maven repository.</li>
<li><code>-DskipTests</code>: Temporarily skips running tests during the <code>install</code> phase. We'll run them explicitly in the <code>Test</code> stage for better separation and control.</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>stage('Test')</code></strong>:
<ul>
<li><code>echo 'Running unit and integration tests...'</code>: Prints a message.</li>
<li><code>sh 'mvn test'</code>: Executes the Maven <code>test</code> goal, which specifically runs all unit and integration tests configured in the project's <code>pom.xml</code>.</li>
</ul>
</li>
<li><strong><code>stage('Archive Artifacts')</code></strong>:
<ul>
<li><code>echo 'Archiving build artifacts...'</code>: Prints a message.</li>
<li><code>archiveArtifacts artifacts: '**/*.jar', fingerprint: true</code>: This Jenkins built-in step archives all <code>.jar</code> files found in the workspace. <code>fingerprint: true</code> enables traceability, meaning Jenkins can track where this artifact was produced and where it might be used later (e.g., in a deployment stage).</li>
</ul>
</li>
<li><strong><code>post</code> block</strong>:
<ul>
<li><code>always { deleteDir() }</code>: Cleans up the workspace directory after every run, ensuring a fresh start for the next build and conserving disk space.</li>
<li><code>success { ... }</code>: Notifies about successful pipeline completion.</li>
<li><code>failure { ... }</code>: Notifies about pipeline failure. In a real-world scenario, this might trigger an email or Slack notification.</li>
</ul>
</li>
</ol>
<h2>Setting Up and Running Your First Pipeline</h2>
<p>To run this pipeline:</p>
<ol>
<li><strong>Commit <code>Jenkinsfile</code></strong>: Place the <code>Jenkinsfile</code> at the root of your Acme Webshop backend Git repository. Commit and push it to your remote repository (e.g., GitHub, GitLab, Bitbucket).</li>
<li><strong>Create a Jenkins Job</strong>:
<ul>
<li>Open your Jenkins dashboard.</li>
<li>Click "New Item".</li>
<li>Enter an item name (e.g., <code>acme-webshop-backend-ci</code>).</li>
<li>Select "Pipeline" and click "OK".</li>
</ul>
</li>
<li><strong>Configure the Pipeline Job</strong>:
<ul>
<li>In the job configuration page, scroll down to the "Pipeline" section.</li>
<li>For "Definition", select "Pipeline script from SCM".</li>
<li>For "SCM", select "Git".</li>
<li>Enter your repository URL (e.g., <code>https://github.com/your-org/acme-webshop-backend.git</code>).</li>
<li>Specify the "Credentials" if your repository is private (you might need to add Git credentials in Jenkins if not already done).</li>
<li>For "Branches to build", enter <code>*/main</code> (or <code>*/master</code> if that's your default branch).</li>
<li>For "Script Path", ensure it's <code>Jenkinsfile</code> (the default).</li>
<li>Click "Save".</li>
</ul>
</li>
<li><strong>Run the Pipeline</strong>:
<ul>
<li>On the job's dashboard page, click "Build Now".</li>
<li>Observe the build execution in the "Build History". Click on the latest build number and then "Console Output" to see the logs.</li>
</ul>
</li>
</ol>
<p>You will see the pipeline progress through the "Build", "Test", and "Archive Artifacts" stages, and finally execute the <code>post</code> actions.</p>
<h2>Practical Examples and Demonstrations</h2>
<h3>Example 1: Pipeline with a <code>docker</code> agent for a Python application</h3>
<p>Consider a simple Python application for the Acme Webshop that processes orders. We want to ensure it runs in a consistent Python environment.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for the Acme Webshop Order Processor (Python Application)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#6A737D">    // Uses a specific Docker image as the agent for the entire pipeline.</span></span>
<span class="line"><span style="color:#6A737D">    // This ensures that Python 3.9 and pip are available without needing to install them on the Jenkins agent itself.</span></span>
<span class="line"><span style="color:#24292E">    agent {</span></span>
<span class="line"><span style="color:#24292E">        docker {</span></span>
<span class="line"><span style="color:#24292E">            image </span><span style="color:#032F62">'python:3.9-slim-buster'</span><span style="color:#6A737D"> // Specifies the Docker image to use</span></span>
<span class="line"><span style="color:#24292E">            args </span><span style="color:#032F62">'-u root'</span><span style="color:#6A737D">                 // Optional argument to run container as root, if needed for permissions</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 1: Install Dependencies ---</span></span>
<span class="line"><span style="color:#6A737D">        // This stage installs the Python package dependencies listed in requirements.txt.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Install Dependencies'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Installing Python dependencies...'</span></span>
<span class="line"><span style="color:#6A737D">                // Assumes 'requirements.txt' is in the root of the repository.</span></span>
<span class="line"><span style="color:#6A737D">                // 'pip install -r requirements.txt' installs all packages listed in the file.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'pip install -r requirements.txt'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 2: Run Tests ---</span></span>
<span class="line"><span style="color:#6A737D">        // This stage executes unit tests for the Python application.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Run Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Running Python unit tests...'</span></span>
<span class="line"><span style="color:#6A737D">                // Assumes 'pytest' is the test runner and it's listed in requirements.txt.</span></span>
<span class="line"><span style="color:#6A737D">                // '-v' for verbose output, '--cov=.' for coverage reporting.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'pytest -v --cov=.'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 3: Code Linting ---</span></span>
<span class="line"><span style="color:#6A737D">        // This stage performs static code analysis (linting) to check for code style issues and potential bugs.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Code Linting'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Running Pylint...'</span></span>
<span class="line"><span style="color:#6A737D">                // Assumes 'pylint' is installed (from requirements.txt) and configured.</span></span>
<span class="line"><span style="color:#6A737D">                // 'src/' specifies the directory to lint.</span></span>
<span class="line"><span style="color:#6A737D">                // Exit code '0' means successful linting, any other code means issues were found.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'pylint src/'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Python Order Processor CI pipeline finished.'</span></span>
<span class="line"><span style="color:#24292E">            deleteDir() </span><span style="color:#6A737D">// Clean up workspace</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Python Order Processor CI pipeline failed!'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This example demonstrates using a <code>docker</code> agent for environment consistency, which is a common and modern practice in CI. It also introduces a <code>Code Linting</code> stage, a crucial part of code quality.</p>
<h3>Example 2: Pipeline with <code>label</code> and stage-specific <code>agent</code> for different environments</h3>
<p>Imagine the Acme Webshop has a frontend application built with Node.js and requires specific build environments. Some tests can run on any agent, but UI builds need a specialized agent.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for the Acme Webshop Frontend (Node.js Application)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#6A737D">    // Global agent is set to 'none', meaning each stage must define its own agent.</span></span>
<span class="line"><span style="color:#6A737D">    // This provides flexibility when different stages require different environments or resources.</span></span>
<span class="line"><span style="color:#24292E">    agent none</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 1: Install Dependencies ---</span></span>
<span class="line"><span style="color:#6A737D">        // This stage can run on any available Jenkins agent.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Install Dependencies'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent any</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Installing Node.js dependencies...'</span></span>
<span class="line"><span style="color:#6A737D">                // 'npm ci' is preferred over 'npm install' in CI environments</span></span>
<span class="line"><span style="color:#6A737D">                // because it installs exact versions from package-lock.json, ensuring reproducible builds.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm ci'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 2: Run Unit Tests ---</span></span>
<span class="line"><span style="color:#6A737D">        // Unit tests can also run on any agent as they usually don't have heavy UI dependencies.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Run Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent any</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Running Node.js unit tests...'</span></span>
<span class="line"><span style="color:#6A737D">                // Executes the 'test' script defined in package.json (e.g., 'react-scripts test').</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // --- Stage 3: Build UI Artifacts ---</span></span>
<span class="line"><span style="color:#6A737D">        // This stage requires an agent with specific capabilities, perhaps a faster machine</span></span>
<span class="line"><span style="color:#6A737D">        // or one with graphics libraries installed if headless browser testing is involved.</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build UI'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">            // Specifies that this stage must run on an agent labeled 'frontend-build-server'.</span></span>
<span class="line"><span style="color:#6A737D">            // This label would be configured in Jenkins to point to a specific build machine.</span></span>
<span class="line"><span style="color:#24292E">            agent {</span></span>
<span class="line"><span style="color:#24292E">                label </span><span style="color:#032F62">'frontend-build-server'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Building production UI assets...'</span></span>
<span class="line"><span style="color:#6A737D">                // Executes the 'build' script defined in package.json (e.g., 'react-scripts build').</span></span>
<span class="line"><span style="color:#6A737D">                // This typically compiles and minifies frontend assets.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm run build'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Frontend CI pipeline finished.'</span></span>
<span class="line"><span style="color:#24292E">            deleteDir()</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Frontend UI CI pipeline completed successfully!'</span></span>
<span class="line"><span style="color:#6A737D">            // Archive the built frontend assets (e.g., the 'build' or 'dist' folder).</span></span>
<span class="line"><span style="color:#24292E">            archiveArtifacts </span><span style="color:#005CC5">artifacts</span><span style="color:#24292E">: </span><span style="color:#032F62">'build/**'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Frontend UI CI pipeline failed!'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This example demonstrates the power of <code>agent none</code> at the pipeline level and using stage-specific <code>agent</code> definitions, including <code>label</code> for specialized build environments. It also shows a common <code>post</code> action for archiving frontend build artifacts.</p>
<h2>Exercises and Practice Activities</h2>
<h3>Exercise 1: Customize the Acme Webshop Backend Pipeline</h3>
<p>Modify the provided <code>Jenkinsfile</code> for the Acme Webshop backend application:</p>
<ol>
<li><strong>Change Agent</strong>: Instead of <code>agent any</code>, configure the pipeline to run inside a Docker container using the <code>maven:3.8.1-jdk-11</code> image. This ensures a consistent build environment.</li>
<li><strong>Add a "Prepare Environment" Stage</strong>: Introduce a new stage before "Build" called "Prepare Environment". In this stage, just use an <code>echo</code> step to print "Setting up the build environment..."</li>
<li><strong>Add a <code>post</code> <code>unstable</code> action</strong>: Add a <code>unstable</code> block to the <code>post</code> section that echoes "Pipeline was unstable (e.g., some tests failed but build succeeded)."</li>
<li><strong>Add a <code>post</code> <code>changed</code> action</strong>: Add a <code>changed</code> block to the <code>post</code> section that echoes "Pipeline status changed from previous run."</li>
</ol>
<p>After making these changes, commit the <code>Jenkinsfile</code> and run the Jenkins job. Observe the console output to verify your changes.</p>
<h3>Exercise 2: Create a Pipeline for a New Simple Application</h3>
<p>Imagine the Acme Webshop is introducing a new microservice written in Go. This service has a simple <code>main.go</code> file and uses Go modules for dependencies.</p>
<p>Your task is to create a <code>Jenkinsfile</code> for this Go application that includes the following stages:</p>
<ol>
<li><strong>Checkout Code</strong>: (Implicit, Jenkins does this by default if not <code>skipDefaultCheckout</code>)</li>
<li><strong>Go Mod Tidy</strong>: A stage to ensure <code>go.mod</code> and <code>go.sum</code> are clean and up-to-date.</li>
<li><strong>Build</strong>: A stage to build the Go executable.</li>
<li><strong>Run Tests</strong>: A stage to execute unit tests.</li>
<li><strong>Archive Executable</strong>: A stage to archive the compiled executable.</li>
</ol>
<p>Consider:</p>
<ul>
<li>What <code>agent</code> would be appropriate for a Go application? (Hint: <code>docker</code> with a <code>golang</code> image)</li>
<li>What shell commands (<code>sh</code>) are needed for <code>go mod tidy</code>, <code>go build</code>, and <code>go test</code>?</li>
<li>How would you archive the executable (e.g., <code>my-go-app</code>)?</li>
</ul>
<p>Create a dummy Go project with a <code>main.go</code> and <code>go.mod</code> file, then integrate your <code>Jenkinsfile</code> and create a Jenkins job for it.</p>
<p><em>Example <code>main.go</code></em>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">go</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">package</span><span style="color:#6F42C1"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#032F62"> "</span><span style="color:#6F42C1">fmt</span><span style="color:#032F62">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">func</span><span style="color:#6F42C1"> main</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#24292E">    fmt.</span><span style="color:#6F42C1">Println</span><span style="color:#24292E">(</span><span style="color:#032F62">"Hello from Acme Go Service!"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><em>Example <code>main_test.go</code></em>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">go</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">package</span><span style="color:#6F42C1"> main</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#032F62"> "</span><span style="color:#6F42C1">testing</span><span style="color:#032F62">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">func</span><span style="color:#6F42C1"> TestMain</span><span style="color:#24292E">(</span><span style="color:#E36209">t</span><span style="color:#D73A49"> *</span><span style="color:#6F42C1">testing</span><span style="color:#24292E">.</span><span style="color:#6F42C1">T</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">    // A simple placeholder test</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#005CC5"> 1</span><span style="color:#D73A49">+</span><span style="color:#005CC5">1</span><span style="color:#D73A49"> !=</span><span style="color:#005CC5"> 2</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        t.</span><span style="color:#6F42C1">Errorf</span><span style="color:#24292E">(</span><span style="color:#032F62">"Expected 1+1 to be 2, but it was not"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><em>To initialize <code>go.mod</code></em>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">go</span><span style="color:#032F62"> mod</span><span style="color:#032F62"> init</span><span style="color:#032F62"> your_module_path/acme-go-service</span></span></code></pre></div></div></div>
<p>Then run <code>go mod tidy</code> to ensure <code>go.sum</code> is generated.</p>
  
</div>

<div id="chapter-2.4">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Automating Build Processes and Dependency Management</h1><p>Automating build processes and managing dependencies are fundamental steps in establishing a robust Continuous Integration pipeline. These processes transform source code into executable artifacts and ensure all necessary libraries and components are available and correctly configured. Effective automation in this area reduces manual errors, speeds up development cycles, and provides consistent, reliable builds, which are crucial for the "Acme Webshop" and any other modern application.</p>
<h2>Understanding Automated Build Processes</h2>
<p>An automated build process compiles source code, links libraries, and packages the application into a deployable format without manual intervention. This ensures consistency and reproducibility. The build process typically involves several stages, including source code retrieval, dependency resolution, compilation, and packaging.</p>
<p>For the "Acme Webshop" application, which we assume is a Java-based application, the build process would involve compiling Java source files, packaging them into a <code>.jar</code> or <code>.war</code> file, and potentially running pre-packaging scripts. For a Node.js application, it would involve executing <code>npm install</code> to download dependencies and then running <code>npm run build</code> to transpile code and bundle assets.</p>
<h3>Key Components of a Build Process</h3>
<ol>
<li>
<p><strong>Source Code Retrieval:</strong> The first step is to fetch the latest code from the version control system (VCS), such as Git. As discussed in previous lessons, consistent branching strategies ensure the correct code version is used.</p>
<ul>
<li><strong>Example 1 (Java/Maven):</strong> A Jenkins pipeline might use the <code>git</code> step to clone the repository.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout Code'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ... subsequent stages</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
<li><strong>Example 2 (Node.js/NPM):</strong> Similarly, for a Node.js front-end application, the Git checkout would be identical.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout Code'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/frontend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ... subsequent stages</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Dependency Resolution:</strong> External libraries and frameworks that the application relies on must be downloaded and made available to the build. This is where dependency management tools come into play.</p>
</li>
<li>
<p><strong>Compilation/Transpilation:</strong> Source code written in high-level languages needs to be converted into machine-readable code or an intermediate bytecode.</p>
<ul>
<li><strong>Example 1 (Java):</strong> Maven or Gradle will compile Java <code>.java</code> files into <code>.class</code> files.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">xml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">&lt;!-- Excerpt from pom.xml for Acme Webshop Backend --&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">build</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">plugins</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">plugin</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.apache.maven.plugins&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;maven-compiler-plugin&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;3.8.1&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">configuration</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">source</span><span style="color:#24292E">&gt;11&lt;/</span><span style="color:#22863A">source</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">target</span><span style="color:#24292E">&gt;11&lt;/</span><span style="color:#22863A">target</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;/</span><span style="color:#22863A">configuration</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">plugin</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#6A737D">        &lt;!-- Other build plugins --&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">plugins</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">build</span><span style="color:#24292E">&gt;</span></span></code></pre></div></div></div>
</li>
<li><strong>Example 2 (TypeScript/JavaScript):</strong> For a TypeScript-based front-end, a tool like TypeScript compiler (<code>tsc</code>) or Webpack might transpile TypeScript to JavaScript.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">json</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Excerpt from tsconfig.json for Acme Webshop Frontend</span></span>
<span class="line"><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#005CC5">  "compilerOptions"</span><span style="color:#24292E">: {</span></span>
<span class="line"><span style="color:#005CC5">    "target"</span><span style="color:#24292E">: </span><span style="color:#032F62">"es5"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "module"</span><span style="color:#24292E">: </span><span style="color:#032F62">"es2015"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "strict"</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "esModuleInterop"</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "skipLibCheck"</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "forceConsistentCasingInFileNames"</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">  },</span></span>
<span class="line"><span style="color:#005CC5">  "include"</span><span style="color:#24292E">: [</span><span style="color:#032F62">"src/**/*.ts"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Packaging:</strong> The compiled code, along with necessary resources and metadata, is bundled into a deployable artifact.</p>
<ul>
<li><strong>Example 1 (Java/Maven):</strong> Maven packages the compiled classes and resources into a <code>.jar</code> or <code>.war</code> file.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">xml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">&lt;!-- Excerpt from pom.xml for Acme Webshop Backend --&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">packaging</span><span style="color:#24292E">&gt;jar&lt;/</span><span style="color:#22863A">packaging</span><span style="color:#24292E">&gt; </span><span style="color:#6A737D">&lt;!-- or war --&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">build</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">plugins</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">plugin</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.springframework.boot&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;spring-boot-maven-plugin&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;2.5.4&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">executions</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">execution</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                    &lt;</span><span style="color:#22863A">goals</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                        &lt;</span><span style="color:#22863A">goal</span><span style="color:#24292E">&gt;repackage&lt;/</span><span style="color:#22863A">goal</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                    &lt;/</span><span style="color:#22863A">goals</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;/</span><span style="color:#22863A">execution</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;/</span><span style="color:#22863A">executions</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">plugin</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">plugins</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">build</span><span style="color:#24292E">&gt;</span></span></code></pre></div></div></div>
</li>
<li><strong>Example 2 (Node.js/NPM):</strong> A Node.js application might be packaged into a distributable folder containing transpiled JavaScript and assets, often using tools like Webpack or Rollup.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">json</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Excerpt from package.json for Acme Webshop Frontend</span></span>
<span class="line"><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#005CC5">  "name"</span><span style="color:#24292E">: </span><span style="color:#032F62">"acme-webshop-frontend"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">  "version"</span><span style="color:#24292E">: </span><span style="color:#032F62">"1.0.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">  "scripts"</span><span style="color:#24292E">: {</span></span>
<span class="line"><span style="color:#005CC5">    "build"</span><span style="color:#24292E">: </span><span style="color:#032F62">"webpack --config webpack.prod.js"</span></span>
<span class="line"><span style="color:#24292E">  },</span></span>
<span class="line"><span style="color:#005CC5">  "dependencies"</span><span style="color:#24292E">: {</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#24292E">  },</span></span>
<span class="line"><span style="color:#005CC5">  "devDependencies"</span><span style="color:#24292E">: {</span></span>
<span class="line"><span style="color:#005CC5">    "webpack"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^5.0.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "webpack-cli"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^4.0.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#6A737D">    // ...</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
</ul>
</li>
</ol>
<h2>Dependency Management</h2>
<p>Dependency management is the process of identifying, resolving, and managing all the external libraries and modules an application relies on. Proper dependency management ensures consistent builds, avoids conflicts, and enhances security by using vetted versions.</p>
<h3>Challenges in Dependency Management</h3>
<ul>
<li><strong>Version Conflicts (Dependency Hell):</strong> Different parts of an application or its dependencies might require conflicting versions of the same library.</li>
<li><strong>Transitive Dependencies:</strong> Libraries themselves have dependencies, leading to a complex graph of required components.</li>
<li><strong>Security Vulnerabilities:</strong> Outdated or unpatched dependencies can introduce security risks.</li>
<li><strong>Build Reproducibility:</strong> Without explicit dependency locking, builds might be inconsistent if a dependency's latest version changes.</li>
</ul>
<h3>Common Dependency Management Tools</h3>
<p>Different programming languages and ecosystems have their dedicated dependency management tools.</p>
<ol>
<li>
<p><strong>Maven (Java):</strong> Maven uses a <code>pom.xml</code> (Project Object Model) file to declare project dependencies. It automatically downloads required <code>.jar</code> files from remote repositories (like Maven Central) and manages transitive dependencies.</p>
<ul>
<li><strong>Example (Acme Webshop Backend <code>pom.xml</code> snippet):</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">xml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">project</span><span style="color:#6F42C1"> xmlns</span><span style="color:#24292E">=</span><span style="color:#032F62">"http://maven.apache.org/POM/4.0.0"</span></span>
<span class="line"><span style="color:#6F42C1">         xmlns:xsi</span><span style="color:#24292E">=</span><span style="color:#032F62">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
<span class="line"><span style="color:#6F42C1">         xsi:schemaLocation</span><span style="color:#24292E">=</span><span style="color:#032F62">"http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">modelVersion</span><span style="color:#24292E">&gt;4.0.0&lt;/</span><span style="color:#22863A">modelVersion</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;com.acme&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;acme-webshop-backend&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;1.0.0-SNAPSHOT&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">packaging</span><span style="color:#24292E">&gt;jar&lt;/</span><span style="color:#22863A">packaging</span><span style="color:#24292E">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">dependencies</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#6A737D">        &lt;!-- Spring Boot Web Starter for RESTful services --&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.springframework.boot&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;spring-boot-starter-web&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;2.5.4&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#6A737D">        &lt;!-- Spring Data JPA for database interaction --&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.springframework.boot&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;spring-boot-starter-data-jpa&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;2.5.4&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#6A737D">        &lt;!-- H2 Database for in-memory development database --&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;com.h2database&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;h2&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;1.4.200&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">scope</span><span style="color:#24292E">&gt;runtime&lt;/</span><span style="color:#22863A">scope</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#6A737D">        &lt;!-- Lombok for boilerplate code reduction --&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.projectlombok&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;lombok&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;1.18.20&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">scope</span><span style="color:#24292E">&gt;provided&lt;/</span><span style="color:#22863A">scope</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#6A737D">        &lt;!-- JUnit Jupiter for unit testing --&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.junit.jupiter&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;junit-jupiter-api&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;5.7.2&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">scope</span><span style="color:#24292E">&gt;test&lt;/</span><span style="color:#22863A">scope</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">dependency</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">dependencies</span><span style="color:#24292E">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">build</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">plugins</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">plugin</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.springframework.boot&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;spring-boot-maven-plugin&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;2.5.4&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">executions</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                    &lt;</span><span style="color:#22863A">execution</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                        &lt;</span><span style="color:#22863A">goals</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                            &lt;</span><span style="color:#22863A">goal</span><span style="color:#24292E">&gt;repackage&lt;/</span><span style="color:#22863A">goal</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                        &lt;/</span><span style="color:#22863A">goals</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                    &lt;/</span><span style="color:#22863A">execution</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;/</span><span style="color:#22863A">executions</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;/</span><span style="color:#22863A">plugin</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;</span><span style="color:#22863A">plugin</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;org.apache.maven.plugins&lt;/</span><span style="color:#22863A">groupId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;maven-compiler-plugin&lt;/</span><span style="color:#22863A">artifactId</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;3.8.1&lt;/</span><span style="color:#22863A">version</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;</span><span style="color:#22863A">configuration</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                    &lt;</span><span style="color:#22863A">source</span><span style="color:#24292E">&gt;11&lt;/</span><span style="color:#22863A">source</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                    &lt;</span><span style="color:#22863A">target</span><span style="color:#24292E">&gt;11&lt;/</span><span style="color:#22863A">target</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">                &lt;/</span><span style="color:#22863A">configuration</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">            &lt;/</span><span style="color:#22863A">plugin</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">plugins</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">build</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">project</span><span style="color:#24292E">&gt;</span></span></code></pre></div></div></div>
</li>
<li><strong>Explanation:</strong> Each <code>&lt;dependency&gt;</code> block specifies a <code>groupId</code>, <code>artifactId</code>, and <code>version</code>. Maven fetches these from configured repositories. The <code>scope</code> element defines when the dependency is available (e.g., <code>runtime</code> for dependencies needed at runtime but not compile-time, <code>test</code> for testing).</li>
</ul>
</li>
<li>
<p><strong>Gradle (Java, Kotlin, Groovy):</strong> Gradle uses a Groovy or Kotlin DSL (Domain Specific Language) to define dependencies in <code>build.gradle</code> files. It offers more flexibility than Maven and is often preferred for larger, multi-module projects.</p>
<ul>
<li><strong>Example (Hypothetical Acme Webshop Backend <code>build.gradle</code> snippet):</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">plugins {</span></span>
<span class="line"><span style="color:#24292E">    id </span><span style="color:#032F62">'java'</span></span>
<span class="line"><span style="color:#24292E">    id </span><span style="color:#032F62">'org.springframework.boot'</span><span style="color:#24292E"> version </span><span style="color:#032F62">'2.5.4'</span></span>
<span class="line"><span style="color:#24292E">    id </span><span style="color:#032F62">'io.spring.dependency-management'</span><span style="color:#24292E"> version </span><span style="color:#032F62">'1.0.11.RELEASE'</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">group </span><span style="color:#032F62">'com.acme'</span></span>
<span class="line"><span style="color:#24292E">version </span><span style="color:#032F62">'1.0.0-SNAPSHOT'</span></span>
<span class="line"><span style="color:#24292E">sourceCompatibility </span><span style="color:#D73A49">=</span><span style="color:#032F62"> '11'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">repositories {</span></span>
<span class="line"><span style="color:#24292E">    mavenCentral()</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">dependencies {</span></span>
<span class="line"><span style="color:#24292E">    implementation </span><span style="color:#032F62">'org.springframework.boot:spring-boot-starter-web'</span></span>
<span class="line"><span style="color:#24292E">    implementation </span><span style="color:#032F62">'org.springframework.boot:spring-boot-starter-data-jpa'</span></span>
<span class="line"><span style="color:#24292E">    runtimeOnly </span><span style="color:#032F62">'com.h2database:h2'</span></span>
<span class="line"><span style="color:#24292E">    compileOnly </span><span style="color:#032F62">'org.projectlombok:lombok'</span></span>
<span class="line"><span style="color:#24292E">    annotationProcessor </span><span style="color:#032F62">'org.projectlombok:lombok'</span></span>
<span class="line"><span style="color:#24292E">    testImplementation </span><span style="color:#032F62">'org.springframework.boot:spring-boot-starter-test'</span></span>
<span class="line"><span style="color:#24292E">    testImplementation </span><span style="color:#032F62">'org.junit.jupiter:junit-jupiter-api:5.7.2'</span></span>
<span class="line"><span style="color:#24292E">    testRuntimeOnly </span><span style="color:#032F62">'org.junit.jupiter:junit-jupiter-engine:5.7.2'</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">test {</span></span>
<span class="line"><span style="color:#24292E">    useJUnitPlatform()</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
<li><strong>Explanation:</strong> Dependencies are declared using <code>implementation</code>, <code>runtimeOnly</code>, <code>compileOnly</code>, <code>annotationProcessor</code>, and <code>testImplementation</code> configurations, providing fine-grained control over their usage in different phases.</li>
</ul>
</li>
<li>
<p><strong>npm (Node.js):</strong> npm uses <code>package.json</code> to manage dependencies for Node.js projects. It distinguishes between <code>dependencies</code> (required for application to run) and <code>devDependencies</code> (required for development/build process). <code>npm install</code> downloads packages from the npm registry.</p>
<ul>
<li><strong>Example (Acme Webshop Frontend <code>package.json</code> snippet):</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">json</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#005CC5">  "name"</span><span style="color:#24292E">: </span><span style="color:#032F62">"acme-webshop-frontend"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">  "version"</span><span style="color:#24292E">: </span><span style="color:#032F62">"1.0.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">  "description"</span><span style="color:#24292E">: </span><span style="color:#032F62">"Frontend application for Acme Webshop"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">  "main"</span><span style="color:#24292E">: </span><span style="color:#032F62">"index.js"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">  "scripts"</span><span style="color:#24292E">: {</span></span>
<span class="line"><span style="color:#005CC5">    "start"</span><span style="color:#24292E">: </span><span style="color:#032F62">"webpack serve --mode development"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "build"</span><span style="color:#24292E">: </span><span style="color:#032F62">"webpack --mode production"</span></span>
<span class="line"><span style="color:#24292E">  },</span></span>
<span class="line"><span style="color:#005CC5">  "dependencies"</span><span style="color:#24292E">: {</span></span>
<span class="line"><span style="color:#005CC5">    "react"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^17.0.2"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "react-dom"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^17.0.2"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "axios"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^0.21.1"</span></span>
<span class="line"><span style="color:#24292E">  },</span></span>
<span class="line"><span style="color:#005CC5">  "devDependencies"</span><span style="color:#24292E">: {</span></span>
<span class="line"><span style="color:#005CC5">    "@babel/core"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^7.15.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "@babel/preset-env"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^7.15.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "@babel/preset-react"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^7.14.5"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "babel-loader"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^8.2.2"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "css-loader"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^6.2.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "style-loader"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^3.2.1"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "webpack"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^5.50.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "webpack-cli"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^4.8.0"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">    "webpack-dev-server"</span><span style="color:#24292E">: </span><span style="color:#032F62">"^4.0.0"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
<li><strong>Explanation:</strong> <code>dependencies</code> list runtime requirements (like React, Axios), while <code>devDependencies</code> list build tools (like Babel, Webpack). <code>npm install</code> reads this file and installs packages into <code>node_modules</code>. A <code>package-lock.json</code> file is generated to lock down exact dependency versions for reproducible builds.</li>
</ul>
</li>
<li>
<p><strong>Pip (Python):</strong> Pip is the standard package installer for Python. Dependencies are typically listed in a <code>requirements.txt</code> file, which specifies package names and versions.</p>
<ul>
<li><strong>Example (Acme Webshop ML Service <code>requirements.txt</code> snippet):</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">javascript</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">Flask</span><span style="color:#D73A49">==</span><span style="color:#005CC5">2.0</span><span style="color:#24292E">.</span><span style="color:#005CC5">1</span></span>
<span class="line"><span style="color:#24292E">requests</span><span style="color:#D73A49">==</span><span style="color:#005CC5">2.26</span><span style="color:#24292E">.</span><span style="color:#005CC5">0</span></span>
<span class="line"><span style="color:#24292E">numpy</span><span style="color:#D73A49">==</span><span style="color:#005CC5">1.21</span><span style="color:#24292E">.</span><span style="color:#005CC5">2</span></span>
<span class="line"><span style="color:#24292E">pandas</span><span style="color:#D73A49">==</span><span style="color:#005CC5">1.3</span><span style="color:#24292E">.</span><span style="color:#005CC5">3</span></span>
<span class="line"><span style="color:#24292E">scikit</span><span style="color:#D73A49">-</span><span style="color:#24292E">learn</span><span style="color:#D73A49">==</span><span style="color:#005CC5">0.24</span><span style="color:#24292E">.</span><span style="color:#005CC5">2</span></span></code></pre></div></div></div>
</li>
<li><strong>Explanation:</strong> Each line specifies a package and its exact version (e.g., <code>Flask==2.0.1</code>) or a version range. <code>pip install -r requirements.txt</code> installs all listed dependencies. A <code>pip freeze &gt; requirements.txt</code> command can capture the exact versions of all installed packages in an environment.</li>
</ul>
</li>
</ol>
<h3>Strategies for Robust Dependency Management in CI</h3>
<ol>
<li><strong>Version Pinning/Locking:</strong> Always specify exact versions for direct dependencies to ensure consistent builds across different environments. Dependency lock files (<code>package-lock.json</code> for npm, <code>Pipfile.lock</code> for Pipenv, <code>Gemfile.lock</code> for RubyGems) automatically lock transitive dependency versions.</li>
<li><strong>Using Private/Internal Repositories:</strong> For proprietary libraries or to cache external dependencies, organizations often use private repositories (e.g., Nexus, Artifactory). This ensures dependencies are available even if public repositories are down and allows for internal vetting.
<ul>
<li><strong>Scenario:</strong> Acme Webshop develops a proprietary payment gateway SDK that needs to be used by the backend service. Instead of relying on a public repository, they publish it to an internal Maven repository. The <code>pom.xml</code> would then include a repository definition:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">xml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">repositories</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">repository</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;acme-internal&lt;/</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">name</span><span style="color:#24292E">&gt;Acme Internal Maven Repository&lt;/</span><span style="color:#22863A">name</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">url</span><span style="color:#24292E">&gt;https://nexus.acme.com/repository/maven-releases/&lt;/</span><span style="color:#22863A">url</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">repository</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">repositories</span><span style="color:#24292E">&gt;</span></span></code></pre></div></div></div>
</li>
</ul>
</li>
<li><strong>Dependency Caching:</strong> Build tools can cache downloaded dependencies, significantly speeding up subsequent builds. In a CI environment like Jenkins, this can be configured using workspace caching or dedicated plugin features.</li>
<li><strong>Regular Updates and Audits:</strong> Periodically update dependencies to benefit from bug fixes and security patches. Tools like <code>npm audit</code> or Maven dependency plugins can scan for known vulnerabilities.
<ul>
<li><strong>Hypothetical Scenario:</strong> The Acme Webshop's front-end team runs <code>npm audit</code> as part of their CI pipeline. If critical vulnerabilities are found, the build might fail, prompting developers to update the affected dependency.</li>
</ul>
</li>
</ol>
<h2>Integrating Build Processes and Dependency Management into Jenkins Pipelines</h2>
<p>The Jenkins Declarative Pipeline (introduced in the previous lesson) provides a structured way to define these steps.</p>
<h3>Example: Jenkins Pipeline for Acme Webshop Backend (Java/Maven)</h3>
<p>This pipeline demonstrates checking out code, resolving dependencies, compiling, and packaging the application.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any </span><span style="color:#6A737D">// Specifies where the pipeline will run (e.g., any available agent)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout Source Code'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Retrieves the latest code from the 'main' branch of the GitHub repository</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build with Maven'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Uses the 'sh' step to execute shell commands</span></span>
<span class="line"><span style="color:#6A737D">                // 'mvn clean install' performs several actions:</span></span>
<span class="line"><span style="color:#6A737D">                // 1. 'clean': Deletes the target directory, ensuring a fresh build.</span></span>
<span class="line"><span style="color:#6A737D">                // 2. 'install': Compiles the source code, runs tests (if any),</span></span>
<span class="line"><span style="color:#6A737D">                //    packages the application (e.g., into a JAR), and installs</span></span>
<span class="line"><span style="color:#6A737D">                //    it into the local Maven repository (for multi-module projects).</span></span>
<span class="line"><span style="color:#6A737D">                //    Crucially, it resolves all declared dependencies from pom.xml.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Archive Artifacts'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Archives the generated JAR file, making it accessible from the Jenkins build page.</span></span>
<span class="line"><span style="color:#6A737D">                // This JAR is the deployable artifact for the Acme Webshop backend.</span></span>
<span class="line"><span style="color:#24292E">                archiveArtifacts </span><span style="color:#005CC5">artifacts</span><span style="color:#24292E">: </span><span style="color:#032F62">'target/*.jar'</span><span style="color:#24292E">, </span><span style="color:#005CC5">fingerprint</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#6A737D">        // Post-build actions, e.g., notifications</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build pipeline for Acme Webshop Backend completed."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Acme Webshop Backend build successful!"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Acme Webshop Backend build failed! Check logs for details."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h3>Example: Jenkins Pipeline for Acme Webshop Frontend (Node.js/npm)</h3>
<p>This pipeline handles Node.js project setup, dependency installation, and a build step to create production-ready assets.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent {</span></span>
<span class="line"><span style="color:#6A737D">        // Specifies an agent with the 'nodejs' label to ensure Node.js is available</span></span>
<span class="line"><span style="color:#24292E">        label </span><span style="color:#032F62">'nodejs'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout Source Code'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Retrieves the latest code from the 'main' branch of the GitHub repository</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/frontend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Install Dependencies'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // 'npm ci' (clean install) is preferred in CI environments over 'npm install'.</span></span>
<span class="line"><span style="color:#6A737D">                // It ensures that exact versions from package-lock.json are used,</span></span>
<span class="line"><span style="color:#6A737D">                // providing reproducible builds and avoiding unexpected dependency updates.</span></span>
<span class="line"><span style="color:#6A737D">                // It also cleans the 'node_modules' directory before installing.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm ci'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Frontend Assets'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Executes the 'build' script defined in package.json.</span></span>
<span class="line"><span style="color:#6A737D">                // This typically runs Webpack or a similar tool to transpile code,</span></span>
<span class="line"><span style="color:#6A737D">                // bundle assets, minify, and optimize for production.</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm run build'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Archive Build Output'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Archives the generated production build directory (e.g., 'dist' or 'build').</span></span>
<span class="line"><span style="color:#6A737D">                // These static assets are the deployable artifact for the Acme Webshop frontend.</span></span>
<span class="line"><span style="color:#24292E">                archiveArtifacts </span><span style="color:#005CC5">artifacts</span><span style="color:#24292E">: </span><span style="color:#032F62">'dist/**'</span><span style="color:#24292E">, </span><span style="color:#005CC5">fingerprint</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build pipeline for Acme Webshop Frontend completed."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Acme Webshop Frontend build successful!"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Acme Webshop Frontend build failed! Check logs for details."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h2>Exercises and Practice Activities</h2>
<p>To solidify your understanding, perform the following exercises.</p>
<ol>
<li>
<p><strong>Modify the Acme Webshop Backend Pipeline:</strong></p>
<ul>
<li>Create a simple <code>pom.xml</code> for a hypothetical small Java application (you don't need actual Java code, just the <code>pom.xml</code>).</li>
<li>Integrate this into a Jenkins Declarative Pipeline.</li>
<li>Add a new <code>stage</code> named <code>Validate POM</code> <em>before</em> the <code>Build with Maven</code> stage that runs <code>mvn validate</code>. This ensures the <code>pom.xml</code> is syntactically correct and all necessary plugins are configured before a full build.</li>
<li>Run the pipeline and observe the output, specifically how Maven resolves dependencies.</li>
</ul>
</li>
<li>
<p><strong>Explore Dependency Conflicts (Hypothetical):</strong></p>
<ul>
<li>For the Acme Webshop Frontend (Node.js), manually edit the <code>package.json</code> to introduce a dependency conflict. For example, add two different popular libraries that are known to have conflicting transitive dependencies (e.g., an older version of <code>lodash</code> and a newer one required by another package).</li>
<li>Attempt to run <code>npm install</code> locally. What error messages do you get?</li>
<li>How does <code>npm ci</code> behave differently in a CI context when <code>package-lock.json</code> is present and potentially in conflict with <code>package.json</code> changes? (Hint: <code>npm ci</code> will strictly adhere to the lock file).</li>
</ul>
</li>
<li>
<p><strong>Implement Dependency Caching in Jenkins:</strong></p>
<ul>
<li>Research how to implement dependency caching for Maven (<code>.m2</code> directory) or npm (<code>node_modules</code> directory) within a Jenkins pipeline using the <code>cache</code> step or a dedicated Jenkins plugin (e.g., "Workspace Cleanup Plugin" with exclusions, or Jenkins built-in <code>stash</code>/<code>unstash</code> for more advanced scenarios).</li>
<li>Modify one of the provided Jenkins Pipelines to include a caching strategy for dependencies. (Focus on preventing repeated downloads of the same libraries across builds).</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-2.5">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Implementing Automated Unit and Integration Testing in CI</h1><p>Automated testing is a fundamental component of any robust Continuous Integration (CI) pipeline. By integrating unit and integration tests directly into the build process, development teams can quickly detect regressions, ensure code quality, and maintain confidence in their software releases. This proactive approach to quality assurance drastically reduces the time and effort required to identify and fix defects, ultimately accelerating the delivery of stable and reliable applications.</p>
<h2>Understanding Unit Testing in CI</h2>
<p>Unit testing involves testing individual components or "units" of code in isolation. The goal is to verify that each unit of source code performs as expected. In a CI environment, unit tests are typically the fastest to run and provide immediate feedback on local changes.</p>
<h3>Principles of Effective Unit Tests</h3>
<p>Effective unit tests adhere to several key principles:</p>
<ul>
<li><strong>Isolation:</strong> Each test should run independently of others and external dependencies. Mocking or stubbing techniques are used to achieve this isolation, simulating the behavior of dependencies rather than interacting with actual external systems.</li>
<li><strong>Automation:</strong> Unit tests must be fully automated to be integrated into a CI pipeline. Manual execution defeats the purpose of rapid feedback.</li>
<li><strong>Repeatability:</strong> Running the same test multiple times should yield the same result, assuming no code changes. This ensures consistency and reliability.</li>
<li><strong>Fast Execution:</strong> Unit tests should complete quickly, typically within milliseconds. Slow unit tests hinder rapid feedback and discourage developers from running them frequently.</li>
<li><strong>Small Scope:</strong> Each unit test should focus on a single piece of functionality within a single unit of code.</li>
</ul>
<h3>Integrating Unit Tests into the Acme Webshop CI Pipeline</h3>
<p>For the Acme Webshop, which might be built using a Java Spring Boot backend and a React frontend, unit tests would exist for both components.</p>
<p><strong>Java Backend Example (JUnit 5 and Maven)</strong></p>
<p>Consider a <code>ProductService</code> in the Acme Webshop responsible for fetching product details. A unit test for a method like <code>getProductById</code> would verify its behavior without actually hitting a database.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">java</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// src/main/java/com/acmewebshop/service/ProductService.java</span></span>
<span class="line"><span style="color:#D73A49">package</span><span style="color:#24292E"> com.acmewebshop.service;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> com.acmewebshop.model.Product;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> com.acmewebshop.repository.ProductRepository;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.springframework.stereotype.Service;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> java.util.Optional;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">Service</span></span>
<span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> ProductService</span><span style="color:#24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#D73A49"> final</span><span style="color:#24292E"> ProductRepository productRepository;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    public</span><span style="color:#6F42C1"> ProductService</span><span style="color:#24292E">(ProductRepository </span><span style="color:#E36209">productRepository</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#24292E">.productRepository </span><span style="color:#D73A49">=</span><span style="color:#24292E"> productRepository;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    public</span><span style="color:#24292E"> Optional&lt;</span><span style="color:#D73A49">Product</span><span style="color:#24292E">&gt; </span><span style="color:#6F42C1">getProductById</span><span style="color:#24292E">(Long </span><span style="color:#E36209">id</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> productRepository.</span><span style="color:#6F42C1">findById</span><span style="color:#24292E">(id);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    public</span><span style="color:#24292E"> Product </span><span style="color:#6F42C1">saveProduct</span><span style="color:#24292E">(Product </span><span style="color:#E36209">product</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Assume some business logic here, e.g., validation</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#24292E"> productRepository.</span><span style="color:#6F42C1">save</span><span style="color:#24292E">(product);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>A corresponding unit test would use a mocking framework like Mockito to simulate the <code>ProductRepository</code>.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">java</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// src/test/java/com/acmewebshop/service/ProductServiceTest.java</span></span>
<span class="line"><span style="color:#D73A49">package</span><span style="color:#24292E"> com.acmewebshop.service;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> com.acmewebshop.model.Product;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> com.acmewebshop.repository.ProductRepository;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.junit.jupiter.api.BeforeEach;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.junit.jupiter.api.Test;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.junit.jupiter.api.extension.ExtendWith;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.mockito.InjectMocks;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.mockito.Mock;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.mockito.junit.jupiter.MockitoExtension;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> java.util.Optional;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#D73A49"> static</span><span style="color:#24292E"> org.junit.jupiter.api.Assertions.</span><span style="color:#005CC5">*</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#D73A49"> static</span><span style="color:#24292E"> org.mockito.Mockito.</span><span style="color:#005CC5">*</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">ExtendWith</span><span style="color:#24292E">(MockitoExtension.class)</span></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> ProductServiceTest</span><span style="color:#24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Mock</span><span style="color:#6A737D"> // This creates a mock instance of ProductRepository</span></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#24292E"> ProductRepository productRepository;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">InjectMocks</span><span style="color:#6A737D"> // This injects the mock into ProductService</span></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#24292E"> ProductService productService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#24292E"> Product testProduct;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">BeforeEach</span></span>
<span class="line"><span style="color:#D73A49">    void</span><span style="color:#6F42C1"> setUp</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#24292E">        testProduct </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Product</span><span style="color:#24292E">(</span><span style="color:#005CC5">1L</span><span style="color:#24292E">, </span><span style="color:#032F62">"Laptop"</span><span style="color:#24292E">, </span><span style="color:#005CC5">1200.00</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Test</span></span>
<span class="line"><span style="color:#D73A49">    void</span><span style="color:#6F42C1"> getProductById_shouldReturnProduct_whenProductExists</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#6A737D">        // Define the behavior of the mocked repository</span></span>
<span class="line"><span style="color:#6F42C1">        when</span><span style="color:#24292E">(productRepository.</span><span style="color:#6F42C1">findById</span><span style="color:#24292E">(</span><span style="color:#005CC5">1L</span><span style="color:#24292E">)).</span><span style="color:#6F42C1">thenReturn</span><span style="color:#24292E">(Optional.</span><span style="color:#6F42C1">of</span><span style="color:#24292E">(testProduct));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        Optional&lt;</span><span style="color:#D73A49">Product</span><span style="color:#24292E">&gt; foundProduct </span><span style="color:#D73A49">=</span><span style="color:#24292E"> productService.</span><span style="color:#6F42C1">getProductById</span><span style="color:#24292E">(</span><span style="color:#005CC5">1L</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">        assertTrue</span><span style="color:#24292E">(foundProduct.</span><span style="color:#6F42C1">isPresent</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#6F42C1">        assertEquals</span><span style="color:#24292E">(</span><span style="color:#032F62">"Laptop"</span><span style="color:#24292E">, foundProduct.</span><span style="color:#6F42C1">get</span><span style="color:#24292E">().</span><span style="color:#6F42C1">getName</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#6F42C1">        verify</span><span style="color:#24292E">(productRepository, </span><span style="color:#6F42C1">times</span><span style="color:#24292E">(</span><span style="color:#005CC5">1</span><span style="color:#24292E">)).</span><span style="color:#6F42C1">findById</span><span style="color:#24292E">(</span><span style="color:#005CC5">1L</span><span style="color:#24292E">); </span><span style="color:#6A737D">// Verify interaction</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Test</span></span>
<span class="line"><span style="color:#D73A49">    void</span><span style="color:#6F42C1"> getProductById_shouldReturnEmpty_whenProductDoesNotExist</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#6F42C1">        when</span><span style="color:#24292E">(productRepository.</span><span style="color:#6F42C1">findById</span><span style="color:#24292E">(</span><span style="color:#005CC5">2L</span><span style="color:#24292E">)).</span><span style="color:#6F42C1">thenReturn</span><span style="color:#24292E">(Optional.</span><span style="color:#6F42C1">empty</span><span style="color:#24292E">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        Optional&lt;</span><span style="color:#D73A49">Product</span><span style="color:#24292E">&gt; foundProduct </span><span style="color:#D73A49">=</span><span style="color:#24292E"> productService.</span><span style="color:#6F42C1">getProductById</span><span style="color:#24292E">(</span><span style="color:#005CC5">2L</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">        assertFalse</span><span style="color:#24292E">(foundProduct.</span><span style="color:#6F42C1">isPresent</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#6F42C1">        verify</span><span style="color:#24292E">(productRepository, </span><span style="color:#6F42C1">times</span><span style="color:#24292E">(</span><span style="color:#005CC5">1</span><span style="color:#24292E">)).</span><span style="color:#6F42C1">findById</span><span style="color:#24292E">(</span><span style="color:#005CC5">2L</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Test</span></span>
<span class="line"><span style="color:#D73A49">    void</span><span style="color:#6F42C1"> saveProduct_shouldReturnSavedProduct</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#6F42C1">        when</span><span style="color:#24292E">(productRepository.</span><span style="color:#6F42C1">save</span><span style="color:#24292E">(</span><span style="color:#6F42C1">any</span><span style="color:#24292E">(Product.class))).</span><span style="color:#6F42C1">thenReturn</span><span style="color:#24292E">(testProduct);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        Product savedProduct </span><span style="color:#D73A49">=</span><span style="color:#24292E"> productService.</span><span style="color:#6F42C1">saveProduct</span><span style="color:#24292E">(</span><span style="color:#D73A49">new</span><span style="color:#6F42C1"> Product</span><span style="color:#24292E">(</span><span style="color:#005CC5">null</span><span style="color:#24292E">, </span><span style="color:#032F62">"Laptop"</span><span style="color:#24292E">, </span><span style="color:#005CC5">1200.00</span><span style="color:#24292E">));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">        assertNotNull</span><span style="color:#24292E">(savedProduct);</span></span>
<span class="line"><span style="color:#6F42C1">        assertEquals</span><span style="color:#24292E">(</span><span style="color:#032F62">"Laptop"</span><span style="color:#24292E">, savedProduct.</span><span style="color:#6F42C1">getName</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#6F42C1">        verify</span><span style="color:#24292E">(productRepository, </span><span style="color:#6F42C1">times</span><span style="color:#24292E">(</span><span style="color:#005CC5">1</span><span style="color:#24292E">)).</span><span style="color:#6F42C1">save</span><span style="color:#24292E">(</span><span style="color:#6F42C1">any</span><span style="color:#24292E">(Product.class));</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In a Maven project, these tests are automatically discovered and executed during the <code>test</code> phase. A Jenkins pipeline, as introduced in previous lessons, would simply invoke <code>mvn test</code> or <code>mvn clean install</code> (which includes the <code>test</code> phase).</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Snippet for a Jenkins Declarative Pipeline stage</span></span>
<span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        script {</span></span>
<span class="line"><span style="color:#6A737D">            // Assume the project is a Maven project</span></span>
<span class="line"><span style="color:#6A737D">            // 'mvn test' command executes all unit tests</span></span>
<span class="line"><span style="color:#6A737D">            // 'clean install' also runs tests as part of its lifecycle</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'mvn clean install -DskipDockerBuild=true'</span><span style="color:#6A737D"> // Skipping Docker build for this stage</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>JavaScript/React Frontend Example (Jest)</strong></p>
<p>For the React frontend, unit tests would verify individual components or utility functions. Jest is a popular testing framework for JavaScript applications.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">javascript</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// src/components/ProductCard.js</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> React </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'react'</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">function</span><span style="color:#6F42C1"> ProductCard</span><span style="color:#24292E">({ </span><span style="color:#E36209">product</span><span style="color:#24292E"> }) {</span></span>
<span class="line"><span style="color:#D73A49">  if</span><span style="color:#24292E"> (</span><span style="color:#D73A49">!</span><span style="color:#24292E">product) {</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#24292E"> &lt;</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt;No product data&lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt;;</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#D73A49">  return</span><span style="color:#24292E"> (</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">div</span><span style="color:#6F42C1"> className</span><span style="color:#D73A49">=</span><span style="color:#032F62">"product-card"</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">h3</span><span style="color:#24292E">&gt;{product.name}&lt;/</span><span style="color:#22863A">h3</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">p</span><span style="color:#24292E">&gt;${product.price.</span><span style="color:#6F42C1">toFixed</span><span style="color:#24292E">(</span><span style="color:#005CC5">2</span><span style="color:#24292E">)}&lt;/</span><span style="color:#22863A">p</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      {</span><span style="color:#6A737D">/* Other product details */</span><span style="color:#24292E">}</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">div</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  );</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">export</span><span style="color:#D73A49"> default</span><span style="color:#24292E"> ProductCard;</span></span></code></pre></div></div></div>
<p>A Jest unit test for the <code>ProductCard</code> component would ensure it renders correctly with provided data.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">javascript</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// src/components/ProductCard.test.js</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> React </span><span style="color:#D73A49">from</span><span style="color:#032F62"> 'react'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> { render, screen } </span><span style="color:#D73A49">from</span><span style="color:#032F62"> '@testing-library/react'</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> ProductCard </span><span style="color:#D73A49">from</span><span style="color:#032F62"> './ProductCard'</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">describe</span><span style="color:#24292E">(</span><span style="color:#032F62">'ProductCard'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">  it</span><span style="color:#24292E">(</span><span style="color:#032F62">'renders product details correctly'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    const</span><span style="color:#005CC5"> product</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> { id: </span><span style="color:#005CC5">1</span><span style="color:#24292E">, name: </span><span style="color:#032F62">'Sample Product'</span><span style="color:#24292E">, price: </span><span style="color:#005CC5">99.99</span><span style="color:#24292E"> };</span></span>
<span class="line"><span style="color:#6F42C1">    render</span><span style="color:#24292E">(&lt;</span><span style="color:#005CC5">ProductCard</span><span style="color:#6F42C1"> product</span><span style="color:#D73A49">=</span><span style="color:#24292E">{product} /&gt;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    expect</span><span style="color:#24292E">(screen.</span><span style="color:#6F42C1">getByText</span><span style="color:#24292E">(</span><span style="color:#032F62">'Sample Product'</span><span style="color:#24292E">)).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#6F42C1">    expect</span><span style="color:#24292E">(screen.</span><span style="color:#6F42C1">getByText</span><span style="color:#24292E">(</span><span style="color:#032F62">'$99.99'</span><span style="color:#24292E">)).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  it</span><span style="color:#24292E">(</span><span style="color:#032F62">'renders "No product data" when no product is provided'</span><span style="color:#24292E">, () </span><span style="color:#D73A49">=&gt;</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6F42C1">    render</span><span style="color:#24292E">(&lt;</span><span style="color:#005CC5">ProductCard</span><span style="color:#6F42C1"> product</span><span style="color:#D73A49">=</span><span style="color:#24292E">{</span><span style="color:#005CC5">null</span><span style="color:#24292E">} /&gt;);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    expect</span><span style="color:#24292E">(screen.</span><span style="color:#6F42C1">getByText</span><span style="color:#24292E">(</span><span style="color:#032F62">'No product data'</span><span style="color:#24292E">)).</span><span style="color:#6F42C1">toBeInTheDocument</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#24292E">  });</span></span>
<span class="line"><span style="color:#24292E">});</span></span></code></pre></div></div></div>
<p>In a Node.js project, <code>npm test</code> typically runs the configured test suite. The Jenkins pipeline stage would look like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Snippet for a Jenkins Declarative Pipeline stage for a Node.js project</span></span>
<span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Frontend Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        dir(</span><span style="color:#032F62">'frontend'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Assuming frontend code is in a 'frontend' directory</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'npm install'</span><span style="color:#6A737D"> // Install dependencies</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'npm test -- --ci --watchAll=false'</span><span style="color:#6A737D"> // Run tests in CI mode, without watch</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h2>Implementing Integration Testing in CI</h2>
<p>Integration testing verifies that different modules or services within an application interact correctly with each other. Unlike unit tests, integration tests often involve actual external dependencies (like databases, APIs, or message queues) or a combination of several isolated components. This ensures that the interfaces and communication paths between components are functioning as expected.</p>
<h3>Principles of Effective Integration Tests</h3>
<ul>
<li><strong>Component Interaction:</strong> Focus on the interfaces and data flow between components rather than internal logic of a single unit.</li>
<li><strong>Realistic Environment:</strong> Aim to run tests in an environment that closely resembles the production environment, including actual database connections, API calls, etc.</li>
<li><strong>Setup and Teardown:</strong> Requires more complex setup (e.g., database initialization, starting external services) and teardown (e.g., cleaning up test data) compared to unit tests.</li>
<li><strong>Slower Execution:</strong> Integration tests typically take longer to execute than unit tests due to the involvement of external systems and more complex setup.</li>
</ul>
<h3>Integrating Integration Tests into the Acme Webshop CI Pipeline</h3>
<p>For the Acme Webshop, integration tests might involve verifying that the <code>ProductService</code> can correctly interact with the <code>ProductRepository</code> and a real database, or that the frontend can successfully fetch data from the backend API.</p>
<p><strong>Java Backend Integration Test Example (Spring Boot Test and Testcontainers)</strong></p>
<p>To test the interaction between <code>ProductService</code> and a real database, Spring Boot provides excellent support for integration testing. Using Testcontainers allows spinning up lightweight, disposable containers for databases (or other services) during the test run, ensuring a clean and consistent testing environment.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">java</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// src/test/java/com/acmewebshop/service/ProductServiceIntegrationTest.java</span></span>
<span class="line"><span style="color:#D73A49">package</span><span style="color:#24292E"> com.acmewebshop.service;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> com.acmewebshop.model.Product;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> com.acmewebshop.repository.ProductRepository;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.junit.jupiter.api.BeforeEach;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.junit.jupiter.api.Test;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.springframework.beans.factory.annotation.Autowired;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.springframework.boot.test.context.SpringBootTest;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.springframework.test.context.DynamicPropertyRegistry;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.springframework.test.context.DynamicPropertySource;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.testcontainers.containers.PostgreSQLContainer;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.testcontainers.junit.jupiter.Container;</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.testcontainers.junit.jupiter.Testcontainers;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> java.util.Optional;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#D73A49"> static</span><span style="color:#24292E"> org.junit.jupiter.api.Assertions.</span><span style="color:#005CC5">*</span><span style="color:#24292E">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">SpringBootTest</span><span style="color:#6A737D"> // Boots up the full Spring application context</span></span>
<span class="line"><span style="color:#24292E">@</span><span style="color:#D73A49">Testcontainers</span><span style="color:#6A737D"> // Enables Testcontainers for JUnit 5</span></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> ProductServiceIntegrationTest</span><span style="color:#24292E"> {</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Define a PostgreSQL container for testing</span></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Container</span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#24292E"> PostgreSQLContainer&lt;</span><span style="color:#D73A49">?</span><span style="color:#24292E">&gt; postgres </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#24292E"> PostgreSQLContainer&lt;&gt;(</span><span style="color:#032F62">"postgres:13"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">            .</span><span style="color:#6F42C1">withDatabaseName</span><span style="color:#24292E">(</span><span style="color:#032F62">"testdb"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">            .</span><span style="color:#6F42C1">withUsername</span><span style="color:#24292E">(</span><span style="color:#032F62">"testuser"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">            .</span><span style="color:#6F42C1">withPassword</span><span style="color:#24292E">(</span><span style="color:#032F62">"testpass"</span><span style="color:#24292E">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Dynamically set database properties based on the running container</span></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">DynamicPropertySource</span></span>
<span class="line"><span style="color:#D73A49">    static</span><span style="color:#D73A49"> void</span><span style="color:#6F42C1"> configureProperties</span><span style="color:#24292E">(DynamicPropertyRegistry </span><span style="color:#E36209">registry</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        registry.</span><span style="color:#6F42C1">add</span><span style="color:#24292E">(</span><span style="color:#032F62">"spring.datasource.url"</span><span style="color:#24292E">, postgres</span><span style="color:#D73A49">::</span><span style="color:#24292E">getJdbcUrl);</span></span>
<span class="line"><span style="color:#24292E">        registry.</span><span style="color:#6F42C1">add</span><span style="color:#24292E">(</span><span style="color:#032F62">"spring.datasource.username"</span><span style="color:#24292E">, postgres</span><span style="color:#D73A49">::</span><span style="color:#24292E">getUsername);</span></span>
<span class="line"><span style="color:#24292E">        registry.</span><span style="color:#6F42C1">add</span><span style="color:#24292E">(</span><span style="color:#032F62">"spring.datasource.password"</span><span style="color:#24292E">, postgres</span><span style="color:#D73A49">::</span><span style="color:#24292E">getPassword);</span></span>
<span class="line"><span style="color:#24292E">        registry.</span><span style="color:#6F42C1">add</span><span style="color:#24292E">(</span><span style="color:#032F62">"spring.jpa.hibernate.ddl-auto"</span><span style="color:#24292E">, () </span><span style="color:#D73A49">-&gt;</span><span style="color:#032F62"> "create-drop"</span><span style="color:#24292E">); </span><span style="color:#6A737D">// Create schema for each test run</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Autowired</span></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#24292E"> ProductService productService;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Autowired</span></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#24292E"> ProductRepository productRepository; </span><span style="color:#6A737D">// Also inject repository for setup/cleanup</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">BeforeEach</span></span>
<span class="line"><span style="color:#D73A49">    void</span><span style="color:#6F42C1"> setUp</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#24292E">        productRepository.</span><span style="color:#6F42C1">deleteAll</span><span style="color:#24292E">(); </span><span style="color:#6A737D">// Clear database before each test</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Test</span></span>
<span class="line"><span style="color:#D73A49">    void</span><span style="color:#6F42C1"> getProductById_shouldRetrieveProductFromDatabase</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#24292E">        Product newProduct </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Product</span><span style="color:#24292E">(</span><span style="color:#005CC5">null</span><span style="color:#24292E">, </span><span style="color:#032F62">"Keyboard"</span><span style="color:#24292E">, </span><span style="color:#005CC5">75.00</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        Product savedProduct </span><span style="color:#D73A49">=</span><span style="color:#24292E"> productRepository.</span><span style="color:#6F42C1">save</span><span style="color:#24292E">(newProduct);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        Optional&lt;</span><span style="color:#D73A49">Product</span><span style="color:#24292E">&gt; foundProduct </span><span style="color:#D73A49">=</span><span style="color:#24292E"> productService.</span><span style="color:#6F42C1">getProductById</span><span style="color:#24292E">(savedProduct.</span><span style="color:#6F42C1">getId</span><span style="color:#24292E">());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">        assertTrue</span><span style="color:#24292E">(foundProduct.</span><span style="color:#6F42C1">isPresent</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#6F42C1">        assertEquals</span><span style="color:#24292E">(</span><span style="color:#032F62">"Keyboard"</span><span style="color:#24292E">, foundProduct.</span><span style="color:#6F42C1">get</span><span style="color:#24292E">().</span><span style="color:#6F42C1">getName</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#6F42C1">        assertEquals</span><span style="color:#24292E">(</span><span style="color:#005CC5">75.00</span><span style="color:#24292E">, foundProduct.</span><span style="color:#6F42C1">get</span><span style="color:#24292E">().</span><span style="color:#6F42C1">getPrice</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    @</span><span style="color:#D73A49">Test</span></span>
<span class="line"><span style="color:#D73A49">    void</span><span style="color:#6F42C1"> saveProduct_shouldPersistProductToDatabase</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#24292E">        Product newProduct </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#6F42C1"> Product</span><span style="color:#24292E">(</span><span style="color:#005CC5">null</span><span style="color:#24292E">, </span><span style="color:#032F62">"Mouse"</span><span style="color:#24292E">, </span><span style="color:#005CC5">25.00</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        Product savedProduct </span><span style="color:#D73A49">=</span><span style="color:#24292E"> productService.</span><span style="color:#6F42C1">saveProduct</span><span style="color:#24292E">(newProduct);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">        assertNotNull</span><span style="color:#24292E">(savedProduct.</span><span style="color:#6F42C1">getId</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#24292E">        Optional&lt;</span><span style="color:#D73A49">Product</span><span style="color:#24292E">&gt; retrievedProduct </span><span style="color:#D73A49">=</span><span style="color:#24292E"> productRepository.</span><span style="color:#6F42C1">findById</span><span style="color:#24292E">(savedProduct.</span><span style="color:#6F42C1">getId</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#6F42C1">        assertTrue</span><span style="color:#24292E">(retrievedProduct.</span><span style="color:#6F42C1">isPresent</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#6F42C1">        assertEquals</span><span style="color:#24292E">(</span><span style="color:#032F62">"Mouse"</span><span style="color:#24292E">, retrievedProduct.</span><span style="color:#6F42C1">get</span><span style="color:#24292E">().</span><span style="color:#6F42C1">getName</span><span style="color:#24292E">());</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This integration test will:</p>
<ol>
<li>Start a PostgreSQL Docker container before any tests run.</li>
<li>Configure the Spring application context to connect to this temporary database.</li>
<li>Run the tests, which involve the <code>ProductService</code> interacting with the actual <code>ProductRepository</code> and the PostgreSQL database.</li>
<li>Stop and remove the container after all tests complete.</li>
</ol>
<p>Because these tests involve starting Docker containers, they will naturally take longer than pure unit tests. In a Jenkins pipeline, they are typically run in a separate stage or as part of the main <code>mvn clean install</code> command, provided Testcontainers are correctly configured.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkins Pipeline snippet for running integration tests</span></span>
<span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Integration Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        script {</span></span>
<span class="line"><span style="color:#6A737D">            // Testcontainers will automatically manage Docker containers during this phase</span></span>
<span class="line"><span style="color:#6A737D">            // Ensure Docker daemon is accessible on the Jenkins agent</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'mvn verify -Pintegration-tests'</span><span style="color:#6A737D"> // Example using a Maven profile for integration tests</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>The <code>-Pintegration-tests</code> flag assumes a Maven profile is configured in the <code>pom.xml</code> to include integration tests (often located in <code>src/it/java</code> or configured to run with <code>failsafe-plugin</code>). If integration tests are within <code>src/test/java</code> and are simply marked with <code>@Tag("integration")</code> and filtered, <code>mvn test</code> might suffice, but it's generally better practice to separate them for pipeline clarity and performance reasons.</p>
<h3>Considerations for CI Integration</h3>
<p>When integrating automated tests into a CI pipeline:</p>
<ul>
<li><strong>Test Granularity:</strong> Prioritize running unit tests first due to their speed. Integration tests should follow, and end-to-end tests (which are outside the scope of this lesson) later.</li>
<li><strong>Environment Management:</strong> Ensure the CI environment (e.g., Jenkins agent) has the necessary tools (e.g., Docker for Testcontainers, Java, Node.js) and access rights to execute tests, including starting containers or connecting to external services.</li>
<li><strong>Reporting:</strong> Configure test runners to generate reports in formats like JUnit XML, which Jenkins can parse and display. This allows visual tracking of test results and failures directly in the Jenkins UI.</li>
<li><strong>Failure Handling:</strong> The CI pipeline should fail immediately if any unit or integration tests fail. This adheres to the "fail fast" principle of CI, preventing broken code from progressing further down the pipeline.</li>
</ul>
<h2>Practice Activities</h2>
<h3>Activity 1: Add a Unit Test to the Acme Webshop Backend</h3>
<ol>
<li>Assume the Acme Webshop backend has a new <code>OrderService</code> with a method <code>createOrder(Order order)</code>. This method should validate the order before saving it.</li>
<li>Create a unit test for this <code>createOrder</code> method using JUnit and Mockito.</li>
<li>The test should:
<ul>
<li>Mock the <code>OrderRepository</code> dependency.</li>
<li>Verify that <code>createOrder</code> calls <code>OrderRepository.save()</code> when a valid order is provided.</li>
<li>Verify that <code>createOrder</code> throws an exception (e.g., <code>IllegalArgumentException</code>) if the order contains invalid data (e.g., an empty list of items).</li>
</ul>
</li>
</ol>
<h3>Activity 2: Simulate Integration Test Failure in Jenkins</h3>
<ol>
<li>Take the existing <code>ProductServiceIntegrationTest</code> example.</li>
<li>Modify one of the tests in <code>ProductServiceIntegrationTest</code> to intentionally fail. For instance, change an <code>assertEquals</code> to <code>assertNotEquals</code> for a value that should match.</li>
<li>Run the Jenkins pipeline (or simulate running it) that executes these integration tests.</li>
<li>Observe how Jenkins reports the test failure. Identify the stage that failed and review the console output for the specific test failure details.</li>
</ol>
<h3>Activity 3: Frontend Component Integration Test</h3>
<ol>
<li>Consider a new React component for the Acme Webshop frontend, <code>ProductList</code>, which fetches a list of products from a simulated API and renders multiple <code>ProductCard</code> components.</li>
<li>Write an integration test using <code>react-testing-library</code> and a mocking library like <code>msw</code> (Mock Service Worker) to:
<ul>
<li>Simulate an API call returning a list of products.</li>
<li>Verify that the <code>ProductList</code> component renders the correct number of <code>ProductCard</code> components based on the fetched data.</li>
<li>Verify that each <code>ProductCard</code> displays the correct product name.</li>
<li>Simulate an API error and ensure <code>ProductList</code> displays an appropriate error message.</li>
</ul>
</li>
</ol>
<h2>Real-World Application</h2>
<p>Automated unit and integration testing are cornerstones of modern software development, regardless of industry.</p>
<p>In <strong>financial technology (FinTech)</strong>, even a minor calculation error or an incorrect data transfer between systems can have significant monetary consequences. Unit tests ensure that individual financial functions (e.g., interest calculation, currency conversion) are precise, while integration tests verify that these functions correctly interact with database persistence, payment gateways, and fraud detection services. For instance, a bank's CI pipeline for its online banking platform would execute thousands of unit tests validating every business logic rule, followed by integration tests confirming that transactions correctly update account balances across different microservices.</p>
<p>In the <strong>healthcare sector</strong>, software defects can directly impact patient safety. A hospital's patient management system, undergoing continuous development, relies heavily on automated testing. Unit tests validate that individual modules correctly process patient data, schedule appointments, or manage prescriptions. Integration tests ensure seamless data flow between the patient records system, laboratory results interface, and billing system. A CI pipeline failure due to an integration test exposing a data mismatch between two systems would prevent a broken build from reaching a staging environment, thereby safeguarding against potential errors in patient care.</p>
<p>A hypothetical scenario for the Acme Webshop:
The Acme Webshop team implements a new recommendation engine that suggests related products based on a user's browsing history.</p>
<ul>
<li><strong>Unit tests</strong> would be written for the recommendation algorithm itself, ensuring that given specific input (e.g., a list of viewed products), it generates the expected recommendations. These tests would mock the data source for browsing history.</li>
<li><strong>Integration tests</strong> would then verify that the recommendation service correctly fetches data from the user history database, processes it with the algorithm, and returns the recommendations to the frontend API. This test would involve spinning up a temporary database instance (e.g., with Testcontainers) and making actual API calls to the recommendation service endpoint. If an integration test fails because the service cannot connect to the database or the data format is unexpected, the CI pipeline would immediately stop, preventing the faulty recommendation feature from being deployed.</li>
</ul>
  
</div>

<div id="chapter-2.6">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Integrating Static Code Analysis and Quality Gates</h1><p>Integrating static code analysis and quality gates into a Continuous Integration (CI) pipeline enhances code quality, identifies potential issues early, and enforces coding standards before code reaches later stages of development. This proactive approach reduces technical debt, improves maintainability, and ultimately contributes to more stable and secure applications.</p>
<h2>Understanding Static Code Analysis</h2>
<p>Static code analysis involves examining source code without executing it, to detect potential bugs, security vulnerabilities, and violations of coding standards. It acts as an automated code review, providing immediate feedback to developers as part of the CI process. This process differs from dynamic analysis, which involves executing the code.</p>
<h3>Types of Issues Detected by Static Code Analysis</h3>
<p>Static analysis tools identify a wide range of issues, categorized broadly as:</p>
<ol>
<li>
<p><strong>Coding Standard Violations</strong>: These include adherence to style guides (e.g., indentation, naming conventions), maximum line lengths, complexity metrics (e.g., cyclomatic complexity), and code duplication.</p>
<ul>
<li><strong>Example (Hypothetical Scenario)</strong>: Acme Webshop developers use a consistent coding style, but new hires sometimes forget to follow the established Python PEP 8 guidelines. A static analysis tool flags instances where <code>camelCase</code> is used for variable names instead of <code>snake_case</code>, or where lines exceed 79 characters, ensuring consistency across the codebase.</li>
<li><strong>Real-World Example (Python)</strong>: Tools like <em>Pylint</em> or <em>Flake8</em> check for PEP 8 compliance, unhandled exceptions, unused variables, and excessive function length. For instance, Pylint might report a "C0301: Line too long" or "W0611: Unused import" error.</li>
<li><strong>Real-World Example (Java)</strong>: <em>Checkstyle</em> or <em>PMD</em> enforce Java coding standards. Checkstyle can verify brace style, variable naming, and class header comments.</li>
</ul>
</li>
<li>
<p><strong>Potential Bugs and Runtime Errors</strong>: These are issues that might lead to unexpected behavior during execution, such as null pointer dereferences, resource leaks (e.g., unclosed file handles), uninitialized variables, or division by zero.</p>
<ul>
<li><strong>Example (Acme Webshop)</strong>: A developer introduces a new payment processing module. Static analysis identifies a path where a database connection might not be properly closed in an error handling block, leading to a resource leak if that error path is hit frequently.</li>
<li><strong>Real-World Example (C#)</strong>: <em>FxCop</em> (part of Visual Studio's code analysis) or <em>Roslyn Analyzers</em> detect common C# programming errors like incorrect exception handling or potential <code>NullReferenceException</code> scenarios.</li>
<li><strong>Real-World Example (JavaScript)</strong>: <em>ESLint</em> can identify potential issues like accessing an undefined variable or using <code>==</code> instead of <code>===</code> (which can lead to type coercion bugs).</li>
</ul>
</li>
<li>
<p><strong>Security Vulnerabilities (SAST - Static Application Security Testing)</strong>: These tools specifically look for patterns in code that could indicate security weaknesses, such as SQL injection possibilities, cross-site scripting (XSS) vulnerabilities, insecure cryptographic practices, or hardcoded credentials.</p>
<ul>
<li><strong>Example (Acme Webshop)</strong>: The login page of the Acme Webshop processes user input for authentication. A static analysis tool might flag an instance where user input is directly concatenated into a SQL query string without proper sanitization or parameterized queries, indicating a potential SQL injection vulnerability.</li>
<li><strong>Real-World Example (Java)</strong>: <em>SonarQube</em> (with its security analysis plugins) or <em>OWASP Dependency-Check</em> can identify common vulnerabilities like those in the OWASP Top 10. For instance, SonarQube might detect a Java method that uses <code>Runtime.exec()</code> with unsanitized user input, making it vulnerable to command injection.</li>
<li><strong>Real-World Example (Python)</strong>: <em>Bandit</em> is a security linter for Python that specifically looks for security issues like using <code>eval</code> with user input, hardcoded passwords, or insecure <code>pickle</code> module usage.</li>
</ul>
</li>
</ol>
<h3>Popular Static Analysis Tools</h3>
<p>Several open-source and commercial tools are available:</p>
<ul>
<li><strong>SonarQube</strong>: A widely adopted platform that supports over 27 programming languages. It centralizes code quality and security analysis results, tracks technical debt, and provides detailed reports. It's often integrated as a central hub for code quality.</li>
<li><strong>Checkstyle (Java)</strong>: Focuses on enforcing coding style and standards.</li>
<li><strong>PMD (Java)</strong>: Detects common programming flaws like empty catch blocks, unused variables, and overly complex expressions.</li>
<li><strong>Pylint / Flake8 (Python)</strong>: Linters for Python that enforce style, check for common errors, and report complexity.</li>
<li><strong>ESLint (JavaScript)</strong>: A highly configurable linter that allows developers to define and enforce coding styles and detect potential issues.</li>
<li><strong>Bandit (Python)</strong>: Specifically designed to find common security issues in Python code.</li>
<li><strong>Fortify / Checkmarx (Commercial)</strong>: Enterprise-grade SAST solutions offering comprehensive security analysis.</li>
</ul>
<h2>Implementing Quality Gates</h2>
<p>A quality gate is a set of predefined conditions that code must meet before it can proceed to the next stage in the CI/CD pipeline. If any of these conditions are not met, the pipeline "fails" and prevents the code from moving forward, requiring developers to address the issues. Quality gates ensure that only high-quality, secure, and compliant code is deployed.</p>
<h3>Defining Quality Gate Metrics</h3>
<p>Quality gates are built upon metrics derived from various sources, including static code analysis, test results, and code coverage. Common metrics include:</p>
<ul>
<li><strong>Code Coverage</strong>: The percentage of source code executed by automated tests.
<ul>
<li><strong>Example</strong>: Acme Webshop requires new features to maintain at least 80% unit test coverage. If a new pull request drops the coverage below this threshold, the quality gate fails.</li>
</ul>
</li>
<li><strong>Static Analysis Issues</strong>: The number or severity of bugs, vulnerabilities, and code smells identified by static analysis tools.
<ul>
<li><strong>Example</strong>: The Acme Webshop's quality gate mandates zero new "blocker" or "critical" issues reported by SonarQube in the changed code, and a maximum of 5 "minor" issues overall.</li>
</ul>
</li>
<li><strong>Cyclomatic Complexity</strong>: A measure of the number of linearly independent paths through a program's source code. High complexity indicates potentially difficult-to-understand and difficult-to-test code.
<ul>
<li><strong>Example</strong>: No new function or method introduced should have a cyclomatic complexity greater than 10.</li>
</ul>
</li>
<li><strong>Duplication</strong>: The amount of duplicated code. High duplication indicates potential maintenance issues and code smells.
<ul>
<li><strong>Example</strong>: Code duplication must not exceed 3% across the entire project.</li>
</ul>
</li>
<li><strong>Security Vulnerabilities</strong>: Specific checks for critical security findings.
<ul>
<li><strong>Example</strong>: Zero high-severity security vulnerabilities identified by Bandit in Python code.</li>
</ul>
</li>
</ul>
<h3>Integrating Static Code Analysis and Quality Gates into Jenkins</h3>
<p>The integration typically involves a dedicated stage in the Jenkins pipeline after the build and unit testing stages.</p>
<ol>
<li><strong>Install Necessary Plugins</strong>: For SonarQube, install the "SonarQube Scanner" plugin in Jenkins.</li>
<li><strong>Configure Tool Connections</strong>: In Jenkins, configure the SonarQube server details (URL, authentication token).</li>
<li><strong>Add a Static Analysis Stage</strong>: Include a stage in your Jenkinsfile that executes the static analysis tool (e.g., SonarQube Scanner).</li>
<li><strong>Define Quality Gate in the Tool</strong>: Configure the quality gate directly within the static analysis tool (e.g., SonarQube UI). This separation of concerns means Jenkins triggers the analysis, and the analysis tool itself determines if the gate passes or fails.</li>
<li><strong>Add a Quality Gate Check Step</strong>: After the analysis is complete, add a step in the Jenkinsfile to wait for and check the quality gate status from the static analysis tool. If the quality gate fails, the Jenkins pipeline should be marked as <code>FAILED</code>.</li>
</ol>
<h4>Acme Webshop Example Jenkinsfile Snippet</h4>
<p>Building upon the previous lessons where we crafted a Jenkins Declarative Pipeline and automated builds and tests, we will now extend it to include static code analysis using SonarQube. Assume SonarQube is already set up and configured in Jenkins' system settings.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    environment {</span></span>
<span class="line"><span style="color:#6A737D">        // SonarQube server configuration (configured in Jenkins global tools or environment variables)</span></span>
<span class="line"><span style="color:#6A737D">        // SONAR_SCANNER_HOME is typically set by the SonarQube Scanner plugin</span></span>
<span class="line"><span style="color:#005CC5">        SONAR_HOST_URL</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'http://localhost:9000'</span><span style="color:#6A737D"> // Replace with your SonarQube server URL</span></span>
<span class="line"><span style="color:#005CC5">        SONAR_PROJECT_KEY</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'acme-webshop-app'</span><span style="color:#6A737D"> // Unique key for your project in SonarQube</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // From Lesson 2: Source Code Management with Git and Branching Strategies</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-org/acme-webshop.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // From Lesson 4: Automating Build Processes and Dependency Management</span></span>
<span class="line"><span style="color:#6A737D">                // Assuming a Maven project for Acme Webshop for demonstration</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install -DskipTests'</span><span style="color:#6A737D"> // Build without running tests here</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // From Lesson 5: Implementing Automated Unit and Integration Testing in CI</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span><span style="color:#6A737D"> // Run unit tests</span></span>
<span class="line"><span style="color:#6A737D">                // Store test results for Jenkins reporting</span></span>
<span class="line"><span style="color:#24292E">                junit </span><span style="color:#032F62">'**/target/surefire-reports/*.xml'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Static Code Analysis'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Trigger SonarQube analysis</span></span>
<span class="line"><span style="color:#6A737D">                    // The 'withSonarQubeEnv' wrapper ensures the SonarQube environment variables are set.</span></span>
<span class="line"><span style="color:#6A737D">                    // 'sonar.projectKey' is a mandatory parameter for SonarQube analysis.</span></span>
<span class="line"><span style="color:#6A737D">                    // 'sonar.sources' specifies the directory to analyze.</span></span>
<span class="line"><span style="color:#6A737D">                    // Other properties like 'sonar.tests' and 'sonar.java.binaries' are good practice for Java projects.</span></span>
<span class="line"><span style="color:#24292E">                    withSonarQubeEnv(</span><span style="color:#032F62">'SonarQube-Server'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// 'SonarQube-Server' is the name of your SonarQube server configuration in Jenkins</span></span>
<span class="line"><span style="color:#24292E">                        sh </span><span style="color:#032F62">"mvn sonar:sonar "</span><span style="color:#D73A49"> +</span></span>
<span class="line"><span style="color:#032F62">                           "-Dsonar.projectKey=${env.SONAR_PROJECT_KEY} "</span><span style="color:#D73A49"> +</span></span>
<span class="line"><span style="color:#032F62">                           "-Dsonar.host.url=${env.SONAR_HOST_URL} "</span><span style="color:#D73A49"> +</span></span>
<span class="line"><span style="color:#032F62">                           "-Dsonar.sources=src/main "</span><span style="color:#D73A49"> +</span><span style="color:#6A737D"> // Directory containing source code to analyze</span></span>
<span class="line"><span style="color:#032F62">                           "-Dsonar.tests=src/test "</span><span style="color:#D73A49"> +</span><span style="color:#6A737D">   // Directory containing test code</span></span>
<span class="line"><span style="color:#032F62">                           "-Dsonar.java.binaries=target/classes"</span><span style="color:#6A737D"> // Path to compiled bytecode</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Quality Gate Check'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Wait for SonarQube analysis to complete and check the quality gate status.</span></span>
<span class="line"><span style="color:#6A737D">                    // 'waitForQualityGate' will block until the analysis report is processed by SonarQube</span></span>
<span class="line"><span style="color:#6A737D">                    // and then check the quality gate status.</span></span>
<span class="line"><span style="color:#6A737D">                    // If the quality gate fails in SonarQube, this step will mark the Jenkins build as UNSTABLE or FAILED.</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> qg </span><span style="color:#D73A49">=</span><span style="color:#24292E"> waitForQualityGate()</span></span>
<span class="line"><span style="color:#D73A49">                    if</span><span style="color:#24292E"> (qg</span><span style="color:#D73A49">.</span><span style="color:#24292E">status </span><span style="color:#D73A49">!=</span><span style="color:#032F62"> 'OK'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">                        // Mark the Jenkins build as failed if the SonarQube quality gate fails.</span></span>
<span class="line"><span style="color:#24292E">                        error </span><span style="color:#032F62">"SonarQube Quality Gate Failed: ${qg.status}"</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">        // Future stages like 'Deploy to Staging' would follow here,</span></span>
<span class="line"><span style="color:#6A737D">        // but only if the quality gate passes.</span></span>
<span class="line"><span style="color:#6A737D">        // stage('Deploy to Staging') {</span></span>
<span class="line"><span style="color:#6A737D">        //     steps {</span></span>
<span class="line"><span style="color:#6A737D">        //         echo "Deploying Acme Webshop to Staging..."</span></span>
<span class="line"><span style="color:#6A737D">        //</span><span style="color:#6A737D">         // Deployment steps</span></span>
<span class="line"><span style="color:#6A737D">        //     }</span></span>
<span class="line"><span style="color:#6A737D">        // }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>Explanation of the Jenkinsfile Snippet:</strong></p>
<ul>
<li><strong><code>environment</code> block</strong>: Defines environment variables <code>SONAR_HOST_URL</code> and <code>SONAR_PROJECT_KEY</code> for the SonarQube analysis. These values should correspond to your SonarQube instance and the project configured within it.</li>
<li><strong><code>Static Code Analysis</code> stage</strong>:
<ul>
<li><code>withSonarQubeEnv('SonarQube-Server')</code>: This is a Jenkins pipeline step provided by the SonarQube Scanner plugin. It ensures that the necessary environment variables and paths for the SonarQube scanner are correctly set up before executing the analysis. <code>'SonarQube-Server'</code> must match the name of the SonarQube server configured in your Jenkins global settings.</li>
<li><code>sh "mvn sonar:sonar ..."</code>: This command executes the Maven goal <code>sonar:sonar</code>, which triggers the SonarQube analysis.
<ul>
<li><code>-Dsonar.projectKey</code>: A unique identifier for your project in SonarQube.</li>
<li><code>-Dsonar.host.url</code>: The URL of your SonarQube server.</li>
<li><code>-Dsonar.sources</code>, <code>-Dsonar.tests</code>, <code>-Dsonar.java.binaries</code>: These properties tell SonarQube where to find the source code, test code, and compiled classes for analysis, which is crucial for accurate results and code coverage metrics.</li>
</ul>
</li>
</ul>
</li>
<li><strong><code>Quality Gate Check</code> stage</strong>:
<ul>
<li><code>def qg = waitForQualityGate()</code>: This step, also provided by the SonarQube Scanner plugin, pauses the Jenkins pipeline execution until SonarQube has completed processing the analysis report and determined the Quality Gate status. It then retrieves the status.</li>
<li><code>if (qg.status != 'OK')</code>: Checks if the quality gate status returned by SonarQube is <code>OK</code>. If it's anything else (e.g., <code>ERROR</code>, <code>WARN</code>, <code>FAILED</code>), it means the code did not meet the defined quality standards.</li>
<li><code>error "SonarQube Quality Gate Failed: ${qg.status}"</code>: If the quality gate fails, the Jenkins pipeline build is immediately marked as <code>FAILED</code>, preventing subsequent stages (like deployment) from executing. This ensures that low-quality or vulnerable code is not pushed further down the pipeline.</li>
</ul>
</li>
</ul>
<h3>Benefits of Quality Gates</h3>
<ul>
<li><strong>Early Feedback</strong>: Issues are identified immediately after code is committed, allowing developers to fix them while the context is fresh.</li>
<li><strong>Enforced Standards</strong>: Ensures consistent adherence to coding standards, security policies, and architectural guidelines across the team and project.</li>
<li><strong>Reduced Technical Debt</strong>: By preventing new low-quality code from entering the codebase, quality gates help manage and reduce technical debt over time.</li>
<li><strong>Improved Reliability and Security</strong>: Catches potential bugs and security vulnerabilities before they reach production, leading to more robust and secure applications.</li>
<li><strong>Automation</strong>: Automates a significant part of the code review process, freeing up human reviewers to focus on architectural decisions and complex logic.</li>
</ul>
<h2>Exercises and Practice Activities</h2>
<ol>
<li>
<p><strong>Configure SonarQube Quality Gate</strong>:</p>
<ul>
<li><strong>Task</strong>: Access a running SonarQube instance (you can set one up locally using Docker). Navigate to "Quality Gates" and create a new quality gate named "Acme Webshop Standard".</li>
<li><strong>Conditions</strong>:
<ul>
<li>On "New Code" (code introduced in the current analysis, typically defined as changes since the last analysis):
<ul>
<li>"Maintainability Rating" must be 'A'.</li>
<li>"Bugs" must be 0.</li>
<li>"Vulnerabilities" must be 0.</li>
<li>"Code Smells" must be 0.</li>
<li>"Coverage" must be greater than 80%.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Apply</strong>: Assign this quality gate as the default for your "acme-webshop-app" project in SonarQube.</li>
</ul>
</li>
<li>
<p><strong>Modify Acme Webshop Codebase</strong>:</p>
<ul>
<li><strong>Task</strong>: Introduce a deliberate quality issue into the Acme Webshop application's Java code (e.g., in a new feature branch).
<ul>
<li><strong>Scenario 1 (Bug)</strong>: Create a method that could throw a <code>NullPointerException</code> without proper handling (e.g., <code>String s = null; System.out.println(s.length());</code>).</li>
<li><strong>Scenario 2 (Code Smell)</strong>: Create a very long method (more than 50 lines) or a method with high cyclomatic complexity (e.g., a method with many nested <code>if-else</code> statements or a large <code>switch</code> statement).</li>
<li><strong>Scenario 3 (Security)</strong>: If you're using a web framework, intentionally introduce a basic SQL injection vulnerability (e.g., <code>String query = "SELECT * FROM users WHERE username = '" + userInput + "'";</code>).</li>
</ul>
</li>
<li><strong>Commit</strong>: Commit this change to a feature branch in your local Git repository.</li>
</ul>
</li>
<li>
<p><strong>Run the Jenkins Pipeline</strong>:</p>
<ul>
<li><strong>Task</strong>: Trigger the extended Jenkins pipeline (from the lesson's Jenkinsfile snippet) on your feature branch.</li>
<li><strong>Observe</strong>: Monitor the pipeline execution in Jenkins.</li>
<li><strong>Analysis</strong>:
<ul>
<li>Does the <code>Static Code Analysis</code> stage complete successfully?</li>
<li>Does the <code>Quality Gate Check</code> stage fail? Why?</li>
<li>Review the SonarQube dashboard for your project. Locate the issue you intentionally introduced. How does SonarQube categorize it (Bug, Vulnerability, Code Smell) and what severity does it assign?</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Fix and Re-run</strong>:</p>
<ul>
<li><strong>Task</strong>: Modify your feature branch code to fix the introduced quality issue, ensuring it now meets the defined quality gate conditions.</li>
<li><strong>Commit &amp; Push</strong>: Commit the fix and push to your remote repository.</li>
<li><strong>Re-run Pipeline</strong>: Trigger the Jenkins pipeline again on the updated feature branch.</li>
<li><strong>Verify</strong>: Confirm that the <code>Quality Gate Check</code> stage now passes, allowing the pipeline to proceed (if further stages were defined).</li>
</ul>
</li>
</ol>
  
</div>

</div>

<div id="chapter-3">

<div id="chapter-3.1">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Managing Build Artifacts and Package Repositories</h1><p>Managing build artifacts and package repositories is a critical component of a robust Continuous Integration and Delivery (CI/CD) pipeline. Build artifacts are the output of a build process, such as compiled code, executable binaries, deployable archives, or container images. Package repositories serve as centralized storage for these artifacts, enabling their versioning, distribution, and secure management across various stages of the software delivery lifecycle. Effective artifact management ensures that consistent, verifiable, and immutable builds are promoted through different environments, from development to production.</p>
<h2>Understanding Build Artifacts</h2>
<p>Build artifacts represent the tangible outcome of a successful build. They are the deployable units that will eventually run in a target environment. The nature of an artifact varies significantly depending on the programming language, framework, and application architecture.</p>
<p>For example, in a Java application, a build artifact might be a <code>.jar</code> or <code>.war</code> file, containing the compiled bytecode, resources, and manifest files. For a Node.js application, it could be a compressed <code>tar.gz</code> archive of the <code>node_modules</code> directory and application code, ready to be deployed. In a frontend context, artifacts often include minified JavaScript, CSS, and optimized image assets, bundled into a static website or a web application archive.</p>
<p>An important characteristic of build artifacts is their immutability. Once an artifact is created and assigned a version, it should not be modified. If any change is required, a new build process should be triggered, resulting in a new, distinct artifact with a new version. This immutability ensures that what is tested in one environment is precisely what is deployed to the next, preventing "works on my machine" issues and ensuring consistency throughout the pipeline.</p>
<p>Consider the Acme Webshop case study. After the CI pipeline builds the Java backend, the resulting <code>.jar</code> file for the API service and the compiled frontend assets (HTML, CSS, JavaScript) for the web user interface are distinct build artifacts. These artifacts are then packaged together or stored separately, ready for deployment. The goal is that the <code>.jar</code> file and frontend assets that pass all tests in the staging environment are the exact same ones deployed to production.</p>
<h2>The Role of Package Repositories</h2>
<p>Package repositories, also known as artifact repositories, are specialized storage systems designed to manage and distribute build artifacts and their dependencies. They are central to continuous delivery because they provide a single source of truth for all deployable components.</p>
<p>Key functions of a package repository include:</p>
<ul>
<li><strong>Storage and Versioning:</strong> Securely stores artifacts with unique identifiers and versions, often automatically incremented by the CI system.</li>
<li><strong>Distribution:</strong> Facilitates the download and deployment of artifacts to various environments (e.g., development, staging, production).</li>
<li><strong>Security:</strong> Controls access to artifacts, preventing unauthorized modifications or downloads, and often includes features for scanning artifacts for vulnerabilities.</li>
<li><strong>Dependency Management:</strong> Acts as a proxy for external dependencies (e.g., Maven Central, npm registry), caching them locally to speed up builds and ensure reliability even if external registries are unavailable.</li>
<li><strong>Traceability:</strong> Provides a historical record of all uploaded artifacts, including metadata about their origin (e.g., Git commit hash, build number, builder user).</li>
</ul>
<p>Without a package repository, managing artifacts becomes chaotic. Developers might download artifacts from shared network drives, local build outputs, or even directly from CI server workspaces, leading to inconsistencies, versioning conflicts, and security risks. A dedicated repository centralizes this process, making it repeatable and auditable.</p>
<h3>Types of Package Repositories</h3>
<p>Several types of package repositories exist, each optimized for different programming ecosystems and artifact types:</p>
<ul>
<li><strong>Maven/Gradle repositories:</strong> For Java artifacts (<code>.jar</code>, <code>.war</code>, <code>.pom</code>). Examples include Nexus Repository Manager and JFrog Artifactory.</li>
<li><strong>npm registries:</strong> For Node.js packages (<code>.tgz</code>). npm Inc. provides a public registry, but private instances like Verdaccio or those offered by Nexus/Artifactory are common for internal packages.</li>
<li><strong>PyPI (Python Package Index) compatible repositories:</strong> For Python packages (<code>.whl</code>, <code>.tar.gz</code>). Tools like devpi or enterprise solutions support this.</li>
<li><strong>Docker registries:</strong> For Docker images. Docker Hub is the public default, but private registries like Amazon ECR, Google Container Registry, Azure Container Registry, and self-hosted registries (e.g., Harbor) are widely used.</li>
<li><strong>Generic repositories:</strong> For storing any type of file, such as configuration files, static assets, or arbitrary binaries. Nexus and Artifactory also offer generic repository capabilities.</li>
</ul>
<p>For the Acme Webshop, managing artifacts would involve using a Maven repository for the Java backend <code>.jar</code> files, an npm registry for any Node.js based frontend components, and potentially a Docker registry for the containerized versions of both if we move towards containerization (as we will in Module 4).</p>
<h2>Practical Implementation of Artifact Management</h2>
<p>Implementing effective artifact management involves integrating package repositories into the CI/CD pipeline. This typically means that after a successful build and automated testing within the CI pipeline, the resulting artifacts are immediately pushed to the designated package repository.</p>
<h3>Example: Storing a Java Artifact in a Maven Repository</h3>
<p>Let's assume the Acme Webshop backend is a Java application built with Maven. After the <code>mvn package</code> command successfully creates the <code>.jar</code> file, the next step in the Jenkins pipeline would be to deploy this artifact to a Maven repository, such as Nexus.</p>
<p>A typical Jenkins declarative pipeline stage for this might look like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span><span style="color:#6A737D"> // Clone the Acme Webshop backend repository</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean package -DskipTests'</span><span style="color:#6A737D"> // Build the JAR, skipping unit tests here as they would run in a separate stage</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span><span style="color:#6A737D"> // Run unit tests</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Upload Artifact'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                withMaven(</span><span style="color:#005CC5">maven</span><span style="color:#24292E">: </span><span style="color:#032F62">'M3'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Assuming 'M3' is configured in Jenkins for Maven 3</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'mvn deploy -DaltDeploymentRepository=acme-releases::default::http://your-nexus-server:8081/repository/acme-releases/'</span></span>
<span class="line"><span style="color:#6A737D">                    // 'acme-releases' is the ID in settings.xml and the repository name in Nexus</span></span>
<span class="line"><span style="color:#6A737D">                    // This command deploys the built JAR to the specified Nexus repository</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ... subsequent stages for deployment</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this example, the <code>mvn deploy</code> command pushes the <code>acme-backend-1.0.0.jar</code> (or whatever version it is) to the <code>acme-releases</code> repository in Nexus. Nexus would then store this artifact, making it available for download by subsequent deployment stages. The <code>-DaltDeploymentRepository</code> parameter specifies the repository details directly, overriding any default settings in the <code>pom.xml</code> or <code>settings.xml</code> if needed, which can be useful in a CI context.</p>
<h3>Example: Managing Docker Images with a Container Registry</h3>
<p>If the Acme Webshop backend is containerized (as it will be in Module 4), the build artifact becomes a Docker image. This image needs to be pushed to a Docker registry.</p>
<p>A Jenkins stage to build and push a Docker image could look like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    environment {</span></span>
<span class="line"><span style="color:#005CC5">        DOCKER_REGISTRY</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'your-registry.example.com'</span><span style="color:#6A737D"> // e.g., 'acme.azurecr.io' or 'docker.io/yourusername'</span></span>
<span class="line"><span style="color:#005CC5">        IMAGE_NAME</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "acme-webshop-backend"</span></span>
<span class="line"><span style="color:#005CC5">        IMAGE_TAG</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "${env.BUILD_NUMBER}"</span><span style="color:#6A737D"> // Using Jenkins build number as image tag for uniqueness</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">build </span><span style="color:#032F62">"${DOCKER_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"</span><span style="color:#6A737D"> // Build the Docker image</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Push Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Authenticate to the Docker registry (credentials configured in Jenkins)</span></span>
<span class="line"><span style="color:#6A737D">                    // The 'docker.withRegistry' block handles authentication securely</span></span>
<span class="line"><span style="color:#24292E">                    docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">withRegistry(</span><span style="color:#032F62">"https://${DOCKER_REGISTRY}"</span><span style="color:#24292E">, </span><span style="color:#032F62">'dockerhub-credentials-id'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                        docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">image(</span><span style="color:#032F62">"${DOCKER_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"</span><span style="color:#24292E">)</span><span style="color:#D73A49">.</span><span style="color:#24292E">push() </span><span style="color:#6A737D">// Push the image to the registry</span></span>
<span class="line"><span style="color:#24292E">                        docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">image(</span><span style="color:#032F62">"${DOCKER_REGISTRY}/${IMAGE_NAME}:latest"</span><span style="color:#24292E">)</span><span style="color:#D73A49">.</span><span style="color:#24292E">push() </span><span style="color:#6A737D">// Optionally push a 'latest' tag</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ... subsequent stages for deploying the Docker image</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this pipeline, after the Docker image is built from the <code>Dockerfile</code> in the repository, it's tagged with a combination of the registry URL, image name, and the Jenkins <code>BUILD_NUMBER</code>. It's then pushed to the specified Docker registry. Using the build number as a tag ensures each image is unique and traceable back to a specific CI build, supporting the principle of artifact immutability. An additional <code>latest</code> tag is often pushed for convenience, though relying solely on <code>latest</code> in production is generally discouraged.</p>
<h2>Managing Dependencies in Package Repositories</h2>
<p>Beyond storing the artifacts generated by a build, package repositories also play a crucial role in managing external dependencies. When a build tool (like Maven, npm, or pip) fetches external libraries, it can be configured to do so through a corporate package repository. This repository acts as a proxy, downloading dependencies from public registries (e.g., Maven Central, npmjs.com) once and caching them locally.</p>
<p>Benefits of proxying dependencies through a private repository include:</p>
<ul>
<li><strong>Faster Builds:</strong> Subsequent builds can retrieve dependencies from the local cache instead of re-downloading them from external sources, significantly speeding up build times.</li>
<li><strong>Reliability:</strong> Builds are insulated from outages or slowdowns of public registries. If Maven Central goes down, your builds can still succeed using cached dependencies.</li>
<li><strong>Security:</strong> Allows organizations to scan dependencies for known vulnerabilities before they are used in builds, and to prevent the use of malicious or unapproved packages.</li>
<li><strong>Consistency:</strong> Ensures all developers and CI agents use the exact same versions of dependencies.</li>
</ul>
<p>For the Acme Webshop, configuring Maven to use Nexus as a proxy for Maven Central would involve updating the <code>settings.xml</code> file.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">xml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">&lt;</span><span style="color:#22863A">settings</span><span style="color:#6F42C1"> xmlns</span><span style="color:#24292E">=</span><span style="color:#032F62">"http://maven.apache.org/SETTINGS/1.1.0"</span></span>
<span class="line"><span style="color:#6F42C1">          xmlns:xsi</span><span style="color:#24292E">=</span><span style="color:#032F62">"http://www.w3.org/2001/XMLSchema-instance"</span></span>
<span class="line"><span style="color:#6F42C1">          xsi:schemaLocation</span><span style="color:#24292E">=</span><span style="color:#032F62">"http://maven.apache.org/SETTINGS/1.1.0 http://maven.apache.org/xsd/settings-1.1.0.xsd"</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">localRepository</span><span style="color:#24292E">/&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">interactiveMode</span><span style="color:#24292E">/&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">usePluginRegistry</span><span style="color:#24292E">/&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">offline</span><span style="color:#24292E">/&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">pluginGroups</span><span style="color:#24292E">/&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">servers</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">server</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;nexus&lt;/</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">username</span><span style="color:#24292E">&gt;deployment&lt;/</span><span style="color:#22863A">username</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">password</span><span style="color:#24292E">&gt;deployment_password&lt;/</span><span style="color:#22863A">password</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">server</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;/</span><span style="color:#22863A">servers</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">mirrors</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">mirror</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;nexus-public&lt;/</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">mirrorOf</span><span style="color:#24292E">&gt;*&lt;/</span><span style="color:#22863A">mirrorOf</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">url</span><span style="color:#24292E">&gt;http://your-nexus-server:8081/repository/maven-public/&lt;/</span><span style="color:#22863A">url</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#6A737D">      &lt;!-- 'maven-public' is often a group repository in Nexus that combines various proxy repositories (e.g., Maven Central) and internal hosted repositories. --&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">mirror</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;/</span><span style="color:#22863A">mirrors</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">profiles</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">profile</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;nexus&lt;/</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">repositories</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">repository</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;nexus&lt;/</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">name</span><span style="color:#24292E">&gt;Nexus Public Releases&lt;/</span><span style="color:#22863A">name</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">url</span><span style="color:#24292E">&gt;http://your-nexus-server:8081/repository/maven-public/&lt;/</span><span style="color:#22863A">url</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">releases</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">enabled</span><span style="color:#24292E">&gt;true&lt;/</span><span style="color:#22863A">enabled</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">releases</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">snapshots</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">enabled</span><span style="color:#24292E">&gt;true&lt;/</span><span style="color:#22863A">enabled</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">snapshots</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">repository</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;/</span><span style="color:#22863A">repositories</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;</span><span style="color:#22863A">pluginRepositories</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;</span><span style="color:#22863A">pluginRepository</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;nexus&lt;/</span><span style="color:#22863A">id</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">name</span><span style="color:#24292E">&gt;Nexus Public Releases&lt;/</span><span style="color:#22863A">name</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">url</span><span style="color:#24292E">&gt;http://your-nexus-server:8081/repository/maven-public/&lt;/</span><span style="color:#22863A">url</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">releases</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">enabled</span><span style="color:#24292E">&gt;true&lt;/</span><span style="color:#22863A">enabled</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">releases</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">          &lt;</span><span style="color:#22863A">snapshots</span><span style="color:#24292E">&gt;&lt;</span><span style="color:#22863A">enabled</span><span style="color:#24292E">&gt;true&lt;/</span><span style="color:#22863A">enabled</span><span style="color:#24292E">&gt;&lt;/</span><span style="color:#22863A">snapshots</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">        &lt;/</span><span style="color:#22863A">pluginRepository</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">      &lt;/</span><span style="color:#22863A">pluginRepositories</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;/</span><span style="color:#22863A">profile</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;/</span><span style="color:#22863A">profiles</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;</span><span style="color:#22863A">activeProfiles</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">    &lt;</span><span style="color:#22863A">activeProfile</span><span style="color:#24292E">&gt;nexus&lt;/</span><span style="color:#22863A">activeProfile</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">  &lt;/</span><span style="color:#22863A">activeProfiles</span><span style="color:#24292E">&gt;</span></span>
<span class="line"><span style="color:#24292E">&lt;/</span><span style="color:#22863A">settings</span><span style="color:#24292E">&gt;</span></span></code></pre></div></div></div>
<p>By configuring Maven to mirror all requests (<code>&lt;mirrorOf&gt;*&lt;/mirrorOf&gt;</code>) to the Nexus public group repository, all dependency downloads will first attempt to retrieve from Nexus. If Nexus does not have the dependency cached, it will fetch it from the upstream public repository, cache it, and then serve it to the build. This pattern is crucial for maintaining efficient and secure builds.</p>
<h2>Exercises and Practice Activities</h2>
<h3>Exercise 1: Exploring a Package Repository</h3>
<p><strong>Scenario:</strong> Your team at Acme Webshop has set up a new Nexus Repository Manager instance for managing Java artifacts.</p>
<p><strong>Task:</strong></p>
<ol>
<li>Access the Nexus instance (if provided, otherwise assume a local setup).</li>
<li>Locate the "acme-releases" hosted repository and the "maven-central" proxy repository.</li>
<li>Upload a dummy Maven artifact (a simple JAR file built from a local project) to the "acme-releases" repository using <code>mvn deploy</code>. Verify its presence in the Nexus UI.</li>
<li>Browse the "maven-central" proxy repository. Observe how dependencies are cached after your Maven build attempts to download them.</li>
<li>Try to delete an artifact from the "acme-releases" repository and note the security implications (e.g., only specific roles can delete).</li>
</ol>
<h3>Exercise 2: Modifying the Jenkins Pipeline for Artifact Management</h3>
<p><strong>Scenario:</strong> You are tasked with enhancing the existing Jenkins pipeline for the Acme Webshop backend to properly manage artifacts.</p>
<p><strong>Task:</strong></p>
<ol>
<li>Take the provided Jenkins declarative pipeline for the Acme Webshop backend (or a simplified version you've been working on).</li>
<li>Add a new <code>stage('Upload Artifact')</code> that uses <code>mvn deploy</code> to push the built <code>.jar</code> file to a specified Maven repository (e.g., your local Nexus or a dummy URL if no Nexus is available). Ensure the artifact version is dynamically generated (e.g., using a build number).</li>
<li>Modify the <code>settings.xml</code> that Jenkins uses (or configure it via Jenkins' Global Tool Configuration if you have access) to ensure Maven uses a proxy repository for external dependencies.</li>
<li>Run the pipeline and verify in the console output that the artifact was successfully deployed. Check the Nexus UI (or your chosen repository manager) to confirm the artifact's presence and version.</li>
</ol>
<h3>Exercise 3: Container Image Management</h3>
<p><strong>Scenario:</strong> The Acme Webshop team is starting to containerize services. You need to ensure Docker images are properly built and stored.</p>
<p><strong>Task:</strong></p>
<ol>
<li>Create a simple Dockerfile for a basic web application (e.g., an Nginx server serving a static HTML page, or a simple Node.js 'Hello World' app).</li>
<li>Develop a Jenkins declarative pipeline that:
<ul>
<li>Clones the repository containing the Dockerfile.</li>
<li>Builds the Docker image, tagging it with the Jenkins build number.</li>
<li>Pushes the tagged image to a Docker registry (e.g., Docker Hub, or a local registry like Harbor if available, or even just <code>docker.io/yourusername</code>).</li>
</ul>
</li>
<li>Configure Jenkins credentials for Docker Hub (or your chosen registry).</li>
<li>Run the pipeline and verify the image is pushed to the registry. Pull the image locally using <code>docker pull</code> to confirm it's accessible.</li>
</ol>
  
</div>

<div id="chapter-3.2">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Advanced Jenkins Pipelines: Parameterized Builds and Shared Libraries</h1><p>This lesson explores how to enhance Jenkins pipelines through parameterized builds and shared libraries. Parameterized builds allow for dynamic input during pipeline execution, enabling greater flexibility and reusability. Shared libraries provide a mechanism to define reusable functions, steps, and full pipelines, promoting consistency and reducing duplication across multiple Jenkins projects.</p>
<h2>Parameterized Builds in Jenkins Pipelines</h2>
<p>Parameterized builds enable users to provide input values to a Jenkins pipeline at the time of execution. This input can influence various aspects of the pipeline, such as the branch to build, the environment to deploy to, or configuration settings. By making pipelines configurable, they become more versatile and adaptable to different scenarios without requiring code changes.</p>
<h3>Defining Parameters</h3>
<p>Parameters are defined within the <code>parameters</code> section of a declarative pipeline. Jenkins supports several types of parameters, each serving a specific purpose.</p>
<ul>
<li>
<p><strong>StringParameter</strong>: Allows users to input a single line of text. Useful for specifying version numbers, commit hashes, or short messages.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    parameters {</span></span>
<span class="line"><span style="color:#24292E">        string(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'BRANCH_NAME'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'The Git branch to build.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">        string(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'BUILD_MESSAGE'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#032F62">''</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'Optional message for this build.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building branch: ${params.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#6A737D">                // Example: Checkout code from the specified branch</span></span>
<span class="line"><span style="color:#6A737D">                // git branch: params.BRANCH_NAME, url: 'https://github.com/your-org/acme-webshop.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this example, <code>BRANCH_NAME</code> defaults to <code>main</code>, and <code>BUILD_MESSAGE</code> is optional. When the pipeline runs, a form will appear, prompting the user for these values.</p>
</li>
<li>
<p><strong>BooleanParameter</strong>: Provides a checkbox for a true/false input. Useful for toggling features or conditional steps.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    parameters {</span></span>
<span class="line"><span style="color:#D73A49">        boolean</span><span style="color:#24292E">(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'RUN_TESTS'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'Check to run unit and integration tests.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building application..."</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when { expression { params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">RUN_TESTS</span><span style="color:#D73A49"> ==</span><span style="color:#005CC5"> true</span><span style="color:#24292E"> } } </span><span style="color:#6A737D">// Execute only if RUN_TESTS is true</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Running tests..."</span></span>
<span class="line"><span style="color:#6A737D">                // Example: sh 'mvn test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>Here, the "Test" stage will only execute if the <code>RUN_TESTS</code> checkbox is selected.</p>
</li>
<li>
<p><strong>ChoiceParameter</strong>: Presents a dropdown list of predefined options. Ideal for selecting deployment environments (e.g., <code>dev</code>, <code>staging</code>, <code>production</code>) or build types.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    parameters {</span></span>
<span class="line"><span style="color:#24292E">        choice(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'DEPLOY_ENV'</span><span style="color:#24292E">, </span><span style="color:#005CC5">choices</span><span style="color:#24292E">: [</span><span style="color:#032F62">'development'</span><span style="color:#24292E">, </span><span style="color:#032F62">'staging'</span><span style="color:#24292E">, </span><span style="color:#032F62">'production'</span><span style="color:#24292E">], </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'Select the deployment environment.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Deploying to ${params.DEPLOY_ENV} environment."</span></span>
<span class="line"><span style="color:#6A737D">                // Example: sh "deploy_script.sh --env ${params.DEPLOY_ENV}"</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This parameter restricts the user to choosing one of the three specified environments, preventing typos and ensuring valid inputs.</p>
</li>
<li>
<p><strong>TextParameter</strong>: Allows users to input multiline text. Useful for long commit messages, configuration snippets, or release notes.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    parameters {</span></span>
<span class="line"><span style="color:#24292E">        text(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'RELEASE_NOTES'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#032F62">'Bug fixes and performance improvements.'</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'Enter release notes for this deployment.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Document Release'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Release Notes: ${params.RELEASE_NOTES}"</span></span>
<span class="line"><span style="color:#6A737D">                // Example: Write release notes to a file or update a wiki</span></span>
<span class="line"><span style="color:#6A737D">                // writeFile file: 'release-notes.txt', text: params.RELEASE_NOTES</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>The <code>RELEASE_NOTES</code> parameter captures detailed information for the release.</p>
</li>
</ul>
<h3>Accessing Parameters</h3>
<p>Within the pipeline script, parameters are accessed using the <code>params</code> object, followed by the parameter's name. For instance, <code>params.BRANCH_NAME</code> retrieves the value of the <code>BRANCH_NAME</code> parameter. These values can then be used in shell commands, conditional logic (<code>when</code> clauses), or passed to other Jenkins steps.</p>
<p>Consider the "Acme Webshop" case study. Instead of hardcoding the deployment environment, a parameterized build could allow developers to choose <code>staging</code> for testing new features or <code>production</code> for a stable release. This reduces the need for multiple, slightly different pipelines.</p>
<h2>Jenkins Shared Libraries</h2>
<p>Jenkins Shared Libraries provide a powerful mechanism to define reusable functions, steps, and entire pipeline definitions that can be loaded and executed by any pipeline. This approach promotes code reusability, consistency, and maintainability across multiple projects within an organization. Instead of copying and pasting pipeline code, common logic can be centralized in a shared library.</p>
<h3>Structure of a Shared Library</h3>
<p>A shared library is typically a Git repository with a predefined directory structure. Jenkins automatically detects and loads components from these directories.</p>
<ul>
<li><strong><code>vars/</code></strong>: This directory contains Groovy script files that define global variables, functions, or steps callable from pipelines. Each file in <code>vars/</code> exposes a global variable with the same name as the file (without the <code>.groovy</code> extension).
<ul>
<li>Example: <code>vars/buildAcmeApp.groovy</code> would expose <code>buildAcmeApp()</code> as a step.</li>
</ul>
</li>
<li><strong><code>src/</code></strong>: This directory is for more complex Groovy classes that contain helper methods or encapsulate business logic. Classes in <code>src/</code> follow standard Java/Groovy package structures (e.g., <code>src/com/acme/util/Mailer.groovy</code>). These classes must be imported into <code>vars/</code> scripts or directly into pipelines.</li>
<li><strong><code>resources/</code></strong>: This directory can hold non-Groovy files (e.g., shell scripts, configuration files, templates) that need to be accessed by library code. These resources are accessed using the <code>libraryResource</code> step.</li>
</ul>
<h3>Defining Custom Steps in <code>vars/</code></h3>
<p>The most common use case for shared libraries is defining custom steps within the <code>vars/</code> directory. Each <code>.groovy</code> file in <code>vars/</code> represents a new callable step in your pipeline.</p>
<p>Example: <code>vars/acmeBuild.groovy</code></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// vars/acmeBuild.groovy</span></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> call</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> appName</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> branch</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'main'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">    // Defines a custom step named 'acmeBuild'</span></span>
<span class="line"><span style="color:#6A737D">    // It takes appName (required) and branch (optional, defaults to 'main') as arguments</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    node { </span><span style="color:#6A737D">// Ensures the build runs on an available agent</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">"Checkout ${appName}"</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: branch, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">"https://github.com/your-org/${appName}.git"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">"Build ${appName}"</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">            // Placeholder for build logic</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Building ${appName} from branch ${branch}..."</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">"docker build -t ${appName}:${env.BUILD_NUMBER} ."</span><span style="color:#6A737D"> // Example build command</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // Further stages like testing or artifact publishing can be added here</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This <code>acmeBuild.groovy</code> script defines a custom step named <code>acmeBuild</code>. It takes <code>appName</code> and an optional <code>branch</code> argument.</p>
<h3>Using Shared Libraries in Jenkinsfiles</h3>
<p>To use a shared library, it must first be configured in Jenkins (either globally or per folder). Once configured, you can load it into your pipeline using the <code>@Library</code> annotation or the <code>library</code> directive.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop</span></span>
<span class="line"><span style="color:#D73A49">@Library</span><span style="color:#24292E">(</span><span style="color:#032F62">'acme-shared-library@main'</span><span style="color:#24292E">) _ </span><span style="color:#6A737D">// Loads the 'acme-shared-library' from the 'main' branch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    parameters {</span></span>
<span class="line"><span style="color:#24292E">        string(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'APP_NAME'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#032F62">'acme-webshop'</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'Name of the application.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">        string(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'BRANCH_TO_BUILD'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#032F62">'feature/new-checkout'</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'The Git branch to build.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Full Acme Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Calling the custom 'acmeBuild' step from the shared library</span></span>
<span class="line"><span style="color:#24292E">                acmeBuild(params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">APP_NAME</span><span style="color:#24292E">, params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">BRANCH_TO_BUILD</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy Staging'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Deploying ${params.APP_NAME}:${env.BUILD_NUMBER} to staging..."</span></span>
<span class="line"><span style="color:#6A737D">                // Example: Call another shared library step for deployment</span></span>
<span class="line"><span style="color:#6A737D">                // acmeDeploy(params.APP_NAME, 'staging', env.BUILD_NUMBER)</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this <code>Jenkinsfile</code>, the <code>@Library</code> annotation loads the <code>acme-shared-library</code> (assuming it's configured in Jenkins). Then, the <code>acmeBuild</code> step is called, passing the parameterized <code>APP_NAME</code> and <code>BRANCH_TO_BUILD</code> values. This allows different projects to reuse the same robust build logic defined in the shared library, ensuring consistency and reducing maintenance overhead.</p>
<h3>Complex Logic with <code>src/</code> and <code>resources/</code></h3>
<p>For more complex logic, the <code>src/</code> directory can host Groovy classes.</p>
<p>Example: <code>src/com/acme/pipeline/Mailer.groovy</code></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// src/com/acme/pipeline/Mailer.groovy</span></span>
<span class="line"><span style="color:#D73A49">package</span><span style="color:#24292E"> com.acme.pipeline</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> Mailer</span><span style="color:#D73A49"> implements</span><span style="color:#6F42C1"> Serializable</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">    // Implements Serializable for passing across Jenkins steps/stages</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#D73A49"> Script</span><span style="color:#24292E"> script </span><span style="color:#6A737D">// Reference to the pipeline script context</span></span>
<span class="line"><span style="color:#D73A49">    private</span><span style="color:#D73A49"> String</span><span style="color:#24292E"> recipient</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    Mailer</span><span style="color:#24292E">(</span><span style="color:#D73A49">Script</span><span style="color:#E36209"> script</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> recipient</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#D73A49">.</span><span style="color:#24292E">script </span><span style="color:#D73A49">=</span><span style="color:#24292E"> script</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#D73A49">.</span><span style="color:#24292E">recipient </span><span style="color:#D73A49">=</span><span style="color:#24292E"> recipient</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    void</span><span style="color:#6F42C1"> sendBuildStatus</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> status</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">        // Accessing the 'mail' step from the Jenkins environment via 'script'</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">mail </span><span style="color:#005CC5">bcc</span><span style="color:#24292E">: </span><span style="color:#032F62">''</span><span style="color:#24292E">, </span><span style="color:#005CC5">body</span><span style="color:#24292E">: </span><span style="color:#032F62">"Build for ${script.env.JOB_NAME} (${script.env.BUILD_NUMBER}) finished with status: ${status}"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">             from</span><span style="color:#24292E">: </span><span style="color:#032F62">'jenkins@acme.com'</span><span style="color:#24292E">, </span><span style="color:#005CC5">subject</span><span style="color:#24292E">: </span><span style="color:#032F62">"[Acme] Build Notification"</span><span style="color:#24292E">, </span><span style="color:#005CC5">to</span><span style="color:#24292E">: recipient</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Email sent to ${recipient} about build status: ${status}"</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This <code>Mailer</code> class can then be instantiated and used in a <code>vars/</code> script:</p>
<p>Example: <code>vars/notifyBuildStatus.groovy</code></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// vars/notifyBuildStatus.groovy</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> com.acme.pipeline.Mailer</span><span style="color:#24292E"> //</span><span style="color:#24292E"> Import</span><span style="color:#24292E"> the</span><span style="color:#24292E"> Mailer</span><span style="color:#24292E"> class</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> call</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> recipient</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> status</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">    // Instantiate the Mailer class, passing 'this' (the current script context)</span></span>
<span class="line"><span style="color:#D73A49">    def</span><span style="color:#24292E"> mailer </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#D73A49"> Mailer</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">, recipient)</span></span>
<span class="line"><span style="color:#24292E">    mailer</span><span style="color:#D73A49">.</span><span style="color:#24292E">sendBuildStatus(status)</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In a <code>Jenkinsfile</code>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">@Library</span><span style="color:#24292E">(</span><span style="color:#032F62">'acme-shared-library@main'</span><span style="color:#24292E">) _</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building..."</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Notify Success'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    notifyBuildStatus(</span><span style="color:#032F62">'devops@acme.com'</span><span style="color:#24292E">, </span><span style="color:#032F62">'SUCCESS'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>The <code>resources/</code> directory can store configuration files. For example, <code>resources/config/acme-properties.json</code>.
You can access it using <code>libraryResource</code>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// In a vars/ script or Jenkinsfile</span></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#24292E"> configContent </span><span style="color:#D73A49">=</span><span style="color:#24292E"> libraryResource </span><span style="color:#032F62">'config/acme-properties.json'</span></span>
<span class="line"><span style="color:#24292E">echo </span><span style="color:#032F62">"Configuration content: ${configContent}"</span></span></code></pre></div></div></div>
<h3>Advantages of Shared Libraries</h3>
<ul>
<li><strong>Reusability</strong>: Avoids duplicating pipeline code across multiple projects.</li>
<li><strong>Consistency</strong>: Ensures all projects follow the same best practices and standards.</li>
<li><strong>Maintainability</strong>: Changes to common logic only need to be made in one place (the shared library).</li>
<li><strong>Version Control</strong>: Shared libraries are Git repositories, allowing for versioning, branching, and pull requests, just like application code.</li>
<li><strong>Encapsulation</strong>: Complex logic can be hidden behind simple custom steps, making <code>Jenkinsfiles</code> cleaner and easier to read.</li>
</ul>
<h3>Example: "Acme Webshop" with Shared Library</h3>
<p>For the "Acme Webshop", a shared library could contain common steps for:</p>
<ol>
<li><strong><code>acmeCheckout</code></strong>: Checking out the application's source code, possibly with Git credentials.</li>
<li><strong><code>acmeBuildDockerImage</code></strong>: Building the Docker image for the webshop. (This prepares for Module 4: Containerization)</li>
<li><strong><code>acmeRunUnitTests</code></strong>: Executing unit and integration tests. (References Module 2 concepts)</li>
<li><strong><code>acmePublishArtifact</code></strong>: Publishing the built Docker image to a container registry. (Relates to Lesson 1: Managing Build Artifacts)</li>
<li><strong><code>acmeDeploy</code></strong>: Deploying the application to a specific environment.</li>
</ol>
<p>A <code>Jenkinsfile</code> for the Acme Webshop might look like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">@Library</span><span style="color:#24292E">(</span><span style="color:#032F62">'acme-devops-library@main'</span><span style="color:#24292E">) _ </span><span style="color:#6A737D">// Assuming 'acme-devops-library' is the shared library</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    parameters {</span></span>
<span class="line"><span style="color:#24292E">        choice(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'ENVIRONMENT'</span><span style="color:#24292E">, </span><span style="color:#005CC5">choices</span><span style="color:#24292E">: [</span><span style="color:#032F62">'dev'</span><span style="color:#24292E">, </span><span style="color:#032F62">'staging'</span><span style="color:#24292E">], </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'Select deployment environment.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">        string(</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'IMAGE_TAG'</span><span style="color:#24292E">, </span><span style="color:#005CC5">defaultValue</span><span style="color:#24292E">: </span><span style="color:#032F62">'latest'</span><span style="color:#24292E">, </span><span style="color:#005CC5">description</span><span style="color:#24292E">: </span><span style="color:#032F62">'Docker image tag to build/deploy.'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout Source'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                acmeCheckout(</span><span style="color:#032F62">'acme-webshop'</span><span style="color:#24292E">, </span><span style="color:#032F62">'main'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Custom step from shared library</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build and Test Webshop'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                acmeBuildDockerImage(</span><span style="color:#032F62">'acme-webshop'</span><span style="color:#24292E">, params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">IMAGE_TAG</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Custom step</span></span>
<span class="line"><span style="color:#24292E">                acmeRunUnitTests(</span><span style="color:#032F62">'acme-webshop'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Custom step</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Environment'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Conditional deployment based on parameter</span></span>
<span class="line"><span style="color:#24292E">                when { expression { params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">ENVIRONMENT</span><span style="color:#D73A49"> ==</span><span style="color:#032F62"> 'dev'</span><span style="color:#24292E"> } }</span></span>
<span class="line"><span style="color:#24292E">                then {</span></span>
<span class="line"><span style="color:#24292E">                    acmeDeploy(</span><span style="color:#032F62">'acme-webshop'</span><span style="color:#24292E">, params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">IMAGE_TAG</span><span style="color:#24292E">, </span><span style="color:#032F62">'dev'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Custom step</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">                when { expression { params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">ENVIRONMENT</span><span style="color:#D73A49"> ==</span><span style="color:#032F62"> 'staging'</span><span style="color:#24292E"> } }</span></span>
<span class="line"><span style="color:#24292E">                then {</span></span>
<span class="line"><span style="color:#24292E">                    acmeDeploy(</span><span style="color:#032F62">'acme-webshop'</span><span style="color:#24292E">, params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">IMAGE_TAG</span><span style="color:#24292E">, </span><span style="color:#032F62">'staging'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Custom step</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This dramatically simplifies the <code>Jenkinsfile</code> by abstracting away the implementation details into the shared library, making the pipeline's intent clearer and easier to manage.</p>
<h2>Exercises and Practice Activities</h2>
<ol>
<li>
<p><strong>Parameterized Build for Acme Webshop Testing:</strong>
Create a Jenkins Declarative Pipeline for the "Acme Webshop" that allows users to specify:</p>
<ul>
<li><code>TEST_TYPE</code> (ChoiceParameter: <code>unit</code>, <code>integration</code>, <code>e2e</code>)</li>
<li><code>BRANCH_TO_TEST</code> (StringParameter, default to <code>main</code>)
The pipeline should have a stage called "Run Tests" that <em>only</em> executes if <code>TEST_TYPE</code> is <code>unit</code> or <code>integration</code>. Inside this stage, print a message indicating which type of tests are being run on which branch (e.g., "Running unit tests on branch main").</li>
</ul>
</li>
<li>
<p><strong>Developing a Shared Library for Deployment:</strong>
Imagine you need a standardized deployment step for the "Acme Webshop" and other applications.</p>
<ul>
<li>Create a new Git repository for your shared library (e.g., <code>jenkins-devops-library</code>).</li>
<li>Inside this repository, create a <code>vars/</code> directory.</li>
<li>Add a file named <code>acmeDeployApp.groovy</code> to the <code>vars/</code> directory.</li>
<li>The <code>acmeDeployApp</code> step should accept the following parameters:
<ul>
<li><code>appName</code> (String): The name of the application (e.g., <code>acme-webshop</code>)</li>
<li><code>environment</code> (String): The target environment (e.g., <code>dev</code>, <code>staging</code>)</li>
<li><code>version</code> (String): The version or image tag to deploy</li>
</ul>
</li>
<li>The <code>acmeDeployApp.groovy</code> script should simply print a message like: "Deploying <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mi>a</mi><mi>p</mi><mi>p</mi><mi>N</mi><mi>a</mi><mi>m</mi><mi>e</mi></mrow><mi>v</mi><mi>e</mi><mi>r</mi><mi>s</mi><mi>i</mi><mi>o</mi><mi>n</mi></mrow><annotation encoding="application/x-tex">{appName} version </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8778em; vertical-align: -0.1944em;"></span><span class="mord"><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.10903em;">ppN</span><span class="mord mathnormal">am</span><span class="mord mathnormal">e</span></span><span class="mord mathnormal" style="margin-right: 0.03588em;">v</span><span class="mord mathnormal">ers</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">n</span></span></span></span>{version} to ${environment}." (No actual deployment logic needed yet).</li>
<li>Configure your Jenkins instance to recognize this new shared library.</li>
<li>Modify the "Acme Webshop" <code>Jenkinsfile</code> (from Exercise 1 or previous lessons) to use the <code>acmeDeployApp</code> step within a "Deploy" stage, passing in appropriate parameterized values.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-3.3">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Defining Deployment Environments with Infrastructure as Code (Terraform)</h1><p>Deployment environments provide isolated spaces for developing, testing, and running applications throughout their lifecycle. These environments typically include development, testing, staging, and production. Managing the configuration and provisioning of these environments manually is time-consuming, error-prone, and inconsistent. Infrastructure as Code (IaC) addresses these challenges by enabling the management of infrastructure (networks, virtual machines, databases, etc.) using configuration files and code. Terraform is a widely adopted IaC tool that allows defining and provisioning infrastructure using a declarative configuration language.</p>
<h2>Understanding Deployment Environments</h2>
<p>Deployment environments are distinct system landscapes designed for specific phases of the software development and delivery process. Each environment serves a unique purpose and often has different configurations, resource allocations, and access controls.</p>
<h3>Common Deployment Environment Types</h3>
<ul>
<li><strong>Development Environment (Dev):</strong> This is where developers write and test their code locally. It's often highly flexible, allowing for rapid iteration and debugging. Configurations may vary significantly among individual developers. For instance, a developer building a new feature for the Acme Webshop might run a local instance of the web application, a local database, and mock third-party services on their machine.</li>
<li><strong>Testing Environment (Test):</strong> Used for automated and manual testing, including unit tests, integration tests, and system tests. This environment aims to mirror the production environment as closely as possible to catch issues early. The Acme Webshop's automated CI pipeline, as discussed in Module 2, would deploy its built artifacts to a dedicated testing environment for running a comprehensive suite of tests before moving to further stages.</li>
<li><strong>Staging Environment (Staging/Pre-Production):</strong> A near-identical replica of the production environment. It is used for final verification before deployment to production, often involving user acceptance testing (UAT), performance testing, and security audits. For the Acme Webshop, the staging environment would be a fully functional copy, including all services (web application, database, payment gateway integration), that business stakeholders and a select group of users can test to ensure everything works as expected before a public release.</li>
<li><strong>Production Environment (Prod):</strong> The live environment where the application is accessible to end-users. This environment prioritizes stability, security, and performance. The Acme Webshop's actual customer-facing site runs in the production environment.</li>
</ul>
<h3>Challenges of Manual Environment Management</h3>
<p>Historically, setting up and maintaining these environments involved manual tasks, which led to several issues:</p>
<ul>
<li><strong>Inconsistency (Configuration Drift):</strong> Manual changes can lead to environments deviating from their intended state or from each other, making troubleshooting difficult. For example, a development team might manually install a new library on a server in the testing environment, but forget to document it or apply it to staging, leading to unexpected failures later.</li>
<li><strong>Slow Provisioning:</strong> Manual setup is time-consuming, delaying development and testing cycles. A team needing a new staging environment for a major release might wait days or weeks for IT operations to manually provision servers, databases, and network configurations.</li>
<li><strong>Human Error:</strong> Typos, missed steps, or incorrect configurations are common with manual processes. An administrator might accidentally misconfigure a firewall rule in one environment, exposing a service or blocking legitimate traffic.</li>
<li><strong>Lack of Version Control:</strong> Manual configurations are difficult to track, revert, or collaborate on. Without a clear record, it is impossible to know who changed what, when, or why.</li>
</ul>
<h2>Introduction to Infrastructure as Code (IaC)</h2>
<p>Infrastructure as Code (IaC) is the practice of managing and provisioning computing infrastructure (physical and virtual machines, networks, storage, etc.) using machine-readable definition files, rather than physical hardware configuration or interactive configuration tools.</p>
<h3>Key Principles of IaC</h3>
<ul>
<li><strong>Declarative vs. Imperative:</strong>
<ul>
<li><strong>Declarative (Terraform):</strong> Defines the <em>desired state</em> of the infrastructure. The IaC tool determines the necessary steps to achieve that state. For example, you declare "I want three EC2 instances, an S3 bucket, and a VPC." The tool figures out how to create them.</li>
<li><strong>Imperative:</strong> Defines the <em>steps</em> to achieve a desired state. For example, "First, create an EC2 instance. Second, install Nginx. Third, open port 80."</li>
</ul>
</li>
<li><strong>Version Control:</strong> Infrastructure definitions are stored in version control systems (like Git), allowing tracking changes, collaboration, and easy rollback. If a new network configuration breaks connectivity, rolling back to a previous working version is straightforward.</li>
<li><strong>Idempotence:</strong> Applying the same IaC configuration multiple times produces the same result without unintended side effects. If a resource already exists and matches the desired state, no changes are made. If it doesn't, it's created or updated.</li>
<li><strong>Automation:</strong> IaC tools automate the provisioning and management of infrastructure, eliminating manual intervention. This speeds up environment setup and reduces errors.</li>
</ul>
<h3>Benefits of IaC</h3>
<ul>
<li><strong>Consistency:</strong> Ensures environments are identical and always in a defined state, reducing configuration drift.</li>
<li><strong>Speed and Efficiency:</strong> Automates environment provisioning, reducing setup time from days to minutes.</li>
<li><strong>Cost Savings:</strong> Optimizes resource utilization by easily tearing down unused environments.</li>
<li><strong>Reduced Risk:</strong> Minimizes human error and provides audit trails through version control.</li>
<li><strong>Scalability:</strong> Allows easy replication of environments for scaling or creating new development/testing setups.</li>
</ul>
<h2>Defining Infrastructure with Terraform</h2>
<p>Terraform, developed by HashiCorp, is an open-source IaC tool that enables users to define and provision data center infrastructure using a high-level configuration language called HashiCorp Configuration Language (HCL).</p>
<h3>Terraform Core Concepts</h3>
<ul>
<li><strong>Providers:</strong> Terraform interacts with various cloud and on-premise infrastructure platforms through providers (e.g., AWS, Azure, Google Cloud, VMware vSphere). Each provider offers resources specific to that platform.</li>
<li><strong>Resources:</strong> Fundamental building blocks of Terraform configurations. A resource represents an infrastructure object like a virtual machine, a network interface, a database instance, or a load balancer.</li>
<li><strong>State File:</strong> Terraform maintains a state file (by default <code>terraform.tfstate</code>) that maps real-world infrastructure to the configuration and tracks metadata. This file is crucial for Terraform to understand what infrastructure it is managing and to create an execution plan for changes. It should always be stored securely and ideally in a remote backend for collaboration.</li>
<li><strong>Modules:</strong> Reusable, encapsulated configurations that can be shared and versioned. Modules promote modularity and reduce redundancy.</li>
<li><strong>Variables:</strong> Inputs to Terraform configurations, allowing for customization without modifying the core code.</li>
<li><strong>Outputs:</strong> Values exposed by a Terraform configuration, useful for consuming by other configurations or for displaying relevant information after provisioning.</li>
</ul>
<h3>Terraform Workflow</h3>
<ol>
<li><strong>Write Configuration:</strong> Define the desired infrastructure in <code>.tf</code> files using HCL.</li>
<li><strong>Initialize:</strong> Run <code>terraform init</code> to download necessary provider plugins and initialize the working directory.</li>
<li><strong>Plan:</strong> Run <code>terraform plan</code> to generate an execution plan. This plan shows what actions Terraform will take (create, modify, delete) to achieve the desired state without actually making changes.</li>
<li><strong>Apply:</strong> Run <code>terraform apply</code> to execute the plan and provision/modify the infrastructure.</li>
<li><strong>Destroy:</strong> Run <code>terraform destroy</code> to tear down all resources managed by the current configuration.</li>
</ol>
<h2>Practical Example: Defining Acme Webshop Environments with Terraform</h2>
<p>Let's apply Terraform to define a basic staging environment for the Acme Webshop on AWS. We will define a Virtual Private Cloud (VPC), subnets, and a security group, and then provision an EC2 instance to host our application.</p>
<h3>Setting Up a Basic AWS VPC and EC2 Instance</h3>
<p>First, ensure you have AWS credentials configured for Terraform (e.g., via environment variables <code>AWS_ACCESS_KEY_ID</code>, <code>AWS_SECRET_ACCESS_KEY</code>, or <code>~/.aws/credentials</code>).</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">hcl</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># main.tf - Defines the core infrastructure for Acme Webshop Staging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Configure the AWS provider</span></span>
<span class="line"><span style="color:#6F42C1">provider</span><span style="color:#005CC5"> "aws"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  region</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "us-east-1"</span><span style="color:#6A737D"> # Specify your desired AWS region</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define a Virtual Private Cloud (VPC) for the staging environment</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_vpc"</span><span style="color:#005CC5"> "acme_webshop_staging_vpc"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  cidr_block</span><span style="color:#D73A49">           =</span><span style="color:#032F62"> "10.0.0.0/16"</span></span>
<span class="line"><span style="color:#24292E">  enable_dns_hostnames</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> true</span></span>
<span class="line"><span style="color:#24292E">  enable_dns_support</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-staging-vpc"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "staging"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define a public subnet within the VPC</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_subnet"</span><span style="color:#005CC5"> "acme_webshop_staging_subnet"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  vpc_id</span><span style="color:#D73A49">                  =</span><span style="color:#24292E"> aws_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">  cidr_block</span><span style="color:#D73A49">              =</span><span style="color:#032F62"> "10.0.1.0/24"</span></span>
<span class="line"><span style="color:#24292E">  map_public_ip_on_launch</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> true</span><span style="color:#6A737D"> # Automatically assign public IPs to instances launched in this subnet</span></span>
<span class="line"><span style="color:#24292E">  availability_zone</span><span style="color:#D73A49">       =</span><span style="color:#032F62"> "us-east-1a"</span><span style="color:#6A737D"> # Choose an appropriate AZ</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-staging-subnet"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "staging"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define an Internet Gateway to allow communication between VPC and the internet</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_internet_gateway"</span><span style="color:#005CC5"> "acme_webshop_staging_igw"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  vpc_id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> aws_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-staging-igw"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "staging"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define a route table for the public subnet</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_route_table"</span><span style="color:#005CC5"> "acme_webshop_staging_rt"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  vpc_id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> aws_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  route</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    cidr_block</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "0.0.0.0/0"</span><span style="color:#6A737D"> # Route all outbound traffic to the Internet Gateway</span></span>
<span class="line"><span style="color:#24292E">    gateway_id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> aws_internet_gateway</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_igw</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-staging-rt"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "staging"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Associate the route table with the public subnet</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_route_table_association"</span><span style="color:#005CC5"> "acme_webshop_staging_rt_association"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  subnet_id</span><span style="color:#D73A49">      =</span><span style="color:#24292E"> aws_subnet</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_subnet</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">  route_table_id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> aws_route_table</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_rt</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define a Security Group for the EC2 instance</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_security_group"</span><span style="color:#005CC5"> "acme_webshop_staging_sg"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  name</span><span style="color:#D73A49">        =</span><span style="color:#032F62"> "acme-webshop-staging-sg"</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Allow HTTP/HTTPS and SSH access to Acme Webshop staging instances"</span></span>
<span class="line"><span style="color:#24292E">  vpc_id</span><span style="color:#D73A49">      =</span><span style="color:#24292E"> aws_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  # Ingress (inbound) rules</span></span>
<span class="line"><span style="color:#6F42C1">  ingress</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    from_port</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> 22</span></span>
<span class="line"><span style="color:#24292E">    to_port</span><span style="color:#D73A49">     =</span><span style="color:#005CC5"> 22</span></span>
<span class="line"><span style="color:#24292E">    protocol</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "tcp"</span></span>
<span class="line"><span style="color:#24292E">    cidr_blocks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span><span style="color:#032F62">"0.0.0.0/0"</span><span style="color:#24292E">] </span><span style="color:#6A737D"># Allow SSH from anywhere (for demonstration, restrict in production)</span></span>
<span class="line"><span style="color:#24292E">    description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Allow SSH access"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  ingress</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    from_port</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> 80</span></span>
<span class="line"><span style="color:#24292E">    to_port</span><span style="color:#D73A49">     =</span><span style="color:#005CC5"> 80</span></span>
<span class="line"><span style="color:#24292E">    protocol</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "tcp"</span></span>
<span class="line"><span style="color:#24292E">    cidr_blocks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span><span style="color:#032F62">"0.0.0.0/0"</span><span style="color:#24292E">] </span><span style="color:#6A737D"># Allow HTTP from anywhere</span></span>
<span class="line"><span style="color:#24292E">    description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Allow HTTP access"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  ingress</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    from_port</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> 443</span></span>
<span class="line"><span style="color:#24292E">    to_port</span><span style="color:#D73A49">     =</span><span style="color:#005CC5"> 443</span></span>
<span class="line"><span style="color:#24292E">    protocol</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "tcp"</span></span>
<span class="line"><span style="color:#24292E">    cidr_blocks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span><span style="color:#032F62">"0.0.0.0/0"</span><span style="color:#24292E">] </span><span style="color:#6A737D"># Allow HTTPS from anywhere</span></span>
<span class="line"><span style="color:#24292E">    description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Allow HTTPS access"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  # Egress (outbound) rule</span></span>
<span class="line"><span style="color:#6F42C1">  egress</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    from_port</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> 0</span></span>
<span class="line"><span style="color:#24292E">    to_port</span><span style="color:#D73A49">     =</span><span style="color:#005CC5"> 0</span></span>
<span class="line"><span style="color:#24292E">    protocol</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "-1"</span><span style="color:#6A737D"> # Allow all outbound traffic</span></span>
<span class="line"><span style="color:#24292E">    cidr_blocks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span><span style="color:#032F62">"0.0.0.0/0"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-staging-sg"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "staging"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define an EC2 instance for the Acme Webshop application</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_instance"</span><span style="color:#005CC5"> "acme_webshop_staging_app"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  ami</span><span style="color:#D73A49">           =</span><span style="color:#032F62"> "ami-0abcdef1234567890"</span><span style="color:#6A737D"> # Replace with a valid AMI ID for your region (e.g., Amazon Linux 2 AMI)</span></span>
<span class="line"><span style="color:#24292E">  instance_type</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "t2.micro"</span></span>
<span class="line"><span style="color:#24292E">  subnet_id</span><span style="color:#D73A49">     =</span><span style="color:#24292E"> aws_subnet</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_subnet</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">  security_groups</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [aws_security_group</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_sg</span><span style="color:#D73A49">.</span><span style="color:#24292E">name] </span><span style="color:#6A737D"># Reference the security group by name</span></span>
<span class="line"><span style="color:#24292E">  key_name</span><span style="color:#D73A49">      =</span><span style="color:#032F62"> "my-ssh-key"</span><span style="color:#6A737D"> # Replace with your SSH key pair name for EC2 access</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  user_data</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> &lt;&lt;-EOF</span></span>
<span class="line"><span style="color:#032F62">              #!/bin/bash</span></span>
<span class="line"><span style="color:#032F62">              echo "Hello from Acme Webshop staging instance!" &gt; /var/www/html/index.html</span></span>
<span class="line"><span style="color:#032F62">              # In a real scenario, you would install web server (e.g., Nginx, Apache),</span></span>
<span class="line"><span style="color:#032F62">              # deploy your application artifact, and configure it here.</span></span>
<span class="line"><span style="color:#032F62">              # For demonstration, we just create a simple index.html.</span></span>
<span class="line"><span style="color:#D73A49">              EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-staging-app"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "staging"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Output the public IP address of the EC2 instance</span></span>
<span class="line"><span style="color:#6F42C1">output</span><span style="color:#005CC5"> "acme_webshop_staging_app_public_ip"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Public IP address of the Acme Webshop staging application instance."</span></span>
<span class="line"><span style="color:#24292E">  value</span><span style="color:#D73A49">       =</span><span style="color:#24292E"> aws_instance</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_staging_app</span><span style="color:#D73A49">.</span><span style="color:#24292E">public_ip</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>Explanation of the Configuration:</strong></p>
<ul>
<li><strong><code>provider "aws"</code></strong>: Specifies that we are provisioning resources on AWS. The <code>region</code> defines where these resources will be created.</li>
<li><strong><code>resource "aws_vpc" "acme_webshop_staging_vpc"</code></strong>: Creates a new VPC named <code>acme-webshop-staging-vpc</code> with a CIDR block of <code>10.0.0.0/16</code>.</li>
<li><strong><code>resource "aws_subnet" "acme_webshop_staging_subnet"</code></strong>: Defines a public subnet within the created VPC. <code>map_public_ip_on_launch = true</code> ensures instances launched here get a public IP.</li>
<li><strong><code>resource "aws_internet_gateway" "acme_webshop_staging_igw"</code></strong>: Attaches an Internet Gateway to the VPC, enabling internet connectivity.</li>
<li><strong><code>resource "aws_route_table" "acme_webshop_staging_rt"</code></strong>: Creates a route table that directs all traffic (<code>0.0.0.0/0</code>) out through the Internet Gateway.</li>
<li><strong><code>resource "aws_route_table_association"</code></strong>: Links the route table to the subnet.</li>
<li><strong><code>resource "aws_security_group" "acme_webshop_staging_sg"</code></strong>: Defines a security group that acts as a virtual firewall. It opens ports 22 (SSH), 80 (HTTP), and 443 (HTTPS) to the world. In a real scenario, SSH access would be restricted to specific IP ranges.</li>
<li><strong><code>resource "aws_instance" "acme_webshop_staging_app"</code></strong>: Launches an EC2 instance.
<ul>
<li><code>ami</code>: The Amazon Machine Image ID (you need to find a suitable one for your region, e.g., for Amazon Linux 2).</li>
<li><code>instance_type</code>: Defines the size and capacity of the VM (e.g., <code>t2.micro</code>).</li>
<li><code>subnet_id</code>: Associates the instance with the defined public subnet.</li>
<li><code>security_groups</code>: Attaches the defined security group.</li>
<li><code>key_name</code>: Specifies the SSH key pair for accessing the instance.</li>
<li><code>user_data</code>: A script that runs when the instance first starts. Here, it creates a simple <code>index.html</code>. In a real scenario, this would involve installing dependencies and deploying the application.</li>
</ul>
</li>
<li><strong><code>output "acme_webshop_staging_app_public_ip"</code></strong>: Exports the public IP address of the EC2 instance after creation, making it easily accessible.</li>
</ul>
<h3>Executing the Terraform Configuration</h3>
<ol>
<li><strong>Save:</strong> Save the code above as <code>main.tf</code> in an empty directory.</li>
<li><strong>Initialize:</strong> Open your terminal in that directory and run:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#032F62"> init</span></span></code></pre></div></div></div>
This downloads the AWS provider plugin.</li>
<li><strong>Plan:</strong> Generate an execution plan:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#032F62"> plan</span></span></code></pre></div></div></div>
Review the output carefully. It will show you exactly what resources Terraform plans to create.</li>
<li><strong>Apply:</strong> If the plan looks correct, apply the changes:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#032F62"> apply</span></span></code></pre></div></div></div>
Type <code>yes</code> when prompted to confirm the execution.
Terraform will provision the resources in your AWS account. Once complete, it will output the public IP of the EC2 instance.</li>
<li><strong>Verify:</strong> Access the public IP in your browser to see the "Hello from Acme Webshop staging instance!" message. You can also log into your AWS console to verify the created VPC, subnet, IGW, security group, and EC2 instance.</li>
<li><strong>Destroy (Cleanup):</strong> To remove all provisioned resources, run:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#032F62"> destroy</span></span></code></pre></div></div></div>
Type <code>yes</code> when prompted. This is crucial for avoiding unexpected AWS charges.</li>
</ol>
<h3>Environment Separation with Variables</h3>
<p>To make our configuration reusable for other environments (e.g., production), we can introduce variables. This prevents hardcoding values specific to an environment.</p>
<p>Create a <code>variables.tf</code> file:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">hcl</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># variables.tf</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">variable</span><span style="color:#005CC5"> "environment_name"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "The name of the deployment environment (e.g., staging, production)"</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#D73A49">        =</span><span style="color:#D73A49"> string</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">variable</span><span style="color:#005CC5"> "vpc_cidr_block"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "The CIDR block for the VPC"</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#D73A49">        =</span><span style="color:#D73A49"> string</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">variable</span><span style="color:#005CC5"> "subnet_cidr_block"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "The CIDR block for the public subnet"</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#D73A49">        =</span><span style="color:#D73A49"> string</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">variable</span><span style="color:#005CC5"> "ami_id"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "The AMI ID for the EC2 instance"</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#D73A49">        =</span><span style="color:#D73A49"> string</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">variable</span><span style="color:#005CC5"> "instance_type"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "The instance type for the EC2 instance"</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#D73A49">        =</span><span style="color:#D73A49"> string</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">variable</span><span style="color:#005CC5"> "key_pair_name"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "The name of the SSH key pair for EC2 access"</span></span>
<span class="line"><span style="color:#24292E">  type</span><span style="color:#D73A49">        =</span><span style="color:#D73A49"> string</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>Modify <code>main.tf</code> to use these variables:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">hcl</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># main.tf - Modified to use variables</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Configure the AWS provider</span></span>
<span class="line"><span style="color:#6F42C1">provider</span><span style="color:#005CC5"> "aws"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  region</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "us-east-1"</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define a Virtual Private Cloud (VPC)</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_vpc"</span><span style="color:#005CC5"> "acme_webshop_vpc"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  cidr_block</span><span style="color:#D73A49">           =</span><span style="color:#24292E"> var</span><span style="color:#D73A49">.</span><span style="color:#24292E">vpc_cidr_block</span></span>
<span class="line"><span style="color:#24292E">  enable_dns_hostnames</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> true</span></span>
<span class="line"><span style="color:#24292E">  enable_dns_support</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> true</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-</span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62">-vpc"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#24292E"> var.environment_name</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define a public subnet within the VPC</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_subnet"</span><span style="color:#005CC5"> "acme_webshop_subnet"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  vpc_id</span><span style="color:#D73A49">                  =</span><span style="color:#24292E"> aws_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">  cidr_block</span><span style="color:#D73A49">              =</span><span style="color:#24292E"> var</span><span style="color:#D73A49">.</span><span style="color:#24292E">subnet_cidr_block</span></span>
<span class="line"><span style="color:#24292E">  map_public_ip_on_launch</span><span style="color:#D73A49"> =</span><span style="color:#005CC5"> true</span></span>
<span class="line"><span style="color:#24292E">  availability_zone</span><span style="color:#D73A49">       =</span><span style="color:#032F62"> "us-east-1a"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-</span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62">-subnet"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#24292E"> var.environment_name</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define an Internet Gateway</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_internet_gateway"</span><span style="color:#005CC5"> "acme_webshop_igw"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  vpc_id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> aws_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-</span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62">-igw"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#24292E"> var.environment_name</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define a route table</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_route_table"</span><span style="color:#005CC5"> "acme_webshop_rt"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  vpc_id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> aws_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  route</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    cidr_block</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "0.0.0.0/0"</span></span>
<span class="line"><span style="color:#24292E">    gateway_id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> aws_internet_gateway</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_igw</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-</span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62">-rt"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#24292E"> var.environment_name</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Associate the route table with the public subnet</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_route_table_association"</span><span style="color:#005CC5"> "acme_webshop_rt_association"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  subnet_id</span><span style="color:#D73A49">      =</span><span style="color:#24292E"> aws_subnet</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_subnet</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">  route_table_id</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> aws_route_table</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_rt</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define a Security Group</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_security_group"</span><span style="color:#005CC5"> "acme_webshop_sg"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  name</span><span style="color:#D73A49">        =</span><span style="color:#032F62"> "acme-webshop-</span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62">-sg"</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Allow HTTP/HTTPS and SSH access to Acme Webshop </span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62"> instances"</span></span>
<span class="line"><span style="color:#24292E">  vpc_id</span><span style="color:#D73A49">      =</span><span style="color:#24292E"> aws_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_vpc</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  ingress</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    from_port</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> 22</span></span>
<span class="line"><span style="color:#24292E">    to_port</span><span style="color:#D73A49">     =</span><span style="color:#005CC5"> 22</span></span>
<span class="line"><span style="color:#24292E">    protocol</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "tcp"</span></span>
<span class="line"><span style="color:#24292E">    cidr_blocks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span><span style="color:#032F62">"0.0.0.0/0"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#24292E">    description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Allow SSH access"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  ingress</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    from_port</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> 80</span></span>
<span class="line"><span style="color:#24292E">    to_port</span><span style="color:#D73A49">     =</span><span style="color:#005CC5"> 80</span></span>
<span class="line"><span style="color:#24292E">    protocol</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "tcp"</span></span>
<span class="line"><span style="color:#24292E">    cidr_blocks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span><span style="color:#032F62">"0.0.0.0/0"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#24292E">    description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Allow HTTP access"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  ingress</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    from_port</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> 443</span></span>
<span class="line"><span style="color:#24292E">    to_port</span><span style="color:#D73A49">     =</span><span style="color:#005CC5"> 443</span></span>
<span class="line"><span style="color:#24292E">    protocol</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "tcp"</span></span>
<span class="line"><span style="color:#24292E">    cidr_blocks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span><span style="color:#032F62">"0.0.0.0/0"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#24292E">    description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Allow HTTPS access"</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">  egress</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    from_port</span><span style="color:#D73A49">   =</span><span style="color:#005CC5"> 0</span></span>
<span class="line"><span style="color:#24292E">    to_port</span><span style="color:#D73A49">     =</span><span style="color:#005CC5"> 0</span></span>
<span class="line"><span style="color:#24292E">    protocol</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "-1"</span></span>
<span class="line"><span style="color:#24292E">    cidr_blocks</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [</span><span style="color:#032F62">"0.0.0.0/0"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-</span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62">-sg"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#24292E"> var.environment_name</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Define an EC2 instance</span></span>
<span class="line"><span style="color:#6F42C1">resource</span><span style="color:#005CC5"> "aws_instance"</span><span style="color:#005CC5"> "acme_webshop_app"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  ami</span><span style="color:#D73A49">           =</span><span style="color:#24292E"> var</span><span style="color:#D73A49">.</span><span style="color:#24292E">ami_id</span></span>
<span class="line"><span style="color:#24292E">  instance_type</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> var</span><span style="color:#D73A49">.</span><span style="color:#24292E">instance_type</span></span>
<span class="line"><span style="color:#24292E">  subnet_id</span><span style="color:#D73A49">     =</span><span style="color:#24292E"> aws_subnet</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_subnet</span><span style="color:#D73A49">.</span><span style="color:#24292E">id</span></span>
<span class="line"><span style="color:#24292E">  security_groups</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> [aws_security_group</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_sg</span><span style="color:#D73A49">.</span><span style="color:#24292E">name]</span></span>
<span class="line"><span style="color:#24292E">  key_name</span><span style="color:#D73A49">      =</span><span style="color:#24292E"> var</span><span style="color:#D73A49">.</span><span style="color:#24292E">key_pair_name</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  user_data</span><span style="color:#D73A49"> =</span><span style="color:#D73A49"> &lt;&lt;-EOF</span></span>
<span class="line"><span style="color:#032F62">              #!/bin/bash</span></span>
<span class="line"><span style="color:#032F62">              echo "Hello from Acme Webshop </span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62"> instance!" &gt; /var/www/html/index.html</span></span>
<span class="line"><span style="color:#D73A49">              EOF</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  tags</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    Name        </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-</span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62">-app"</span></span>
<span class="line"><span style="color:#24292E">    Environment </span><span style="color:#D73A49">=</span><span style="color:#24292E"> var.environment_name</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Output the public IP address</span></span>
<span class="line"><span style="color:#6F42C1">output</span><span style="color:#005CC5"> "acme_webshop_app_public_ip"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">  description</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "Public IP address of the Acme Webshop application instance in </span><span style="color:#D73A49">${</span><span style="color:#24292E">var</span><span style="color:#D73A49">.</span><span style="color:#24292E">environment_name</span><span style="color:#D73A49">}</span><span style="color:#032F62">."</span></span>
<span class="line"><span style="color:#24292E">  value</span><span style="color:#D73A49">       =</span><span style="color:#24292E"> aws_instance</span><span style="color:#D73A49">.</span><span style="color:#24292E">acme_webshop_app</span><span style="color:#D73A49">.</span><span style="color:#24292E">public_ip</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>Now, to provision the <strong>staging</strong> environment, create a <code>staging.tfvars</code> file:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">hcl</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># staging.tfvars</span></span>
<span class="line"><span style="color:#24292E">environment_name</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "staging"</span></span>
<span class="line"><span style="color:#24292E">vpc_cidr_block</span><span style="color:#D73A49">   =</span><span style="color:#032F62"> "10.0.0.0/16"</span></span>
<span class="line"><span style="color:#24292E">subnet_cidr_block</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "10.0.1.0/24"</span></span>
<span class="line"><span style="color:#24292E">ami_id</span><span style="color:#D73A49">           =</span><span style="color:#032F62"> "ami-0abcdef1234567890"</span><span style="color:#6A737D"> # Use a valid AMI for your region</span></span>
<span class="line"><span style="color:#24292E">instance_type</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "t2.micro"</span></span>
<span class="line"><span style="color:#24292E">key_pair_name</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "my-ssh-key"</span><span style="color:#6A737D"> # Your SSH key pair name</span></span></code></pre></div></div></div>
<p>To provision the <strong>production</strong> environment, create a <code>production.tfvars</code> file:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">hcl</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># production.tfvars</span></span>
<span class="line"><span style="color:#24292E">environment_name</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "production"</span></span>
<span class="line"><span style="color:#24292E">vpc_cidr_block</span><span style="color:#D73A49">   =</span><span style="color:#032F62"> "10.10.0.0/16"</span><span style="color:#6A737D"> # Different CIDR for production</span></span>
<span class="line"><span style="color:#24292E">subnet_cidr_block</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "10.10.1.0/24"</span></span>
<span class="line"><span style="color:#24292E">ami_id</span><span style="color:#D73A49">           =</span><span style="color:#032F62"> "ami-0abcdef1234567890"</span><span style="color:#6A737D"> # Use a valid AMI for your region</span></span>
<span class="line"><span style="color:#24292E">instance_type</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "t2.medium"</span><span style="color:#6A737D"> # Larger instance type for production</span></span>
<span class="line"><span style="color:#24292E">key_pair_name</span><span style="color:#D73A49">    =</span><span style="color:#032F62"> "my-prod-ssh-key"</span><span style="color:#6A737D"> # Potentially a different key for production</span></span></code></pre></div></div></div>
<p>To apply the staging configuration:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#032F62"> plan</span><span style="color:#005CC5"> -var-file=</span><span style="color:#032F62">"staging.tfvars"</span></span>
<span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#032F62"> apply</span><span style="color:#005CC5"> -var-file=</span><span style="color:#032F62">"staging.tfvars"</span></span></code></pre></div></div></div>
<p>To apply the production configuration:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#032F62"> plan</span><span style="color:#005CC5"> -var-file=</span><span style="color:#032F62">"production.tfvars"</span></span>
<span class="line"><span style="color:#6F42C1">terraform</span><span style="color:#032F62"> apply</span><span style="color:#005CC5"> -var-file=</span><span style="color:#032F62">"production.tfvars"</span></span></code></pre></div></div></div>
<p>This approach allows a single, maintainable Terraform configuration to provision multiple distinct environments by simply providing different input variable files. This directly addresses the consistency and efficiency aspects of IaC.</p>
<h2>Exercises</h2>
<ol>
<li><strong>Modify Security Group Rules:</strong> Update the <code>aws_security_group</code> resource in your <code>main.tf</code> to restrict SSH access (<code>port 22</code>) only to your current public IP address instead of <code>0.0.0.0/0</code>. You can find your public IP by searching "what is my ip" on Google. Then, run <code>terraform plan</code> and <code>terraform apply</code> to observe the changes.</li>
<li><strong>Add a Database Instance (Hypothetical):</strong> Imagine the Acme Webshop needs a simple PostgreSQL database. Without actually provisioning one, define a new <code>aws_db_instance</code> resource (using a placeholder <code>db_instance_class</code> and <code>allocated_storage</code>). Add this resource to your <code>main.tf</code> and ensure it's placed within the same VPC. Consider what security group rules would be needed to allow the EC2 application instance to communicate with this database. (Do not apply these changes unless you are prepared to provision a database instance and incur potential costs).</li>
<li><strong>Create a Development Environment Configuration:</strong> Using the parameterized <code>main.tf</code> and <code>variables.tf</code> files, create a new <code>development.tfvars</code> file. Define appropriate values for a development environment, perhaps using <code>t2.nano</code> instances and a distinct CIDR block, and then use <code>terraform plan -var-file="development.tfvars"</code> to see the proposed changes.</li>
</ol>
<h2>Real-World Application</h2>
<h3>Scenario 1: On-Demand Test Environments</h3>
<p>A large enterprise with hundreds of developers building microservices needs to ensure each team can provision isolated test environments rapidly. Manually configuring AWS accounts, VPCs, and databases for each new feature branch or service is unsustainable. By using Terraform, they create a modular configuration that defines a "standard test environment blueprint." When a developer needs a new environment, they simply clone a repository, adjust a few variables (e.g., <code>environment_name</code>, <code>git_branch</code>), and run <code>terraform apply</code>. This allows them to spin up and tear down full-stack environments in minutes, significantly accelerating their testing cycles and reducing infrastructure costs by de-provisioning unused resources.</p>
<h3>Scenario 2: Disaster Recovery Provisioning</h3>
<p>A financial institution requires a robust disaster recovery (DR) plan for its critical trading platform. Instead of maintaining a duplicate, idle production environment (which is expensive), they use Terraform to define their entire production infrastructure in a separate AWS region. In the event of a primary region outage, the operations team can execute a pre-audited Terraform configuration in the DR region. This rapidly provisions an exact replica of their production environment, including network configurations, compute instances, databases, and load balancers, drastically reducing recovery time objectives (RTO). The Terraform code acts as the definitive blueprint for their infrastructure, ensuring consistency and reliability during a crisis.</p>
  
</div>

<div id="chapter-3.4">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Implementing Automated Deployments to Staging Environments</h1><p>Automated deployments to staging environments involve transferring tested build artifacts to a dedicated environment that closely mimics production. This process validates the application's functionality and performance in a near-production setting before release to end-users. It bridges the gap between successful continuous integration (CI) and final continuous deployment (CD), ensuring that only high-quality, stable software progresses to the next stage of the delivery pipeline.</p>
<h2>Understanding Staging Environments</h2>
<p>A staging environment is a replica of the production environment, designed to test the application under conditions as close to real-world usage as possible. It typically includes the same operating system, database versions, network configurations, and often, similar data sets as production. The primary goal of a staging environment is to uncover issues that might not be apparent in development or testing environments, such as performance bottlenecks, integration errors with external services, or infrastructure-specific problems.</p>
<h3>Characteristics of a Staging Environment</h3>
<ul>
<li><strong>Production Parity:</strong> The most crucial aspect of a staging environment is its resemblance to production. This includes infrastructure (servers, network, load balancers), software stack (OS, runtime, libraries), and data. Any significant deviation can lead to "works on my machine" or "works in staging, but not in production" scenarios.</li>
<li><strong>Isolated:</strong> Staging environments must be isolated from both development/testing environments and production to prevent interference. Data used in staging should not be accidentally mixed with production data, and performance tests in staging should not impact development work.</li>
<li><strong>Automated Provisioning:</strong> With Infrastructure as Code (IaC), staging environments are often provisioned and de-provisioned automatically. This ensures consistency and reduces manual errors, as discussed in the "Defining Deployment Environments with Infrastructure as Code (Terraform)" lesson.</li>
<li><strong>Security:</strong> While not as stringent as production, staging environments still require robust security measures. They often contain sensitive data or application logic that should not be publicly accessible.</li>
</ul>
<h3>Benefits of Automated Deployments to Staging</h3>
<p>Automating deployments to staging environments offers several advantages:</p>
<ol>
<li><strong>Early Detection of Production-like Issues:</strong> By deploying frequently to an environment mirroring production, teams can catch configuration drift, resource allocation problems, or performance regressions before they impact end-users. For Acme Webshop, this means identifying database connection issues or slow API responses in staging rather than having customers experience them.</li>
<li><strong>Reliable Quality Assurance:</strong> Automated deployments provide a consistent and repeatable process for QA teams to perform final acceptance testing, performance testing, and user acceptance testing (UAT). This reduces manual effort and increases confidence in the deployment process itself.</li>
<li><strong>Faster Feedback Loop:</strong> When deployments are automated, teams receive faster feedback on the deployability and stability of their application. This allows for quicker iteration and remediation of issues.</li>
<li><strong>Reduced Manual Errors:</strong> Manual deployment steps are prone to human error. Automation eliminates these errors, ensuring that every deployment follows the exact same procedure, thereby increasing reliability and consistency.</li>
<li><strong>Improved Team Collaboration:</strong> Developers, QA, and operations teams can collaborate more effectively when deployments are automated. Developers can quickly see their changes in a production-like environment, and QA can begin testing immediately.</li>
</ol>
<h2>Strategies for Automated Deployments to Staging</h2>
<p>Implementing automated deployments to staging typically involves a series of steps orchestrated by a CI/CD tool like Jenkins, building upon the artifact management concepts from previous lessons.</p>
<h3>1. Triggering the Staging Deployment</h3>
<p>The deployment to staging is usually triggered after successful completion of the CI pipeline, including automated tests and artifact generation.</p>
<ul>
<li><strong>Manual Trigger (for controlled releases):</strong> In some cases, especially for larger, more complex applications or compliance reasons, a manual approval step might be required before deploying to staging. This allows a designated team member to review the build and decide if it's ready.</li>
<li><strong>Automated Trigger (for continuous flow):</strong> For a truly continuous delivery pipeline, the deployment to staging is automatically triggered upon successful completion of the CI pipeline. This ensures a constant flow of validated code into the staging environment.</li>
</ul>
<h3>2. Environment Preparation</h3>
<p>Before deploying the application, the staging environment might need preparation. This often involves:</p>
<ul>
<li><strong>Resource Provisioning/Update:</strong> Using IaC tools like Terraform, the necessary infrastructure components (e.g., virtual machines, databases, load balancers) are provisioned or updated to the desired state. This ensures the environment configuration is consistent with what's defined in code.</li>
<li><strong>Dependency Installation:</strong> Installing any required system-level dependencies or runtime environments that are not part of the application artifact itself.</li>
<li><strong>Configuration Management:</strong> Applying environment-specific configurations (e.g., database connection strings, API keys) using tools like Ansible or environment variables.</li>
</ul>
<h3>3. Artifact Retrieval</h3>
<p>The deployment process retrieves the specific build artifact (e.g., a WAR file, Docker image, ZIP archive) that was generated and stored in a package repository (like Nexus or Artifactory) during the CI phase.</p>
<h3>4. Application Deployment</h3>
<p>This is the core step where the application artifact is placed onto the staging servers. The method of deployment depends heavily on the application architecture and infrastructure.</p>
<ul>
<li>
<p><strong>Traditional Server Deployment:</strong> For monolithic applications deployed on virtual machines, this might involve:</p>
<ul>
<li>Stopping the existing application server.</li>
<li>Copying the new artifact to the server.</li>
<li>Starting the application server.</li>
<li><em>Example: Acme Webshop deployment to a Java application server.</em>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color:#6A737D"># Script to deploy Acme Webshop WAR file to a Tomcat server on staging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">APP_NAME</span><span style="color:#D73A49">=</span><span style="color:#032F62">"acme-webshop"</span></span>
<span class="line"><span style="color:#24292E">WAR_FILE</span><span style="color:#D73A49">=</span><span style="color:#032F62">"/var/lib/jenkins/workspace/acme-webshop/target/</span><span style="color:#24292E">$APP_NAME</span><span style="color:#032F62">.war"</span><span style="color:#6A737D"> # Path to the build artifact</span></span>
<span class="line"><span style="color:#24292E">TOMCAT_WEBAPPS</span><span style="color:#D73A49">=</span><span style="color:#032F62">"/opt/tomcat/webapps"</span><span style="color:#6A737D"> # Tomcat's webapps directory on the staging server</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Stopping Tomcat service on staging server..."</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> systemctl</span><span style="color:#032F62"> stop</span><span style="color:#032F62"> tomcat</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Removing previous deployment..."</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> rm</span><span style="color:#005CC5"> -rf</span><span style="color:#24292E"> $TOMCAT_WEBAPPS</span><span style="color:#032F62">/</span><span style="color:#24292E">$APP_NAME</span><span style="color:#005CC5">*</span><span style="color:#6A737D"> # Remove old WAR and expanded directory</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Copying new WAR file to Tomcat webapps..."</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> cp</span><span style="color:#24292E"> $WAR_FILE $TOMCAT_WEBAPPS</span><span style="color:#032F62">/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Starting Tomcat service..."</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> systemctl</span><span style="color:#032F62"> start</span><span style="color:#032F62"> tomcat</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Deployment to staging complete for </span><span style="color:#24292E">$APP_NAME</span><span style="color:#032F62">."</span></span></code></pre></div></div></div>
<em>Explanation:</em> This script automates stopping Tomcat, removing the old application, copying the new WAR file, and restarting Tomcat. <code>sudo</code> commands indicate execution with elevated privileges on the staging server.</li>
</ul>
</li>
<li>
<p><strong>Container-based Deployment:</strong> For containerized applications (as will be covered in Module 4), this typically involves:</p>
<ul>
<li>Pulling the new Docker image from a container registry.</li>
<li>Updating the running container (e.g., using <code>docker-compose</code> or Kubernetes manifests).</li>
<li><em>Example: Deploying Acme Webshop Docker image to a staging server.</em>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># docker-compose.staging.yml for Acme Webshop</span></span>
<span class="line"><span style="color:#22863A">version</span><span style="color:#24292E">: </span><span style="color:#032F62">'3.8'</span></span>
<span class="line"><span style="color:#22863A">services</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  webshop</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    image</span><span style="color:#24292E">: </span><span style="color:#032F62">yourregistry/acme-webshop:latest</span><span style="color:#6A737D"> # Pull the latest image</span></span>
<span class="line"><span style="color:#22863A">    ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">"80:8080"</span></span>
<span class="line"><span style="color:#22863A">    environment</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      DB_HOST</span><span style="color:#24292E">: </span><span style="color:#032F62">"staging-db.acme.com"</span></span>
<span class="line"><span style="color:#22863A">      DB_NAME</span><span style="color:#24292E">: </span><span style="color:#032F62">"acme_staging"</span></span>
<span class="line"><span style="color:#6A737D">    # Other configurations specific to staging</span></span></code></pre></div></div></div>
<em>Explanation:</em> This <code>docker-compose</code> file defines the <code>webshop</code> service using a specific Docker image. When <code>docker-compose up -d</code> is executed on the staging server, it will pull the specified image and run the container with staging-specific environment variables.</li>
</ul>
</li>
</ul>
<h3>5. Post-Deployment Verification</h3>
<p>After the application is deployed, automated checks ensure that the deployment was successful and the application is functioning correctly.</p>
<ul>
<li><strong>Health Checks:</strong> Simple checks to verify the application process is running and responding to requests (e.g., checking HTTP 200 on a <code>/health</code> endpoint).</li>
<li><strong>Smoke Tests:</strong> A small suite of critical tests that verify the core functionality of the application. These tests run quickly and confirm that essential features are working after deployment.</li>
<li><strong>Log Monitoring:</strong> Checking application logs for errors or warnings immediately after deployment.</li>
</ul>
<h3>6. Notification</h3>
<p>Alerting relevant teams (QA, operations, developers) about the success or failure of the staging deployment. This can be via email, Slack, or other communication tools.</p>
<h2>Practical Example: Automating Acme Webshop Deployment to Staging with Jenkins</h2>
<p>Continuing with the Acme Webshop case study, consider a Jenkins pipeline that automates the deployment of the webshop application to a staging environment. We assume the CI pipeline (from Module 2) successfully builds a <code>acme-webshop.war</code> artifact and stores it in a Nexus repository.</p>
<p>The staging environment consists of a Linux VM running Tomcat, a MySQL database, and has SSH access enabled for Jenkins.</p>
<h3>Jenkins Pipeline Stage for Staging Deployment</h3>
<p>Here's an example of a Jenkins Declarative Pipeline stage that handles deployment to a staging environment. This stage would follow the successful <code>build</code> and <code>test</code> stages.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile (part of a larger pipeline)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#6A737D">        // ... (Previous stages for Build, Unit Tests, Static Analysis, Integration Tests) ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Staging'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Define staging server details</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> stagingHost </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'staging.acme.com'</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> stagingUser </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'jenkins'</span></span>
<span class="line"><span style="color:#24292E">                    </span></span>
<span class="line"><span style="color:#6A737D">                    // Retrieve artifact (assuming it's already built and stored)</span></span>
<span class="line"><span style="color:#6A737D">                    // In a real scenario, you'd pull from Nexus/Artifactory here.</span></span>
<span class="line"><span style="color:#6A737D">                    // For this example, we assume the artifact is in the workspace from a previous build stage.</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> artifactPath </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "target/acme-webshop.war"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // Check if the artifact exists locally (from previous build stage)</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"test -f ${artifactPath}"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // 1. Transfer artifact to staging server</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Transferring artifact ${artifactPath} to ${stagingUser}@${stagingHost}:/tmp/"</span></span>
<span class="line"><span style="color:#24292E">                    sshPublisher(</span></span>
<span class="line"><span style="color:#005CC5">                        publishers</span><span style="color:#24292E">: [</span></span>
<span class="line"><span style="color:#24292E">                            sshPublisherEntry(</span></span>
<span class="line"><span style="color:#005CC5">                                configName</span><span style="color:#24292E">: </span><span style="color:#032F62">'Staging Server SSH'</span><span style="color:#24292E">, </span><span style="color:#6A737D">// Name of SSH connection configured in Jenkins</span></span>
<span class="line"><span style="color:#005CC5">                                transfers</span><span style="color:#24292E">: [</span></span>
<span class="line"><span style="color:#24292E">                                    sshTransfer(</span></span>
<span class="line"><span style="color:#005CC5">                                        sourceFiles</span><span style="color:#24292E">: artifactPath,</span></span>
<span class="line"><span style="color:#005CC5">                                        removePrefix</span><span style="color:#24292E">: </span><span style="color:#032F62">'target'</span><span style="color:#24292E">, </span><span style="color:#6A737D">// Remove 'target/' from the path on the remote server</span></span>
<span class="line"><span style="color:#005CC5">                                        remoteDirectory</span><span style="color:#24292E">: </span><span style="color:#032F62">'/tmp/'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                                        execCommand</span><span style="color:#24292E">: </span><span style="color:#032F62">''</span><span style="color:#6A737D"> // No immediate command, just transfer</span></span>
<span class="line"><span style="color:#24292E">                                    )</span></span>
<span class="line"><span style="color:#24292E">                                ]</span></span>
<span class="line"><span style="color:#24292E">                            )</span></span>
<span class="line"><span style="color:#24292E">                        ]</span></span>
<span class="line"><span style="color:#24292E">                    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // 2. Execute deployment script on staging server</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Executing deployment script on ${stagingHost}"</span></span>
<span class="line"><span style="color:#24292E">                    sshPublisher(</span></span>
<span class="line"><span style="color:#005CC5">                        publishers</span><span style="color:#24292E">: [</span></span>
<span class="line"><span style="color:#24292E">                            sshPublisherEntry(</span></span>
<span class="line"><span style="color:#005CC5">                                configName</span><span style="color:#24292E">: </span><span style="color:#032F62">'Staging Server SSH'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                                transfers</span><span style="color:#24292E">: [</span></span>
<span class="line"><span style="color:#6A737D">                                    // Transfer a deployment script to the remote server and execute it</span></span>
<span class="line"><span style="color:#24292E">                                    sshTransfer(</span></span>
<span class="line"><span style="color:#005CC5">                                        sourceFiles</span><span style="color:#24292E">: </span><span style="color:#032F62">'scripts/deploy_to_tomcat.sh'</span><span style="color:#24292E">, </span><span style="color:#6A737D">// Local path to the deployment script</span></span>
<span class="line"><span style="color:#005CC5">                                        remoteDirectory</span><span style="color:#24292E">: </span><span style="color:#032F62">'/tmp/'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                                        execCommand</span><span style="color:#24292E">: </span><span style="color:#032F62">"""</span></span>
<span class="line"><span style="color:#032F62">                                            chmod +x /tmp/deploy_to_tomcat.sh</span></span>
<span class="line"><span style="color:#032F62">                                            sudo /tmp/deploy_to_tomcat.sh acme-webshop.war /opt/tomcat/webapps</span></span>
<span class="line"><span style="color:#032F62">                                            # Optional: Clean up the script from remote</span></span>
<span class="line"><span style="color:#032F62">                                            rm /tmp/deploy_to_tomcat.sh</span></span>
<span class="line"><span style="color:#032F62">                                        """</span></span>
<span class="line"><span style="color:#24292E">                                    )</span></span>
<span class="line"><span style="color:#24292E">                                ]</span></span>
<span class="line"><span style="color:#24292E">                            )</span></span>
<span class="line"><span style="color:#24292E">                        ]</span></span>
<span class="line"><span style="color:#24292E">                    )</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // 3. Post-deployment verification (Health Check)</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Performing health check on staging application..."</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"curl --fail --silent --show-error http://${stagingHost}/acme-webshop/health || error 'Health check failed!'"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            post {</span></span>
<span class="line"><span style="color:#24292E">                success {</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Acme Webshop deployed to staging successfully!"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">                failure {</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Failed to deploy Acme Webshop to staging."</span></span>
<span class="line"><span style="color:#6A737D">                    // Optionally, send notifications</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ... (Upcoming stages like "Explore Blue/Green and Canary Deployment") ...</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>And the <code>scripts/deploy_to_tomcat.sh</code> script on the Jenkins agent:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">#!/bin/bash</span></span>
<span class="line"><span style="color:#6A737D"># deploy_to_tomcat.sh - Remote script to deploy a WAR file to Tomcat</span></span>
<span class="line"><span style="color:#6A737D"># Usage: ./deploy_to_tomcat.sh &lt;WAR_FILENAME&gt; &lt;TOMCAT_WEBAPPS_DIR&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">WAR_FILENAME</span><span style="color:#D73A49">=</span><span style="color:#032F62">"</span><span style="color:#005CC5">$1</span><span style="color:#032F62">"</span></span>
<span class="line"><span style="color:#24292E">TOMCAT_WEBAPPS</span><span style="color:#D73A49">=</span><span style="color:#032F62">"</span><span style="color:#005CC5">$2</span><span style="color:#032F62">"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">if</span><span style="color:#24292E"> [ </span><span style="color:#D73A49">-z</span><span style="color:#032F62"> "</span><span style="color:#24292E">$WAR_FILENAME</span><span style="color:#032F62">"</span><span style="color:#24292E"> ] </span><span style="color:#D73A49">||</span><span style="color:#24292E"> [ </span><span style="color:#D73A49">-z</span><span style="color:#032F62"> "</span><span style="color:#24292E">$TOMCAT_WEBAPPS</span><span style="color:#032F62">"</span><span style="color:#24292E"> ]; </span><span style="color:#D73A49">then</span></span>
<span class="line"><span style="color:#005CC5">    echo</span><span style="color:#032F62"> "Usage: </span><span style="color:#005CC5">$0</span><span style="color:#032F62"> &lt;WAR_FILENAME&gt; &lt;TOMCAT_WEBAPPS_DIR&gt;"</span></span>
<span class="line"><span style="color:#005CC5">    exit</span><span style="color:#005CC5"> 1</span></span>
<span class="line"><span style="color:#D73A49">fi</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">APP_NAME</span><span style="color:#D73A49">=</span><span style="color:#24292E">$(</span><span style="color:#6F42C1">basename</span><span style="color:#032F62"> "</span><span style="color:#24292E">$WAR_FILENAME</span><span style="color:#032F62">"</span><span style="color:#032F62"> .war</span><span style="color:#24292E">) </span><span style="color:#6A737D"># Extract 'acme-webshop' from 'acme-webshop.war'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Stopping Tomcat service..."</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> systemctl</span><span style="color:#032F62"> stop</span><span style="color:#032F62"> tomcat</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> { </span><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Failed to stop Tomcat"</span><span style="color:#24292E">; </span><span style="color:#005CC5">exit</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Removing previous deployment for </span><span style="color:#24292E">$APP_NAME</span><span style="color:#032F62">..."</span></span>
<span class="line"><span style="color:#6A737D"># Remove old WAR and expanded directory. The WAR file is transferred to /tmp first.</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> rm</span><span style="color:#005CC5"> -rf</span><span style="color:#032F62"> "${</span><span style="color:#24292E">TOMCAT_WEBAPPS</span><span style="color:#032F62">}/${</span><span style="color:#24292E">APP_NAME</span><span style="color:#032F62">}.war"</span><span style="color:#032F62"> "${</span><span style="color:#24292E">TOMCAT_WEBAPPS</span><span style="color:#032F62">}/${</span><span style="color:#24292E">APP_NAME</span><span style="color:#032F62">}"</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> { </span><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Failed to remove old deployment"</span><span style="color:#24292E">; </span><span style="color:#005CC5">exit</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Copying new WAR file (/tmp/</span><span style="color:#24292E">$WAR_FILENAME</span><span style="color:#032F62">) to Tomcat webapps..."</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> cp</span><span style="color:#032F62"> "/tmp/</span><span style="color:#24292E">$WAR_FILENAME</span><span style="color:#032F62">"</span><span style="color:#032F62"> "${</span><span style="color:#24292E">TOMCAT_WEBAPPS</span><span style="color:#032F62">}/"</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> { </span><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Failed to copy new WAR"</span><span style="color:#24292E">; </span><span style="color:#005CC5">exit</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Starting Tomcat service..."</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> systemctl</span><span style="color:#032F62"> start</span><span style="color:#032F62"> tomcat</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> { </span><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Failed to start Tomcat"</span><span style="color:#24292E">; </span><span style="color:#005CC5">exit</span><span style="color:#005CC5"> 1</span><span style="color:#24292E">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#005CC5">echo</span><span style="color:#032F62"> "Deployment to staging complete for </span><span style="color:#24292E">$APP_NAME</span><span style="color:#032F62">."</span></span></code></pre></div></div></div>
<p><em>Explanation of the Jenkins Pipeline:</em></p>
<ul>
<li><strong><code>sshPublisher</code>:</strong> This Jenkins plugin facilitates file transfers and command execution over SSH. It's configured with <code>configName: 'Staging Server SSH'</code>, which refers to an SSH connection pre-configured in Jenkins credentials (e.g., username/password or SSH key for <code>jenkins@staging.acme.com</code>).</li>
<li><strong><code>transfers</code> for artifact:</strong> The first <code>sshPublisherEntry</code> block transfers the <code>acme-webshop.war</code> artifact from the Jenkins workspace to the <code>/tmp/</code> directory on the <code>staging.acme.com</code> server.</li>
<li><strong><code>transfers</code> for script execution:</strong> The second <code>sshPublisherEntry</code> block transfers the <code>deploy_to_tomcat.sh</code> script to <code>/tmp/</code> on the staging server, makes it executable (<code>chmod +x</code>), and then executes it using <code>sudo</code>. The WAR filename and Tomcat webapps directory are passed as arguments to the script.</li>
<li><strong>Post-deployment Health Check:</strong> A <code>curl</code> command attempts to access a health endpoint (<code>/acme-webshop/health</code>) on the deployed application. The <code>--fail</code> flag ensures that <code>curl</code> returns a non-zero exit code if the request fails (e.g., HTTP 4xx or 5xx), which will cause the Jenkins pipeline to fail.</li>
</ul>
<h3>Hypothetical Scenario: Automated UI Test Triggering</h3>
<p>Imagine the Acme Webshop development team uses Selenium for UI testing. After the automated deployment to staging, the pipeline could trigger a dedicated UI test suite against the deployed application. If any critical UI tests fail, the pipeline marks the staging deployment as unsuccessful, preventing further progression and alerting the team. This ensures that not only the application deploys correctly, but also that its user interface remains functional and accessible.</p>
<h2>Exercises</h2>
<ol>
<li>
<p><strong>Modify the Staging Deployment Script:</strong>
Assume the Acme Webshop now requires a specific environment variable, <code>ACME_LOG_LEVEL=DEBUG</code>, to be set on the Tomcat server during staging deployments. Modify the <code>deploy_to_tomcat.sh</code> script to dynamically add this environment variable to a Tomcat configuration file (e.g., <code>setenv.sh</code> or a systemd unit file) before starting Tomcat. Ensure it handles cases where the variable might already exist.</p>
</li>
<li>
<p><strong>Integrate Parameterized Deployment:</strong>
Update the Jenkins pipeline (<code>Jenkinsfile</code>) to allow for a parameterized deployment to staging. Add a String parameter named <code>VERSION_TO_DEPLOY</code> to the pipeline that defaults to <code>latest</code>. Modify the pipeline to use this parameter when retrieving the artifact from Nexus/Artifactory (e.g., <code>acme-webshop-${VERSION_TO_DEPLOY}.war</code>) and deploying it. This would enable deploying a specific previously built version to staging if needed. (Note: For this exercise, assume <code>artifactPath</code> already points to the correct version based on the parameter).</p>
</li>
<li>
<p><strong>Enhance Post-Deployment Verification:</strong>
Beyond a simple health check, the Acme Webshop team wants to verify a critical user journey after deployment to staging, such as logging in and viewing the product catalog. Describe how you would integrate a simple <em>smoke test script</em> (e.g., a Python script using <code>requests</code> or <code>selenium</code>) into the Jenkins pipeline to perform these actions and confirm success. Outline the steps and commands needed in the Jenkinsfile.</p>
</li>
</ol>
<h2>Real-World Application</h2>
<h3>Large Enterprise Software Deployment</h3>
<p>A global financial institution develops a suite of applications for trading and risk management. Each application undergoes rigorous testing. Their CI/CD pipeline includes an automated deployment to multiple staging environments. After a successful build and unit testing, the application is deployed to:</p>
<ol>
<li><strong>Integration Staging:</strong> An environment where the application is integrated and tested with other internal financial systems (e.g., accounting, market data feeds). This detects contract mismatches or API versioning issues.</li>
<li><strong>UAT Staging:</strong> An environment where business users perform User Acceptance Testing. This environment is refreshed regularly with production-like data, allowing users to validate new features and bug fixes in a realistic context.</li>
<li><strong>Performance Staging:</strong> A dedicated environment used solely for load and performance testing, to ensure the application can handle expected user loads and transaction volumes.</li>
</ol>
<p>Each of these deployments is automated via Jenkins pipelines. For instance, the pipeline might use Ansible playbooks to configure specific database schemas for different staging environments and then deploy the application artifacts using shell scripts or Docker commands. A critical aspect is that these environments are often spun up and down using Terraform for consistency, ensuring they truly mirror production configurations. Automated smoke tests and synthetic transactions run immediately after deployment to each staging environment to confirm basic functionality and connectivity.</p>
<h3>E-commerce Platform with Microservices</h3>
<p>Consider a popular online retail platform like "MegaMart," which uses a microservices architecture. Each microservice (e.g., product catalog, order management, payment gateway) has its own independent CI/CD pipeline. When a developer pushes a change to the product catalog service, its pipeline:</p>
<ol>
<li>Builds the Docker image.</li>
<li>Runs unit and integration tests.</li>
<li>Pushes the image to a container registry.</li>
<li>Automatically deploys the new image to a shared <strong>Developer Staging</strong> environment. This environment runs the <em>entire</em> MegaMart ecosystem with the latest version of <em>all</em> microservices from their respective <code>main</code> branches. This allows developers to see their changes integrated with other services immediately.</li>
<li>After successful automated API tests in the Developer Staging, the change can be manually promoted to a more stable <strong>QA Staging</strong> environment, where dedicated QA teams perform manual and automated end-to-end tests against a more controlled version of the entire platform.</li>
</ol>
  
</div>

<div id="chapter-3.5">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Exploring Blue/Green and Canary Deployment Patterns</h1><p>As organizations strive for higher availability and faster deployments, traditional "big bang" deployments introduce significant risks. Blue/Green and Canary deployment patterns offer strategies to minimize downtime and risk by gradually rolling out new versions of applications. These patterns are essential for achieving true continuous delivery, allowing new features and fixes to be released to production with confidence and the ability to quickly revert if issues arise.</p>
<h2>Understanding Blue/Green Deployment</h2>
<p>Blue/Green deployment is a strategy that minimizes downtime and risk by running two identical production environments, "Blue" and "Green." One environment (Blue) is running the current application version serving live traffic, while the other (Green) is prepared with the new application version. Once the new version in the Green environment is fully tested and verified, traffic is switched from Blue to Green.</p>
<h3>Core Principles of Blue/Green Deployment</h3>
<p>The fundamental idea is to have two parallel, production-ready environments.</p>
<ol>
<li><strong>Blue Environment (Current Version):</strong> This is the live production environment actively serving user traffic with the currently stable version of the application.</li>
<li><strong>Green Environment (New Version):</strong> This is an identical production environment where the new version of the application is deployed, configured, and thoroughly tested using synthetic transactions or internal users.</li>
<li><strong>Traffic Switching:</strong> Once the Green environment is verified, a load balancer or router is updated to direct all incoming production traffic to the Green environment.</li>
<li><strong>Rollback Capability:</strong> If any issues are detected in the Green environment after the switch, traffic can be instantly routed back to the Blue environment, which remains untouched and functional, providing a rapid rollback mechanism.</li>
<li><strong>Resource Utilization:</strong> After a successful switch, the old Blue environment can either be decommissioned, updated with the new version to become the next "Green" for future deployments, or used for performance testing or other non-production activities.</li>
</ol>
<h3>Detailed Blue/Green Deployment Example</h3>
<p>Consider the Acme Webshop application. Currently, <code>v1.0</code> is running in the production environment. We want to deploy <code>v1.1</code> with new features and bug fixes.</p>
<ol>
<li><strong>Initial State:</strong> The "Blue" environment serves all user traffic for Acme Webshop <code>v1.0</code>.</li>
<li><strong>Green Environment Provisioning:</strong> A new, identical "Green" environment is provisioned using Infrastructure as Code (e.g., Terraform, as discussed in the previous lesson). This ensures the new environment mirrors the Blue one precisely.</li>
<li><strong>Deployment to Green:</strong> Acme Webshop <code>v1.1</code> is deployed to the "Green" environment. This deployment includes the application code, dependencies, and any necessary database migrations (handled carefully to be backward compatible).</li>
<li><strong>Testing in Green:</strong> Automated tests (smoke tests, integration tests, performance tests) are run against Acme Webshop <code>v1.1</code> in the Green environment. Manual exploratory testing might also be performed by a small group of internal users.</li>
<li><strong>Traffic Switch:</strong> Once <code>v1.1</code> is validated in Green, the load balancer is reconfigured to point all traffic from Blue to Green. This is typically a DNS change, an IP address change, or a load balancer rule update, which happens almost instantaneously.</li>
<li><strong>Post-Deployment Verification:</strong> After the switch, monitoring systems (which will be covered in Module 5) immediately begin observing the Green environment for errors, performance degradation, or other anomalies.</li>
<li><strong>Rollback Scenario:</strong> If a critical bug is discovered in <code>v1.1</code> (e.g., users cannot add items to their cart), the load balancer is immediately switched back to the Blue environment, restoring <code>v1.0</code> as the active production version. This happens rapidly, minimizing user impact.</li>
<li><strong>Decommissioning/Repurposing Blue:</strong> If <code>v1.1</code> is stable, the Blue environment can be kept as a backup for a period, or it can be updated to <code>v1.1</code> and become the "Green" environment for the next <code>v1.2</code> deployment.</li>
</ol>
<h3>Real-World Application: E-commerce Platform Update</h3>
<p>A major online retailer like Amazon or Walmart might use Blue/Green deployments for significant updates to their customer-facing websites.</p>
<ul>
<li><strong>Scenario:</strong> A new version of the checkout process needs to be rolled out. This new version includes updated payment gateway integrations and UI changes.</li>
<li><strong>Blue:</strong> The current live checkout (version A) is serving millions of customers.</li>
<li><strong>Green:</strong> An identical infrastructure is spun up. The new checkout (version B) is deployed and thoroughly tested, including end-to-end payment processing with various payment methods in a production-like setting (but without live customer data).</li>
<li><strong>Traffic Switch:</strong> When confidence is high, the load balancer shifts traffic from version A to version B. This might involve updating DNS records or reconfiguring routing rules on an Application Load Balancer.</li>
<li><strong>Immediate Rollback:</strong> If a critical issue like payment processing failures is detected in version B after the switch, traffic is immediately redirected back to version A. The downtime is measured in seconds, not minutes or hours.</li>
</ul>
<h3>Hypothetical Scenario: Financial Trading Platform Upgrade</h3>
<p>A financial institution is upgrading its trading platform to improve latency and add new trading algorithms.</p>
<ul>
<li><strong>Challenge:</strong> Downtime is extremely costly, and any bugs could lead to significant financial losses.</li>
<li><strong>Blue:</strong> The current trading platform <code>v2.0</code> is processing live trades.</li>
<li><strong>Green:</strong> A new, identical environment is provisioned. The updated trading platform <code>v2.1</code> is deployed and extensively tested with simulated high-volume trading scenarios and regulatory compliance checks.</li>
<li><strong>Switch:</strong> During a low-volume period (e.g., overnight), traffic is switched to <code>v2.1</code>.</li>
<li><strong>Observation:</strong> Performance metrics, trade execution times, and error rates are rigorously monitored.</li>
<li><strong>Benefit:</strong> If <code>v2.1</code> introduces any unexpected latency or incorrect algorithm behavior, the platform can be reverted to <code>v2.0</code> quickly, preventing potential financial impact.</li>
</ul>
<h2>Exploring Canary Deployment</h2>
<p>Canary deployment is a technique that reduces the risk of introducing a new software version by gradually rolling out the change to a small subset of users before making it available to everyone. This allows for real-world testing of the new version with a limited impact if issues are discovered.</p>
<h3>Core Principles of Canary Deployment</h3>
<p>Canary deployments derive their name from the "canary in a coal mine" practice, where canaries were used to detect toxic gases before they harmed human miners.</p>
<ol>
<li><strong>Small User Subset:</strong> A new version of the application (the "canary") is deployed to a small percentage of servers or instances, and only a small fraction of real user traffic is routed to it.</li>
<li><strong>Monitoring and Evaluation:</strong> The canary version is closely monitored for errors, performance degradation, and business metrics. This is the crucial phase where real-world feedback is gathered.</li>
<li><strong>Phased Rollout:</strong> If the canary performs well, the new version is gradually rolled out to more servers/instances, increasing the percentage of user traffic it handles. This can happen in several stages (e.g., 5%, 25%, 50%, 100%).</li>
<li><strong>Automated Promotion/Rollback:</strong> The decision to promote the canary to full production or roll it back is often automated based on predefined metrics and thresholds (e.g., error rate exceeding 1% triggers an automatic rollback).</li>
<li><strong>Continuous Feedback:</strong> Feedback loops are critical, using monitoring and logging tools (Module 5) to inform the decision at each stage of the rollout.</li>
</ol>
<h3>Detailed Canary Deployment Example</h3>
<p>Let's return to the Acme Webshop and deploy <code>v1.1</code> using a canary strategy.</p>
<ol>
<li><strong>Initial State:</strong> Acme Webshop <code>v1.0</code> is serving 100% of user traffic across all instances.</li>
<li><strong>Canary Deployment:</strong> A small number of instances (e.g., 5% of the total production fleet) are updated with Acme Webshop <code>v1.1</code>. The remaining 95% continue to run <code>v1.0</code>.</li>
<li><strong>Traffic Routing:</strong> The load balancer is configured to route a small percentage of incoming requests (e.g., 5%) to the <code>v1.1</code> instances, while the majority still go to <code>v1.0</code>. This routing can be based on various factors:
<ul>
<li><strong>Random:</strong> A simple percentage split.</li>
<li><strong>User Geography:</strong> Specific regions get the new version.</li>
<li><strong>User Attributes:</strong> A/B testing frameworks route specific user segments (e.g., internal users, users with a specific feature flag) to the canary.</li>
</ul>
</li>
<li><strong>Monitoring Phase 1:</strong> For a defined period (e.g., 30 minutes to a few hours), <code>v1.1</code> is intensely monitored. Metrics like HTTP error rates, application latency, CPU utilization, memory usage, and business-specific metrics (e.g., conversion rate for Acme Webshop) are compared between <code>v1.0</code> and <code>v1.1</code>.</li>
<li><strong>Decision Point:</strong>
<ul>
<li>If <code>v1.1</code> shows no degradation and meets success criteria, the rollout proceeds to the next phase.</li>
<li>If <code>v1.1</code> exhibits issues (e.g., 5xx errors increase, response times spike), the canary instances are immediately removed from the load balancer pool, effectively rolling back the change for the affected subset of users. The <code>v1.0</code> instances continue to serve 100% of traffic.</li>
</ul>
</li>
<li><strong>Phased Rollout (Example):</strong>
<ul>
<li><strong>Phase 2 (25% Traffic):</strong> If Phase 1 is successful, another 20% of instances are updated to <code>v1.1</code>, bringing the total to 25%. Monitoring continues.</li>
<li><strong>Phase 3 (50% Traffic):</strong> If Phase 2 is successful, another 25% of instances are updated. Monitoring continues.</li>
<li><strong>Phase 4 (100% Traffic):</strong> If Phase 3 is successful, the remaining instances are updated, and <code>v1.1</code> becomes the sole production version.</li>
</ul>
</li>
<li><strong>Completion:</strong> All users are now on <code>v1.1</code>.</li>
</ol>
<h3>Real-World Application: Social Media Feature Rollout</h3>
<p>A large social media platform like Facebook or Twitter might use Canary deployments to introduce a new feature, such as an updated news feed algorithm or a new reaction type.</p>
<ul>
<li><strong>Scenario:</strong> A new algorithm for ranking posts in the news feed needs to be released. This could significantly impact user engagement.</li>
<li><strong>Canary Group:</strong> The new algorithm is first rolled out to 1% of users, perhaps internal employees or users in a specific, non-critical geographic region.</li>
<li><strong>Metrics:</strong> The platform monitors engagement metrics (e.g., time spent on platform, number of likes/comments, ad clicks) and error rates for this 1% group compared to a control group still on the old algorithm.</li>
<li><strong>Gradual Expansion:</strong> If metrics are positive and no critical bugs emerge, the rollout expands to 5%, then 20%, and so on, until 100% of users receive the new algorithm.</li>
<li><strong>Benefit:</strong> This approach limits the blast radius of any negative impact. If the new algorithm causes a drop in engagement or an increase in errors for the initial 1% (the "canary"), it can be quickly reverted without affecting the entire user base.</li>
</ul>
<h3>Hypothetical Scenario: Online Gaming Server Update</h3>
<p>An online multiplayer game developer is rolling out a new game patch that includes bug fixes and a new game mode.</p>
<ul>
<li><strong>Challenge:</strong> New patches can introduce unexpected bugs that crash game servers or disrupt gameplay, leading to a poor user experience for thousands of concurrent players.</li>
<li><strong>Canary Deployment:</strong> The patch is first deployed to a small cluster of game servers (e.g., 5% of the total).</li>
<li><strong>Traffic Allocation:</strong> Players joining specific "canary" lobbies or regions are routed to these updated servers.</li>
<li><strong>Monitoring:</strong> The game studio monitors server stability, crash rates, network latency, and in-game error messages reported by players on the canary servers. They also observe player retention and satisfaction metrics.</li>
<li><strong>Phased Rollout:</strong> If the canary servers are stable and players report a good experience, the patch is gradually deployed to more server clusters. If crashes or game-breaking bugs are detected, only a small portion of the player base is affected, and the canary servers can be quickly reverted to the old patch. This prevents a widespread negative impact on the entire player base.</li>
</ul>
<h2>Blue/Green vs. Canary Deployment</h2>
<p>While both strategies aim to minimize risk and downtime during deployments, they achieve it through different mechanisms and are suitable for different scenarios.</p>
<table><thead><tr><th style="text-align: left;">Feature</th><th style="text-align: left;">Blue/Green Deployment</th><th style="text-align: left;">Canary Deployment</th></tr></thead><tbody><tr><td style="text-align: left;"><strong>Risk Mitigation</strong></td><td style="text-align: left;">Instantaneous full rollback if issues arise post-switch.</td><td style="text-align: left;">Gradual rollout limits initial impact to a small user group.</td></tr><tr><td style="text-align: left;"><strong>Downtime</strong></td><td style="text-align: left;">Near-zero downtime during the switch.</td><td style="text-align: left;">Near-zero downtime during phased rollout.</td></tr><tr><td style="text-align: left;"><strong>Infrastructure</strong></td><td style="text-align: left;">Requires provisioning and maintaining two full, identical production environments.</td><td style="text-align: left;">Requires additional instances only for the canary version, then scales up.</td></tr><tr><td style="text-align: left;"><strong>Testing</strong></td><td style="text-align: left;">Thorough testing occurs <em>before</em> the traffic switch on the Green environment.</td><td style="text-align: left;">Real-world testing with a subset of live traffic <em>during</em> the rollout.</td></tr><tr><td style="text-align: left;"><strong>Complexity</strong></td><td style="text-align: left;">Managing two identical environments and traffic routing.</td><td style="text-align: left;">More complex traffic routing and granular monitoring needed to compare canary vs. stable.</td></tr><tr><td style="text-align: left;"><strong>Cost</strong></td><td style="text-align: left;">Potentially higher due to duplicating production infrastructure (even temporarily).</td><td style="text-align: left;">Potentially lower initial cost, as full duplication is not required upfront.</td></tr><tr><td style="text-align: left;"><strong>Rollback</strong></td><td style="text-align: left;">Immediate switch back to the "Blue" (old version).</td><td style="text-align: left;">Remove canary instances from traffic, or promote previous stable version.</td></tr><tr><td style="text-align: left;"><strong>Best For</strong></td><td style="text-align: left;">Major releases, critical applications where full end-to-end testing can be done pre-switch.</td><td style="text-align: left;">Feature flags, A/B testing, microservices, continuous small updates, risk-averse deployments.</td></tr></tbody></table>
<h3>Choosing the Right Strategy</h3>
<p>The choice between Blue/Green and Canary often depends on several factors:</p>
<ul>
<li><strong>Application Type:</strong> For monolithic applications with tight coupling, Blue/Green might be simpler to manage, as the entire system is updated at once. For microservices, Canary deployments can be highly effective, allowing individual services to be updated independently.</li>
<li><strong>Risk Tolerance:</strong> Blue/Green offers a very quick full rollback. Canary offers a controlled exposure to risk. If the impact of a bug is catastrophic, Blue/Green's instant rollback might be preferred. If the impact is less severe but still undesirable, Canary allows for early detection.</li>
<li><strong>Infrastructure Cost:</strong> Maintaining two full production environments for Blue/Green can be expensive if not properly managed (e.g., decommissioning the old environment quickly). Canary deployments might be more cost-effective as only a small fraction of resources initially run the new version.</li>
<li><strong>Testing Capabilities:</strong> If you can perform very thorough and realistic testing on a separate staging environment <em>before</em> deployment, Blue/Green might be a good fit. If real-world user behavior is hard to simulate and you need to observe the new version with actual traffic, Canary is powerful.</li>
</ul>
<p>In practice, organizations often combine aspects of both or use different strategies for different parts of their application. For instance, a Blue/Green deployment might be used for the core application infrastructure, while a Canary release is used for specific new features within that application.</p>
<h2>Exercises and Practice Activities</h2>
<p>These exercises will help you solidify your understanding of Blue/Green and Canary deployment patterns.</p>
<ol>
<li>
<p><strong>Acme Webshop Scenario - Blue/Green Planning:</strong>
The Acme Webshop currently runs on a single production environment. You are tasked with implementing a Blue/Green deployment strategy for its next major release (<code>v2.0</code>).</p>
<ul>
<li><strong>Activity:</strong> Outline the steps involved in deploying <code>v2.0</code> using Blue/Green. Consider:
<ul>
<li>How would you provision the "Green" environment, referencing Infrastructure as Code concepts from a previous lesson?</li>
<li>What types of automated tests would you run against the "Green" environment before switching traffic?</li>
<li>What would be your rollback procedure if <code>v2.0</code> caused critical errors?</li>
<li>How would you manage database schema changes in this context, ensuring backward compatibility?</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Acme Webshop Scenario - Canary Rollout Strategy:</strong>
Now, imagine you want to roll out a new recommendation engine (<code>v1.1</code>) for the Acme Webshop using a Canary deployment. This engine is a new microservice.</p>
<ul>
<li><strong>Activity:</strong> Describe a multi-phase Canary rollout strategy for this recommendation engine. Include:
<ul>
<li>How would you define the initial "canary" group (e.g., percentage of users, specific user attributes)?</li>
<li>What key metrics (e.g., error rate, latency, recommendation click-through rate) would you monitor during each phase?</li>
<li>Define thresholds for these metrics that would trigger an automatic rollback.</li>
<li>Outline the steps for gradually increasing traffic to the new engine until 100% of users are using it.</li>
</ul>
</li>
</ul>
</li>
<li>
<p><strong>Comparative Analysis:</strong>
You are designing a deployment strategy for two different services:</p>
<ul>
<li><strong>Service A:</strong> A critical payment processing microservice that handles all financial transactions. Downtime or errors are extremely costly.</li>
<li><strong>Service B:</strong> A new personalization service that suggests products based on user browsing history. Errors here would result in sub-optimal recommendations but no loss of funds.</li>
<li><strong>Activity:</strong> For each service, recommend whether a Blue/Green or Canary deployment would be more appropriate and justify your choice based on the characteristics of each pattern and the service's criticality. Discuss potential benefits and drawbacks for each choice.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-3.6">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Rollback Strategies and Post-Deployment Verification</h1><p>Deployment processes, even with extensive testing, carry inherent risks. When a new version of an application is deployed, unforeseen issues can emerge, such as performance degradation, critical bugs, or integration failures. Robust rollback strategies are essential to mitigate these risks, allowing teams to quickly revert to a known stable state if a deployment fails. Complementing rollback capabilities, post-deployment verification ensures that the newly deployed application is functioning as expected in the production environment, providing immediate feedback on the deployment's success and operational health.</p>
<h2>Understanding Rollback Strategies</h2>
<p>Rollback strategies involve reverting a system or application to a previous, known-good state. This is a critical capability in a continuous delivery pipeline, providing a safety net for deployments that introduce errors or undesirable behavior. Effective rollback minimizes downtime and reduces the impact of failed deployments on users.</p>
<h3>Reverting Infrastructure</h3>
<p>One aspect of rollback involves reverting changes made to the underlying infrastructure. With Infrastructure as Code (IaC), this becomes more manageable. Tools like Terraform maintain state files that track deployed resources.</p>
<p><strong>Example 1: Terraform State Rollback</strong></p>
<p>Consider the Acme Webshop, which uses Terraform to define its staging environment, as discussed in "Defining Deployment Environments with Infrastructure as Code (Terraform)". If a Terraform apply operation introduces a configuration error, a common rollback strategy is to revert to a previous, known-good version of the Terraform configuration files in your version control system (e.g., Git).</p>
<ol>
<li><strong>Identify the problematic change</strong>: Review Git history to pinpoint the commit that introduced the breaking infrastructure change.</li>
<li><strong>Revert the commit</strong>: Use <code>git revert &lt;commit-hash&gt;</code> to create a new commit that undoes the changes from the problematic commit. This is generally preferred over <code>git reset</code> in shared repositories as it preserves history.</li>
<li><strong>Apply the reverted configuration</strong>: Run <code>terraform apply</code> with the reverted configuration. Terraform will then orchestrate the changes needed to revert the infrastructure to its previous state.</li>
</ol>
<p><em>Hypothetical Scenario:</em> Acme Webshop deploys a new database instance type using Terraform, but the new instance type has unexpected latency issues with existing application logic. The team identifies the Terraform change, reverts the specific <code>main.tf</code> commit in Git that changed the instance type, and re-applies Terraform. Terraform then provisions the old database instance type, restoring performance.</p>
<p><strong>Example 2: Cloud Provider Snapshots</strong></p>
<p>For more drastic infrastructure issues, particularly with virtual machines or databases, cloud provider snapshots offer a robust rollback mechanism.</p>
<ul>
<li><strong>EC2 Instance Rollback:</strong> If a new AMI (Amazon Machine Image) deployed to an EC2 instance causes issues, a snapshot of the previous instance's root volume can be used to restore the instance to its prior state. This often involves terminating the problematic instance and launching a new one from the snapshot, or attaching the snapshot as a new volume to an existing instance.</li>
<li><strong>RDS Database Rollback:</strong> For managed databases like Amazon RDS, point-in-time recovery allows restoring a database to any specified second within a retention period, or restoring from a manual snapshot. This is critical for data-level rollbacks.</li>
</ul>
<h3>Reverting Application Deployments</h3>
<p>Rollback for the application itself depends heavily on the deployment strategy used.</p>
<p><strong>1. Reverting with Traditional Deployments (e.g., server updates)</strong></p>
<p>For applications deployed directly to servers without advanced patterns like Blue/Green, rollback typically involves deploying the previous stable version of the application artifact.</p>
<ul>
<li><strong>Mechanism:</strong> Replace the currently deployed application artifact (e.g., JAR, WAR, Docker image tag) with the previous stable version.</li>
<li><strong>Process:</strong>
<ol>
<li>Stop the application service on the servers.</li>
<li>Remove the faulty new artifact.</li>
<li>Copy the known-good previous artifact to the deployment location.</li>
<li>Start the application service.</li>
</ol>
</li>
<li><strong>Challenge:</strong> Can involve downtime and manual steps if not fully automated.</li>
</ul>
<p><em>Real-World Example:</em> A financial services company deploys a new version of its trading platform to a cluster of application servers. Post-deployment, a critical bug is discovered causing incorrect trade executions. Their automated deployment pipeline, integrated with Jenkins, has a rollback job. This job pulls the <em>previous</em> stable WAR file from Nexus (as discussed in "Managing Build Artifacts and Package Repositories"), deploys it to the affected servers, and restarts the application, minimizing impact on trading operations.</p>
<p><strong>2. Rollback with Blue/Green Deployments</strong></p>
<p>As explored in "Exploring Blue/Green and Canary Deployment Patterns", Blue/Green deployments inherently simplify rollback.</p>
<ul>
<li><strong>Mechanism:</strong> If the new "Green" environment experiences issues after traffic has been switched, simply redirect traffic back to the "Blue" environment (the old, stable version).</li>
<li><strong>Process:</strong>
<ol>
<li>Deploy new version to "Green" environment.</li>
<li>Perform smoke tests.</li>
<li>Switch load balancer/router to direct traffic to "Green".</li>
<li>If issues arise, immediately switch load balancer/router back to "Blue".</li>
</ol>
</li>
<li><strong>Benefit:</strong> Near-instantaneous rollback with zero downtime, as the "Blue" environment remains operational and ready.</li>
</ul>
<p><em>Real-World Example:</em> Acme Webshop uses a Blue/Green strategy for its e-commerce frontend. A new version is deployed to the "Green" cluster. After switching traffic, monitoring reveals a significant increase in 5xx errors for checkout pages. The operations team immediately triggers a rollback via their load balancer configuration, redirecting all traffic back to the "Blue" cluster. The "Green" cluster can then be debugged offline without affecting user experience.</p>
<p><strong>3. Rollback with Canary Deployments</strong></p>
<p>Canary deployments (also covered in "Exploring Blue/Green and Canary Deployment Patterns") also facilitate controlled rollbacks.</p>
<ul>
<li><strong>Mechanism:</strong> If issues are detected while a small percentage of traffic is routed to the "Canary" version, traffic to the "Canary" is stopped, and all traffic remains on the stable "Production" version.</li>
<li><strong>Process:</strong>
<ol>
<li>Deploy new version to a small "Canary" subset of servers/pods.</li>
<li>Route a small percentage of user traffic to the Canary.</li>
<li>Monitor the Canary's performance and error rates.</li>
<li>If issues, stop routing traffic to the Canary.</li>
</ol>
</li>
<li><strong>Benefit:</strong> Limits the blast radius of a faulty deployment, affecting only a small subset of users before a full rollback.</li>
</ul>
<p><em>Real-World Example:</em> A SaaS company rolls out a new feature in its collaboration tool using a canary deployment. 5% of users are directed to the new version. Within minutes, anomaly detection systems (tied to monitoring, as will be discussed in Module 5) detect a sharp rise in memory consumption and latency for these users. The automated pipeline immediately stops routing traffic to the canary instances, preventing the issue from affecting the remaining 95% of the user base.</p>
<h2>Post-Deployment Verification (PDV)</h2>
<p>Post-Deployment Verification is a crucial set of automated and manual checks performed immediately after a new application version or infrastructure change is deployed to production. Its purpose is to confirm that the deployment was successful, the application is operational, and key functionalities are working as expected. PDV helps in detecting issues early, preventing them from impacting a larger user base.</p>
<h3>Types of Post-Deployment Verification Checks</h3>
<p><strong>1. Health Checks and System Metrics</strong></p>
<p>These are foundational checks to ensure the application instances are alive and responsive.</p>
<ul>
<li><strong>HTTP Endpoint Checks:</strong> Automated tools (e.g., <code>curl</code>, <code>wget</code>, or dedicated monitoring agents) can probe specific HTTP endpoints (e.g., <code>/health</code>, <code>/status</code>) that report the application's internal state.</li>
<li><strong>Process Monitoring:</strong> Verify that expected application processes are running on the servers.</li>
<li><strong>Resource Utilization:</strong> Monitor CPU, memory, disk I/O, and network usage. Sudden spikes or drops might indicate an issue. (This ties into monitoring concepts to be covered in Module 5.)</li>
</ul>
<p><em>Real-World Example:</em> After deploying a new microservice for Acme Webshop's order processing, the deployment pipeline automatically pings the <code>/health</code> endpoint of the newly deployed instances. If any instance returns a non-200 HTTP status code, the deployment is marked as failed, and an automated rollback is triggered.</p>
<p><strong>2. Smoke Tests (Synthetics)</strong></p>
<p>Smoke tests are a set of minimal, critical tests designed to verify basic functionality. They are quick to run and confirm that the most important features are operational.</p>
<ul>
<li><strong>Login/Logout:</strong> Can users log in successfully?</li>
<li><strong>Core Feature Access:</strong> Can users access the main application dashboard or a key page?</li>
<li><strong>Database Connectivity:</strong> Is the application able to connect to its database?</li>
</ul>
<p><em>Hypothetical Scenario:</em> For Acme Webshop, a smoke test after a frontend deployment might involve:
1.  Navigating to the homepage.
2.  Searching for a specific product.
3.  Adding an item to the cart.
4.  Attempting to proceed to checkout (without completing the purchase).
If any of these steps fail, the deployment is considered problematic. These tests are typically automated and run within seconds or minutes of deployment.</p>
<p><strong>3. Application Performance Monitoring (APM) Data Analysis</strong></p>
<p>Monitoring tools (which will be a focus of Module 5) gather metrics like latency, error rates, throughput, and resource consumption. PDV involves comparing these metrics against established baselines or thresholds.</p>
<ul>
<li><strong>Response Times:</strong> Are API response times within acceptable limits, or have they increased significantly?</li>
<li><strong>Error Rates:</strong> Is the rate of HTTP 5xx errors or application-specific errors within the normal range?</li>
<li><strong>Throughput:</strong> Is the application handling the expected volume of requests?</li>
</ul>
<p><em>Real-World Example:</em> A media streaming service deploys an update. Immediately after, APM tools show a 30% increase in video buffering times for a specific region. This anomaly, detected through real-time monitoring, triggers an alert and initiates a review, potentially leading to a rollback if the issue is directly attributable to the new deployment.</p>
<p><strong>4. Log Analysis</strong></p>
<p>Centralized logging solutions (to be covered in Module 5) allow teams to aggregate and search application logs. PDV involves checking logs for new errors, warnings, or unexpected patterns after a deployment.</p>
<ul>
<li><strong>Error Keywords:</strong> Search for terms like "ERROR", "FATAL", "Exception", "OutOfMemoryError".</li>
<li><strong>Unexpected Messages:</strong> Look for log messages that indicate configuration issues or unusual behavior.</li>
</ul>
<p><em>Real-World Example:</em> Acme Webshop's logging system, after a backend deployment, is configured to alert if more than 10 <code>NullPointerException</code> errors occur within a 5-minute window. Post-deployment, this threshold is breached, indicating a severe bug in the new code, prompting an immediate investigation and potential rollback.</p>
<p><strong>5. Business Metric Validation</strong></p>
<p>For critical applications, PDV might extend to verifying business-level metrics, though these often take longer to manifest.</p>
<ul>
<li><strong>Conversion Rates:</strong> Are e-commerce conversion rates maintaining expected levels?</li>
<li><strong>User Engagement:</strong> Are users interacting with key features as expected?</li>
<li><strong>Revenue Generation:</strong> For revenue-critical applications, is revenue flowing as anticipated?</li>
</ul>
<p>These are typically monitored over a slightly longer period but can be early indicators of major issues.</p>
<h3>Integrating PDV into the CI/CD Pipeline</h3>
<p>PDV steps should be an integral part of the automated deployment pipeline, often executed immediately after the application is considered "live" but before a full traffic switch (for Blue/Green/Canary) or before decommissioning the old version.</p>
<p>A typical sequence:</p>
<ol>
<li><strong>Deployment Triggered:</strong> New artifact is deployed to target environment (e.g., staging or production).</li>
<li><strong>Health Checks:</strong> Basic health endpoints are probed to confirm application startup.</li>
<li><strong>Smoke Tests:</strong> Critical business functionalities are exercised via automated tests.</li>
<li><strong>Monitoring Hook:</strong> The pipeline waits for a short period, allowing APM and logging systems to collect initial data. It then queries these systems for anomalies.</li>
<li><strong>Decision Point:</strong> If any PDV step fails, the pipeline can:
<ul>
<li>Trigger an automated rollback.</li>
<li>Send alerts to the operations team.</li>
<li>Pause the pipeline for manual intervention.</li>
</ul>
</li>
</ol>
<h2>Exercises and Practice Activities</h2>
<h3>Exercise 1: Designing a Rollback Plan for Acme Webshop</h3>
<p>Given Acme Webshop's current deployment strategy (potentially a mix of traditional for some services and Blue/Green/Canary for others), outline a detailed rollback plan for the following scenarios:</p>
<ol>
<li><strong>Backend API Deployment Failure:</strong> A new version of the product catalog API (deployed to a set of traditional application servers) introduces a database connection error that wasn't caught in staging.
<ul>
<li><em>What are the steps to revert to the previous stable version?</em></li>
<li><em>What specific artifacts or configurations would need to be changed?</em></li>
<li><em>How would you minimize downtime during this rollback?</em></li>
</ul>
</li>
<li><strong>Frontend UI Blue/Green Deployment Failure:</strong> A new version of the Acme Webshop frontend, deployed via a Blue/Green strategy, causes CSS rendering issues on mobile devices after traffic is switched.
<ul>
<li><em>What is the immediate rollback action?</em></li>
<li><em>How quickly can this rollback be performed?</em></li>
<li><em>What role does the load balancer play?</em></li>
</ul>
</li>
<li><strong>Terraform Infrastructure Rollback:</strong> A Terraform deployment for the staging environment inadvertently changes an S3 bucket policy, making it inaccessible to the application.
<ul>
<li><em>How would you identify the problematic Terraform change?</em></li>
<li><em>What Git command would you use to prepare for the rollback?</em></li>
<li><em>What Terraform command would you execute to apply the fix?</em></li>
</ul>
</li>
</ol>
<h3>Exercise 2: Implementing Post-Deployment Verification for a Microservice</h3>
<p>Imagine Acme Webshop introduces a new "Recommendation Engine" microservice. Design a set of Post-Deployment Verification checks for this service, considering it's deployed using Docker containers orchestrated by Kubernetes (concepts to be detailed in Module 4).</p>
<ol>
<li><strong>Health Check:</strong> What specific HTTP endpoint would you create on the microservice for health checks? What would it report?</li>
<li><strong>Smoke Test:</strong> Describe two critical smoke tests you would automate for this recommendation engine.</li>
<li><strong>APM/Logging Check:</strong>
<ul>
<li>What key performance metrics (e.g., response time, error rate) would you monitor immediately after deployment?</li>
<li>What specific log messages or patterns would you look for to indicate a successful deployment or potential issues?</li>
</ul>
</li>
<li><strong>Thresholds:</strong> For one of the metrics or log patterns identified above, suggest a threshold that, if crossed, would trigger an alert or an automated rollback.</li>
</ol>
<h2>Real-World Application</h2>
<p>Rollback strategies and post-deployment verification are not just theoretical concepts; they are daily realities for high-performing DevOps teams.</p>
<p><strong>Case Study: Large E-commerce Platform</strong></p>
<p>A major online retailer processes millions of transactions daily. They heavily utilize Blue/Green deployments for their customer-facing web application. When a new release is pushed, it goes to the "Green" environment. Their PDV includes:</p>
<ul>
<li><strong>Automated UI Tests:</strong> Selenium or Cypress tests run against the "Green" environment, validating critical user flows like product search, adding to cart, and checkout, without affecting actual users.</li>
<li><strong>Synthetic Monitoring:</strong> Bots simulate user journeys to key pages and API endpoints, measuring response times and availability. These run continuously against both "Blue" and "Green" environments.</li>
<li><strong>API Load Tests:</strong> A small simulated load is applied to new APIs in "Green" to test performance under stress.</li>
<li><strong>Deep APM Integration:</strong> Tools like Dynatrace or New Relic are configured with specific dashboards and alerts for the "Green" environment. Any degradation in transaction response times, increased error rates, or unusual resource consumption immediately triggers high-priority alerts.</li>
</ul>
<p>If any of these PDV checks fail, the deployment to "Green" is halted. If traffic has already been switched and an issue is detected by live monitoring (even if initial PDV passed), the load balancer is instantly reconfigured to send all traffic back to the "Blue" environment. This allows the team to debug the "Green" environment offline, preserving customer experience.</p>
<p><strong>Case Study: Fintech Startup</strong></p>
<p>A fast-growing fintech startup manages a critical payment processing gateway. They employ a combination of traditional server deployments for legacy components and Canary deployments for newer microservices. Their PDV is highly stringent due to regulatory and financial implications.</p>
<ul>
<li><strong>Compliance Checks:</strong> Automated scripts verify that new deployments adhere to PCI DSS (Payment Card Industry Data Security Standard) requirements, checking configuration files and network rules.</li>
<li><strong>Transaction Validation:</strong> Synthetic transactions are processed through the new payment gateway version, verifying end-to-end functionality and correct data flow through all layers.</li>
<li><strong>Fraud Detection System Integration:</strong> They ensure that the new deployment integrates correctly with their real-time fraud detection systems. Any misconfiguration here could lead to significant financial loss.</li>
<li><strong>Database Schema Verification:</strong> Automated checks verify that database schema migrations were applied correctly and that the application can interact with the new schema without errors.</li>
</ul>
<p>For Canary deployments, if even a small percentage of test transactions through the canary show discrepancies or performance regressions, the canary is immediately rolled back, preventing any impact on the majority of customer transactions. Their ability to quickly roll back is a key differentiator in maintaining trust and compliance.</p>
  
</div>

</div>

<div id="chapter-4">

<div id="chapter-4.1">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Docker Fundamentals: Creating and Managing Container Images</h1><p>Containerization addresses inconsistencies often experienced in development by packaging applications and their dependencies into isolated units called containers. Docker is a leading platform that facilitates the creation, deployment, and management of these containerized applications. This lesson explores the foundational aspects of Docker, focusing on how to create and manage container images, which are the blueprints for running containers.</p>
<h2>Understanding Docker and Containerization</h2>
<p>Docker provides a platform to develop, ship, and run applications using containerization. A container is a standalone, executable package of software that includes everything needed to run an application: code, runtime, system tools, system libraries, and settings. Containers decouple applications from the underlying infrastructure, providing a consistent environment across various stages of the software development lifecycle, from development to testing to production. This consistency eliminates "it works on my machine" problems, which are a common challenge in traditional development environments.</p>
<p>For instance, consider two developers working on the Acme Webshop application. Developer A uses a specific version of Python and several libraries, while Developer B uses different versions. Without containers, setting up the development environment consistently can be time-consuming and prone to errors due to dependency conflicts. With Docker, both developers can use the same container image, ensuring identical environments and dependencies.</p>
<p>Another example is deploying the Acme Webshop to a staging server. The staging server might have different operating system configurations or library versions than the development environment. A Docker container ensures that the Acme Webshop application runs identically on the staging server as it did on the developer's machine, as all necessary components are bundled within the container.</p>
<h3>Containers vs. Virtual Machines</h3>
<p>It is important to differentiate containers from traditional virtual machines (VMs). While both provide isolation, they do so at different levels.</p>
<ul>
<li><strong>Virtual Machines:</strong> VMs abstract the entire hardware layer. Each VM runs a complete operating system (guest OS) on top of a hypervisor, which then runs on the host operating system. This makes VMs heavy, resource-intensive, and slow to start because each VM carries its own kernel and set of system libraries.</li>
<li><strong>Containers:</strong> Containers abstract the operating system layer. They share the host OS kernel and typically contain only the application and its dependencies. This makes containers lightweight, fast to start, and more resource-efficient than VMs. They provide process isolation and resource governance using technologies like cgroups and namespaces, which are features of the Linux kernel.</li>
</ul>
<p>Hypothetically, imagine you need to run ten different microservices for a new feature in the Acme Webshop. If each microservice required a separate VM, you would need ten full operating systems, consuming significant RAM and CPU. With containers, all ten microservices can share the same host OS kernel, each running in its own isolated container, using far fewer resources and starting up much faster.</p>
<h2>Docker Images: Blueprints for Containers</h2>
<p>A Docker image is a read-only template that contains a set of instructions for creating a container. These instructions define what software to install, what commands to run, and what network ports to expose. Images are built in layers, with each instruction in a <code>Dockerfile</code> creating a new layer. This layered approach enables efficient storage and faster distribution, as common layers can be shared among different images.</p>
<p>For example, a base image like <code>ubuntu:22.04</code> might be the first layer. Adding <code>apt-get update</code> and <code>apt-get install nginx</code> creates new layers on top. If another image also uses <code>ubuntu:22.04</code> and <code>apt-get update</code>, those common layers are reused.</p>
<h3>Dockerfile: Building Custom Images</h3>
<p>Docker images are typically built using a <code>Dockerfile</code>, which is a plain text file containing a series of instructions. Each instruction creates a layer in the image.</p>
<p>Here's an example <code>Dockerfile</code> for a simple Python application, similar to a component of the Acme Webshop:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">dockerfile</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Use an official Python runtime as a parent image</span></span>
<span class="line"><span style="color:#D73A49">FROM</span><span style="color:#24292E"> python:3.9-slim-buster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Set the working directory in the container</span></span>
<span class="line"><span style="color:#D73A49">WORKDIR</span><span style="color:#24292E"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Copy the current directory contents into the container at /app</span></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> . /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Install any needed packages specified in requirements.txt</span></span>
<span class="line"><span style="color:#D73A49">RUN</span><span style="color:#24292E"> pip install --no-cache-dir -r requirements.txt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Make port 8000 available to the world outside this container</span></span>
<span class="line"><span style="color:#D73A49">EXPOSE</span><span style="color:#24292E"> 8000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Run app.py when the container launches</span></span>
<span class="line"><span style="color:#D73A49">CMD</span><span style="color:#24292E"> [</span><span style="color:#032F62">"python"</span><span style="color:#24292E">, </span><span style="color:#032F62">"app.py"</span><span style="color:#24292E">]</span></span></code></pre></div></div></div>
<p><strong>Explanation of Dockerfile Instructions:</strong></p>
<ul>
<li><code>FROM python:3.9-slim-buster</code>: Specifies the base image. This instruction pulls the <code>python:3.9-slim-buster</code> image from Docker Hub, providing a minimal Python environment.</li>
<li><code>WORKDIR /app</code>: Sets the working directory inside the container. All subsequent commands will be executed relative to this directory.</li>
<li><code>COPY . /app</code>: Copies the entire contents of the current directory (where the <code>Dockerfile</code> resides) into the <code>/app</code> directory within the container.</li>
<li><code>RUN pip install --no-cache-dir -r requirements.txt</code>: Executes a command during the image build process. This command installs Python dependencies listed in <code>requirements.txt</code>. <code>--no-cache-dir</code> is used to prevent pip from caching packages, reducing image size.</li>
<li><code>EXPOSE 8000</code>: Informs Docker that the container listens on the specified network port at runtime. This is purely documentation; it does not actually publish the port.</li>
<li><code>CMD ["python", "app.py"]</code>: Provides defaults for an executing container. This instruction specifies the command to run when the container starts.</li>
</ul>
<p>To build an image from this <code>Dockerfile</code>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> build</span><span style="color:#005CC5"> -t</span><span style="color:#032F62"> acme-webshop-app:1.0</span><span style="color:#032F62"> .</span></span></code></pre></div></div></div>
<ul>
<li><code>docker build</code>: The command to build a Docker image.</li>
<li><code>-t acme-webshop-app:1.0</code>: Tags the image with a name (<code>acme-webshop-app</code>) and a version (<code>1.0</code>).</li>
<li><code>.</code>: Specifies the build context, which is the current directory. Docker sends the entire contents of this directory to the Docker daemon.</li>
</ul>
<h2>Managing Docker Images</h2>
<p>After building images, various commands are available to manage them.</p>
<h3>Listing Images</h3>
<p>To view a list of all locally stored Docker images:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> images</span></span></code></pre></div></div></div>
<p>This command shows details like the repository name, tag, image ID, creation date, and size.</p>
<h3>Inspecting Images</h3>
<p>To get detailed information about a specific image, including its layers, configuration, and history:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> inspect</span><span style="color:#032F62"> acme-webshop-app:1.0</span></span></code></pre></div></div></div>
<p>This command outputs a JSON object with comprehensive metadata about the image.</p>
<h3>Removing Images</h3>
<p>To delete a Docker image from local storage:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> rmi</span><span style="color:#032F62"> acme-webshop-app:1.0</span></span></code></pre></div></div></div>
<p>If a container is currently using the image, Docker will prevent its removal until the container is stopped and removed. To force removal, even if containers are running, you can use the <code>-f</code> flag (e.g., <code>docker rmi -f acme-webshop-app:1.0</code>), but this should be used with caution.</p>
<h3>Tagging Images</h3>
<p>Images can have multiple tags, which are useful for versioning or providing different identifiers. For example, <code>acme-webshop-app:latest</code> could always point to the most recent stable build, while <code>acme-webshop-app:1.0</code> specifically refers to version 1.0.</p>
<p>To add a new tag to an existing image:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> tag</span><span style="color:#032F62"> acme-webshop-app:1.0</span><span style="color:#032F62"> myregistry/acme-webshop-app:latest</span></span></code></pre></div></div></div>
<p>This command creates a new tag for an existing image without creating a new image. Both <code>acme-webshop-app:1.0</code> and <code>myregistry/acme-webshop-app:latest</code> now point to the same image ID.</p>
<h2>Running Containers from Images</h2>
<p>Once an image is built, it can be used to run a container. A container is a runnable instance of an image.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 80:8000</span><span style="color:#005CC5"> --name</span><span style="color:#032F62"> acme-frontend-container</span><span style="color:#032F62"> acme-webshop-app:1.0</span></span></code></pre></div></div></div>
<ul>
<li><code>docker run</code>: The command to create and start a container from an image.</li>
<li><code>-p 80:8000</code>: Maps port 80 on the host machine to port 8000 inside the container. This allows external traffic to reach the application running in the container.</li>
<li><code>--name acme-frontend-container</code>: Assigns a specific name to the container, making it easier to reference. If not provided, Docker generates a random name.</li>
<li><code>acme-webshop-app:1.0</code>: Specifies the image to use.</li>
</ul>
<p>To run a container in detached mode (in the background):</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> -d</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 80:8000</span><span style="color:#005CC5"> --name</span><span style="color:#032F62"> acme-frontend-container-detached</span><span style="color:#032F62"> acme-webshop-app:1.0</span></span></code></pre></div></div></div>
<ul>
<li><code>-d</code>: Runs the container in detached mode.</li>
</ul>
<h3>Listing Running Containers</h3>
<p>To see all running containers:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> ps</span></span></code></pre></div></div></div>
<p>To see all containers, including stopped ones:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> ps</span><span style="color:#005CC5"> -a</span></span></code></pre></div></div></div>
<h3>Stopping and Removing Containers</h3>
<p>To stop a running container:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> stop</span><span style="color:#032F62"> acme-frontend-container</span></span></code></pre></div></div></div>
<p>To remove a stopped container:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> rm</span><span style="color:#032F62"> acme-frontend-container</span></span></code></pre></div></div></div>
<p>To stop and remove a container in one step:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> rm</span><span style="color:#005CC5"> -f</span><span style="color:#032F62"> acme-frontend-container</span></span></code></pre></div></div></div>
<p>The <code>-f</code> flag forces removal even if the container is running.</p>
<h2>Practical Example: Containerizing a Simple Web Application</h2>
<p>Let's assume we have a very basic <code>app.py</code> for the Acme Webshop's frontend and a <code>requirements.txt</code> file.</p>
<p><strong><code>app.py</code>:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">python</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#D73A49">from</span><span style="color:#24292E"> flask </span><span style="color:#D73A49">import</span><span style="color:#24292E"> Flask</span></span>
<span class="line"><span style="color:#24292E">app </span><span style="color:#D73A49">=</span><span style="color:#24292E"> Flask(</span><span style="color:#005CC5">__name__</span><span style="color:#24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">@app.route</span><span style="color:#24292E">(</span><span style="color:#032F62">'/'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> hello</span><span style="color:#24292E">():</span></span>
<span class="line"><span style="color:#D73A49">    return</span><span style="color:#032F62"> "Hello from Acme Webshop Frontend!"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">if</span><span style="color:#005CC5"> __name__</span><span style="color:#D73A49"> ==</span><span style="color:#032F62"> '__main__'</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    app.run(</span><span style="color:#E36209">host</span><span style="color:#D73A49">=</span><span style="color:#032F62">'0.0.0.0'</span><span style="color:#24292E">, </span><span style="color:#E36209">port</span><span style="color:#D73A49">=</span><span style="color:#005CC5">8000</span><span style="color:#24292E">)</span></span></code></pre></div></div></div>
<p><strong><code>requirements.txt</code>:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">javascript</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">Flask</span><span style="color:#D73A49">==</span><span style="color:#005CC5">2.0</span><span style="color:#24292E">.</span><span style="color:#005CC5">1</span></span></code></pre></div></div></div>
<p><strong><code>Dockerfile</code> (as shown previously):</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">dockerfile</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Use an official Python runtime as a parent image</span></span>
<span class="line"><span style="color:#D73A49">FROM</span><span style="color:#24292E"> python:3.9-slim-buster</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Set the working directory in the container</span></span>
<span class="line"><span style="color:#D73A49">WORKDIR</span><span style="color:#24292E"> /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Copy the current directory contents into the container at /app</span></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> . /app</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Install any needed packages specified in requirements.txt</span></span>
<span class="line"><span style="color:#D73A49">RUN</span><span style="color:#24292E"> pip install --no-cache-dir -r requirements.txt</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Make port 8000 available to the world outside this container</span></span>
<span class="line"><span style="color:#D73A49">EXPOSE</span><span style="color:#24292E"> 8000</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Run app.py when the container launches</span></span>
<span class="line"><span style="color:#D73A49">CMD</span><span style="color:#24292E"> [</span><span style="color:#032F62">"python"</span><span style="color:#24292E">, </span><span style="color:#032F62">"app.py"</span><span style="color:#24292E">]</span></span></code></pre></div></div></div>
<p><strong>Steps to containerize and run:</strong></p>
<ol>
<li><strong>Create the files:</strong> Save the <code>app.py</code>, <code>requirements.txt</code>, and <code>Dockerfile</code> in the same directory.</li>
<li><strong>Build the image:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> build</span><span style="color:#005CC5"> -t</span><span style="color:#032F62"> acme-webshop-frontend:1.0</span><span style="color:#032F62"> .</span></span></code></pre></div></div></div>
This command builds the image and tags it as <code>acme-webshop-frontend:1.0</code>.</li>
<li><strong>Run the container:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 8080:8000</span><span style="color:#005CC5"> --name</span><span style="color:#032F62"> acme-frontend</span><span style="color:#032F62"> acme-webshop-frontend:1.0</span></span></code></pre></div></div></div>
This runs the container, mapping host port 8080 to container port 8000.</li>
<li><strong>Verify the application:</strong> Open your web browser and navigate to <code>http://localhost:8080</code>. You should see "Hello from Acme Webshop Frontend!".</li>
<li><strong>Stop and remove the container:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> stop</span><span style="color:#032F62"> acme-frontend</span></span>
<span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> rm</span><span style="color:#032F62"> acme-frontend</span></span></code></pre></div></div></div>
</li>
</ol>
<p>This sequence demonstrates the complete lifecycle of creating and running a containerized application.</p>
<h2>Exercises</h2>
<ol>
<li>
<p><strong>Modify and Rebuild:</strong></p>
<ul>
<li>Change the message in <code>app.py</code> from "Hello from Acme Webshop Frontend!" to "Welcome to the Acme Webshop!".</li>
<li>Rebuild the Docker image, but this time, tag it as <code>acme-webshop-frontend:2.0</code>.</li>
<li>Run a new container using the <code>2.0</code> image, mapping it to host port 8081.</li>
<li>Verify the new message in your browser at <code>http://localhost:8081</code>.</li>
<li>List all images and containers to see both versions.</li>
<li>Stop and remove all containers, then remove both image versions.</li>
</ul>
</li>
<li>
<p><strong>Explore Base Images:</strong></p>
<ul>
<li>Create a new <code>Dockerfile</code> that uses <code>nginx:alpine</code> as its base image.</li>
<li>Add a <code>COPY</code> instruction to copy a simple <code>index.html</code> file into the Nginx default serving directory (<code>/usr/share/nginx/html</code>).</li>
<li>Build the image and tag it as <code>acme-nginx-proxy:1.0</code>.</li>
<li>Run a container from this image, mapping host port 80 to container port 80.</li>
<li>Verify Nginx is serving your <code>index.html</code> at <code>http://localhost:80</code>.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-4.2">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Containerizing the "Acme Webshop" Application for Portability</h1><p>Containerization revolutionizes how applications are developed, shipped, and run, providing a consistent environment across different stages of the CI/CD pipeline. This lesson focuses on packaging the "Acme Webshop" application into Docker containers, enhancing its portability and setting the stage for consistent deployments.</p>
<h2>Understanding Application Portability with Containers</h2>
<p>Application portability refers to the ability of an application to run consistently across various computing environments without significant modifications. Historically, achieving portability was challenging due to differences in operating systems, library versions, and underlying infrastructure. Containers abstract away these environmental discrepancies by bundling an application and all its dependencies (libraries, configuration files, environment variables, etc.) into a single, isolated package.</p>
<p>For instance, consider a Java application that requires a specific version of the Java Development Kit (JDK) and several third-party libraries. Without containerization, deploying this application to a new server would involve manually installing the correct JDK, configuring environment variables, and ensuring all library dependencies are met. If another application on the same server requires a different JDK version, compatibility issues might arise.</p>
<p>With containerization, a Docker image for the Java application would include the exact JDK version and all necessary libraries, creating a self-contained unit. This image can then run identically on any machine with Docker installed, regardless of the host operating system's JDK version or other installed software. The application inside the container operates in its isolated environment, unaffected by, and not affecting, other processes on the host or in other containers.</p>
<p>A hypothetical scenario involves a Python-based microservice that relies on a specific version of the <code>pandas</code> library for data processing. If a development machine uses <code>pandas</code> version 1.0, and the production server has version 1.3, subtle incompatibilities or unexpected behavior could emerge due to API changes between versions. By containerizing the microservice, the exact <code>pandas</code> version 1.0 is bundled within its container image, ensuring the application behaves identically in both development and production environments, eliminating "it works on my machine" issues.</p>
<h2>Containerizing the "Acme Webshop" Frontend</h2>
<p>The "Acme Webshop" application, as discussed in previous modules, consists of several components. We will begin by containerizing the frontend, which is a React-based application. This process involves creating a <code>Dockerfile</code> that specifies how to build the application's image.</p>
<p>A <code>Dockerfile</code> is a text document that contains all the commands a user could call on the command line to assemble an image. It defines the base image, copies application source code, installs dependencies, builds the application, and specifies the command to run the application when the container starts.</p>
<p>For the Acme Webshop frontend, the <code>Dockerfile</code> needs to:</p>
<ol>
<li>Choose a suitable base image for a Node.js application (React requires Node.js).</li>
<li>Set a working directory inside the container.</li>
<li>Copy the <code>package.json</code> and <code>package-lock.json</code> files to install dependencies.</li>
<li>Install the Node.js dependencies.</li>
<li>Copy the rest of the application source code.</li>
<li>Build the React application into static files.</li>
<li>Serve these static files using a lightweight web server like Nginx.</li>
</ol>
<p>Here is an example <code>Dockerfile</code> for the Acme Webshop frontend:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">dockerfile</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Stage 1: Build the React application</span></span>
<span class="line"><span style="color:#D73A49">FROM</span><span style="color:#24292E"> node:18-alpine </span><span style="color:#D73A49">AS</span><span style="color:#24292E"> builder # Use a lightweight Node.js base image for building</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">WORKDIR</span><span style="color:#24292E"> /app # Set the working directory inside the container</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> package.json package-lock.json ./ # Copy package files first to leverage Docker</span><span style="color:#032F62">'s layer caching</span></span>
<span class="line"><span style="color:#032F62">RUN npm install # Install Node.js dependencies</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62">COPY . . # Copy the rest of the application source code</span></span>
<span class="line"><span style="color:#032F62">RUN npm run build # Build the React application, outputting static files to the '</span><span style="color:#24292E">build</span><span style="color:#032F62">' directory</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62"># Stage 2: Serve the static files with Nginx</span></span>
<span class="line"><span style="color:#032F62">FROM nginx:alpine # Use a lightweight Nginx base image to serve the static content</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62">COPY --from=builder /app/build /usr/share/nginx/html # Copy the built static files from the builder stage</span></span>
<span class="line"><span style="color:#032F62">COPY nginx.conf /etc/nginx/conf.d/default.conf # Copy a custom Nginx configuration file</span></span>
<span class="line"><span style="color:#032F62">EXPOSE 80 # Expose port 80 for web traffic</span></span>
<span class="line"><span style="color:#032F62">CMD ["nginx", "-g", "daemon off;"] # Command to start Nginx in the foreground</span></span></code></pre></div></div></div>
<p>This <code>Dockerfile</code> uses a multi-stage build pattern. The first stage (<code>builder</code>) compiles the React application, and the second stage (<code>nginx</code>) takes only the resulting static assets, avoiding unnecessary build tools in the final image. This results in smaller, more secure production images.</p>
<p>The <code>nginx.conf</code> file would configure Nginx to serve the static files, potentially handle routing, and enable Gzip compression.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">nginx</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># nginx.conf</span></span>
<span class="line"><span style="color:#D73A49">server</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    listen </span><span style="color:#005CC5">80</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#D73A49">    server_name </span><span style="color:#24292E">localhost;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    root </span><span style="color:#24292E">/usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#D73A49">    index </span><span style="color:#24292E">index.html index.htm;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    location</span><span style="color:#6F42C1"> / </span><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#D73A49">        try_files </span><span style="color:#24292E">$uri $uri/ /index.html; </span><span style="color:#6A737D"># Essential for React Router to handle direct access to routes</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    error_page </span><span style="color:#005CC5">500</span><span style="color:#005CC5"> 502</span><span style="color:#005CC5"> 503</span><span style="color:#005CC5"> 504</span><span style="color:#24292E"> /50x.html;</span></span>
<span class="line"><span style="color:#D73A49">    location</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> /50x.html </span><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#D73A49">        root </span><span style="color:#24292E">/usr/share/nginx/html;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>To build the Docker image, navigate to the directory containing the <code>Dockerfile</code> and <code>nginx.conf</code> (and your React application's <code>package.json</code> and source code), then run:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> build</span><span style="color:#005CC5"> -t</span><span style="color:#032F62"> acme-webshop-frontend:1.0.0</span><span style="color:#032F62"> .</span></span></code></pre></div></div></div>
<ul>
<li><code>docker build</code>: The command to build a Docker image.</li>
<li><code>-t acme-webshop-frontend:1.0.0</code>: Tags the image with a name (<code>acme-webshop-frontend</code>) and a version (<code>1.0.0</code>).</li>
<li><code>.</code>: Specifies the build context, which is the current directory.</li>
</ul>
<p>After building, you can run the container:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 8080:80</span><span style="color:#005CC5"> --name</span><span style="color:#032F62"> acme-frontend-container</span><span style="color:#032F62"> acme-webshop-frontend:1.0.0</span></span></code></pre></div></div></div>
<ul>
<li><code>docker run</code>: The command to run a Docker container.</li>
<li><code>-p 8080:80</code>: Maps port 8080 on the host machine to port 80 inside the container. This allows you to access the webshop at <code>http://localhost:8080</code>.</li>
<li><code>--name acme-frontend-container</code>: Assigns a name to the running container.</li>
<li><code>acme-webshop-frontend:1.0.0</code>: The image to use for the container.</li>
</ul>
<h2>Containerizing the "Acme Webshop" Backend</h2>
<p>The Acme Webshop backend is a Spring Boot application written in Java. Containerizing it also involves creating a <code>Dockerfile</code>, but with considerations specific to Java applications.</p>
<p>For the Spring Boot backend, the <code>Dockerfile</code> needs to:</p>
<ol>
<li>Choose a suitable base image for a Java application.</li>
<li>Set a working directory.</li>
<li>Copy the compiled Java archive (JAR file).</li>
<li>Specify the command to run the Spring Boot application.</li>
</ol>
<p>Here is an example <code>Dockerfile</code> for the Acme Webshop backend:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">dockerfile</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Stage 1: Build the Spring Boot application</span></span>
<span class="line"><span style="color:#D73A49">FROM</span><span style="color:#24292E"> maven:3.8.7-openjdk-17 </span><span style="color:#D73A49">AS</span><span style="color:#24292E"> builder # Use a Maven image with OpenJDK 17 for building</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">WORKDIR</span><span style="color:#24292E"> /app # Set the working directory</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> pom.xml . # Copy the Maven Project Object Model (POM) file</span></span>
<span class="line"><span style="color:#D73A49">RUN</span><span style="color:#24292E"> mvn dependency:go-offline # Download all dependencies to leverage Docker</span><span style="color:#032F62">'s layer caching</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62">COPY src ./src # Copy the source code</span></span>
<span class="line"><span style="color:#032F62">RUN mvn package -DskipTests # Build the JAR file, skipping tests to speed up the build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62"># Stage 2: Create the final image with JRE</span></span>
<span class="line"><span style="color:#032F62">FROM openjdk:17-jdk-slim # Use a lightweight OpenJDK JRE base image for the final application</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62">WORKDIR /app # Set the working directory</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62">COPY --from=builder /app/target/*.jar app.jar # Copy the built JAR file from the builder stage</span></span>
<span class="line"><span style="color:#032F62">EXPOSE 8080 # Expose the default Spring Boot port</span></span>
<span class="line"><span style="color:#032F62">ENTRYPOINT ["java", "-jar", "app.jar"] # Command to run the Spring Boot application</span></span></code></pre></div></div></div>
<p>Similar to the frontend, this <code>Dockerfile</code> uses a multi-stage build. The first stage (<code>builder</code>) compiles the Spring Boot application and creates an executable JAR file. The second stage uses a much smaller JRE (Java Runtime Environment) image to run the application, excluding the Maven build tools, significantly reducing the final image size.</p>
<p>To build the Docker image for the backend:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> build</span><span style="color:#005CC5"> -t</span><span style="color:#032F62"> acme-webshop-backend:1.0.0</span><span style="color:#032F62"> .</span></span></code></pre></div></div></div>
<p>To run the container:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 8081:8080</span><span style="color:#005CC5"> --name</span><span style="color:#032F62"> acme-backend-container</span><span style="color:#032F62"> acme-webshop-backend:1.0.0</span></span></code></pre></div></div></div>
<ul>
<li><code>-p 8081:8080</code>: Maps port 8081 on the host machine to port 8080 inside the container. This allows you to access the backend at <code>http://localhost:8081</code>.</li>
</ul>
<h2>Managing Application Dependencies with Docker Compose</h2>
<p>When an application consists of multiple services, like the Acme Webshop with its frontend and backend, managing them individually can become cumbersome. Docker Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a YAML file to configure your application's services. Then, with a single command, you create and start all the services from your configuration.</p>
<p>A <code>docker-compose.yml</code> file for the Acme Webshop would define both the frontend and backend services, allowing them to communicate and be managed together. It can also define networks and volumes for persistent data.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#22863A">version</span><span style="color:#24292E">: </span><span style="color:#032F62">'3.8'</span><span style="color:#6A737D"> # Specify the Docker Compose file format version</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A">services</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  frontend</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    image</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop-frontend:1.0.0</span><span style="color:#6A737D"> # Use the image we built for the frontend</span></span>
<span class="line"><span style="color:#22863A">    build</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Alternatively, define a build context here if you haven't built the image yet</span></span>
<span class="line"><span style="color:#22863A">      context</span><span style="color:#24292E">: </span><span style="color:#032F62">./frontend</span><span style="color:#6A737D"> # Path to the frontend Dockerfile directory</span></span>
<span class="line"><span style="color:#22863A">      dockerfile</span><span style="color:#24292E">: </span><span style="color:#032F62">Dockerfile</span></span>
<span class="line"><span style="color:#22863A">    ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">"8080:80"</span><span style="color:#6A737D"> # Map host port 8080 to container port 80</span></span>
<span class="line"><span style="color:#22863A">    depends_on</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Ensure backend starts before frontend</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">backend</span></span>
<span class="line"><span style="color:#22863A">    environment</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Pass environment variables to the frontend container</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">REACT_APP_BACKEND_URL=http://backend:8080</span><span style="color:#6A737D"> # Point to the backend service name within the Docker network</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A">  backend</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    image</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop-backend:1.0.0</span><span style="color:#6A737D"> # Use the image we built for the backend</span></span>
<span class="line"><span style="color:#22863A">    build</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Alternatively, define a build context here</span></span>
<span class="line"><span style="color:#22863A">      context</span><span style="color:#24292E">: </span><span style="color:#032F62">./backend</span><span style="color:#6A737D"> # Path to the backend Dockerfile directory</span></span>
<span class="line"><span style="color:#22863A">      dockerfile</span><span style="color:#24292E">: </span><span style="color:#032F62">Dockerfile</span></span>
<span class="line"><span style="color:#22863A">    ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">"8081:8080"</span><span style="color:#6A737D"> # Map host port 8081 to container port 8080</span></span>
<span class="line"><span style="color:#22863A">    environment</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Pass environment variables to the backend container</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">SPRING_PROFILES_ACTIVE=dev</span><span style="color:#6A737D"> # Example Spring profile</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">DB_HOST=db</span><span style="color:#6A737D"> # Assuming a database service named 'db'</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">DB_PORT=5432</span><span style="color:#6A737D"> # Database port</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A">  db</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Example database service (e.g., PostgreSQL)</span></span>
<span class="line"><span style="color:#22863A">    image</span><span style="color:#24292E">: </span><span style="color:#032F62">postgres:13</span></span>
<span class="line"><span style="color:#22863A">    environment</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      POSTGRES_DB</span><span style="color:#24292E">: </span><span style="color:#032F62">acmedb</span></span>
<span class="line"><span style="color:#22863A">      POSTGRES_USER</span><span style="color:#24292E">: </span><span style="color:#032F62">acmeuser</span></span>
<span class="line"><span style="color:#22863A">      POSTGRES_PASSWORD</span><span style="color:#24292E">: </span><span style="color:#032F62">acmepassword</span></span>
<span class="line"><span style="color:#22863A">    volumes</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">db_data:/var/lib/postgresql/data</span><span style="color:#6A737D"> # Mount a volume for persistent database data</span></span>
<span class="line"><span style="color:#22863A">    ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#032F62">"5432:5432"</span><span style="color:#6A737D"> # Expose DB port if needed for external access (e.g., local development)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#22863A">volumes</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Define named volumes for persistent data</span></span>
<span class="line"><span style="color:#22863A">  db_data</span><span style="color:#24292E">:</span></span></code></pre></div></div></div>
<p>To start all services defined in <code>docker-compose.yml</code>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker-compose</span><span style="color:#032F62"> up</span><span style="color:#005CC5"> -d</span></span></code></pre></div></div></div>
<ul>
<li><code>docker-compose up</code>: Creates and starts containers.</li>
<li><code>-d</code>: Runs the containers in detached mode (in the background).</li>
</ul>
<p>To stop and remove the containers:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker-compose</span><span style="color:#032F62"> down</span></span></code></pre></div></div></div>
<p>Docker Compose greatly simplifies local development and testing of multi-service applications, providing a consistent environment that mirrors production setups.</p>
<h2>Exercises and Practice Activities</h2>
<p>These exercises build on the Acme Webshop containerization examples and aim to solidify your understanding of Docker and Docker Compose.</p>
<ol>
<li>
<p><strong>Refine the Frontend Dockerfile:</strong></p>
<ul>
<li>Modify the <code>Dockerfile</code> for the Acme Webshop frontend to use a different, even smaller Nginx base image (e.g., <code>nginx:stable-alpine</code>).</li>
<li>Add a <code>HEALTHCHECK</code> instruction to the <code>Dockerfile</code> that checks if the Nginx server inside the container is responding on port 80. This helps Docker understand the health of your service.</li>
<li>Rebuild and run the frontend image with these changes. Verify the health check status using <code>docker ps</code>.</li>
</ul>
</li>
<li>
<p><strong>Optimize the Backend Dockerfile:</strong></p>
<ul>
<li>Currently, the backend <code>Dockerfile</code> copies <code>pom.xml</code> and then <code>src</code>. For a Spring Boot application, an executable JAR also includes its dependencies. Research and implement a method to create a "thin JAR" (where dependencies are external) or use <code>spring-boot-loader-tools</code> to create a layered JAR for more efficient Docker image layering. This typically involves using a different <code>mvn</code> command or specific plugin configuration.</li>
<li>Modify the <code>ENTRYPOINT</code> to use <code>exec java -jar app.jar</code> for better signal handling within the container.</li>
<li>Rebuild and run the backend image with your optimizations. Compare the size of the new image to the previous one using <code>docker images</code>.</li>
</ul>
</li>
<li>
<p><strong>Expand the Docker Compose Configuration:</strong></p>
<ul>
<li>Add a simple Redis cache service to the <code>docker-compose.yml</code> file. Use an official Redis Docker image (e.g., <code>redis:6-alpine</code>).</li>
<li>Configure the backend service in <code>docker-compose.yml</code> to be able to connect to this new Redis service. This might involve setting environment variables in the backend service definition that point to the Redis host and port (e.g., <code>REDIS_HOST=redis</code>, <code>REDIS_PORT=6379</code>).</li>
<li>Start the entire application stack using <code>docker-compose up -d</code> and verify that all three services (frontend, backend, Redis) are running.</li>
</ul>
</li>
<li>
<p><strong>Simulate a Network Issue:</strong></p>
<ul>
<li>Using your <code>docker-compose.yml</code> file, stop <em>only</em> the backend service (<code>docker-compose stop backend</code>).</li>
<li>Access the frontend in your browser. Observe what happens. Describe how the frontend application behaves when its dependency (the backend) is unavailable.</li>
<li>Restart the backend service (<code>docker-compose start backend</code>) and confirm that the application functions correctly again. This exercise highlights the importance of service resilience and inter-service communication.</li>
</ul>
</li>
</ol>
<h2>Real-World Application</h2>
<p>Containerization is fundamental to modern software deployment.</p>
<p><strong>Example 1: Microservices Architecture</strong>
A large e-commerce company like Amazon or eBay relies heavily on microservices. Each service (e.g., user authentication, product catalog, payment processing, recommendation engine) is developed, deployed, and scaled independently. Containerization allows each microservice to be packaged with its specific runtime environment and dependencies, regardless of the language or framework used (e.g., a Python service for recommendations, a Java service for payments, a Node.js service for user profiles). This isolation prevents dependency conflicts and ensures consistent behavior for each service across development, testing, and production environments, greatly simplifying the CI/CD pipeline for complex applications.</p>
<p><strong>Example 2: Hybrid Cloud Deployments</strong>
Organizations often operate in hybrid cloud environments, utilizing both on-premise data centers and public cloud providers like AWS, Azure, or GCP. Containers provide a consistent deployment unit that can run seamlessly in any of these environments. A financial institution might run its core banking applications on-premise for regulatory compliance while deploying customer-facing mobile banking features in the public cloud. Containerizing these applications ensures that the same application image can be used in both environments, simplifying deployment scripts and reducing the risk of environment-specific issues. This enables flexibility in infrastructure choices without rewriting or reconfiguring applications.</p>
  
</div>

<div id="chapter-4.3">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Integrating Docker Image Builds into Jenkins Pipelines</h1><p>Building on the understanding of Docker fundamentals and containerizing the "Acme Webshop" application, the next crucial step in a CI/CD pipeline is to automate the process of building Docker images. This lesson focuses on integrating these Docker image builds directly into Jenkins pipelines, ensuring that every code change can automatically trigger the creation of a new, updated container image. This automation streamlines the development workflow, reduces manual errors, and provides consistent build artifacts for deployment.</p>
<h2>Setting Up Docker for Jenkins</h2>
<p>For Jenkins to interact with Docker and build images, the Jenkins agent (or the Jenkins controller itself, in smaller setups) needs access to a Docker daemon. This typically involves installing Docker on the machine where Jenkins jobs will execute.</p>
<h3>Installing Docker on the Jenkins Host/Agent</h3>
<p>The Jenkins server or its build agents require Docker installed to execute Docker commands. The installation process varies slightly depending on the operating system. For Linux-based systems, common steps include:</p>
<ol>
<li><strong>Update package index:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt-get</span><span style="color:#032F62"> update</span></span></code></pre></div></div></div>
</li>
<li><strong>Install necessary packages for HTTPS transport:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt-get</span><span style="color:#032F62"> install</span><span style="color:#005CC5"> \</span></span>
<span class="line"><span style="color:#032F62">    ca-certificates</span><span style="color:#005CC5"> \</span></span>
<span class="line"><span style="color:#032F62">    curl</span><span style="color:#005CC5"> \</span></span>
<span class="line"><span style="color:#032F62">    gnupg</span><span style="color:#005CC5"> \</span></span>
<span class="line"><span style="color:#032F62">    lsb-release</span></span></code></pre></div></div></div>
</li>
<li><strong>Add Docker's official GPG key:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> mkdir</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> /etc/apt/keyrings</span></span>
<span class="line"><span style="color:#6F42C1">curl</span><span style="color:#005CC5"> -fsSL</span><span style="color:#032F62"> https://download.docker.com/linux/ubuntu/gpg</span><span style="color:#D73A49"> |</span><span style="color:#6F42C1"> sudo</span><span style="color:#032F62"> gpg</span><span style="color:#005CC5"> --dearmor</span><span style="color:#005CC5"> -o</span><span style="color:#032F62"> /etc/apt/keyrings/docker.gpg</span></span></code></pre></div></div></div>
</li>
<li><strong>Set up the stable repository:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#005CC5">echo</span><span style="color:#005CC5"> \</span></span>
<span class="line"><span style="color:#032F62">  "deb [arch=$(</span><span style="color:#6F42C1">dpkg</span><span style="color:#005CC5"> --print-architecture</span><span style="color:#032F62">) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu </span><span style="color:#005CC5">\</span></span>
<span class="line"><span style="color:#032F62">  $(</span><span style="color:#6F42C1">lsb_release</span><span style="color:#005CC5"> -cs</span><span style="color:#032F62">) stable"</span><span style="color:#D73A49"> |</span><span style="color:#6F42C1"> sudo</span><span style="color:#032F62"> tee</span><span style="color:#032F62"> /etc/apt/sources.list.d/docker.list</span><span style="color:#D73A49"> &gt;</span><span style="color:#032F62"> /dev/null</span></span></code></pre></div></div></div>
</li>
<li><strong>Install Docker Engine:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt-get</span><span style="color:#032F62"> update</span></span>
<span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> apt-get</span><span style="color:#032F62"> install</span><span style="color:#032F62"> docker-ce</span><span style="color:#032F62"> docker-ce-cli</span><span style="color:#032F62"> containerd.io</span><span style="color:#032F62"> docker-compose-plugin</span></span></code></pre></div></div></div>
</li>
<li><strong>Verify Docker installation:</strong>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> docker</span><span style="color:#032F62"> run</span><span style="color:#032F62"> hello-world</span></span></code></pre></div></div></div>
</li>
</ol>
<h3>Granting Jenkins User Docker Access</h3>
<p>By default, only users in the <code>docker</code> group can execute Docker commands. The Jenkins user needs to be added to this group to avoid permission issues when the pipeline attempts to build images.</p>
<ol>
<li>
<p><strong>Add Jenkins user to the <code>docker</code> group:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> usermod</span><span style="color:#005CC5"> -aG</span><span style="color:#032F62"> docker</span><span style="color:#032F62"> jenkins</span></span></code></pre></div></div></div>
</li>
<li>
<p><strong>Restart Jenkins service:</strong> This is often required for the group changes to take effect.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">sudo</span><span style="color:#032F62"> systemctl</span><span style="color:#032F62"> restart</span><span style="color:#032F62"> jenkins</span></span></code></pre></div></div></div>
<p>Or, if Jenkins is running in a container, you need to ensure the container itself has access to the Docker daemon, usually by mounting the Docker socket.</p>
<p><strong>Example: Running Jenkins in Docker with Docker access</strong>
When running Jenkins as a Docker container, it cannot directly access the host's Docker daemon without explicit configuration. The standard approach is to mount the Docker socket from the host into the Jenkins container. This enables the Jenkins container to issue Docker commands to the host's Docker daemon.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> run</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 8080:8080</span><span style="color:#005CC5"> -p</span><span style="color:#032F62"> 50000:50000</span><span style="color:#005CC5"> \</span></span>
<span class="line"><span style="color:#005CC5">  -v</span><span style="color:#032F62"> jenkins_home:/var/jenkins_home</span><span style="color:#005CC5"> \</span></span>
<span class="line"><span style="color:#005CC5">  -v</span><span style="color:#032F62"> /var/run/docker.sock:/var/run/docker.sock</span><span style="color:#005CC5"> \ </span><span style="color:#032F62">#</span><span style="color:#032F62"> Mount</span><span style="color:#032F62"> the</span><span style="color:#032F62"> Docker</span><span style="color:#032F62"> socket</span></span>
<span class="line"><span style="color:#6F42C1">  -v</span><span style="color:#24292E"> $(</span><span style="color:#005CC5">which</span><span style="color:#032F62"> docker</span><span style="color:#24292E">)</span><span style="color:#032F62">:/usr/bin/docker</span><span style="color:#005CC5"> \ </span><span style="color:#032F62">#</span><span style="color:#032F62"> Mount</span><span style="color:#032F62"> the</span><span style="color:#032F62"> Docker</span><span style="color:#032F62"> client</span><span style="color:#032F62"> binary</span></span>
<span class="line"><span style="color:#6F42C1">  jenkins/jenkins:lts</span></span></code></pre></div></div></div>
<p>In this setup, the Jenkins container effectively acts as a Docker client for the host's Docker daemon.</p>
</li>
</ol>
<h2>Integrating Docker Builds into Jenkins Declarative Pipelines</h2>
<p>Integrating Docker image builds involves defining stages in a Jenkinsfile that execute <code>docker build</code> commands. These stages typically occur after the application code has been compiled and tested, ensuring that only validated code is used to build container images.</p>
<h3>Basic Docker Build Stage</h3>
<p>A simple Jenkins pipeline stage for building a Docker image might look like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any </span><span style="color:#6A737D">// Specifies that the pipeline can run on any available agent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Checkout the source code for the Acme Webshop application</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/your-repo/acme-webshop.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Application'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Example: Build the Java application using Maven</span></span>
<span class="line"><span style="color:#6A737D">                    // Assuming the 'pom.xml' is at the root of the repository</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'mvn clean package -DskipTests'</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Define image name and tag</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop"</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageTag </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "${env.BUILD_NUMBER}"</span><span style="color:#6A737D"> // Use Jenkins build number for unique tags</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // Build the Docker image</span></span>
<span class="line"><span style="color:#6A737D">                    // -t: Tag the image</span></span>
<span class="line"><span style="color:#6A737D">                    // .: Build context (current directory where Dockerfile is located)</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker build -t ${imageName}:${imageTag} ."</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // Optional: Tag with 'latest' for convenience</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker tag ${imageName}:${imageTag} ${imageName}:latest"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ... potentially other stages like Push to Registry, Deploy, etc.</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this example:</p>
<ul>
<li>The <code>Build Docker Image</code> stage executes the <code>docker build</code> command.</li>
<li><code>imageName</code> and <code>imageTag</code> variables are used for clear image identification.</li>
<li><code>env.BUILD_NUMBER</code> is a built-in Jenkins environment variable that provides a unique number for each build, making it excellent for image versioning.</li>
<li><code>docker build -t ${imageName}:${imageTag} .</code> builds the image using the <code>Dockerfile</code> found in the current directory (<code>.</code>) and tags it.</li>
<li>An additional <code>docker tag</code> command creates a <code>latest</code> tag, which is a common practice for referring to the most recently built stable image.</li>
</ul>
<h3>Using the <code>docker</code> DSL in Jenkins Pipelines</h3>
<p>Jenkins provides a more idiomatic way to interact with Docker within Declarative Pipelines through the <code>docker</code> DSL (Domain Specific Language). This offers a cleaner syntax and often handles common patterns like image tagging and registry authentication more seamlessly.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop using Docker DSL</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/your-repo/acme-webshop.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Application'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'mvn clean package -DskipTests'</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Docker Image (using Docker DSL)'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Define the Docker image object</span></span>
<span class="line"><span style="color:#6A737D">                    // The first argument is the repository name</span></span>
<span class="line"><span style="color:#6A737D">                    // The second argument is the tag, using the Jenkins build number</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> customImage </span><span style="color:#D73A49">=</span><span style="color:#24292E"> docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">build(</span><span style="color:#032F62">"acme-webshop:${env.BUILD_NUMBER}"</span><span style="color:#24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // You can also add a 'latest' tag</span></span>
<span class="line"><span style="color:#24292E">                    customImage</span><span style="color:#D73A49">.</span><span style="color:#24292E">tag(</span><span style="color:#032F62">"acme-webshop:latest"</span><span style="color:#24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // The image is now built and tagged locally on the Jenkins agent.</span></span>
<span class="line"><span style="color:#6A737D">                    // Further steps would involve pushing it to a registry.</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ...</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>The <code>docker.build()</code> method automatically handles running the <code>docker build</code> command. It assumes the <code>Dockerfile</code> is in the current working directory of the Jenkins agent. The method returns a <code>DockerImage</code> object, which can then be used for further operations like tagging (<code>.tag()</code>) or pushing to a registry (covered in a later lesson).</p>
<h3>Multi-Stage Dockerfile Considerations</h3>
<p>Modern Dockerfiles often utilize multi-stage builds to optimize image size. When integrating such Dockerfiles into Jenkins pipelines, the build process remains the same as <code>docker build</code> handles the stages internally. The Jenkins pipeline only needs to trigger the command.</p>
<p><strong>Example: Multi-stage Dockerfile for Acme Webshop</strong></p>
<p>Assume <code>Dockerfile</code> looks like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">dockerfile</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Stage 1: Build the application</span></span>
<span class="line"><span style="color:#D73A49">FROM</span><span style="color:#24292E"> maven:3.8.5-openjdk-17-slim </span><span style="color:#D73A49">AS</span><span style="color:#24292E"> build</span></span>
<span class="line"><span style="color:#D73A49">WORKDIR</span><span style="color:#24292E"> /app</span></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> pom.xml .</span></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> src ./src</span></span>
<span class="line"><span style="color:#D73A49">RUN</span><span style="color:#24292E"> mvn clean package -DskipTests</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D"># Stage 2: Create the final lean runtime image</span></span>
<span class="line"><span style="color:#D73A49">FROM</span><span style="color:#24292E"> openjdk:17-jre-slim-buster</span></span>
<span class="line"><span style="color:#D73A49">WORKDIR</span><span style="color:#24292E"> /app</span></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> --from=build /app/target/acme-webshop-*.jar acme-webshop.jar</span></span>
<span class="line"><span style="color:#D73A49">EXPOSE</span><span style="color:#24292E"> 8080</span></span>
<span class="line"><span style="color:#D73A49">ENTRYPOINT</span><span style="color:#24292E"> [</span><span style="color:#032F62">"java"</span><span style="color:#24292E">, </span><span style="color:#032F62">"-jar"</span><span style="color:#24292E">, </span><span style="color:#032F62">"acme-webshop.jar"</span><span style="color:#24292E">]</span></span></code></pre></div></div></div>
<p>The Jenkinsfile for this would be identical to the previous examples, as the <code>docker build</code> command seamlessly executes the multi-stage process.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile (same as before, but implicitly using a multi-stage Dockerfile)</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/your-repo/acme-webshop.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop"</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageTag </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "${env.BUILD_NUMBER}"</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker build -t ${imageName}:${imageTag} ."</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker tag ${imageName}:${imageTag} ${imageName}:latest"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ...</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>The benefit of multi-stage builds is a smaller, more secure final image, which is automatically achieved without changes to the Jenkins pipeline build step itself. The pipeline's role is just to initiate the build process defined by the <code>Dockerfile</code>.</p>
<h2>Advanced Build Scenarios in Jenkins</h2>
<h3>Building from a Custom Dockerfile Path or Name</h3>
<p>Sometimes, the <code>Dockerfile</code> is not in the root of the repository or has a different name (e.g., <code>Dockerfile.prod</code>, <code>Dockerfile.dev</code>). The <code>docker build</code> command supports specifying these.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/your-repo/acme-webshop.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Prod Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-prod"</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageTag </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "${env.BUILD_NUMBER}"</span></span>
<span class="line"><span style="color:#6A737D">                    // -f: specify a Dockerfile by name</span></span>
<span class="line"><span style="color:#6A737D">                    // .: build context remains the current directory</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker build -f Dockerfile.prod -t ${imageName}:${imageTag} ."</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Dev Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop-dev"</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageTag </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "${env.BUILD_NUMBER}"</span></span>
<span class="line"><span style="color:#6A737D">                    // Assume Dockerfile is in a 'docker' subdirectory</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker build -f docker/Dockerfile.dev -t ${imageName}:${imageTag} docker"</span><span style="color:#6A737D"> // Build context is 'docker' subdirectory</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>Here:</p>
<ul>
<li><code>docker build -f Dockerfile.prod -t ... .</code> uses <code>Dockerfile.prod</code> in the current directory.</li>
<li><code>docker build -f docker/Dockerfile.dev -t ... docker</code> uses <code>Dockerfile.dev</code> located in the <code>docker</code> subdirectory and sets the build context to that subdirectory. This means files referenced in <code>Dockerfile.dev</code> (e.g., <code>COPY . /app</code>) will refer to files relative to the <code>docker</code> subdirectory.</li>
</ul>
<h3>Passing Build Arguments to Dockerfiles</h3>
<p>Dockerfiles can accept build arguments (<code>ARG</code>) which allow for dynamic values to be passed at build time. Jenkins pipelines can supply these using the <code>--build-arg</code> flag. This is useful for things like specifying base image versions, dependency versions, or other configuration values that shouldn't be hardcoded into the Dockerfile itself but vary per build environment.</p>
<p><strong>Example: Dockerfile with Build Argument</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">dockerfile</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># Dockerfile</span></span>
<span class="line"><span style="color:#D73A49">ARG</span><span style="color:#24292E"> BASE_IMAGE_TAG=17-jre-slim-buster</span></span>
<span class="line"><span style="color:#D73A49">FROM</span><span style="color:#24292E"> openjdk:${BASE_IMAGE_TAG}</span></span>
<span class="line"><span style="color:#D73A49">WORKDIR</span><span style="color:#24292E"> /app</span></span>
<span class="line"><span style="color:#D73A49">COPY</span><span style="color:#24292E"> target/acme-webshop-*.jar acme-webshop.jar</span></span>
<span class="line"><span style="color:#D73A49">EXPOSE</span><span style="color:#24292E"> 8080</span></span>
<span class="line"><span style="color:#D73A49">ENTRYPOINT</span><span style="color:#24292E"> [</span><span style="color:#032F62">"java"</span><span style="color:#24292E">, </span><span style="color:#032F62">"-jar"</span><span style="color:#24292E">, </span><span style="color:#032F62">"acme-webshop.jar"</span><span style="color:#24292E">]</span></span></code></pre></div></div></div>
<p><strong>Jenkinsfile supplying build argument</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/your-repo/acme-webshop.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Docker Image with ARG'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageName </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "acme-webshop"</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> imageTag </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "${env.BUILD_NUMBER}"</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> javaVersion </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "11-jre-slim-buster"</span><span style="color:#6A737D"> // Example: use Java 11 for this build</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // --build-arg: Pass argument to Dockerfile</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker build --build-arg BASE_IMAGE_TAG=${javaVersion} -t ${imageName}:${imageTag} ."</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This allows the Jenkins pipeline to control aspects of the image build without modifying the <code>Dockerfile</code> itself, providing greater flexibility.</p>
<h2>Best Practices for Integrating Docker Builds</h2>
<ul>
<li><strong>Image Tagging Strategy:</strong> Always use meaningful tags. <code>latest</code> should typically point to the most recent stable release. Version-specific tags (e.g., <code>1.0.0</code>, <code>1.0.0-build123</code>) and Git commit SHAs or Jenkins build numbers are excellent for traceability and rollback capabilities.</li>
<li><strong>Build Context Optimization:</strong> Ensure the Docker build context (<code>.</code>) is as small as possible. Use a <code>.dockerignore</code> file to exclude unnecessary files (e.g., <code>.git</code> directory, <code>target</code> directories, IDE files) from being sent to the Docker daemon. This speeds up builds and reduces cache invalidation issues.</li>
<li><strong>Leverage Build Cache:</strong> Docker's layer caching mechanism significantly speeds up subsequent builds. Structure your <code>Dockerfile</code> to place frequently changing layers (like application code) towards the bottom, after more stable layers (like base images, dependencies).</li>
<li><strong>Security Considerations:</strong>
<ul>
<li>Run containers as non-root users.</li>
<li>Minimize the number of packages and tools installed in the final image.</li>
<li>Use official base images as much as possible.</li>
<li>Scan images for vulnerabilities (covered in a later module).</li>
</ul>
</li>
</ul>
<h2>Exercises</h2>
<p>For the "Acme Webshop" application, which we containerized in the previous lesson:</p>
<ol>
<li>
<p><strong>Basic Image Build:</strong>
Create a Jenkinsfile that checks out the "Acme Webshop" source code, compiles it (if applicable, e.g., Maven for Java), and then builds a Docker image. Tag the image with the format <code>acme-webshop:build-${BUILD_NUMBER}</code> and also <code>acme-webshop:latest</code>.
<em>Self-check:</em> Run the Jenkins pipeline. Verify that two Docker images with the specified tags are created on the Jenkins agent.</p>
</li>
<li>
<p><strong>Custom Dockerfile Path:</strong>
Assume you have two Dockerfiles for "Acme Webshop": <code>Dockerfile.dev</code> (for development, maybe includes extra debugging tools) and <code>Dockerfile.prod</code> (for production, lean image).
Modify your Jenkinsfile to include two separate stages:</p>
<ul>
<li>One stage builds <code>acme-webshop-dev:latest</code> using <code>Dockerfile.dev</code>.</li>
<li>Another stage builds <code>acme-webshop-prod:latest</code> using <code>Dockerfile.prod</code>.
Place these Dockerfiles in a subdirectory named <code>dockerfiles</code> within your repository. Ensure the build context is correctly set.
<em>Self-check:</em> Run the pipeline. Confirm both development and production images are built and tagged correctly.</li>
</ul>
</li>
<li>
<p><strong>Dynamic Base Image with Build Argument:</strong>
Update your <code>Dockerfile.prod</code> to accept a <code>JAVA_VERSION</code> build argument (e.g., <code>ARG JAVA_VERSION=17</code>).
Modify the Jenkinsfile to pass this <code>JAVA_VERSION</code> argument to the <code>docker build</code> command. Create two separate builds: one using <code>JAVA_VERSION=11</code> and another using <code>JAVA_VERSION=17</code>. Tag them appropriately (e.g., <code>acme-webshop-java11:${BUILD_NUMBER}</code>, <code>acme-webshop-java17:${BUILD_NUMBER}</code>).
<em>Self-check:</em> Run the pipeline. Inspect the created images to confirm they use the specified Java base image versions.</p>
</li>
</ol>
  
</div>

<div id="chapter-4.4">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Introduction to Kubernetes: Orchestrating Containerized Applications</h1><p>Kubernetes is an open-source system designed to automate the deployment, scaling, and management of containerized applications. It provides a platform to run and manage workloads and services across a cluster of machines, abstracting away the underlying infrastructure. This enables efficient handling of container lifecycles, resource allocation, and self-healing capabilities, which are crucial for maintaining the availability and performance of modern applications like the Acme Webshop.</p>
<h2>Understanding Kubernetes Core Concepts</h2>
<p>Kubernetes operates on a declarative model, meaning you describe the desired state of your applications and the cluster works to achieve and maintain that state. This is a significant shift from imperative approaches where you issue specific commands to achieve a state. The core concepts form the building blocks for orchestrating containerized applications.</p>
<h3>Cluster Architecture</h3>
<p>A Kubernetes cluster consists of a set of worker machines, called <strong>Nodes</strong>, that host the containerized applications. The cluster also has at least one <strong>Control Plane</strong> component that manages the worker nodes and the Pods in the cluster.</p>
<ul>
<li><strong>Control Plane (Master Node):</strong> The control plane components make global decisions about the cluster (e.g., scheduling) and detect and respond to cluster events (e.g., starting up new Pods when a deployment's <code>replicas</code> field is unsatisfied).
<ul>
<li><strong>kube-apiserver:</strong> Exposes the Kubernetes API. The API server is the front end for the Kubernetes control plane.</li>
<li><strong>etcd:</strong> Consistent and highly available key-value store used as Kubernetes' backing store for all cluster data.</li>
<li><strong>kube-scheduler:</strong> Watches for newly created Pods with no assigned node and selects a node for them to run on.</li>
<li><strong>kube-controller-manager:</strong> Runs controller processes. Controllers regulate the state of the cluster, for example, a replication controller maintains the correct number of pods for a deployment.</li>
<li><strong>cloud-controller-manager (Optional):</strong> Integrates with cloud providers (e.g., AWS, GCP, Azure) to manage cloud resources like load balancers and persistent volumes.</li>
</ul>
</li>
<li><strong>Node (Worker Node):</strong> A node is a VM or physical machine that acts as a worker in the Kubernetes cluster. Each node has the necessary services to run Pods.
<ul>
<li><strong>kubelet:</strong> An agent that runs on each node in the cluster. It ensures that containers are running in a Pod.</li>
<li><strong>kube-proxy:</strong> A network proxy that runs on each node and implements part of the Kubernetes Service concept, maintaining network rules on nodes.</li>
<li><strong>Container Runtime:</strong> The software responsible for running containers (e.g., Docker, containerd, CRI-O). We encountered Docker in previous lessons when containerizing the Acme Webshop application.</li>
</ul>
</li>
</ul>
<h3>Pods: The Smallest Deployable Units</h3>
<p>A Pod is the smallest deployable unit in Kubernetes. A Pod represents a single instance of a running process in your cluster. Pods can contain one or more containers, which are tightly coupled and share resources like network and storage.</p>
<ul>
<li><strong>Single-Container Pods:</strong> The most common use case. A Pod encapsulates a single container, such as our Acme Webshop backend application.</li>
<li><strong>Multi-Container Pods (Sidecar Pattern):</strong> A Pod can contain multiple containers that work together to provide a single, cohesive service. For example, a main application container might have a "sidecar" container that handles log shipping or data synchronization.</li>
</ul>
<p><strong>Example: Acme Webshop Backend Pod</strong></p>
<p>Imagine the Acme Webshop backend application, previously containerized into a Docker image. In Kubernetes, this application would run inside a Pod.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Pod</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop-backend-pod</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">    tier</span><span style="color:#24292E">: </span><span style="color:#032F62">backend</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  containers</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">  - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">webshop-backend</span></span>
<span class="line"><span style="color:#22863A">    image</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop/backend:v1.0.0</span><span style="color:#6A737D"> # Image built in previous lessons</span></span>
<span class="line"><span style="color:#22863A">    ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    - </span><span style="color:#22863A">containerPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">8080</span></span>
<span class="line"><span style="color:#22863A">    env</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">DATABASE_HOST</span></span>
<span class="line"><span style="color:#22863A">      value</span><span style="color:#24292E">: </span><span style="color:#032F62">"acme-webshop-db-service"</span><span style="color:#6A737D"> # Reference to a Kubernetes Service</span></span>
<span class="line"><span style="color:#24292E">    - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">DATABASE_PORT</span></span>
<span class="line"><span style="color:#22863A">      value</span><span style="color:#24292E">: </span><span style="color:#032F62">"5432"</span></span></code></pre></div></div></div>
<p>In this example:</p>
<ul>
<li><code>apiVersion: v1</code> specifies the Kubernetes API version.</li>
<li><code>kind: Pod</code> declares that this is a Pod object.</li>
<li><code>metadata</code> provides identifying information, including <code>name</code> and <code>labels</code>. Labels are key-value pairs used for organizing and selecting groups of objects.</li>
<li><code>spec</code> describes the desired state for the Pod.</li>
<li><code>containers</code> lists the containers within the Pod.
<ul>
<li><code>name</code> is the name of the container within the Pod.</li>
<li><code>image</code> specifies the Docker image to use. This would be the image pushed to a registry after building it in Jenkins.</li>
<li><code>ports</code> declares the container port that the application listens on.</li>
<li><code>env</code> defines environment variables that the container will use, such as database connection details.</li>
</ul>
</li>
</ul>
<h3>Deployments: Managing Application Lifecycles</h3>
<p>Deployments are higher-level objects that manage the lifecycle of your application. They describe the desired state of your application (e.g., how many replicas of a Pod should be running) and Kubernetes ensures that this state is maintained. Deployments automatically handle creating, updating, and scaling Pods.</p>
<ul>
<li><strong>ReplicaSet Management:</strong> Deployments manage ReplicaSets, which in turn ensure that a specified number of Pod replicas are running at all times. If a Pod fails, the ReplicaSet will automatically create a new one.</li>
<li><strong>Rolling Updates:</strong> Deployments support rolling updates, allowing you to update your application with new versions without downtime. This is crucial for CI/CD, as it enables continuous delivery.</li>
<li><strong>Rollbacks:</strong> If a new deployment introduces issues, you can easily roll back to a previous stable version.</li>
</ul>
<p><strong>Example: Acme Webshop Backend Deployment</strong></p>
<p>Instead of directly creating Pods, you typically create Deployments. This Deployment ensures three replicas of the Acme Webshop backend are always running.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">apps/v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Deployment</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop-backend-deployment</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">    tier</span><span style="color:#24292E">: </span><span style="color:#032F62">backend</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  replicas</span><span style="color:#24292E">: </span><span style="color:#005CC5">3</span><span style="color:#6A737D"> # Desired number of Pod replicas</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    matchLabels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">      tier</span><span style="color:#24292E">: </span><span style="color:#032F62">backend</span></span>
<span class="line"><span style="color:#22863A">  template</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Pod template managed by this Deployment</span></span>
<span class="line"><span style="color:#22863A">    metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">        app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">        tier</span><span style="color:#24292E">: </span><span style="color:#032F62">backend</span></span>
<span class="line"><span style="color:#22863A">    spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      containers</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">webshop-backend</span></span>
<span class="line"><span style="color:#22863A">        image</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop/backend:v1.0.0</span><span style="color:#6A737D"> # Same image as the Pod example</span></span>
<span class="line"><span style="color:#22863A">        ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">containerPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">8080</span></span>
<span class="line"><span style="color:#22863A">        env</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">DATABASE_HOST</span></span>
<span class="line"><span style="color:#22863A">          value</span><span style="color:#24292E">: </span><span style="color:#032F62">"acme-webshop-db-service"</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">DATABASE_PORT</span></span>
<span class="line"><span style="color:#22863A">          value</span><span style="color:#24292E">: </span><span style="color:#032F62">"5432"</span></span></code></pre></div></div></div>
<p>Here:</p>
<ul>
<li><code>kind: Deployment</code> indicates a Deployment object.</li>
<li><code>replicas: 3</code> tells Kubernetes to maintain three instances of the Pod.</li>
<li><code>selector</code> specifies how the Deployment finds which Pods to manage. It matches Pods with the <code>app: acme-webshop</code> and <code>tier: backend</code> labels.</li>
<li><code>template</code> defines the Pod specification, which is identical to the standalone Pod definition. The Deployment uses this template to create new Pods.</li>
</ul>
<h3>Services: Enabling Network Access</h3>
<p>While Pods are ephemeral and can be restarted or rescheduled, Services provide a stable network endpoint for accessing a set of Pods. Services enable decoupled communication between different parts of your application and external users.</p>
<ul>
<li><strong>Load Balancing:</strong> Services can distribute network traffic across multiple Pods, acting as a load balancer.</li>
<li><strong>Service Discovery:</strong> Services provide a consistent DNS name that other applications can use to discover and communicate with a set of Pods, regardless of their underlying IP addresses.</li>
<li><strong>Types of Services:</strong>
<ul>
<li><strong>ClusterIP:</strong> Exposes the Service on an internal IP address in the cluster. This type makes the Service only reachable from within the cluster.</li>
<li><strong>NodePort:</strong> Exposes the Service on each Node's IP at a static port (the <code>NodePort</code>). Makes the Service accessible from outside the cluster using <code>&lt;NodeIP&gt;:&lt;NodePort&gt;</code>.</li>
<li><strong>LoadBalancer:</strong> Exposes the Service externally using a cloud provider's load balancer. This allocates an external IP address that acts as the entry point to your Service.</li>
<li><strong>ExternalName:</strong> Maps the Service to the contents of the <code>externalName</code> field (e.g., <code>my.database.example.com</code>) by returning a <code>CNAME</code> record.</li>
</ul>
</li>
</ul>
<p><strong>Example: Acme Webshop Frontend Service</strong></p>
<p>The Acme Webshop frontend might need to be accessible from outside the cluster, possibly via a LoadBalancer Service.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Service</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop-frontend-service</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">    tier</span><span style="color:#24292E">: </span><span style="color:#032F62">frontend</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">    tier</span><span style="color:#24292E">: </span><span style="color:#032F62">frontend</span><span style="color:#6A737D"> # Selects Pods with these labels</span></span>
<span class="line"><span style="color:#22863A">  ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    - </span><span style="color:#22863A">protocol</span><span style="color:#24292E">: </span><span style="color:#032F62">TCP</span></span>
<span class="line"><span style="color:#22863A">      port</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span><span style="color:#6A737D">       # Port the Service exposes</span></span>
<span class="line"><span style="color:#22863A">      targetPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">3000</span><span style="color:#6A737D"> # Port the container listens on</span></span>
<span class="line"><span style="color:#22863A">  type</span><span style="color:#24292E">: </span><span style="color:#032F62">LoadBalancer</span><span style="color:#6A737D"> # Exposes the service using a cloud load balancer</span></span></code></pre></div></div></div>
<p>In this example:</p>
<ul>
<li><code>kind: Service</code> declares a Service object.</li>
<li><code>selector</code> matches Pods with <code>app: acme-webshop</code> and <code>tier: frontend</code> labels.</li>
<li><code>ports</code> defines the network mapping. The Service listens on <code>port: 80</code> and forwards traffic to <code>targetPort: 3000</code> on the selected Pods.</li>
<li><code>type: LoadBalancer</code> automatically provisions an external load balancer in a cloud environment, making the frontend accessible via a public IP.</li>
</ul>
<h3>Namespaces: Logical Isolation</h3>
<p>Namespaces provide a mechanism for isolating groups of resources within a single Kubernetes cluster. This is useful for environments with multiple teams or projects, allowing each to operate in its own virtual cluster.</p>
<ul>
<li><strong>Resource Organization:</strong> Namespaces help organize resources and prevent naming collisions.</li>
<li><strong>Access Control:</strong> You can use Role-Based Access Control (RBAC) to grant specific permissions to users or teams within a namespace, restricting their access to resources in other namespaces.</li>
<li><strong>Resource Quotas:</strong> Namespaces can have resource quotas applied to them, limiting the total CPU and memory that all Pods within that namespace can consume.</li>
</ul>
<p><strong>Example: Acme Webshop Development vs. Production Namespaces</strong></p>
<p>For the Acme Webshop, you might use different namespaces for development, staging, and production environments to keep their resources separate.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Namespace</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop-dev</span></span>
<span class="line"><span style="color:#6F42C1">---</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Namespace</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop-prod</span></span></code></pre></div></div></div>
<p>You would then deploy your application components (Pods, Deployments, Services) into their respective namespaces using the <code>-n</code> or <code>--namespace</code> flag with <code>kubectl</code>.</p>
<h2>kubectl: Interacting with Kubernetes</h2>
<p><code>kubectl</code> is the command-line tool for running commands against Kubernetes clusters. It allows you to deploy applications, inspect and manage cluster resources, and view logs.</p>
<h3>Basic <code>kubectl</code> Commands</h3>
<ul>
<li><strong><code>kubectl apply -f &lt;filename.yaml&gt;</code>:</strong> Creates or updates resources defined in a YAML file. This is how you would deploy your Pods, Deployments, and Services.</li>
<li><strong><code>kubectl get &lt;resource_type&gt;</code>:</strong> Lists resources of a specific type (e.g., <code>kubectl get pods</code>, <code>kubectl get deployments</code>, <code>kubectl get services</code>).</li>
<li><strong><code>kubectl describe &lt;resource_type&gt; &lt;resource_name&gt;</code>:</strong> Shows detailed information about a specific resource.</li>
<li><strong><code>kubectl logs &lt;pod_name&gt;</code>:</strong> Retrieves logs from a container in a Pod.</li>
<li><strong><code>kubectl exec -it &lt;pod_name&gt; -- &lt;command&gt;</code>:</strong> Executes a command inside a container within a Pod.</li>
<li><strong><code>kubectl delete -f &lt;filename.yaml&gt;</code>:</strong> Deletes resources defined in a YAML file.</li>
<li><strong><code>kubectl delete &lt;resource_type&gt; &lt;resource_name&gt;</code>:</strong> Deletes a specific resource.</li>
</ul>
<p><strong>Example Usage with Acme Webshop</strong></p>
<ol>
<li>
<p><strong>Deploying the Acme Webshop Backend Deployment:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#032F62"> apply</span><span style="color:#005CC5"> -f</span><span style="color:#032F62"> acme-webshop-backend-deployment.yaml</span></span></code></pre></div></div></div>
<p>This command reads the <code>acme-webshop-backend-deployment.yaml</code> file (like the one shown above) and creates the Deployment and its associated ReplicaSet and Pods in the cluster.</p>
</li>
<li>
<p><strong>Checking the status of the Deployment and Pods:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#032F62"> get</span><span style="color:#032F62"> deployments</span></span>
<span class="line"><span style="color:#6A737D"># Expected output:</span></span>
<span class="line"><span style="color:#6A737D"># NAME                              READY   UP-TO-DATE   AVAILABLE   AGE</span></span>
<span class="line"><span style="color:#6A737D"># acme-webshop-backend-deployment   3/3     3            3           2m</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#032F62"> get</span><span style="color:#032F62"> pods</span><span style="color:#005CC5"> -l</span><span style="color:#032F62"> app=acme-webshop,tier=backend</span></span>
<span class="line"><span style="color:#6A737D"># Expected output (showing three running Pods):</span></span>
<span class="line"><span style="color:#6A737D"># NAME                                               READY   STATUS    RESTARTS   AGE</span></span>
<span class="line"><span style="color:#6A737D"># acme-webshop-backend-deployment-5b9c7b6d49-abcde   1/1     Running   0          2m</span></span>
<span class="line"><span style="color:#6A737D"># acme-webshop-backend-deployment-5b9c7b6d49-fghij   1/1     Running   0          2m</span></span>
<span class="line"><span style="color:#6A737D"># acme-webshop-backend-deployment-5b9c7b6d49-klmno   1/1     Running   0          2m</span></span></code></pre></div></div></div>
<p>The <code>-l</code> flag filters resources by label, which is useful for focusing on specific application components.</p>
</li>
<li>
<p><strong>Inspecting a specific Pod:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#032F62"> describe</span><span style="color:#032F62"> pod</span><span style="color:#032F62"> acme-webshop-backend-deployment-5b9c7b6d49-abcde</span></span></code></pre></div></div></div>
<p>This command provides extensive details, including events, container status, and resource usage.</p>
</li>
<li>
<p><strong>Accessing logs from a Pod:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#032F62"> logs</span><span style="color:#032F62"> acme-webshop-backend-deployment-5b9c7b6d49-abcde</span></span></code></pre></div></div></div>
<p>This shows the standard output and error streams from the application running inside the container.</p>
</li>
</ol>
<h2>Practical Examples and Demonstrations</h2>
<p>Let's walk through a complete example of deploying a simple web application using Kubernetes. We'll use a placeholder <code>hello-world</code> application to demonstrate the workflow before applying it to the Acme Webshop in the next lesson.</p>
<h3>Scenario: Deploying a <code>hello-world</code> Nginx application</h3>
<p>We want to deploy a basic Nginx web server that says "hello world" and expose it to the internet.</p>
<ol>
<li>
<p><strong>Define the Deployment:</strong> This will create Pods running the Nginx image.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># hello-nginx-deployment.yaml</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">apps/v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Deployment</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">hello-nginx-deployment</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">hello-nginx</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  replicas</span><span style="color:#24292E">: </span><span style="color:#005CC5">2</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    matchLabels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      app</span><span style="color:#24292E">: </span><span style="color:#032F62">hello-nginx</span></span>
<span class="line"><span style="color:#22863A">  template</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">        app</span><span style="color:#24292E">: </span><span style="color:#032F62">hello-nginx</span></span>
<span class="line"><span style="color:#22863A">    spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      containers</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">nginx</span></span>
<span class="line"><span style="color:#22863A">        image</span><span style="color:#24292E">: </span><span style="color:#032F62">nginx:latest</span></span>
<span class="line"><span style="color:#22863A">        ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">containerPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span>
<span class="line"><span style="color:#22863A">        volumeMounts</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">config-volume</span></span>
<span class="line"><span style="color:#22863A">          mountPath</span><span style="color:#24292E">: </span><span style="color:#032F62">/etc/nginx/conf.d</span></span>
<span class="line"><span style="color:#22863A">      volumes</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">config-volume</span></span>
<span class="line"><span style="color:#22863A">        configMap</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">          name</span><span style="color:#24292E">: </span><span style="color:#032F62">nginx-config</span></span></code></pre></div></div></div>
<p><em>Explanation:</em> This Deployment creates two replicas of an Nginx Pod. It mounts a <code>ConfigMap</code> named <code>nginx-config</code> (which we will define next) to provide a custom Nginx configuration.</p>
</li>
<li>
<p><strong>Define a ConfigMap for Nginx:</strong> This will hold our custom Nginx configuration to serve a "hello world" page.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># nginx-configmap.yaml</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">ConfigMap</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">nginx-config</span></span>
<span class="line"><span style="color:#22863A">data</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  default.conf</span><span style="color:#24292E">: </span><span style="color:#D73A49">|</span></span>
<span class="line"><span style="color:#032F62">    server {</span></span>
<span class="line"><span style="color:#032F62">      listen 80;</span></span>
<span class="line"><span style="color:#032F62">      location / {</span></span>
<span class="line"><span style="color:#032F62">        return 200 "Hello from Kubernetes! - Nginx Pod: $hostname\n";</span></span>
<span class="line"><span style="color:#032F62">        add_header Content-Type text/plain;</span></span>
<span class="line"><span style="color:#032F62">      }</span></span>
<span class="line"><span style="color:#032F62">    }</span></span></code></pre></div></div></div>
<p><em>Explanation:</em> This <code>ConfigMap</code> creates a file named <code>default.conf</code> with Nginx configuration. The <code>$hostname</code> variable will show which specific Pod is serving the request.</p>
</li>
<li>
<p><strong>Define a Service to expose Nginx:</strong> This will expose the <code>hello-nginx</code> application externally.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># hello-nginx-service.yaml</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Service</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">hello-nginx-service</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">hello-nginx</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">hello-nginx</span></span>
<span class="line"><span style="color:#22863A">  ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">  - </span><span style="color:#22863A">protocol</span><span style="color:#24292E">: </span><span style="color:#032F62">TCP</span></span>
<span class="line"><span style="color:#22863A">    port</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span>
<span class="line"><span style="color:#22863A">    targetPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span>
<span class="line"><span style="color:#22863A">  type</span><span style="color:#24292E">: </span><span style="color:#032F62">LoadBalancer</span><span style="color:#6A737D"> # Or NodePort if no cloud load balancer is available</span></span></code></pre></div></div></div>
<p><em>Explanation:</em> This <code>Service</code> targets Pods with the <code>app: hello-nginx</code> label and exposes them on port 80. By using <code>type: LoadBalancer</code>, a cloud provider's load balancer will be provisioned to route external traffic to our Nginx Pods.</p>
</li>
</ol>
<h3>Deployment Steps:</h3>
<ol>
<li>
<p><strong>Create the ConfigMap:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#032F62"> apply</span><span style="color:#005CC5"> -f</span><span style="color:#032F62"> nginx-configmap.yaml</span></span></code></pre></div></div></div>
<p>Verify: <code>kubectl get configmaps</code></p>
</li>
<li>
<p><strong>Create the Deployment:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#032F62"> apply</span><span style="color:#005CC5"> -f</span><span style="color:#032F62"> hello-nginx-deployment.yaml</span></span></code></pre></div></div></div>
<p>Verify: <code>kubectl get deployments</code>, <code>kubectl get replicasets</code>, <code>kubectl get pods -l app=hello-nginx</code></p>
</li>
<li>
<p><strong>Create the Service:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">kubectl</span><span style="color:#032F62"> apply</span><span style="color:#005CC5"> -f</span><span style="color:#032F62"> hello-nginx-service.yaml</span></span></code></pre></div></div></div>
<p>Verify: <code>kubectl get services</code> and look for the <code>EXTERNAL-IP</code> for <code>hello-nginx-service</code>. It might take a minute or two for the cloud provider to provision the load balancer.</p>
</li>
<li>
<p><strong>Access the application:</strong> Once the <code>EXTERNAL-IP</code> is available for <code>hello-nginx-service</code>, open your web browser to <code>http://&lt;EXTERNAL-IP&gt;</code>. You should see "Hello from Kubernetes! - Nginx Pod: &lt;pod-name&gt;". Refreshing the page might show different Pod names, demonstrating the load balancing.</p>
</li>
</ol>
<h2>Exercises</h2>
<ol>
<li>
<p><strong>Inspect Your Cluster:</strong></p>
<ul>
<li>After deploying the <code>hello-nginx</code> application, use <code>kubectl get all</code> to see a summary of all resources you've created.</li>
<li>Use <code>kubectl describe service hello-nginx-service</code> and <code>kubectl describe deployment hello-nginx-deployment</code> to understand the detailed state and events of these resources.</li>
<li>Try <code>kubectl logs &lt;name-of-one-of-your-nginx-pods&gt;</code> to see the access logs from Nginx.</li>
</ul>
</li>
<li>
<p><strong>Scale the Application:</strong></p>
<ul>
<li>Modify the <code>hello-nginx-deployment.yaml</code> file to change the <code>replicas</code> count from 2 to 5.</li>
<li>Apply the changes using <code>kubectl apply -f hello-nginx-deployment.yaml</code>.</li>
<li>Verify that 5 Pods are now running using <code>kubectl get pods -l app=hello-nginx</code>.</li>
<li>Observe how Kubernetes automatically scales up the number of running Pods.</li>
</ul>
</li>
<li>
<p><strong>Simulate a Pod Failure:</strong></p>
<ul>
<li>Identify one of the <code>hello-nginx</code> Pods using <code>kubectl get pods -l app=hello-nginx</code>.</li>
<li>Forcefully delete one of the Pods using <code>kubectl delete pod &lt;name-of-one-of-your-nginx-pods&gt;</code>.</li>
<li>Immediately run <code>kubectl get pods -l app=hello-nginx</code> again. Observe that Kubernetes quickly replaces the deleted Pod to maintain the desired replica count. This demonstrates Kubernetes' self-healing capabilities.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-4.5">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Deploying Containerized Applications to Kubernetes using Jenkins</h1><p>Deploying containerized applications to Kubernetes using Jenkins involves extending the CI/CD pipeline to interact with a Kubernetes cluster. This process typically includes building Docker images, pushing them to a container registry, and then using Jenkins to apply Kubernetes manifests or Helm charts to deploy and manage the application within the cluster. This allows for automated, consistent, and scalable deployments of microservices and other containerized workloads.</p>
<h2>Integrating Kubernetes Deployment into Jenkins Pipelines</h2>
<p>Integrating Kubernetes deployment into a Jenkins pipeline requires Jenkins to have the necessary credentials and tools to communicate with a Kubernetes cluster. This often involves using Kubernetes-specific Jenkins plugins, <code>kubectl</code> CLI commands, or Helm commands directly within the pipeline script. The pipeline steps typically include authenticating with the cluster, applying deployment configurations, and verifying the deployment status.</p>
<h3>Authenticating Jenkins with Kubernetes</h3>
<p>Jenkins needs a secure way to authenticate with the Kubernetes cluster. The most common and recommended approach is using a Kubernetes Service Account. A Service Account provides an identity for processes running in pods and can be configured with specific permissions (RBAC roles) to interact with the Kubernetes API.</p>
<ul>
<li>
<p><strong>Using a Service Account within a Pod:</strong> If Jenkins itself is running inside a Kubernetes cluster, its pod can be configured to use a Service Account. The <code>kubectl</code> command-line tool, when run within such a pod, automatically uses the pod's Service Account for authentication. This simplifies authentication as no explicit credentials need to be stored or managed by Jenkins.</p>
<p><em>Example Scenario:</em> The Acme Webshop's Jenkins instance runs as a pod within the same Kubernetes cluster where the <code>acme-frontend</code> and <code>acme-backend</code> services will be deployed. The Jenkins pod is configured with a Service Account named <code>jenkins-deployer</code> which has permissions to create, update, and delete Deployments, Services, and Ingress resources in the <code>acme-webshop</code> namespace. When the Jenkins pipeline executes <code>kubectl apply -f deployment.yaml</code>, it automatically authenticates using the <code>jenkins-deployer</code> Service Account.</p>
</li>
<li>
<p><strong>Using Kubeconfig File (for external Jenkins):</strong> If Jenkins runs outside the Kubernetes cluster (e.g., on a dedicated VM), a <code>kubeconfig</code> file containing user credentials (like client certificates, tokens, or <code>kubectl</code> context information) is required. This file must be securely stored in Jenkins, typically as a Kubernetes credential in the Jenkins Credentials Plugin, and then referenced in the pipeline.</p>
<p><em>Example Scenario:</em> A legacy Jenkins instance running on an on-premises server needs to deploy the Acme Webshop application to a cloud-hosted Kubernetes cluster. A <code>kubeconfig</code> file is generated for a dedicated user with appropriate RBAC permissions. This <code>kubeconfig</code> file is then stored as a secret in Jenkins. The pipeline script would copy this <code>kubeconfig</code> to the build agent's workspace and configure the <code>KUBECONFIG</code> environment variable before executing <code>kubectl</code> commands.</p>
</li>
</ul>
<h3>Deploying Kubernetes Manifests</h3>
<p>Kubernetes manifests are YAML or JSON files that describe the desired state of your application within the cluster. These files define resources like Deployments, Services, ConfigMaps, Secrets, and Ingresses. The Jenkins pipeline applies these manifests to the Kubernetes cluster using <code>kubectl apply</code>.</p>
<ul>
<li>
<p><strong>Applying a Deployment and Service:</strong> A typical deployment involves a <code>Deployment</code> resource to manage your application's pods and a <code>Service</code> resource to expose your application within the cluster.</p>
<p><em>Basic Example (Acme Webshop Frontend):</em>
Imagine we have the <code>acme-frontend</code> Docker image built and pushed to a registry from a previous pipeline step (as covered in "Integrating Docker Image Builds into Jenkins Pipelines"). The following <code>acme-frontend-deployment.yaml</code> and <code>acme-frontend-service.yaml</code> define its deployment:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># acme-frontend-deployment.yaml</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">apps/v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Deployment</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-frontend</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-frontend</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  replicas</span><span style="color:#24292E">: </span><span style="color:#005CC5">3</span><span style="color:#6A737D"> # Maintain 3 instances of the frontend</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    matchLabels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-frontend</span></span>
<span class="line"><span style="color:#22863A">  template</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">        app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-frontend</span></span>
<span class="line"><span style="color:#22863A">    spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      containers</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">frontend-container</span></span>
<span class="line"><span style="color:#22863A">        image</span><span style="color:#24292E">: </span><span style="color:#032F62">your_registry/acme-frontend:latest</span><span style="color:#6A737D"> # Image from previous pipeline step</span></span>
<span class="line"><span style="color:#22863A">        ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">containerPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span>
<span class="line"><span style="color:#22863A">        env</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">API_URL</span></span>
<span class="line"><span style="color:#22863A">          value</span><span style="color:#24292E">: </span><span style="color:#032F62">"http://acme-backend-service:8080"</span><span style="color:#6A737D"> # Assumes backend service</span></span>
<span class="line"><span style="color:#6F42C1">---</span></span>
<span class="line"><span style="color:#6A737D"># acme-frontend-service.yaml</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Service</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-frontend-service</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-frontend</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-frontend</span></span>
<span class="line"><span style="color:#22863A">  ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">  - </span><span style="color:#22863A">protocol</span><span style="color:#24292E">: </span><span style="color:#032F62">TCP</span></span>
<span class="line"><span style="color:#22863A">    port</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span>
<span class="line"><span style="color:#22863A">    targetPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span>
<span class="line"><span style="color:#22863A">  type</span><span style="color:#24292E">: </span><span style="color:#032F62">ClusterIP</span><span style="color:#6A737D"> # Internal service within the cluster</span></span></code></pre></div></div></div>
<p>The Jenkins pipeline stage would then look like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Deploy to Kubernetes'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        script {</span></span>
<span class="line"><span style="color:#6A737D">            // Assuming Kubernetes credentials are set up for kubectl to work</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'kubectl apply -f k8s/acme-frontend-deployment.yaml'</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'kubectl apply -f k8s/acme-frontend-service.yaml'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><em>Advanced Example (Using <code>kustomize</code> for environment-specific manifests):</em>
For more complex applications or multiple environments (dev, staging, production), <code>kustomize</code> allows customizing Kubernetes manifests without templating. This is particularly useful for applying different configurations (e.g., replica counts, image tags, environment variables) based on the target environment.</p>
<p>Consider the Acme Webshop application has different configurations for development and production environments.</p>
<ul>
<li><code>base/deployment.yaml</code>: Defines the common deployment structure.</li>
<li><code>overlays/dev/kustomization.yaml</code>: Customizes for dev (e.g., 1 replica, <code>latest</code> image tag).</li>
<li><code>overlays/prod/kustomization.yaml</code>: Customizes for prod (e.g., 5 replicas, specific image tag).</li>
</ul>
<p>The Jenkins pipeline could dynamically select the overlay based on a build parameter:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Example kustomization.yaml for dev environment</span></span>
<span class="line"><span style="color:#24292E"># overlays</span><span style="color:#032F62">/dev/</span><span style="color:#24292E">kustomization</span><span style="color:#D73A49">.</span><span style="color:#24292E">yaml</span></span>
<span class="line"><span style="color:#005CC5">apiVersion</span><span style="color:#24292E">: kustomize</span><span style="color:#D73A49">.</span><span style="color:#24292E">config</span><span style="color:#D73A49">.</span><span style="color:#24292E">k8s</span><span style="color:#D73A49">.</span><span style="color:#24292E">io</span><span style="color:#D73A49">/</span><span style="color:#24292E">v1beta1</span></span>
<span class="line"><span style="color:#005CC5">kind</span><span style="color:#24292E">: </span><span style="color:#D73A49">Kustomization</span></span>
<span class="line"><span style="color:#005CC5">resources</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#D73A49">-</span><span style="color:#D73A49"> ..</span><span style="color:#032F62">/../</span><span style="color:#24292E">base # </span><span style="color:#D73A49">Reference</span><span style="color:#24292E"> to common base manifests</span></span>
<span class="line"><span style="color:#005CC5">patches</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#D73A49">-</span><span style="color:#005CC5"> target</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#005CC5">    kind</span><span style="color:#24292E">: </span><span style="color:#D73A49">Deployment</span></span>
<span class="line"><span style="color:#005CC5">    name</span><span style="color:#24292E">: acme</span><span style="color:#D73A49">-</span><span style="color:#24292E">frontend</span></span>
<span class="line"><span style="color:#005CC5">  patch</span><span style="color:#24292E">: |</span><span style="color:#D73A49">-</span></span>
<span class="line"><span style="color:#D73A49">    -</span><span style="color:#005CC5"> op</span><span style="color:#24292E">: replace</span></span>
<span class="line"><span style="color:#005CC5">      path</span><span style="color:#24292E">: </span><span style="color:#032F62">/spec/</span><span style="color:#24292E">replicas</span></span>
<span class="line"><span style="color:#005CC5">      value</span><span style="color:#24292E">: </span><span style="color:#005CC5">1</span></span>
<span class="line"><span style="color:#D73A49">    -</span><span style="color:#005CC5"> op</span><span style="color:#24292E">: replace</span></span>
<span class="line"><span style="color:#005CC5">      path</span><span style="color:#24292E">: </span><span style="color:#032F62">/spec/</span><span style="color:#24292E">template</span><span style="color:#032F62">/spec/</span><span style="color:#24292E">containers</span><span style="color:#032F62">/0/</span><span style="color:#24292E">image</span></span>
<span class="line"><span style="color:#005CC5">      value</span><span style="color:#24292E">: your_registry</span><span style="color:#D73A49">/</span><span style="color:#24292E">acme</span><span style="color:#D73A49">-</span><span style="color:#005CC5">frontend</span><span style="color:#24292E">:dev</span><span style="color:#D73A49">-</span><span style="color:#24292E">latest</span></span></code></pre></div></div></div>
<p>Jenkins pipeline stage:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Deploy to Kubernetes with Kustomize'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        script {</span></span>
<span class="line"><span style="color:#D73A49">            def</span><span style="color:#24292E"> environment </span><span style="color:#D73A49">=</span><span style="color:#24292E"> params</span><span style="color:#D73A49">.</span><span style="color:#005CC5">ENVIRONMENT</span><span style="color:#6A737D"> // Assuming a parameterized build</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">"kubectl apply -k k8s/overlays/${environment}"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
</ul>
<h3>Using Helm for Package Management</h3>
<p>Helm is a package manager for Kubernetes that simplifies the definition, installation, and upgrade of complex Kubernetes applications. It uses "charts," which are collections of pre-configured Kubernetes resources.</p>
<ul>
<li>
<p><strong>Helm Chart Structure:</strong> A Helm chart typically contains a <code>Chart.yaml</code> file (metadata), <code>values.yaml</code> (default configuration values), and <code>templates/</code> directory (Kubernetes manifests with templating).</p>
<p><em>Example Helm Chart for Acme Webshop:</em></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">javascript</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">acme</span><span style="color:#D73A49">-</span><span style="color:#24292E">webshop</span><span style="color:#D73A49">/</span></span>
<span class="line"><span style="color:#24292E">├── Chart.yaml</span></span>
<span class="line"><span style="color:#24292E">├── values.yaml</span></span>
<span class="line"><span style="color:#24292E">└── templates</span><span style="color:#D73A49">/</span></span>
<span class="line"><span style="color:#24292E">    ├── deployment.yaml</span></span>
<span class="line"><span style="color:#24292E">    ├── service.yaml</span></span>
<span class="line"><span style="color:#24292E">    └── _helpers.tpl</span></span></code></pre></div></div></div>
<p><code>values.yaml</code> might look like:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># acme-webshop/values.yaml</span></span>
<span class="line"><span style="color:#22863A">replicaCount</span><span style="color:#24292E">: </span><span style="color:#005CC5">3</span></span>
<span class="line"><span style="color:#22863A">image</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  repository</span><span style="color:#24292E">: </span><span style="color:#032F62">your_registry/acme-frontend</span></span>
<span class="line"><span style="color:#22863A">  tag</span><span style="color:#24292E">: </span><span style="color:#032F62">latest</span></span>
<span class="line"><span style="color:#22863A">  pullPolicy</span><span style="color:#24292E">: </span><span style="color:#032F62">IfNotPresent</span></span>
<span class="line"><span style="color:#22863A">service</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  type</span><span style="color:#24292E">: </span><span style="color:#032F62">ClusterIP</span></span>
<span class="line"><span style="color:#22863A">  port</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span></code></pre></div></div></div>
<p><code>templates/deployment.yaml</code> would use these values:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># acme-webshop/templates/deployment.yaml</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">apps/v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Deployment</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: {{ </span><span style="color:#032F62">include "acme-webshop.fullname" .</span><span style="color:#24292E"> }}</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    {{- </span><span style="color:#032F62">include "acme-webshop.labels" . | nindent 4</span><span style="color:#24292E"> }}</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  replicas</span><span style="color:#24292E">: {{ </span><span style="color:#032F62">.Values.replicaCount</span><span style="color:#24292E"> }}</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    matchLabels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      {{- </span><span style="color:#032F62">include "acme-webshop.selectorLabels" . | nindent 6</span><span style="color:#24292E"> }}</span></span>
<span class="line"><span style="color:#22863A">  template</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        {{- </span><span style="color:#032F62">include "acme-webshop.selectorLabels" . | nindent 8</span><span style="color:#24292E"> }}</span></span>
<span class="line"><span style="color:#22863A">    spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      containers</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">name</span><span style="color:#24292E">: {{ </span><span style="color:#032F62">.Chart.Name</span><span style="color:#24292E"> }}</span></span>
<span class="line"><span style="color:#22863A">          image</span><span style="color:#24292E">: </span><span style="color:#032F62">"{{ .Values.image.repository }}:{{ .Values.image.tag }}"</span></span>
<span class="line"><span style="color:#22863A">          imagePullPolicy</span><span style="color:#24292E">: {{ </span><span style="color:#032F62">.Values.image.pullPolicy</span><span style="color:#24292E"> }}</span></span>
<span class="line"><span style="color:#22863A">          ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">            - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">http</span></span>
<span class="line"><span style="color:#22863A">              containerPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span>
<span class="line"><span style="color:#22863A">              protocol</span><span style="color:#24292E">: </span><span style="color:#032F62">TCP</span></span></code></pre></div></div></div>
</li>
<li>
<p><strong>Deploying with Helm in Jenkins:</strong> The Jenkins pipeline can use the <code>helm</code> CLI to install or upgrade charts.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Deploy with Helm'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        script {</span></span>
<span class="line"><span style="color:#6A737D">            // Install/upgrade the Helm chart, overriding image tag with the built image</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">"helm upgrade --install acme-frontend ./acme-webshop "</span><span style="color:#D73A49"> +</span></span>
<span class="line"><span style="color:#032F62">               "--set image.tag=${env.BUILD_NUMBER} "</span><span style="color:#D73A49"> +</span><span style="color:#6A737D"> // Use Jenkins build number as image tag</span></span>
<span class="line"><span style="color:#032F62">               "--namespace acme-webshop --create-namespace"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><em>Hypothetical Scenario:</em> An organization needs to deploy multiple microservices (e.g., <code>product-catalog</code>, <code>order-service</code>, <code>user-profile</code>) for their e-commerce platform. Each microservice has its own Helm chart. A single Jenkins pipeline could be triggered to build all images, push them, and then use Helm to deploy all services to Kubernetes. Helm's ability to manage releases (install, upgrade, rollback) simplifies the lifecycle management of these interconnected services. For example, a <code>helm rollback acme-frontend 1</code> command could revert the <code>acme-frontend</code> service to its previous stable version if an issue is detected after deployment.</p>
</li>
</ul>
<h2>Post-Deployment Verification</h2>
<p>After deploying an application to Kubernetes, it is crucial to verify that the deployment was successful and the application is running as expected. This step ensures that the new version is stable before proceeding further (e.g., promoting to production).</p>
<ul>
<li>
<p><strong>Checking Deployment Status:</strong> <code>kubectl rollout status</code> can be used to wait for a deployment to complete successfully.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Verify Deployment'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        script {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Waiting for acme-frontend deployment to rollout..."</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'kubectl rollout status deployment/acme-frontend --namespace acme-webshop --timeout=5m'</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Deployment acme-frontend rolled out successfully."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
<li>
<p><strong>Basic Health Checks:</strong> Once the deployment is stable, the pipeline can perform basic checks, such as ensuring the service is reachable or making a simple HTTP request to the application's endpoint.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'Health Check'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        script {</span></span>
<span class="line"><span style="color:#6A737D">            // Assuming an Ingress or LoadBalancer is set up to expose the service</span></span>
<span class="line"><span style="color:#6A737D">            // For internal cluster check, could use 'kubectl port-forward' or similar</span></span>
<span class="line"><span style="color:#6A737D">            // For a simple test, we might wait for the Service to get an external IP or check the internal ClusterIP.</span></span>
<span class="line"><span style="color:#6A737D">            // For this example, let's assume an Ingress is available at a known URL.</span></span>
<span class="line"><span style="color:#D73A49">            def</span><span style="color:#24292E"> appUrl </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "http://acme-webshop.example.com"</span><span style="color:#6A737D"> // Replace with actual URL</span></span>
<span class="line"><span style="color:#24292E">            retry(</span><span style="color:#005CC5">5</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Retry up to 5 times</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">"curl -f ${appUrl}/health"</span><span style="color:#6A737D"> // Checks for HTTP 2xx status</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Application health check passed."</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
</li>
</ul>
<h2>Jenkinsfile for Kubernetes Deployment</h2>
<p>Combining the previous steps into a complete Jenkinsfile for the Acme Webshop frontend application:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop Frontend CI/CD to Kubernetes</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent {</span></span>
<span class="line"><span style="color:#24292E">        kubernetes {</span></span>
<span class="line"><span style="color:#6A737D">            // Assumes a Jenkins agent image with Docker, kubectl, and Helm installed</span></span>
<span class="line"><span style="color:#6A737D">            // This agent should have the appropriate Service Account permissions for Kubernetes deployment</span></span>
<span class="line"><span style="color:#24292E">            containerTemplate {</span></span>
<span class="line"><span style="color:#24292E">                name </span><span style="color:#032F62">'jnlp'</span></span>
<span class="line"><span style="color:#24292E">                image </span><span style="color:#032F62">'jenkins/jnlp-slave:latest'</span></span>
<span class="line"><span style="color:#24292E">                ttyEnabled </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">                command </span><span style="color:#032F62">'cat'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            containerTemplate {</span></span>
<span class="line"><span style="color:#24292E">                name </span><span style="color:#032F62">'docker'</span></span>
<span class="line"><span style="color:#24292E">                image </span><span style="color:#032F62">'docker:dind'</span><span style="color:#6A737D"> // Docker in Docker for building images</span></span>
<span class="line"><span style="color:#24292E">                privileged </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">                args </span><span style="color:#032F62">'--storage-driver=overlay2'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            defaultContainer </span><span style="color:#032F62">'jnlp'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    environment {</span></span>
<span class="line"><span style="color:#6A737D">        // Replace with your actual Docker registry</span></span>
<span class="line"><span style="color:#005CC5">        DOCKER_REGISTRY</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'your_registry'</span></span>
<span class="line"><span style="color:#005CC5">        IMAGE_NAME</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'acme-frontend'</span></span>
<span class="line"><span style="color:#005CC5">        K8S_NAMESPACE</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'acme-webshop'</span></span>
<span class="line"><span style="color:#005CC5">        HELM_CHART_PATH</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'helm/acme-webshop-frontend'</span><span style="color:#6A737D"> // Path to your Helm chart</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout Source'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/your-org/acme-webshop-frontend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent {</span></span>
<span class="line"><span style="color:#24292E">                container </span><span style="color:#032F62">'docker'</span><span style="color:#6A737D"> // Use the Docker in Docker container for this stage</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker build -t ${DOCKER_REGISTRY}/${IMAGE_NAME}:${env.BUILD_NUMBER} ."</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Push Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent {</span></span>
<span class="line"><span style="color:#24292E">                container </span><span style="color:#032F62">'docker'</span><span style="color:#6A737D"> // Use the Docker in Docker container</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Authenticate with Docker registry (using Jenkins credentials)</span></span>
<span class="line"><span style="color:#24292E">                    withCredentials([usernamePassword(</span><span style="color:#005CC5">credentialsId</span><span style="color:#24292E">: </span><span style="color:#032F62">'docker-registry-credentials'</span><span style="color:#24292E">, </span><span style="color:#005CC5">usernameVariable</span><span style="color:#24292E">: </span><span style="color:#032F62">'DOCKER_USER'</span><span style="color:#24292E">, </span><span style="color:#005CC5">passwordVariable</span><span style="color:#24292E">: </span><span style="color:#032F62">'DOCKER_PASS'</span><span style="color:#24292E">)]) {</span></span>
<span class="line"><span style="color:#24292E">                        sh </span><span style="color:#032F62">"echo ${DOCKER_PASS} | docker login -u ${DOCKER_USER} --password-stdin ${DOCKER_REGISTRY}"</span></span>
<span class="line"><span style="color:#24292E">                        sh </span><span style="color:#032F62">"docker push ${DOCKER_REGISTRY}/${IMAGE_NAME}:${env.BUILD_NUMBER}"</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Kubernetes'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Create namespace if it doesn't exist</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"kubectl create namespace ${K8S_NAMESPACE} --dry-run=client -o yaml | kubectl apply -f -"</span></span>
<span class="line"><span style="color:#6A737D">                    // Deploy using Helm</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"helm upgrade --install ${IMAGE_NAME} ${HELM_CHART_PATH} "</span><span style="color:#D73A49"> +</span></span>
<span class="line"><span style="color:#032F62">                       "--namespace ${K8S_NAMESPACE} "</span><span style="color:#D73A49"> +</span></span>
<span class="line"><span style="color:#032F62">                       "--set image.repository=${DOCKER_REGISTRY}/${IMAGE_NAME} "</span><span style="color:#D73A49"> +</span></span>
<span class="line"><span style="color:#032F62">                       "--set image.tag=${env.BUILD_NUMBER}"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // Or deploy using kubectl apply with manifests:</span></span>
<span class="line"><span style="color:#6A737D">                    // sh "kubectl apply -f k8s/deployment.yaml -f k8s/service.yaml --namespace ${K8S_NAMESPACE}"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Verify Deployment Rollout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Waiting for ${IMAGE_NAME} deployment to rollout..."</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"kubectl rollout status deployment/${IMAGE_NAME} --namespace ${K8S_NAMESPACE} --timeout=5m"</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Deployment ${IMAGE_NAME} rolled out successfully."</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Application Health Check'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // In a real scenario, you would query the Kubernetes service's external IP or Ingress URL.</span></span>
<span class="line"><span style="color:#6A737D">                    // For a simple internal cluster check, you might need more advanced network access or a test pod.</span></span>
<span class="line"><span style="color:#6A737D">                    // This is a placeholder for a more robust external health check.</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Skipping external health check for simplicity. In a real scenario, this would check application endpoint."</span></span>
<span class="line"><span style="color:#6A737D">                    // Example if an Ingress provides an external URL:</span></span>
<span class="line"><span style="color:#6A737D">                    // def ingressHost = sh(returnStdout: true, script: "kubectl get ingress acme-frontend-ingress -n ${K8S_NAMESPACE} -o jsonpath='{.status.loadBalancer.ingress[0].hostname}'").trim()</span></span>
<span class="line"><span style="color:#6A737D">                    // sh "curl -f http://${ingressHost}/health"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            cleanWs() </span><span style="color:#6A737D">// Clean up workspace after build</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Pipeline failed! Check logs for details."</span></span>
<span class="line"><span style="color:#6A737D">            // Optionally notify teams</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Pipeline completed successfully!"</span></span>
<span class="line"><span style="color:#6A737D">            // Optionally notify teams</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This Jenkinsfile demonstrates a full pipeline: checking out code, building a Docker image, pushing it to a registry, and finally deploying it to Kubernetes using Helm. It also includes basic post-deployment verification.</p>
<h2>Exercises and Practice Activities</h2>
<ol>
<li>
<p><strong>Refactor Acme Webshop Backend Deployment:</strong></p>
<ul>
<li>Take the <code>acme-backend</code> application (you would have worked with its Dockerfile in "Containerizing the 'Acme Webshop' Application for Portability") and create Kubernetes Deployment and Service YAML manifests for it. Ensure the <code>Deployment</code> resource uses an environment variable for a database connection string (e.g., <code>DB_HOST</code>).</li>
<li>Create a Jenkins pipeline stage that applies these manifests to your Kubernetes cluster.</li>
<li>Add a <code>kubectl rollout status</code> command to verify the <code>acme-backend</code> deployment.</li>
</ul>
</li>
<li>
<p><strong>Parameterize Image Tag for Rollback:</strong></p>
<ul>
<li>Modify the provided Jenkinsfile to allow for a parameterized build where the <code>IMAGE_TAG</code> can be specified. If not specified, default to <code>env.BUILD_NUMBER</code>.</li>
<li>Explain how this parameterization would facilitate rolling back to a previous image version in Kubernetes by triggering the Jenkins pipeline with an older image tag.</li>
</ul>
</li>
<li>
<p><strong>Helm Chart Customization for Environments:</strong></p>
<ul>
<li>Expand the <code>acme-webshop-frontend</code> Helm chart by adding configuration for an <code>Ingress</code> resource in its <code>templates</code> directory. The Ingress should expose the <code>acme-frontend-service</code> with a host based on a <code>values.yaml</code> entry (e.g., <code>ingress.host</code>).</li>
<li>Create <code>values-dev.yaml</code> and <code>values-prod.yaml</code> files. In <code>values-dev.yaml</code>, set <code>replicaCount</code> to 1 and <code>ingress.host</code> to <code>dev.acme-webshop.example.com</code>. In <code>values-prod.yaml</code>, set <code>replicaCount</code> to 5 and <code>ingress.host</code> to <code>acme-webshop.example.com</code>.</li>
<li>Modify the Jenkins pipeline's <code>Deploy to Kubernetes</code> stage to accept a <code>ENVIRONMENT</code> parameter (<code>dev</code> or <code>prod</code>) and use <code>helm upgrade --install -f values-${params.ENVIRONMENT}.yaml ...</code> to deploy environment-specific configurations.</li>
</ul>
</li>
</ol>
<h2>Real-World Application</h2>
<p>In a real-world enterprise, deploying containerized applications to Kubernetes with Jenkins is a cornerstone of modern CI/CD.</p>
<ul>
<li>
<p><strong>Financial Services Firm:</strong> A large financial institution uses Jenkins to automate the deployment of dozens of microservices that power its trading platform. Each microservice (e.g., <code>trade-execution-service</code>, <code>market-data-ingestion</code>) has its own Jenkins pipeline. When a developer commits code, Jenkins builds a Docker image, runs extensive tests, and then uses Helm to deploy the new version to a staging Kubernetes cluster. Automated integration tests run against this staging environment. If all tests pass, the same Helm chart, with production-specific values, is then deployed to the production Kubernetes cluster, often using a blue/green or canary deployment strategy managed by Helm and Kubernetes features. This ensures high availability and rapid feature delivery while maintaining regulatory compliance through strict versioning and audit trails.</p>
</li>
<li>
<p><strong>E-commerce Giant:</strong> An e-commerce company like Acme Webshop uses this approach to manage its rapidly evolving online store. The <code>product-catalog</code>, <code>shopping-cart</code>, <code>checkout</code>, and <code>user-authentication</code> services are all containerized and deployed to Kubernetes. Jenkins pipelines are configured for each service. When a new feature is developed for the <code>shopping-cart</code> service, Jenkins automatically builds the Docker image, pushes it to a private container registry, and then uses a custom Helm chart to deploy it to a dedicated Kubernetes namespace for testing. Once validated, the pipeline automatically promotes the Helm release to the production Kubernetes cluster during off-peak hours, ensuring minimal disruption to customers. This allows the company to deploy new features and bug fixes multiple times a day.</p>
</li>
</ul>
  
</div>

<div id="chapter-4.6">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Managing Container Registries and Image Versioning</h1><p>Containerization provides portability for applications, but managing the created images and distributing them efficiently across various environments requires a robust system. This involves understanding how container images are stored, organized, and versioned in registries, which are central repositories for these images. Effective management of these registries and their contents is crucial for maintaining consistent and reproducible CI/CD pipelines.</p>
<h2>Understanding Container Registries</h2>
<p>Container registries serve as centralized storage and distribution points for Docker images. They function similarly to package repositories for programming languages (e.g., Maven Central for Java, npm for Node.js, PyPI for Python), providing a catalog of images that can be pulled by container runtimes like Docker or orchestrated by systems like Kubernetes. Registries ensure that all environments, from development to production, use the same verified image for a given application or service.</p>
<p>There are primarily two types of container registries:</p>
<h3>Public Registries</h3>
<p>Public registries are open to anyone and host a vast collection of official and community-contributed images. These are often used for base images (like Alpine, Ubuntu, Node.js) or popular open-source applications.</p>
<ul>
<li><strong>Docker Hub:</strong> The most well-known public registry, owned by Docker Inc. It hosts millions of images, including official images maintained by vendors and community images. For instance, the <code>nginx</code> official image can be pulled directly from Docker Hub.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">docker</span><span style="color:#032F62"> pull</span><span style="color:#032F62"> nginx:latest</span></span></code></pre></div></div></div>
This command fetches the latest NGINX image from Docker Hub.</li>
<li><strong>Quay.io:</strong> Another popular public registry, now owned by Red Hat. Quay.io is known for its security scanning features and robust access control. While it offers private repositories, its public repository hosts many open-source projects.</li>
</ul>
<h3>Private Registries</h3>
<p>Private registries provide a secure and controlled environment for storing proprietary application images. Companies use private registries to ensure that their internal application images are not publicly accessible and can be managed with specific access policies, often integrated with their existing authentication systems.</p>
<ul>
<li><strong>Cloud Provider Registries:</strong> Major cloud providers offer their own managed private registries, which integrate seamlessly with their ecosystem.
<ul>
<li><strong>Amazon Elastic Container Registry (ECR):</strong> AWS's fully managed Docker container registry. ECR integrates with IAM for granular access control and supports lifecycle policies for image management. For the "Acme Webshop," deploying to an AWS environment would typically involve pushing images to ECR.</li>
<li><strong>Google Container Registry (GCR) / Artifact Registry:</strong> Google Cloud's private registry. Artifact Registry is the successor, supporting various artifact types, including Docker images. It integrates with Google Cloud IAM.</li>
<li><strong>Azure Container Registry (ACR):</strong> Microsoft Azure's managed registry. ACR supports geo-replication and content trust for enhanced security.</li>
</ul>
</li>
<li><strong>Self-Hosted Registries:</strong> Organizations can also deploy their own private registries on-premises or within their own cloud infrastructure.
<ul>
<li><strong>Harbor:</strong> An open-source, cloud-native registry that secures images with policies and role-based access control, scans images for vulnerabilities, and signs images as trusted. It's often chosen for more complex, on-premises or multi-cloud scenarios.</li>
<li><strong>Docker Registry (Distribution):</strong> The open-source registry implementation that powers Docker Hub. It can be self-hosted for complete control but requires more operational overhead compared to managed services.</li>
</ul>
</li>
</ul>
<h3>Real-World Example: Acme Webshop and ECR</h3>
<p>For the "Acme Webshop" case study, let's assume Acme Corp. operates on AWS. They would utilize Amazon ECR as their private registry. When the CI pipeline (managed by Jenkins as learned in Module 2 and 3) successfully builds a new Docker image for the webshop's frontend service, it would then push this image to a designated ECR repository. This ensures that only authorized Acme Corp. systems can pull and deploy this image, and it's readily available for Kubernetes clusters running on AWS (as we will explore in upcoming lessons).</p>
<h2>Image Naming and Tagging Conventions</h2>
<p>Effective image naming and tagging are critical for organizing images within a registry, managing versions, and ensuring that the correct image is deployed.</p>
<h3>Image Naming</h3>
<p>A Docker image name typically follows the pattern <code>[registry_url/][repository_name/]&lt;image_name&gt;[:&lt;tag&gt;]</code>.</p>
<ul>
<li><strong>Registry URL:</strong> For public Docker Hub images, this is often omitted (e.g., <code>nginx</code>). For private registries, it's essential (e.g., <code>123456789012.dkr.ecr.us-east-1.amazonaws.com/acme-webshop/frontend</code>).</li>
<li><strong>Repository Name (optional):</strong> Used to group related images, especially in larger organizations.</li>
<li><strong>Image Name:</strong> Identifies the specific application or service (e.g., <code>frontend</code>, <code>backend-api</code>).</li>
<li><strong>Tag:</strong> Specifies a particular version or variant of the image.</li>
</ul>
<h3>Image Tagging Strategies</h3>
<p>Tags are flexible labels applied to images. They allow multiple versions of an image to coexist within the same repository. While Docker defaults to <code>latest</code> if no tag is specified, relying solely on <code>latest</code> is a common anti-pattern in CI/CD.</p>
<h4>1. Semantic Versioning Tags</h4>
<p>Using semantic versioning (Major.Minor.Patch) is a widely accepted practice for stable releases.</p>
<ul>
<li><code>v1.0.0</code>: A specific, immutable release.</li>
<li><code>v1.0</code>: Points to the latest patch version of 1.0 (e.g., <code>v1.0.3</code> could be <code>v1.0</code>).</li>
<li><code>v1</code>: Points to the latest minor or patch version of 1 (e.g., <code>v1.2.5</code> could be <code>v1</code>).</li>
</ul>
<p><strong>Example: Acme Webshop Frontend</strong></p>
<p>A new feature release of the "Acme Webshop" frontend might be tagged <code>acme-webshop/frontend:2.1.0</code>. Subsequent bug fixes would then be <code>acme-webshop/frontend:2.1.1</code>, <code>acme-webshop/frontend:2.1.2</code>, and so on. Developers could pull <code>acme-webshop/frontend:2.1</code> to get the latest patch for the 2.1 minor version.</p>
<h4>2. Git Commit SHA Tags</h4>
<p>Using the short Git commit SHA (e.g., <code>abcdef1</code>) as a tag ensures that each image corresponds to a specific, immutable point in the source code history. This is excellent for traceability and debugging.</p>
<p><strong>Example: Acme Webshop Backend</strong></p>
<p>When the Jenkins pipeline builds the <code>backend-api</code> service, it could tag the image with the short commit SHA of the Git commit that triggered the build: <code>acme-webshop/backend-api:abcdef1</code>. This tag is unique and immutable, making it easy to trace which code version is running.</p>
<h4>3. Build Number/Timestamp Tags</h4>
<p>Integrating the CI build number or a timestamp into the tag provides uniqueness for every build, even if the code hasn't changed.</p>
<ul>
<li><code>acme-webshop/frontend:jenkins-build-1234</code></li>
<li><code>acme-webshop/backend-api:20231027-1430</code></li>
</ul>
<p>This is particularly useful for development or nightly builds where specific versions are less critical than knowing the exact build artifact.</p>
<h4>4. Environment-Specific Tags (Use with Caution)</h4>
<p>Sometimes, teams use environment-specific tags like <code>dev</code>, <code>staging</code>, <code>production</code>. However, this is generally discouraged because it means the <em>same tag</em> can refer to <em>different underlying images</em> over time, leading to non-reproducible deployments. A better approach is to use immutable, versioned tags (e.g., <code>v1.0.0</code>) and deploy that <em>same</em> image across environments. The environment variable, <code>latest</code>, falls into this category and should be avoided in production CI/CD.</p>
<p><strong>Counterexample: Why <code>latest</code> is problematic</strong></p>
<p>Imagine <code>acme-webshop/frontend:latest</code> is deployed to staging. A new build pushes a different image as <code>latest</code>. If you then try to deploy <code>latest</code> to production, you might be deploying a different image than what was tested in staging, leading to unexpected issues. Using specific, immutable tags prevents this.</p>
<h2>Integrating Registry Operations into Jenkins Pipelines</h2>
<p>As established in Module 2 and 3, Jenkins manages our CI/CD pipelines. Interacting with container registries (authenticating, pushing, and pulling images) is a fundamental step in these pipelines.</p>
<h3>Authenticating with Registries</h3>
<p>Before pushing or pulling images, the Jenkins agent needs to authenticate with the container registry.</p>
<ul>
<li><strong>Docker Hub:</strong> Requires a Docker ID and password, often stored as Jenkins credentials.</li>
<li><strong>Cloud Registries (ECR, GCR, ACR):</strong> Typically use cloud provider IAM roles or service accounts. For example, with ECR, the Jenkins agent (running on an EC2 instance or in Kubernetes) would assume an IAM role with <code>ecr:GetAuthorizationToken</code>, <code>ecr:BatchCheckLayerAvailability</code>, <code>ecr:InitiateLayerUpload</code>, <code>ecr:UploadLayer</code>, <code>ecr:CompleteLayerUpload</code>, <code>ecr:PutImage</code> permissions for pushing, and <code>ecr:BatchGetImage</code>, <code>ecr:GetDownloadUrlForLayer</code> for pulling.</li>
</ul>
<p><strong>Jenkins Declarative Pipeline for ECR Authentication</strong></p>
<p>This snippet demonstrates authenticating with ECR in a Jenkins pipeline using the <code>docker</code> agent and the AWS CLI.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent {</span></span>
<span class="line"><span style="color:#24292E">        docker {</span></span>
<span class="line"><span style="color:#24292E">            image </span><span style="color:#032F62">'amazon/aws-cli:latest'</span><span style="color:#6A737D"> // Use an image with AWS CLI installed</span></span>
<span class="line"><span style="color:#24292E">            args </span><span style="color:#032F62">'-u root:root'</span><span style="color:#6A737D"> // Run as root if needed for permissions inside container</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    environment {</span></span>
<span class="line"><span style="color:#005CC5">        AWS_REGION</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'us-east-1'</span></span>
<span class="line"><span style="color:#005CC5">        ECR_REGISTRY</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> '123456789012.dkr.ecr.us-east-1.amazonaws.com'</span><span style="color:#6A737D"> // Replace with your AWS Account ID and Region</span></span>
<span class="line"><span style="color:#005CC5">        IMAGE_NAME</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "acme-webshop/frontend"</span></span>
<span class="line"><span style="color:#005CC5">        IMAGE_TAG</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "${env.BUILD_NUMBER}"</span><span style="color:#6A737D"> // Using Jenkins BUILD_NUMBER for unique tags</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Login to ECR'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Get ECR login password using AWS CLI</span></span>
<span class="line"><span style="color:#6A737D">                    // AWS credentials must be configured on the Jenkins agent (e.g., IAM role for EC2 instance)</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> ecrPassword </span><span style="color:#D73A49">=</span><span style="color:#24292E"> sh(</span><span style="color:#005CC5">returnStdout</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">, </span><span style="color:#005CC5">script</span><span style="color:#24292E">: </span><span style="color:#032F62">"aws ecr get-login-password --region ${AWS_REGION}"</span><span style="color:#24292E">)</span><span style="color:#D73A49">.</span><span style="color:#24292E">trim()</span></span>
<span class="line"><span style="color:#24292E">                    </span></span>
<span class="line"><span style="color:#6A737D">                    // Log in to Docker using the ECR password</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"echo ${ecrPassword} | docker login --username AWS --password-stdin ${ECR_REGISTRY}"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build and Push Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Assuming Dockerfile is in the current directory</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker build -t ${ECR_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG} ."</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"docker push ${ECR_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG}"</span></span>
<span class="line"><span style="color:#24292E">                    </span></span>
<span class="line"><span style="color:#6A737D">                    // Optional: Push a 'latest' tag, but be aware of its implications</span></span>
<span class="line"><span style="color:#6A737D">                    // sh "docker tag ${ECR_REGISTRY}/${IMAGE_NAME}:${IMAGE_TAG} ${ECR_REGISTRY}/${IMAGE_NAME}:latest"</span></span>
<span class="line"><span style="color:#6A737D">                    // sh "docker push ${ECR_REGISTRY}/${IMAGE_NAME}:latest"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This pipeline stage specifically logs in using AWS CLI to retrieve a temporary password for ECR, then uses <code>docker login</code> to authenticate the Docker client. It then builds the <code>frontend</code> image for the Acme Webshop, tagging it with the Jenkins build number, and pushes it to ECR.</p>
<h2>Image Versioning Strategies in CI/CD</h2>
<p>Image versioning ensures that every deployed artifact is traceable and reproducible. It's a cornerstone of reliable continuous deployment.</p>
<h3>Best Practices for Versioning</h3>
<ol>
<li><strong>Immutability:</strong> Once an image is pushed with a specific tag (e.g., <code>v1.2.3</code>), that tag should <em>never</em> point to a different image. If a change is needed, create a <em>new</em> image with a <em>new</em> tag (e.g., <code>v1.2.4</code>). This guarantees that what was tested in staging is precisely what gets deployed to production.</li>
<li><strong>Unique Tags for Every Build:</strong> Every successful CI build that produces a deployable image should result in a unique tag. This can be the Git commit SHA, the CI build number, or a timestamp.
<ul>
<li><strong>Git Commit SHA:</strong> <code>acme-webshop/frontend:a1b2c3d</code> – Provides direct traceability to source code.</li>
<li><strong>Jenkins Build Number:</strong> <code>acme-webshop/frontend:1234</code> – Easy to correlate with Jenkins build history.</li>
</ul>
</li>
<li><strong>Semantic Versioning for Releases:</strong> When an image is deemed stable enough for a release, apply a semantic version tag in addition to the unique build tag. For example, if build <code>1234</code> is considered release <code>v1.0.0</code>, the image would have two tags: <code>acme-webshop/frontend:1234</code> and <code>acme-webshop/frontend:v1.0.0</code>. This allows consumers to either pull a specific build or the latest stable release.</li>
<li><strong>Avoid <code>latest</code> in Production:</strong> The <code>latest</code> tag is mutable and can lead to inconsistent deployments. While convenient for local development, it should be avoided in automated CI/CD pipelines targeting production or critical environments.</li>
<li><strong>Tagging Multiple Artifacts:</strong> If a build produces multiple images (e.g., <code>frontend</code>, <code>backend</code>, <code>worker</code>), ensure they are all tagged consistently, perhaps with the same Git commit SHA, to represent a cohesive application release.</li>
</ol>
<h3>Example: Versioning Strategy for Acme Webshop</h3>
<p>Acme Corp. decides to use a dual-tagging strategy for their "Acme Webshop" services:</p>
<ul>
<li><strong>Every successful build on the <code>main</code> branch:</strong> Tags the image with the short Git commit SHA (e.g., <code>acme-webshop/frontend:c0ffee1</code>). This is used for internal testing and pre-release environments.</li>
<li><strong>When a release branch is merged or a specific commit is marked for release:</strong> An additional semantic version tag is applied (e.g., <code>acme-webshop/frontend:v2.3.0</code>). This <code>v2.3.0</code> image (which also has the <code>c0ffee1</code> tag) is then deployed to staging and production.</li>
</ul>
<p>This ensures:</p>
<ul>
<li>Traceability to source code for every build.</li>
<li>Clear, human-readable versions for stable releases.</li>
<li>Immutability for all deployed images.</li>
</ul>
<h2>Managing Image Lifecycles and Cleanup</h2>
<p>Container registries can accumulate many images, especially with frequent CI builds. Managing their lifecycle is essential to control storage costs and maintain registry hygiene.</p>
<h3>Lifecycle Policies</h3>
<p>Many private registries offer lifecycle policies that automate the cleanup of old or unused images.</p>
<ul>
<li><strong>Delete old images:</strong> Automatically remove images older than a certain number of days or exceeding a maximum count. For example, "delete images older than 30 days that are not tagged with a semantic version (e.g., <code>vX.Y.Z</code>)".</li>
<li><strong>Retain <code>N</code> latest images:</strong> Keep only the most recent N images per repository. This is useful for development branches where only recent builds are relevant.</li>
<li><strong>Retain images with specific tags:</strong> Always keep images tagged with certain patterns (e.g., <code>v*</code>, <code>release-*</code>) to ensure production releases are never automatically deleted.</li>
</ul>
<p><strong>Example: ECR Lifecycle Policy for Acme Webshop</strong></p>
<p>Acme Corp. configures ECR lifecycle policies for their <code>acme-webshop/frontend</code> repository:</p>
<ul>
<li>Rule 1: Delete untagged images (intermediate layers that aren't referenced by any manifest) after 7 days.</li>
<li>Rule 2: For images tagged with <code>*-development-*</code> (used for feature branches), keep only the latest 5.</li>
<li>Rule 3: For images tagged with <code>v*.*.*</code> (semantic versions), never delete them automatically.</li>
</ul>
<p>This ensures development builds are cleaned up, but stable releases are preserved, and overall storage is optimized.</p>
<h3>Manual Cleanup</h3>
<p>Sometimes manual intervention is necessary, especially in smaller setups or for specific ad-hoc cleanup tasks. Docker commands like <code>docker rmi</code> (remove image) and <code>docker prune</code> (remove unused data, including dangling images) can be used locally. Registry-specific CLIs (e.g., AWS CLI for ECR) or APIs are used for remote registry management.</p>
<h2>Exercises and Practice Activities</h2>
<ol>
<li><strong>ECR Repository Creation and Policy:</strong>
<ul>
<li>Using the AWS CLI, create a new ECR repository named <code>acme-webshop/backend-api-dev</code>.</li>
<li>Define and apply an ECR lifecycle policy to this repository that retains only the 3 most recent images and deletes all others.</li>
<li><em>Hint:</em> Refer to AWS ECR documentation for <code>aws ecr create-repository</code> and <code>aws ecr put-lifecycle-policy</code>.</li>
</ul>
</li>
<li><strong>Jenkins Pipeline for Multi-Tagging:</strong>
<ul>
<li>Modify the provided Jenkinsfile snippet for the "Acme Webshop" frontend.</li>
<li>In the 'Build and Push Docker Image' stage, ensure that <em>every</em> build pushes an image with two tags:
<ol>
<li><code>ECR_REGISTRY/acme-webshop/frontend:${GIT_COMMIT_SHORT}</code> (using the short Git commit hash, which can be obtained via <code>sh('git rev-parse --short HEAD').trim()</code>)</li>
<li><code>ECR_REGISTRY/acme-webshop/frontend:${env.BUILD_NUMBER}</code></li>
</ol>
</li>
<li>Test this pipeline by pushing a change to your Git repository and observing the tags in ECR.</li>
</ul>
</li>
<li><strong>Image Pull and Verification:</strong>
<ul>
<li>From your local machine, use <code>docker pull</code> to pull an image you pushed in the previous exercise, using its specific Git commit SHA tag.</li>
<li>Verify the image locally using <code>docker images</code> and <code>docker run</code>.</li>
</ul>
</li>
</ol>
  
</div>

</div>

<div id="chapter-5">

<div id="chapter-5.1">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Implementing Centralized Logging and Log Management Solutions</h1><p>Applications, infrastructure, and services generate a continuous stream of logs. These logs contain critical information about system health, performance, security events, and application behavior. In a distributed DevOps environment, collecting, aggregating, and analyzing these logs from various sources becomes complex. Centralized logging addresses this challenge by providing a unified platform to gather, store, index, and analyze logs, offering comprehensive visibility into the entire system.</p>
<h2>The Importance of Centralized Logging</h2>
<p>Centralized logging consolidates log data from disparate sources into a single, searchable location. This approach moves beyond the limitations of examining log files directly on individual servers, which is inefficient and impractical in dynamic, distributed systems like those built with containers and microservices. By centralizing logs, teams gain the ability to rapidly diagnose issues, monitor trends, perform security audits, and gain operational insights across their entire technology stack.</p>
<p>Consider the "Acme Webshop" application, which we've been building and deploying throughout this course. Initially, the webshop might have run on a single server, making local log file inspection feasible. However, as Acme scales, the webshop likely comprises multiple microservices (e.g., product catalog service, order processing service, user authentication service), a database, a cache, and potentially runs across several container instances orchestrated by Kubernetes (as we explored in Module 4). Each of these components generates its own logs. Without centralization, troubleshooting an issue like a slow checkout process would involve manually logging into multiple servers or containers, searching through various log files, and attempting to correlate events across them. This process is time-consuming and prone to errors.</p>
<p>A real-world example of the benefits of centralized logging is observed in e-commerce platforms during peak sales events like Black Friday. These platforms experience massive traffic spikes, and any performance degradation or error can lead to significant revenue loss. With centralized logging, operations teams can quickly identify bottlenecks by analyzing aggregated logs for error rates, request latencies, and specific transaction failures across hundreds or thousands of instances, allowing for rapid intervention.</p>
<p>Another example is in the financial industry, where regulatory compliance often requires detailed audit trails of all system activities. Centralized logging provides an immutable, searchable record of events, which simplifies compliance reporting and enables forensic analysis in the event of a security breach. Manually sifting through logs on individual machines for a compliance audit would be an impossible task.</p>
<h2>Key Components of a Log Management Solution</h2>
<p>A comprehensive centralized log management solution typically involves several key components working in concert:</p>
<h3>Log Aggregation</h3>
<p>Log aggregation is the process of collecting log data from various sources and sending it to a central location. This involves using agents or collectors that reside on the source systems (e.g., application servers, containers, network devices) to capture logs as they are generated. These agents can read from various log sources, such as files, standard output (stdout/stderr), system journals, or network protocols (e.g., Syslog).</p>
<p>For the Acme Webshop, this would mean installing a log agent on each Kubernetes pod running a microservice, on the database server, and on any other infrastructure components. The agent's role is to reliably forward these logs to a central point.</p>
<h3>Log Storage and Indexing</h3>
<p>Once logs are aggregated, they need to be stored efficiently and in a way that allows for fast retrieval and analysis. Modern log management solutions typically use distributed NoSQL databases or specialized search engines for this purpose. Indexing is crucial; it involves processing the raw log data to extract structured fields (e.g., timestamp, log level, service name, request ID) and create indexes that enable rapid searching, filtering, and analysis across vast volumes of data.</p>
<p>Elasticsearch is a popular open-source search and analytics engine often used for log storage and indexing. It's designed for high scalability and provides powerful full-text search capabilities, making it ideal for processing large streams of unstructured and semi-structured log data.</p>
<h3>Log Analysis and Visualization</h3>
<p>After logs are stored and indexed, the next step is to make sense of the data. Log analysis involves querying, filtering, and correlating log events to identify patterns, anomalies, and potential issues. Visualization tools provide graphical representations of log data, such as dashboards, charts, and graphs, making it easier to spot trends, monitor system health, and drill down into specific events.</p>
<p>Kibana, often used with Elasticsearch, provides rich visualization capabilities. For instance, an operations team at Acme Webshop could build a Kibana dashboard showing:</p>
<ul>
<li><strong>Error Rate by Service:</strong> A line graph tracking the number of <code>ERROR</code> level logs per minute for each microservice.</li>
<li><strong>Request Latency Distribution:</strong> A histogram showing the distribution of response times for API requests, derived from access logs.</li>
<li><strong>Top User Agents:</strong> A pie chart illustrating the most common web browsers used by customers, based on web server access logs.</li>
<li><strong>Security Events:</strong> A table listing failed login attempts or unauthorized access attempts.</li>
</ul>
<p>These visualizations provide a high-level overview of the system's state and allow teams to quickly identify problematic areas.</p>
<h3>Alerting and Notifications</h3>
<p>A critical aspect of log management is the ability to automatically detect significant events or anomalies in log data and trigger alerts. This proactive approach ensures that relevant teams are notified immediately when critical issues arise, enabling them to respond quickly. Alerts can be configured based on specific log patterns, thresholds (e.g., more than 10 error messages per minute from a specific service), or deviations from baseline behavior.</p>
<p>For the Acme Webshop, an alert might be configured to trigger if:</p>
<ul>
<li>The number of HTTP 500 errors from the "order processing" service exceeds a threshold of 50 in a 5-minute window.</li>
<li>A "database connection lost" error appears in the database logs.</li>
<li>Multiple consecutive failed login attempts are detected from a single IP address within a short period.</li>
</ul>
<p>These alerts can be sent via various channels, such as email, Slack, PagerDuty, or directly integrated with incident management systems.</p>
<h2>Implementing the ELK Stack for Centralized Logging</h2>
<p>The ELK Stack (Elasticsearch, Logstash, Kibana) has become a de facto standard for open-source centralized log management. Sometimes referred to as the Elastic Stack, it also commonly includes Beats for log collection.</p>
<ul>
<li><strong>Elasticsearch:</strong> A distributed, RESTful search and analytics engine capable of storing, indexing, and searching large volumes of data quickly.</li>
<li><strong>Logstash:</strong> A server-side data processing pipeline that ingests data from multiple sources simultaneously, transforms it, and then sends it to a "stash" like Elasticsearch.</li>
<li><strong>Kibana:</strong> A data visualization dashboard for Elasticsearch.</li>
<li><strong>Beats:</strong> Lightweight, single-purpose data shippers that send data from hundreds or thousands of machines to Logstash or Elasticsearch. Examples include Filebeat (for log files), Metricbeat (for metrics), and Heartbeat (for uptime monitoring).</li>
</ul>
<h3>Log Collection with Filebeat</h3>
<p>For the Acme Webshop, running on Kubernetes, Filebeat would be the ideal choice for collecting logs. Filebeat can be deployed as a DaemonSet in Kubernetes, ensuring that a Filebeat pod runs on every node in the cluster and can access the logs from all other pods on that node.</p>
<p>A Filebeat configuration might look like this for collecting container logs:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># filebeat.yml configuration example for Kubernetes</span></span>
<span class="line"><span style="color:#22863A">filebeat.inputs</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">- </span><span style="color:#22863A">type</span><span style="color:#24292E">: </span><span style="color:#032F62">container</span></span>
<span class="line"><span style="color:#22863A">  paths</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    - </span><span style="color:#032F62">/var/log/containers/*.log</span><span style="color:#6A737D"> # Path where Kubernetes stores container logs</span></span>
<span class="line"><span style="color:#22863A">  processors</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">  - </span><span style="color:#22863A">add_kubernetes_metadata</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Automatically adds Kubernetes metadata (pod name, namespace, etc.)</span></span>
<span class="line"><span style="color:#22863A">      in_cluster</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#22863A">      host</span><span style="color:#24292E">: </span><span style="color:#032F62">${NODE_NAME}</span></span>
<span class="line"><span style="color:#6A737D">      # Other Kubernetes metadata options</span></span>
<span class="line"><span style="color:#24292E">  - </span><span style="color:#22863A">drop_fields</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Drop unnecessary fields to reduce payload size</span></span>
<span class="line"><span style="color:#22863A">      fields</span><span style="color:#24292E">: [</span><span style="color:#032F62">"host.name"</span><span style="color:#24292E">, </span><span style="color:#032F62">"ecs.version"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#6A737D">  # Optional: Add custom fields for better filtering</span></span>
<span class="line"><span style="color:#24292E">  - </span><span style="color:#22863A">add_fields</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      target</span><span style="color:#24292E">: </span><span style="color:#032F62">"kubernetes.pod"</span></span>
<span class="line"><span style="color:#22863A">      fields</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">        application_name</span><span style="color:#24292E">: </span><span style="color:#032F62">"acme-webshop"</span><span style="color:#6A737D"> # Custom field for easier filtering</span></span></code></pre></div></div></div>
<p>This configuration tells Filebeat to:</p>
<ol>
<li><strong><code>type: container</code></strong>: Use the container input type, specifically designed for Kubernetes.</li>
<li><strong><code>paths</code></strong>: Monitor log files located in <code>/var/log/containers/*.log</code>, which is where Kubernetes typically stores logs for all containers on a node.</li>
<li><strong><code>add_kubernetes_metadata</code></strong>: Automatically enrich log events with metadata from Kubernetes, such as the pod name, namespace, container name, and unique IDs. This is crucial for correlating logs with specific services or deployments.</li>
<li><strong><code>drop_fields</code></strong>: Remove fields that are not relevant to save on storage and processing.</li>
<li><strong><code>add_fields</code></strong>: Add custom fields, such as <code>application_name: "acme-webshop"</code>, which can be very useful for filtering and categorizing logs from different applications within the same cluster.</li>
</ol>
<p>Filebeat then sends these collected logs, often directly to Elasticsearch or through Logstash for further processing.</p>
<h3>Log Processing with Logstash (Optional but Recommended)</h3>
<p>While Filebeat can send logs directly to Elasticsearch, Logstash provides more advanced capabilities for transforming, enriching, and filtering logs before they reach the storage layer. This is particularly useful for standardizing log formats, redacting sensitive information, or adding contextual data.</p>
<p>An example Logstash configuration for processing Acme Webshop logs might include:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">javascript</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">input {</span></span>
<span class="line"><span style="color:#24292E">  beats {</span></span>
<span class="line"><span style="color:#E36209">    port</span><span style="color:#D73A49"> =&gt;</span><span style="color:#005CC5"> 5044</span><span style="color:#24292E"> # Listen for incoming Filebeat connections</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">filter {</span></span>
<span class="line"><span style="color:#24292E">  # Apply </span><span style="color:#005CC5">JSON</span><span style="color:#24292E"> parsing </span><span style="color:#D73A49">if</span><span style="color:#24292E"> logs are </span><span style="color:#D73A49">in</span><span style="color:#005CC5"> JSON</span><span style="color:#24292E"> format</span></span>
<span class="line"><span style="color:#D73A49">  if</span><span style="color:#24292E"> [message] </span><span style="color:#D73A49">=~</span><span style="color:#032F62"> /</span><span style="color:#D73A49">^</span><span style="color:#032F62">{</span><span style="color:#005CC5">.</span><span style="color:#D73A49">*</span><span style="color:#032F62">}</span><span style="color:#D73A49">$</span><span style="color:#032F62">/</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    json {</span></span>
<span class="line"><span style="color:#E36209">      source</span><span style="color:#D73A49"> =&gt;</span><span style="color:#032F62"> "message"</span></span>
<span class="line"><span style="color:#E36209">      target</span><span style="color:#D73A49"> =&gt;</span><span style="color:#032F62"> "json_data"</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    # Example </span><span style="color:#D73A49">of</span><span style="color:#24292E"> extracting a specific field from </span><span style="color:#005CC5">JSON</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> [json_data][transaction_id] {</span></span>
<span class="line"><span style="color:#E36209">      add_field</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> { </span><span style="color:#032F62">"transaction_id"</span><span style="color:#D73A49"> =&gt;</span><span style="color:#032F62"> "%{[json_data][transaction_id]}"</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    # Remove the original </span><span style="color:#005CC5">JSON</span><span style="color:#24292E"> message field </span><span style="color:#D73A49">if</span><span style="color:#24292E"> parsed successfully</span></span>
<span class="line"><span style="color:#E36209">    remove_field</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> [</span><span style="color:#032F62">"message"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  # Example </span><span style="color:#D73A49">of</span><span style="color:#24292E"> Gork parsing for unstructured log lines</span></span>
<span class="line"><span style="color:#24292E">  # This example assumes a common Apache</span><span style="color:#D73A49">/</span><span style="color:#24292E">Nginx access log format</span></span>
<span class="line"><span style="color:#24292E">  # For Acme Webshop, </span><span style="color:#005CC5">this</span><span style="color:#24292E"> could be used for application</span><span style="color:#D73A49">-</span><span style="color:#24292E">specific log patterns</span></span>
<span class="line"><span style="color:#24292E">  grok {</span></span>
<span class="line"><span style="color:#E36209">    match</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> { </span><span style="color:#032F62">"message"</span><span style="color:#D73A49"> =&gt;</span><span style="color:#032F62"> "%{COMBINEDAPACHELOG}"</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">    # You would define custom grok patterns for your specific application logs</span></span>
<span class="line"><span style="color:#24292E">    # </span><span style="color:#005CC5">E</span><span style="color:#24292E">.g., for an Acme custom log </span><span style="color:#6F42C1">format</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    # </span><span style="color:#E36209">match</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> { </span><span style="color:#032F62">"message"</span><span style="color:#D73A49"> =&gt;</span><span style="color:#032F62"> "</span><span style="color:#005CC5">\[</span><span style="color:#032F62">%{TIMESTAMP_ISO8601:log_timestamp}</span><span style="color:#005CC5">\]</span><span style="color:#032F62"> %{LOGLEVEL:log_level} %{WORD:service_name} - %{GREEDYDATA:log_message}"</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#E36209">    remove_field</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> [</span><span style="color:#032F62">"message"</span><span style="color:#24292E">]</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  # Add GeoIP information based on client </span><span style="color:#005CC5">IP</span><span style="color:#24292E"> address</span></span>
<span class="line"><span style="color:#24292E">  geoip {</span></span>
<span class="line"><span style="color:#E36209">    source</span><span style="color:#D73A49"> =&gt;</span><span style="color:#032F62"> "clientip"</span><span style="color:#24292E"> # Assuming </span><span style="color:#032F62">'clientip'</span><span style="color:#24292E"> field is extracted or available</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  # Mutate fields </span><span style="color:#D73A49">-</span><span style="color:#24292E"> e.g., convert log level to uppercase, rename fields</span></span>
<span class="line"><span style="color:#24292E">  mutate {</span></span>
<span class="line"><span style="color:#E36209">    uppercase</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> [ </span><span style="color:#032F62">"log_level"</span><span style="color:#24292E"> ]</span></span>
<span class="line"><span style="color:#E36209">    rename</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> { </span><span style="color:#032F62">"[host][name]"</span><span style="color:#D73A49"> =&gt;</span><span style="color:#032F62"> "hostname"</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">  # Drop events based on certain </span><span style="color:#6F42C1">criteria</span><span style="color:#24292E"> (e.g., debug logs </span><span style="color:#D73A49">in</span><span style="color:#24292E"> production)</span></span>
<span class="line"><span style="color:#D73A49">  if</span><span style="color:#24292E"> [log_level] </span><span style="color:#D73A49">==</span><span style="color:#032F62"> "DEBUG"</span><span style="color:#24292E"> and [environment] </span><span style="color:#D73A49">==</span><span style="color:#032F62"> "production"</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">    drop {}</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">output {</span></span>
<span class="line"><span style="color:#24292E">  elasticsearch {</span></span>
<span class="line"><span style="color:#E36209">    hosts</span><span style="color:#D73A49"> =&gt;</span><span style="color:#24292E"> [</span><span style="color:#032F62">"http://elasticsearch:9200"</span><span style="color:#24292E">] # Your Elasticsearch host</span></span>
<span class="line"><span style="color:#E36209">    index</span><span style="color:#D73A49"> =&gt;</span><span style="color:#032F62"> "acme-webshop-logs-%{+YYYY.MM.dd}"</span><span style="color:#24292E"> # Daily index pattern</span></span>
<span class="line"><span style="color:#24292E">    # Other Elasticsearch output options</span></span>
<span class="line"><span style="color:#24292E">  }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This Logstash configuration demonstrates:</p>
<ul>
<li><strong><code>input</code></strong>: Listens for Beats connections on port 5044.</li>
<li><strong><code>filter</code></strong>:
<ul>
<li><strong>JSON Parsing</strong>: Checks if a log message is valid JSON and parses it, then extracts <code>transaction_id</code>. Many modern applications, especially microservices, output logs in JSON format for easier machine parsing.</li>
<li><strong>Grok</strong>: Uses predefined or custom regular expressions (<code>Grok patterns</code>) to parse unstructured log lines into structured fields. <code>COMBINEDAPACHELOG</code> is a common pattern for web server access logs. For Acme's internal microservices, custom patterns would be defined.</li>
<li><strong>GeoIP</strong>: Enriches log data by adding geographical information based on an IP address, useful for understanding user distribution or identifying suspicious access patterns.</li>
<li><strong>Mutate</strong>: Modifies fields, such as converting <code>log_level</code> to uppercase or renaming <code>host.name</code> to <code>hostname</code> for consistency.</li>
<li><strong>Drop</strong>: Filters out unwanted logs, for instance, dropping <code>DEBUG</code> level logs if the <code>environment</code> field indicates "production."</li>
</ul>
</li>
<li><strong><code>output</code></strong>: Sends processed logs to Elasticsearch, using a daily index pattern (<code>acme-webshop-logs-YYYY.MM.dd</code>) for better performance and lifecycle management.</li>
</ul>
<h3>Log Visualization with Kibana</h3>
<p>Kibana provides the interface for searching, visualizing, and managing the logs stored in Elasticsearch. After deploying Filebeat and Logstash (or sending directly to Elasticsearch), you would access the Kibana UI to:</p>
<ol>
<li><strong>Discover</strong>: Search and filter log events in real-time. You can apply filters based on any indexed field (e.g., <code>kubernetes.pod.name: "order-service"</code>, <code>log_level: "ERROR"</code>, <code>transaction_id: "XYZ123"</code>).</li>
<li><strong>Visualize</strong>: Create various charts, graphs, and tables from your log data. Examples include:
<ul>
<li>Line charts showing CPU usage or memory consumption over time.</li>
<li>Pie charts breaking down errors by service.</li>
<li>Heat maps illustrating geographical distribution of requests.</li>
</ul>
</li>
<li><strong>Dashboards</strong>: Combine multiple visualizations into a single, comprehensive dashboard for monitoring overall system health and application performance. An Acme Webshop dashboard might include:
<ul>
<li>Number of successful orders per minute.</li>
<li>Average response time of the product catalog service.</li>
<li>Error distribution across all microservices.</li>
<li>Security-related events like failed login attempts.</li>
</ul>
</li>
</ol>
<p>Kibana allows users to build these dashboards interactively, making it easy to create custom views tailored to specific operational needs.</p>
<h2>Exercises and Practice Activities</h2>
<ol>
<li>
<p><strong>Log File Identification and Structure</strong>:</p>
<ul>
<li>Imagine you are deploying a new microservice for the Acme Webshop, the <code>recommendation-service</code>. This service will generate logs to <code>stdout</code> and also write specific <code>audit.log</code> files to <code>/var/log/acme/recommendation-service/</code>. Describe how you would configure Filebeat (at a high level, no full YAML needed) to collect both types of logs from this service when deployed in Kubernetes. How would you ensure they are distinguished in Elasticsearch?</li>
<li>Provide an example of a JSON log line that the <code>recommendation-service</code> might produce. Highlight what fields would be most useful for indexing and searching.</li>
</ul>
</li>
<li>
<p><strong>Logstash Filtering Scenario</strong>:</p>
<ul>
<li>The <code>order-service</code> of the Acme Webshop sometimes logs sensitive customer payment information during debugging (which is a security flaw!). You need to prevent this information from reaching Elasticsearch. Using a hypothetical log line containing <code>customer_payment_info: "XXXX-XXXX-XXXX-1234"</code> within a larger JSON structure, write a Logstash filter configuration snippet that redacts this specific field before it's indexed. Assume the log comes in as JSON.</li>
</ul>
</li>
<li>
<p><strong>Kibana Dashboard Design</strong>:</p>
<ul>
<li>Design a simple Kibana dashboard for the "Acme Webshop" operations team. List at least five key metrics or visualizations you would include to help them quickly identify potential issues related to application performance and errors. For each visualization, explain what type of chart or graph you would use and what specific log data it would represent (e.g., "Error rate by service: Line chart of <code>log_level: ERROR</code> grouped by <code>kubernetes.pod.name</code>").</li>
</ul>
</li>
</ol>
<h2>Real-World Application</h2>
<p>Centralized logging is fundamental to modern operations and security. For instance, a large software-as-a-service (SaaS) provider uses a robust centralized logging solution to manage petabytes of log data daily across thousands of servers and container instances. Their system ingests logs from application servers, databases, load balancers, firewalls, and CDN services.</p>
<p>During a recent service degradation where users reported slow response times, their operations team used their centralized logging platform to quickly pinpoint the root cause. By querying logs for a specific <code>request_id</code>, they traced a customer's request from the load balancer through the web server, authentication service, and finally to the database. They observed an unusual number of <code>database connection pool exhaustion</code> errors originating from a specific microservice. Further analysis of the logs for that service revealed a recent code deployment had introduced an inefficient query that was holding database connections open for too long. The issue was identified and a rollback initiated within minutes, minimizing the impact on users. Without centralized logging, isolating this issue in a sprawling microservices architecture would have taken hours, if not days, impacting thousands of customers.</p>
<p>Another practical application is in cybersecurity. A financial institution utilizes centralized logging to monitor for suspicious activities. They have configured alerts for patterns like multiple failed login attempts from a single IP address, attempts to access unauthorized resources, or unusual data transfer volumes. When a potential brute-force attack on their authentication service was detected, their centralized logging solution immediately alerted the security operations center. The security team was able to analyze the attacker's IP, the specific usernames targeted, and the timestamps of the attempts, providing crucial forensic data for blocking the attacker and hardening their systems. This proactive monitoring and rapid response capability, powered by centralized logging, is indispensable for protecting sensitive customer data and maintaining trust.</p>
<p>Centralized logging and effective log management are cornerstones of a resilient and observable DevOps environment. They provide the necessary visibility into complex, distributed systems, enabling faster troubleshooting, proactive monitoring, and enhanced security. Building upon the understanding of version control, CI/CD pipelines, and containerization, establishing a robust logging infrastructure ensures that teams can gather critical feedback from their deployed applications.</p>
  
</div>

<div id="chapter-5.2">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Monitoring Application Performance and Infrastructure Health</h1><p>Monitoring application performance and infrastructure health involves continuously observing the behavior of applications and the underlying infrastructure to ensure optimal operation, identify issues proactively, and provide data for informed decision-making. This process is integral to a robust DevOps pipeline, offering crucial feedback that informs development and operations teams about the system's state in real-time.</p>
<h2>Key Metrics for Application Performance Monitoring (APM)</h2>
<p>Application Performance Monitoring (APM) focuses on tracking key performance indicators (KPIs) related to the functionality and responsiveness of applications. These metrics provide insights into user experience, application stability, and potential bottlenecks.</p>
<h3>Response Time and Latency</h3>
<p>Response time measures the duration from when a user or another service initiates a request until they receive a complete response. Latency refers to the time delay before a transfer of data begins following an instruction. Both are critical for understanding how quickly an application serves its users. High response times or increased latency directly impact user satisfaction and can indicate underlying performance issues.</p>
<p><strong>Example 1: Acme Webshop Product Page Load Time</strong>
For the "Acme Webshop," the response time for loading a product details page is a critical metric. If a user clicks on a product and it takes 5 seconds to load, that's a poor experience. Monitoring tools track the time from the browser sending the request to the server, the server processing it (querying the database, rendering data), and sending the response back to the browser.</p>
<ul>
<li><strong>Good performance:</strong> Product page loads in under 500ms.</li>
<li><strong>Poor performance:</strong> Product page consistently loads in over 2 seconds. This could indicate slow database queries, inefficient server-side code, or network latency.</li>
</ul>
<p><strong>Example 2: API Endpoint Response Time</strong>
Consider an internal API endpoint, <code>/api/orders</code>, that the Acme Webshop mobile application uses to fetch a user's order history. The response time for this API call is crucial for the mobile app's responsiveness.</p>
<ul>
<li>Monitoring tools would record the duration of each call to <code>/api/orders</code>, from the API gateway receiving the request to the backend service returning the JSON response.</li>
<li>An average response time of 100ms is acceptable, but spikes to 1000ms (1 second) or more would trigger alerts, indicating a potential problem with the order service or its database.</li>
</ul>
<h3>Throughput and Request Rate</h3>
<p>Throughput measures the number of operations or requests an application can handle per unit of time. Request rate is specifically the number of requests per second (RPS) received by an application or service. These metrics indicate the capacity and load an application can sustain.</p>
<p><strong>Example 1: Acme Webshop Concurrent Users</strong>
The Acme Webshop might aim to handle 10,000 concurrent users during peak sales events. Throughput would be measured by the number of successful page views, API calls, or transactions processed per minute or second.</p>
<ul>
<li>If the system is designed for 10,000 users, and monitoring shows it can only successfully process 5,000 requests/minute while maintaining acceptable response times, it indicates a capacity issue.</li>
</ul>
<p><strong>Example 2: Payment Gateway Transactions</strong>
A microservice responsible for processing payments for the Acme Webshop is critical. Monitoring its throughput, measured as transactions per second (TPS), directly shows its processing capability.</p>
<ul>
<li>If the payment service typically handles 50 TPS, and during a flash sale, it attempts to process 200 TPS but starts dropping requests or increasing latency, the throughput limit has been reached.</li>
</ul>
<h3>Error Rate</h3>
<p>Error rate is the percentage of requests or operations that result in an error compared to the total number of requests. High error rates signal significant issues that impact application stability and user experience. Errors can be server-side (e.g., 5xx HTTP codes) or client-side (e.g., JavaScript errors in the browser).</p>
<p><strong>Example 1: HTTP 500 Errors on Acme Webshop Checkout</strong>
During the checkout process on the Acme Webshop, if users frequently encounter "Internal Server Error" (HTTP 500), this points to critical backend issues.</p>
<ul>
<li>Monitoring tools track the count of 5xx responses from the web server or application server. An increase from 0.1% to 5% error rate on the <code>/checkout/process</code> endpoint would be an immediate red flag.</li>
</ul>
<p><strong>Example 2: Database Connection Errors</strong>
A microservice that manages customer profiles might experience intermittent database connection errors.</p>
<ul>
<li>The error rate here would be the percentage of database queries that fail due to connection issues or query timeouts. A sudden spike in these errors would indicate a problem with the database server, network, or the application's connection pool management.</li>
</ul>
<h3>Resource Utilization (CPU, Memory, Disk, Network)</h3>
<p>Resource utilization metrics track how much of the underlying infrastructure's resources (CPU, memory, disk I/O, network bandwidth) an application or service consumes. These are crucial for understanding infrastructure health and identifying bottlenecks.</p>
<p><strong>Example 1: High CPU Usage in Acme Webshop API Server</strong>
If the API server for the Acme Webshop consistently shows CPU utilization above 90%, it means the server is struggling to process requests. This could lead to slower response times and unresponsiveness.</p>
<ul>
<li>Monitoring would show a graph of CPU usage over time. Sustained high usage suggests the need for more CPU resources or optimization of the application code.</li>
</ul>
<p><strong>Example 2: Memory Leaks in a Background Service</strong>
A new background service added to the Acme Webshop that generates daily sales reports might have a memory leak.</p>
<ul>
<li>Monitoring memory usage would show a continuous, upward trend in RAM consumption by this service over several hours or days, even when its workload is stable. Eventually, the service might crash or be killed by the operating system, impacting report generation.</li>
</ul>
<h3>Application Logs</h3>
<p>While not a performance metric in the traditional sense, comprehensive application logs are indispensable for debugging and understanding the context of performance issues. Structured logs, containing timestamps, severity levels, and contextual information (e.g., user ID, request ID), are particularly valuable.</p>
<p><strong>Example 1: Tracking a Failed Transaction in Acme Webshop</strong>
If a customer reports a failed order, detailed logs from the various services involved (frontend, order service, payment service, inventory service) are essential.</p>
<ul>
<li>Logs could show a sequence of events: <code>Order received (ID: 123)</code>, <code>Payment initiated (ID: 123, user: John Doe)</code>, <code>Inventory check failed (product SKU: XYZ, reason: out of stock)</code>, <code>Order creation failed (ID: 123)</code>. This provides a clear trail to diagnose the exact point of failure.</li>
</ul>
<p><strong>Example 2: Identifying Slow Queries</strong>
Database query logs, or application logs that record SQL queries and their execution times, help pinpoint performance bottlenecks.</p>
<ul>
<li>A log entry might show <code>Query executed: SELECT * FROM products WHERE category='electronics' AND price &lt; 1000; Duration: 5500ms</code>. This immediately highlights a slow query that needs optimization, potentially by adding an index or refactoring the query itself.</li>
</ul>
<h2>Infrastructure Health Monitoring</h2>
<p>Infrastructure health monitoring focuses on the underlying components that support applications, ensuring their stability, availability, and optimal resource allocation. This includes servers, virtual machines, containers, databases, and network devices.</p>
<h3>Server and Virtual Machine (VM) Metrics</h3>
<p>For traditional server or VM-based deployments (even if they host containers), core OS-level metrics are critical.</p>
<p><strong>Example 1: Disk I/O Bottleneck on Database Server</strong>
The database server for the Acme Webshop stores product information, customer data, and orders. If the disk I/O operations per second (IOPS) or throughput reaches its limit, it can significantly slow down all database queries.</p>
<ul>
<li>Monitoring would show a high percentage of disk utilization or a long queue length for disk operations. This indicates that the disk is the bottleneck, potentially requiring faster storage or database optimization to reduce disk reads/writes.</li>
</ul>
<p><strong>Example 2: Network Throughput on Application Servers</strong>
The web servers hosting the Acme Webshop's frontend handle a large volume of incoming user requests and outgoing responses.</p>
<ul>
<li>Monitoring network interface metrics (bytes in/out) can reveal if the network card or network bandwidth is becoming saturated, leading to delayed responses for users. A sudden drop in network throughput could also indicate a connectivity issue or a DDoS attack.</li>
</ul>
<h3>Container and Orchestration Metrics</h3>
<p>In environments leveraging Docker and Kubernetes (as discussed in Module 4), monitoring shifts to container-specific metrics and the health of the orchestration platform.</p>
<p><strong>Example 1: Kubernetes Pod Resource Limits</strong>
A specific Kubernetes Pod running the Acme Webshop's product catalog service might have a memory limit defined. If the application inside the container attempts to consume more memory than allowed, Kubernetes will terminate the Pod (Out-Of-Memory, OOMKilled).</p>
<ul>
<li>Monitoring tools integrated with Kubernetes would show the memory usage of the Pod approaching its limit, and then a restart event. This alerts operations to either increase the memory limit for the Pod or investigate a potential memory leak in the product catalog service.</li>
</ul>
<p><strong>Example 2: Container Restarts</strong>
If the payment processing container for the Acme Webshop repeatedly crashes and restarts, it indicates instability. This could be due to unhandled exceptions, resource constraints, or configuration issues.</p>
<ul>
<li>Monitoring the container uptime and restart count provides an immediate indicator of service health. Frequent restarts mean the service is intermittently unavailable, impacting transactions.</li>
</ul>
<h3>Database Performance Metrics</h3>
<p>Databases are often critical bottlenecks, and dedicated monitoring of their specific metrics is essential.</p>
<p><strong>Example 1: Slow Queries and Deadlocks in Acme Webshop Database</strong>
The PostgreSQL database for the Acme Webshop might experience slow queries if indexes are missing or queries are poorly written. Deadlocks can occur when two or more transactions are waiting for each other to release locks.</p>
<ul>
<li>Monitoring tools specific to PostgreSQL would track average query execution times, the number of active connections, lock waits, and deadlock occurrences. A rise in slow queries or deadlocks indicates a database tuning or application-level transaction management issue.</li>
</ul>
<p><strong>Example 2: Replication Lag for High Availability</strong>
For the Acme Webshop's high-availability setup, a replica database might be used for read-heavy operations or disaster recovery. Replication lag measures how far behind the primary database the replica is.</p>
<ul>
<li>If the replica lags significantly (e.g., several minutes), read requests sent to the replica might serve stale data, or a failover scenario could result in data loss. Monitoring the replication lag ensures data consistency and readiness for failover.</li>
</ul>
<h2>Practical Implementation of Monitoring</h2>
<p>Modern monitoring solutions aggregate data from various sources (applications, infrastructure, logs) and provide dashboards, alerting, and analysis capabilities.</p>
<h3>Data Collection Agents</h3>
<p>Agents are software components installed on servers, VMs, or within containers that collect metrics, logs, and traces.</p>
<p><strong>Example 1: Prometheus Node Exporter</strong>
For the Acme Webshop's Kubernetes nodes or standalone servers, the Prometheus Node Exporter agent runs as a daemon. It exposes system-level metrics like CPU usage, memory consumption, disk I/O, and network statistics on an HTTP endpoint, which Prometheus can then scrape.</p>
<ul>
<li>This provides a unified way to collect infrastructure health data.</li>
</ul>
<p><strong>Example 2: Application-Specific Agents (e.g., Datadog, New Relic)</strong>
Many APM tools provide language-specific agents (e.g., Java agent, Python agent) that integrate directly into the application code. These agents automatically collect performance metrics (response times, error rates), method-level traces, and sometimes even log data.</p>
<ul>
<li>For the Acme Webshop's Java backend, a Datadog agent would instrument the application, providing detailed insights into individual transactions, database calls, and external service requests.</li>
</ul>
<h3>Centralized Monitoring Platforms</h3>
<p>These platforms ingest, store, visualize, and analyze the collected data. They offer dashboards, alerting rules, and often integrate with incident management systems.</p>
<p><strong>Example 1: Grafana for Visualization with Prometheus</strong>
Prometheus acts as the time-series database and alerting engine, collecting metrics from various services and exporters. Grafana is a popular open-source tool for creating dashboards that visualize the data stored in Prometheus.</p>
<ul>
<li>The DevOps team for the Acme Webshop could have a Grafana dashboard displaying the CPU, memory, network, and disk usage for all production servers, alongside application-specific metrics like response times and error rates for key services. This provides an "at-a-glance" view of system health.</li>
</ul>
<p><strong>Example 2: ELK Stack (Elasticsearch, Logstash, Kibana) for Log Management</strong>
While upcoming lessons will cover centralized logging in detail, it's worth noting that the ELK stack is a common choice for log aggregation and analysis. Logstash collects and processes logs, Elasticsearch stores them, and Kibana provides a powerful interface for searching, analyzing, and visualizing log data.</p>
<ul>
<li>If the Acme Webshop's API service is experiencing intermittent 500 errors, the ELK stack allows the team to search across all service logs for the specific request ID that failed, identify the error message, and trace it back to the problematic code or configuration.</li>
</ul>
<h2>Exercises and Practice Activities</h2>
<ol>
<li><strong>Metric Identification for a New Service:</strong> Imagine the Acme Webshop is introducing a new "Recommendation Engine" microservice. List at least five key APM metrics and three key infrastructure health metrics you would monitor for this new service. For each metric, explain why it's important and what a "good" vs. "bad" value might indicate.</li>
<li><strong>Scenario Analysis - Performance Degradation:</strong> The Acme Webshop's product search functionality is suddenly performing very slowly, taking 10-15 seconds to return results, when it normally takes less than 1 second. Describe how you would use the concepts of response time, throughput, error rate, and resource utilization to diagnose the problem. What specific data points would you look for in your monitoring system?</li>
<li><strong>Dashboard Design:</strong> Sketch a simple dashboard for the "Acme Webshop" production environment. Include at least 6-8 different metric visualizations, combining APM and infrastructure health metrics. Label each visualization and briefly explain what insight it provides. Consider how you would arrange these to give a quick overview of the system's status.</li>
</ol>
<h2>Real-World Application</h2>
<p>Monitoring is not a "set it and forget it" task; it's an ongoing process that evolves with the application and infrastructure. Companies invest heavily in sophisticated monitoring solutions to gain visibility and ensure business continuity.</p>
<p><strong>Case Study: Large E-commerce Platform Performance During Black Friday</strong>
A major e-commerce platform prepares for Black Friday, expecting millions of users. Their monitoring strategy includes:</p>
<ul>
<li><strong>Synthetic Transactions:</strong> Automated scripts simulate user journeys (login, browse, add to cart, checkout) from various geographic locations every minute, reporting response times and success rates to catch issues before real users encounter them.</li>
<li><strong>Real User Monitoring (RUM):</strong> Browser-side agents collect performance data directly from actual user sessions, providing metrics like page load times, JavaScript error rates, and resource loading times for specific geographies or device types.</li>
<li><strong>Distributed Tracing:</strong> Tools like Jaeger or OpenTelemetry are used to trace requests as they flow through hundreds of microservices. If a customer's checkout fails, a trace can show exactly which service call failed and why, including the latency at each hop.</li>
<li><strong>Cloud Provider Metrics:</strong> Integrating with cloud monitoring services (e.g., AWS CloudWatch, Google Cloud Monitoring) to track instance health, load balancer performance, and database statistics.</li>
</ul>
<p>During Black Friday, a surge of traffic causes the inventory service to become a bottleneck, leading to increased latency and eventual 500 errors for "add to cart" operations. The monitoring system immediately highlights:</p>
<ol>
<li>Increased response times for the <code>/api/cart/add</code> endpoint.</li>
<li>Spikes in CPU and memory usage on the inventory service pods in Kubernetes.</li>
<li>A growing queue of pending requests in the inventory service.</li>
<li>Errors in the logs indicating database connection pooling exhaustion in the inventory service.</li>
</ol>
<p>This comprehensive view allows the operations team to quickly identify the inventory service as the root cause, scale up its instances, and potentially roll back a recent change that introduced an inefficient database query, minimizing downtime and lost sales.</p>
<p><strong>Hypothetical Scenario: Healthcare API Integration</strong>
A new API service processes patient data integrations from various medical devices. Strict SLAs require the API to respond within 200ms 99.9% of the time. Monitoring would be essential:</p>
<ul>
<li>Track average and P99 (99th percentile) response times for all API endpoints.</li>
<li>Monitor the rate of successful vs. failed integrations, with specific error codes logged for failures.</li>
<li>Observe the resource utilization of the API servers, including network I/O, as large data payloads might be transmitted.</li>
<li>Ensure database connection health and query performance for the patient data store.</li>
</ul>
<p>If the P99 response time suddenly jumps to 500ms, monitoring would reveal the issue, potentially tracing it to a specific external device sending malformed data, or a database lock contention during peak hours, allowing for immediate action to restore compliance with SLAs and ensure timely patient data processing.</p>
  
</div>

<div id="chapter-5.3">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Setting Up Alerting and Notification Systems for CI/CD Events</h1><p>Establishing effective alerting and notification systems is fundamental for gaining immediate feedback on the health and status of your CI/CD pipelines. This ensures that any issues, failures, or significant events during the build, test, or deployment stages are promptly communicated to the relevant teams or individuals, enabling rapid response and remediation.</p>
<h2>Understanding Alerting and Notification Fundamentals</h2>
<p>Alerting systems actively monitor specific metrics or events and trigger an alert when predefined thresholds or conditions are met. Notification systems, on the other hand, are the mechanisms used to deliver these alerts to recipients through various channels. In the context of CI/CD, these systems provide crucial visibility into the pipeline's operational state.</p>
<h3>Key Components of an Alerting and Notification System</h3>
<ol>
<li><strong>Event Source</strong>: This is where the CI/CD events originate. Examples include a Jenkins pipeline job completing (successfully or with failure), a static code analysis tool reporting critical vulnerabilities, or a deployment script failing.</li>
<li><strong>Monitoring Agent/System</strong>: This component continuously observes the event sources. For CI/CD, the CI server itself (e.g., Jenkins) often acts as a primary monitoring agent, but external tools can also integrate to pull event data.</li>
<li><strong>Alerting Rule Engine</strong>: This defines the conditions that trigger an alert. For instance, "trigger an alert if a Jenkins job with 'deploy-production' in its name fails."</li>
<li><strong>Notification Channel</strong>: This is the medium through which alerts are communicated. Common channels include email, Slack, Microsoft Teams, PagerDuty, SMS, or custom webhooks.</li>
<li><strong>Recipients/On-Call Schedules</strong>: Specifies who should receive which notifications and when, often integrated with on-call management tools for critical alerts.</li>
</ol>
<h3>Types of CI/CD Events for Alerting</h3>
<p>Alerts should be configured for events that require attention and intervention. These typically fall into several categories:</p>
<ul>
<li><strong>Pipeline Failures</strong>: Any stage of the pipeline failing (build, test, deploy).
<ul>
<li><em>Real-world example</em>: A <code>mvn package</code> command fails during the build stage of the "Acme Webshop" backend service, indicating a compilation error or missing dependency. An alert is sent to the development team.</li>
<li><em>Hypothetical scenario</em>: A Jenkins pipeline configured for a new microservice repeatedly fails during the unit testing phase after a code commit. An alert highlights this persistent failure, allowing developers to quickly identify and fix the breaking changes.</li>
</ul>
</li>
<li><strong>Pipeline Successes (for critical deployments)</strong>: Confirmation of successful deployments to production or critical environments.
<ul>
<li><em>Real-world example</em>: The "Acme Webshop" frontend deployment to the production environment completes without errors. A notification is sent to the release manager and a dedicated operations channel.</li>
<li><em>Hypothetical scenario</em>: A new security patch for a critical payment gateway service is successfully deployed to all production clusters. A success notification is sent to the security team and compliance auditors.</li>
</ul>
</li>
<li><strong>Long-running Pipelines</strong>: Pipelines exceeding expected execution times, potentially indicating a hang or performance degradation.
<ul>
<li><em>Real-world example</em>: The integration test stage for the "Acme Webshop" product catalog service typically takes 10 minutes. If it runs for more than 30 minutes, an alert is triggered, suggesting a potential resource bottleneck or an infinite loop in tests.</li>
</ul>
</li>
<li><strong>Security Vulnerability Detections</strong>: Static Application Security Testing (SAST) tools identifying critical vulnerabilities. (We will delve deeper into SAST in an upcoming lesson.)
<ul>
<li><em>Real-world example</em>: A SAST scan integrated into the build pipeline for the "Acme Webshop" user authentication service detects a high-severity SQL injection vulnerability. An immediate alert is sent to the security and development teams.</li>
</ul>
</li>
<li><strong>Deployment Rollbacks</strong>: Automatic or manual rollbacks of a deployment.
<ul>
<li><em>Real-world example</em>: After deploying a new version of the "Acme Webshop" shopping cart service, monitoring detects a significant increase in error rates, triggering an automatic rollback. An alert is sent to inform the operations team about the rollback event.</li>
</ul>
</li>
</ul>
<h2>Integrating Alerting with Jenkins</h2>
<p>Jenkins, as a central component of many CI/CD pipelines, provides robust mechanisms for integrating with various notification systems. This is often achieved through built-in functionalities or external plugins.</p>
<h3>Email Notifications</h3>
<p>Jenkins has a built-in "Email Notification" post-build action and a more flexible "Editable Email Notification" plugin. These allow sending emails based on job status changes.</p>
<ul>
<li>
<p><strong>Configuration</strong>:</p>
<ol>
<li>Navigate to a Jenkins job's configuration.</li>
<li>In the "Post-build Actions" section, select "Editable Email Notification" (or "Email Notification").</li>
<li>Specify recipients (e.g., <code>$DEFAULT_RECIPIENTS</code>, specific email addresses).</li>
<li>Define triggers, such as "Failure - Any," "Success," or "Fixed."</li>
<li>Customize the email subject and body using Groovy scripts and environment variables to include details like job name, build number, status, and console output URL.</li>
</ol>
</li>
<li>
<p><strong>Example for Acme Webshop Build Failure</strong>:
Suppose we want to email the development team for any build failures of the <code>acme-webshop-backend</code> job.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// In a Jenkinsfile for a Declarative Pipeline, within the post section</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#6A737D">            // Ensure email is sent on all outcomes, though we define triggers later</span></span>
<span class="line"><span style="color:#24292E">            script {</span></span>
<span class="line"><span style="color:#24292E">                emailext (</span></span>
<span class="line"><span style="color:#6A737D">                    // Always send to this general distribution list</span></span>
<span class="line"><span style="color:#005CC5">                    to</span><span style="color:#24292E">: </span><span style="color:#032F62">'devops-team@acme.com'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#6A737D">                    // Also send to the committer if known</span></span>
<span class="line"><span style="color:#005CC5">                    subject</span><span style="color:#24292E">: </span><span style="color:#032F62">"${env.JOB_NAME} - Build ${env.BUILD_NUMBER}: ${currentBuild.currentResult}"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                    body</span><span style="color:#24292E">: </span><span style="color:#032F62">"""</span></span>
<span class="line"><span style="color:#032F62">                        &lt;p&gt;Pipeline: ${env.JOB_NAME}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#032F62">                        &lt;p&gt;Build Number: ${env.BUILD_NUMBER}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#032F62">                        &lt;p&gt;Status: ${currentBuild.currentResult}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#032F62">                        &lt;p&gt;Full Log: ${env.BUILD_URL}console&lt;/p&gt;</span></span>
<span class="line"><span style="color:#032F62">                        &lt;p&gt;View Job: ${env.BUILD_URL}&lt;/p&gt;</span></span>
<span class="line"><span style="color:#032F62">                    """</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#6A737D">                    // Triggers for when to actually send the email</span></span>
<span class="line"><span style="color:#005CC5">                    triggers</span><span style="color:#24292E">: [[$</span><span style="color:#005CC5">class</span><span style="color:#24292E">: </span><span style="color:#032F62">'FailureTrigger'</span><span style="color:#24292E">], [$</span><span style="color:#005CC5">class</span><span style="color:#24292E">: </span><span style="color:#032F62">'FixedTrigger'</span><span style="color:#24292E">]]</span></span>
<span class="line"><span style="color:#24292E">                )</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This example uses the <code>emailext</code> step (from the Editable Email Notification plugin) to send an email to <code>devops-team@acme.com</code> whenever the build status changes to <code>FAILURE</code> or <code>FIXED</code>. The subject and body are dynamically populated with pipeline variables.</p>
</li>
</ul>
<h3>Slack/Microsoft Teams Notifications</h3>
<p>Many organizations use chat platforms like Slack or Microsoft Teams for team communication. Jenkins plugins exist to send notifications directly to these channels.</p>
<ul>
<li>
<p><strong>Slack Plugin Configuration</strong>:</p>
<ol>
<li>Install the Jenkins "Slack Notification Plugin."</li>
<li>Configure Slack integration in Jenkins global settings (<code>Manage Jenkins &gt; Configure System</code>). This involves providing your Slack workspace token and default channel.</li>
<li>In a job's configuration or pipeline script, add a Slack notification step.</li>
</ol>
</li>
<li>
<p><strong>Example for Acme Webshop Deployment Status to Slack</strong>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// In a Jenkinsfile for a Declarative Pipeline</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Staging'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Simulate deployment logic</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Deploying Acme Webshop to Staging..."</span></span>
<span class="line"><span style="color:#24292E">                sleep </span><span style="color:#005CC5">5</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'echo "Deployment to staging successful."'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#6A737D">            // Send a Slack notification on successful deployment</span></span>
<span class="line"><span style="color:#24292E">            slackSend </span><span style="color:#005CC5">channel</span><span style="color:#24292E">: </span><span style="color:#032F62">'#acme-webshop-deployments'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                      color</span><span style="color:#24292E">: </span><span style="color:#032F62">'good'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                      message</span><span style="color:#24292E">: </span><span style="color:#032F62">"✅ *${env.JOB_NAME}* build *${env.BUILD_NUMBER}* succeeded! Deployed to Staging. &lt;${env.BUILD_URL}|View Details&gt;"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#6A737D">            // Send a Slack notification on deployment failure</span></span>
<span class="line"><span style="color:#24292E">            slackSend </span><span style="color:#005CC5">channel</span><span style="color:#24292E">: </span><span style="color:#032F62">'#acme-webshop-deployments'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                      color</span><span style="color:#24292E">: </span><span style="color:#032F62">'danger'</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                      message</span><span style="color:#24292E">: </span><span style="color:#032F62">"❌ *${env.JOB_NAME}* build *${env.BUILD_NUMBER}* failed! Check logs. &lt;${env.BUILD_URL}console|View Console Log&gt;"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This pipeline sends a descriptive message to the <code>#acme-webshop-deployments</code> Slack channel upon both success and failure of the job, including a direct link to the Jenkins build details.</p>
</li>
<li>
<p><strong>Microsoft Teams Configuration</strong>:</p>
<ol>
<li>Install the Jenkins "Office 365 Connector Plugin" (or a similar plugin for Teams).</li>
<li>Configure the webhook URL for your Teams channel within Jenkins global settings.</li>
<li>Use the <code>office365ConnectorSend</code> step in your pipeline.</li>
</ol>
</li>
<li>
<p><strong>Example for Acme Webshop Build Failure to Microsoft Teams</strong>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// In a Jenkinsfile for a Declarative Pipeline</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span></span>
<span class="line"><span style="color:#6A737D">                // Simulate a build failure sometimes for testing</span></span>
<span class="line"><span style="color:#6A737D">                // sh 'exit 1'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            office365ConnectorSend </span><span style="color:#005CC5">message</span><span style="color:#24292E">: </span><span style="color:#032F62">"🚨 *${env.JOB_NAME}* build *${env.BUILD_NUMBER}* FAILED! Please investigate immediately. [View Build](${env.BUILD_URL})"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#6A737D">                                    // You can specify a custom webhook URL if not using a global one</span></span>
<span class="line"><span style="color:#6A737D">                                    // webhookUrl: 'YOUR_TEAMS_WEBHOOK_URL'</span></span>
<span class="line"><span style="color:#005CC5">                                    status</span><span style="color:#24292E">: </span><span style="color:#032F62">'Failure'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            office365ConnectorSend </span><span style="color:#005CC5">message</span><span style="color:#24292E">: </span><span style="color:#032F62">"✅ *${env.JOB_NAME}* build *${env.BUILD_NUMBER}* Succeeded. [View Build](${env.BUILD_URL})"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">                                    status</span><span style="color:#24292E">: </span><span style="color:#032F62">'Success'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This script utilizes the <code>office365ConnectorSend</code> step to push notifications to a Microsoft Teams channel, formatting the message with relevant build information and a link.</p>
</li>
</ul>
<h3>Webhook Notifications</h3>
<p>Webhooks are HTTP callbacks that allow one system to notify another system about an event. Many monitoring and alerting tools (like PagerDuty, Opsgenie, custom dashboards) provide webhook endpoints. Jenkins can trigger these webhooks directly.</p>
<ul>
<li>
<p><strong>Using <code>curl</code> or a dedicated plugin</strong>:
Jenkins pipelines can use <code>sh 'curl ...'</code> commands or dedicated plugins like the "Generic Webhook Trigger Plugin" to send custom payloads to webhook URLs.</p>
</li>
<li>
<p><strong>Example for Triggering a PagerDuty Incident on Production Deployment Failure</strong>:
For critical failures like a production deployment of the "Acme Webshop" main application, an alert to an on-call rotation system like PagerDuty is essential.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// In a Jenkinsfile for a Declarative Pipeline</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    environment {</span></span>
<span class="line"><span style="color:#005CC5">        PAGERDUTY_ROUTING_KEY</span><span style="color:#D73A49"> =</span><span style="color:#24292E"> credentials(</span><span style="color:#032F62">'pagerduty-acme-prod-key'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Stored as secret credential in Jenkins</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Production'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Deploying Acme Webshop to Production..."</span></span>
<span class="line"><span style="color:#6A737D">                // Simulate a production deployment failure</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'exit 1'</span><span style="color:#6A737D"> // This will cause the stage to fail</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            script {</span></span>
<span class="line"><span style="color:#D73A49">                if</span><span style="color:#24292E"> (currentBuild</span><span style="color:#D73A49">.</span><span style="color:#24292E">currentResult </span><span style="color:#D73A49">==</span><span style="color:#032F62"> 'FAILURE'</span><span style="color:#D73A49"> &amp;&amp;</span><span style="color:#24292E"> env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">STAGE_NAME</span><span style="color:#D73A49"> ==</span><span style="color:#032F62"> 'Deploy to Production'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> payload </span><span style="color:#D73A49">=</span><span style="color:#032F62"> """</span></span>
<span class="line"><span style="color:#032F62">                        {</span></span>
<span class="line"><span style="color:#032F62">                            "routing_key": "${PAGERDUTY_ROUTING_KEY}",</span></span>
<span class="line"><span style="color:#032F62">                            "event_action": "trigger",</span></span>
<span class="line"><span style="color:#032F62">                            "payload": {</span></span>
<span class="line"><span style="color:#032F62">                                "summary": "Acme Webshop Production Deployment Failed!",</span></span>
<span class="line"><span style="color:#032F62">                                "source": "Jenkins CI/CD",</span></span>
<span class="line"><span style="color:#032F62">                                "severity": "critical",</span></span>
<span class="line"><span style="color:#032F62">                                "component": "Acme Webshop",</span></span>
<span class="line"><span style="color:#032F62">                                "group": "production-deployments",</span></span>
<span class="line"><span style="color:#032F62">                                "class": "deployment-failure",</span></span>
<span class="line"><span style="color:#032F62">                                "custom_details": {</span></span>
<span class="line"><span style="color:#032F62">                                    "job_name": "${env.JOB_NAME}",</span></span>
<span class="line"><span style="color:#032F62">                                    "build_number": "${env.BUILD_NUMBER}",</span></span>
<span class="line"><span style="color:#032F62">                                    "build_url": "${env.BUILD_URL}"</span></span>
<span class="line"><span style="color:#032F62">                                }</span></span>
<span class="line"><span style="color:#032F62">                            }</span></span>
<span class="line"><span style="color:#032F62">                        }</span></span>
<span class="line"><span style="color:#032F62">                    """</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"curl -X POST -H 'Content-Type: application/json' -d '${payload}' https://events.pagerduty.com/v2/enqueue"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This pipeline segment uses a <code>curl</code> command to send a JSON payload to the PagerDuty Events API v2, triggering a critical incident when the "Deploy to Production" stage fails. The <code>PAGERDUTY_ROUTING_KEY</code> is retrieved from Jenkins credentials for security.</p>
</li>
</ul>
<h2>Best Practices for Alerting and Notifications in CI/CD</h2>
<p>Effective alerting goes beyond simply sending notifications; it involves strategy to ensure alerts are actionable and don't lead to "alert fatigue."</p>
<ul>
<li><strong>Contextual Information</strong>: Include relevant details in notifications (job name, build number, link to logs, error messages). This helps recipients quickly understand the issue without needing to log into Jenkins immediately.</li>
<li><strong>Targeted Notifications</strong>: Send alerts to the right audience. Developers for build failures, operations for deployment issues, and security teams for vulnerability findings. Avoid notifying everyone about every event.</li>
<li><strong>Severity Levels</strong>: Differentiate alerts by severity. A production deployment failure should be <code>critical</code>, while a test environment deployment success might be <code>informational</code>. Use channels appropriate for severity (e.g., PagerDuty for critical, Slack for informational).</li>
<li><strong>Consolidation and Deduplication</strong>: Avoid sending multiple identical alerts for the same ongoing issue. Tools or custom logic can consolidate alerts to prevent spam.</li>
<li><strong>Actionable Alerts</strong>: Every alert should ideally suggest a clear next step or indicate who is responsible for addressing the issue.</li>
<li><strong>Feedback Loops</strong>: Ensure there is a process for acknowledging alerts and feeding information back into the system if issues persist or new patterns emerge.</li>
<li><strong>Thresholds and Baselines</strong>: For performance-related alerts (e.g., pipeline taking too long), establish clear thresholds based on historical data.</li>
</ul>
<h2>Exercises and Practice Activities</h2>
<ol>
<li>
<p><strong>Configure Email Notification for Acme Webshop Development Build</strong>:
Modify a Jenkins pipeline for the <code>acme-webshop-frontend</code> development environment. Configure the <code>emailext</code> step to send an email to <code>devteam@acme.com</code> if any stage of the pipeline fails. The email subject should include <code>[FAILED] Acme Frontend Build</code> and the body should contain the build number, a link to the console output, and the stage where it failed. Test this by intentionally introducing an error (e.g., a bad command) in one of the pipeline stages.</p>
</li>
<li>
<p><strong>Integrate Slack Notification for Staging Deployment Success/Failure</strong>:
Assume you have the Jenkins Slack Notification Plugin installed and configured.
Create or modify a Jenkins pipeline for the <code>acme-webshop-backend</code> staging deployment. Add <code>post</code> sections to:</p>
<ul>
<li>Send a "Success" message to a Slack channel named <code>#acme-webshop-staging</code> with a green emoji and a link to the successful build.</li>
<li>Send a "Failure" message to the same Slack channel with a red emoji and a link to the console log, prompting immediate investigation.
Test both success and failure scenarios.</li>
</ul>
</li>
<li>
<p><strong>Implement Webhook Alert for Critical Testing Failure</strong>:
Imagine your "Acme Webshop" pipeline has a <code>critical-security-tests</code> stage. If this stage fails, it indicates a severe security regression that needs immediate attention.</p>
<ul>
<li><strong>Scenario</strong>: Configure a dummy webhook receiver (you can use online tools like <code>webhook.site</code> for testing purposes) to simulate an incident management system.</li>
<li><strong>Task</strong>: Modify your <code>acme-webshop-backend</code> pipeline to send a <code>curl</code> command to your dummy webhook URL with a JSON payload if the <code>critical-security-tests</code> stage fails. The payload should include <code>job_name</code>, <code>build_number</code>, and a <code>message</code> stating the security test failure.</li>
<li><strong>Verification</strong>: Trigger a failure in the <code>critical-security-tests</code> stage and verify that the <code>webhook.site</code> receives your custom JSON payload.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-5.4">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Integrating Security Scans (SAST) into the Build Pipeline</h1><p>Static Application Security Testing (SAST) involves analyzing an application's source code, bytecode, or binary code for security vulnerabilities without actually executing the code. Integrating SAST into the build pipeline shifts security left, enabling the discovery and remediation of vulnerabilities early in the software development lifecycle, before the application reaches production. This proactive approach helps reduce the cost and effort associated with fixing security defects and minimizes the risk of introducing exploitable flaws into deployed applications.</p>
<h2>Understanding Static Application Security Testing (SAST)</h2>
<p>SAST tools inspect an application's internal structure for known vulnerability patterns, insecure coding practices, and architectural flaws. Unlike dynamic testing, SAST does not require a running application, making it suitable for integration into the build phase of a CI/CD pipeline. The analysis typically involves parsing the code, building an abstract syntax tree (AST), and then applying a set of predefined rules or algorithms to identify potential security issues.</p>
<h3>Key Characteristics of SAST</h3>
<ul>
<li><strong>White-Box Testing:</strong> SAST operates with full knowledge of the application's internals, including its source code and design.</li>
<li><strong>Early Detection:</strong> Issues are identified before deployment, often directly in the developer's integrated development environment (IDE) or during code commit.</li>
<li><strong>Language Dependence:</strong> Most SAST tools are language-specific, requiring different tools or configurations for different programming languages (e.g., Java, Python, C#).</li>
<li><strong>False Positives:</strong> A common challenge with SAST tools is the generation of false positives, which are reported vulnerabilities that are not actual security flaws. This requires human review to triage findings.</li>
<li><strong>Policy Enforcement:</strong> SAST can enforce coding standards and security policies across a development team.</li>
</ul>
<h3>Types of Vulnerabilities Detected by SAST</h3>
<p>SAST tools are effective at identifying a broad range of vulnerabilities. Some common examples include:</p>
<ol>
<li>
<p><strong>Injection Flaws (SQL Injection, Command Injection):</strong> Detecting unvalidated or improperly sanitized user input that could be used to execute arbitrary commands or manipulate database queries.</p>
<ul>
<li><strong>Example (Hypothetical Scenario):</strong> A Java application uses <code>Statement.executeUpdate()</code> with a concatenated string for an SQL query, allowing an attacker to inject malicious SQL. The SAST tool would flag this due to the use of string concatenation in a database query, recommending parameterized queries instead.</li>
<li><strong>Real-world Example 1:</strong> A Python web application allows users to search for products. If the search query is directly embedded into an SQL statement without proper escaping or parameterization, an attacker could craft a malicious query to dump sensitive database information. A SAST tool would identify this direct concatenation as a potential SQL injection vulnerability.</li>
<li><strong>Real-world Example 2:</strong> An internal enterprise tool for system administrators takes a server hostname as input and then constructs a shell command to ping that server. If the input is not sanitized, an attacker could inject arbitrary commands (e.g., <code>server.com; rm -rf /</code>) that would be executed on the server hosting the tool. SAST would detect the direct use of user input in a system command.</li>
</ul>
</li>
<li>
<p><strong>Cross-Site Scripting (XSS):</strong> Identifying instances where user-supplied data is rendered directly in a web page without proper encoding, potentially allowing attackers to inject client-side scripts.</p>
<ul>
<li><strong>Example (Hypothetical Scenario):</strong> A JavaScript frontend application directly displays user comments on a page using <code>element.innerHTML = userComment;</code> without sanitizing <code>userComment</code>. A SAST tool would flag this as a potential reflected or stored XSS vulnerability.</li>
<li><strong>Real-world Example 1:</strong> A content management system (CMS) allows users to post articles. If the content of an article (which can contain HTML) is directly rendered on the website without encoding special characters, an attacker could embed malicious JavaScript. SAST would detect the lack of encoding before displaying user-controlled HTML.</li>
<li><strong>Real-world Example 2:</strong> A feedback form on an e-commerce site displays the user's previously submitted feedback. If the feedback text is not properly escaped when re-displayed, an attacker could submit feedback containing JavaScript that would execute in other users' browsers when they view the page.</li>
</ul>
</li>
<li>
<p><strong>Broken Authentication and Session Management:</strong> Identifying weak password storage, insecure session token generation, or improper session invalidation.</p>
<ul>
<li><strong>Example (Hypothetical Scenario):</strong> A Node.js application stores user passwords in plain text in a database or uses a weak hashing algorithm like MD5. The SAST tool would flag the use of MD5 or the absence of strong hashing as a critical vulnerability.</li>
<li><strong>Real-world Example 1:</strong> A microservice uses an authorization token that is generated using a simple counter. SAST can identify predictable token generation patterns that make tokens easy to guess or forge, recommending cryptographically strong random token generation.</li>
<li><strong>Real-world Example 2:</strong> An older PHP application stores session IDs in URL parameters. SAST tools can detect session IDs being passed in URLs, which makes them susceptible to eavesdropping and leakage via browser history or referrer headers.</li>
</ul>
</li>
<li>
<p><strong>Insecure Direct Object References (IDOR):</strong> Detecting cases where an application directly exposes references to internal implementation objects (like file names, database keys) to unauthorized users.</p>
<ul>
<li><strong>Example (Hypothetical Scenario):</strong> A web API allows users to access documents via <code>GET /api/documents?id=123</code>. If <code>id</code> can be changed by an unauthorized user to <code>124</code> to access another user's document without authorization checks, a SAST tool might identify the direct use of an object ID combined with missing authorization logic in the associated handler.</li>
<li><strong>Real-world Example 1:</strong> An online banking portal allows users to view their account statements by navigating to <code>bank.com/statements?account_id=USER_ACCOUNT_ID</code>. If the <code>account_id</code> is merely validated against the current user's <em>login</em> session and not against explicit authorization rules for <em>that specific account ID</em>, an attacker could enumerate <code>account_id</code>s and access other users' statements.</li>
<li><strong>Real-world Example 2:</strong> A file sharing service provides download links like <code>fileshare.com/download?file=unique_file_id</code>. If <code>unique_file_id</code> is a sequential or easily guessable identifier and there are no robust authorization checks for each download request, users could download files belonging to others.</li>
</ul>
</li>
</ol>
<h2>Integrating SAST into the Build Pipeline</h2>
<p>Integrating SAST into the CI/CD pipeline, as established in Module 2 for static code analysis, means that security checks become an automated part of every build. This "shift left" approach ensures that security issues are identified as soon as new code is committed, allowing developers to address them immediately rather than discovering them much later in the development cycle.</p>
<h3>Placement in the Pipeline</h3>
<p>SAST tools are typically executed during the build phase, after code compilation (if applicable) and before unit testing. This ensures that the analysis runs on the complete and compilable source code.</p>
<p>Consider the "Acme Webshop" case study introduced in Module 1. As new features are developed and code is committed to the Git repository, the Jenkins pipeline (as configured in Module 2) automatically triggers a build. This build pipeline already includes steps for dependency management, compilation, and unit testing. Integrating SAST means adding another stage or step within this build process.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Example Jenkins Declarative Pipeline (simplified)</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Compile the Acme Webshop application</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span><span style="color:#6A737D"> // For Java application</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'SAST Scan'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Execute SAST tool here</span></span>
<span class="line"><span style="color:#6A737D">                    // Example with a generic SAST tool command</span></span>
<span class="line"><span style="color:#6A737D">                    // This command will vary significantly based on the chosen SAST tool</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">'Starting SAST scan...'</span></span>
<span class="line"><span style="color:#6A737D">                    // For a Java application using, for example, SonarQube Scanner</span></span>
<span class="line"><span style="color:#6A737D">                    // This assumes SonarQube is configured and accessible</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'mvn sonar:sonar -Dsonar.projectKey=acme-webshop-backend -Dsonar.host.url=http://sonar.acme.com -Dsonar.login=$SONAR_TOKEN'</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">'SAST scan complete.'</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Run unit tests for Acme Webshop</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ... subsequent stages like integration tests, artifact archiving, deployment (as covered in Module 3)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this example, a <code>SAST Scan</code> stage is introduced after the <code>Build</code> stage. The <code>mvn sonar:sonar</code> command represents the execution of a SAST tool (SonarQube in this hypothetical scenario) against the built application. The results of this scan would typically be published to a central dashboard (like SonarQube's own UI) and could also be used to enforce quality gates, as discussed for static code analysis in Module 2.</p>
<h3>Choosing a SAST Tool</h3>
<p>The selection of a SAST tool depends on several factors:</p>
<ul>
<li><strong>Programming Languages Supported:</strong> The tool must support the languages used in your application (e.g., Java, Python, .NET, JavaScript).</li>
<li><strong>Integration with CI/CD:</strong> Seamless integration with Jenkins and other pipeline tools is crucial.</li>
<li><strong>Reporting and Triage:</strong> Clear, actionable reports and features for managing false positives.</li>
<li><strong>Rule Customization:</strong> Ability to customize rules to fit specific organizational security policies.</li>
<li><strong>Cost and Licensing:</strong> Open-source versus commercial solutions.</li>
</ul>
<p><strong>Modern SAST Tool Examples:</strong></p>
<ol>
<li><strong>SonarQube:</strong> A widely adopted open-source platform for continuous inspection of code quality and security. It supports many languages and integrates well with CI/CD pipelines. SonarQube identifies bugs, code smells, and security vulnerabilities. Its "Quality Gate" feature allows you to fail a build if certain security metrics (e.g., number of critical vulnerabilities) are not met.</li>
<li><strong>Checkmarx SAST:</strong> A commercial SAST solution known for its comprehensive language support and advanced vulnerability detection capabilities. It offers strong integration with various development tools and provides detailed reporting and remediation guidance.</li>
<li><strong>Veracode Static Analysis:</strong> A cloud-based commercial SAST solution that provides rapid scanning and comprehensive security analysis. It's often chosen for its ease of use and ability to scan a wide range of application types.</li>
<li><strong>Snyk Code:</strong> Focuses on developer-first security, integrating directly into IDEs and CI/CD pipelines to find and fix vulnerabilities in application code, open-source dependencies, and container images.</li>
</ol>
<h3>Quality Gates and Failing Builds</h3>
<p>Similar to how quality gates were applied for static code analysis in Module 2, SAST results can also be used to gate the build pipeline. If the SAST scan identifies vulnerabilities exceeding a predefined threshold (e.g., more than zero critical vulnerabilities, or more than five high-severity vulnerabilities), the build can be failed. This prevents insecure code from progressing further down the pipeline to staging or production environments.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// ... previous stages ...</span></span>
<span class="line"><span style="color:#24292E">stage(</span><span style="color:#032F62">'SAST Scan &amp; Quality Gate'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    steps {</span></span>
<span class="line"><span style="color:#24292E">        script {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Starting SAST scan...'</span></span>
<span class="line"><span style="color:#6A737D">            // Execute SAST tool, assuming it outputs results and exit code</span></span>
<span class="line"><span style="color:#6A737D">            // For SonarQube, this typically involves a separate webhook or API call to check quality gate status</span></span>
<span class="line"><span style="color:#6A737D">            // A simplified example using a hypothetical 'sast-scanner' CLI</span></span>
<span class="line"><span style="color:#D73A49">            def</span><span style="color:#24292E"> scanResult </span><span style="color:#D73A49">=</span><span style="color:#24292E"> sh(</span><span style="color:#005CC5">script</span><span style="color:#24292E">: </span><span style="color:#032F62">'sast-scanner --project acme-webshop --threshold critical=0,high=5'</span><span style="color:#24292E">, </span><span style="color:#005CC5">returnStatus</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#D73A49">            if</span><span style="color:#24292E"> (scanResult </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                error </span><span style="color:#032F62">'SAST scan failed due to critical vulnerabilities or exceeding thresholds!'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'SAST scan complete and quality gate passed.'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span>
<span class="line"><span style="color:#6A737D">// ... subsequent stages ...</span></span></code></pre></div></div></div>
<p>In this expanded <code>SAST Scan &amp; Quality Gate</code> stage, the <code>sast-scanner</code> command is assumed to return a non-zero exit code if the configured security thresholds are violated. The <code>error</code> step in Jenkins then fails the build, providing immediate feedback to the development team.</p>
<h2>Practical Examples and Demonstrations</h2>
<p>Let's illustrate with a more concrete example using a hypothetical SAST tool integrated into the Acme Webshop's Jenkins pipeline. We'll assume the Acme Webshop backend is a Java application.</p>
<h3>Scenario: Acme Webshop - SAST Integration for Java Backend</h3>
<p>The Acme Webshop development team wants to ensure that no new critical security vulnerabilities are introduced into their Java backend service. They decide to integrate a SAST tool into their existing Jenkins pipeline. For this demonstration, we'll use a conceptual SAST tool, <code>AcmeSecScan</code>, that can scan Java source code and enforce policies.</p>
<p><strong>Step 1: Pipeline Setup (Initial Build)</strong>
The existing Jenkinsfile for the Acme Webshop Java backend looks like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop Java Backend</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    tools {</span></span>
<span class="line"><span style="color:#6A737D">        // Assume Maven is configured in Jenkins global tools</span></span>
<span class="line"><span style="color:#24292E">        maven </span><span style="color:#032F62">'M3'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install -DskipTests'</span><span style="color:#6A737D"> // Build application, skip tests for now</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span><span style="color:#6A737D"> // Run unit tests</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Package Artifact'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                archiveArtifacts </span><span style="color:#005CC5">artifacts</span><span style="color:#24292E">: </span><span style="color:#032F62">'target/*.jar'</span><span style="color:#24292E">, </span><span style="color:#005CC5">fingerprint</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>Step 2: Integrating the <code>AcmeSecScan</code> SAST Tool</strong></p>
<p>The <code>AcmeSecScan</code> tool has a CLI interface that can be called with <code>acmesecscan scan --project-path . --output-format json</code>. It also has a quality gate feature, <code>acmesecscan check-quality-gate --report-file scan-results.json --fail-on-critical true</code>.</p>
<p>We will add a new stage called <code>Security Scan (SAST)</code> after the <code>Build</code> stage.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop Java Backend with SAST</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    tools {</span></span>
<span class="line"><span style="color:#24292E">        maven </span><span style="color:#032F62">'M3'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Building Acme Webshop Java backend...'</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install -DskipTests'</span><span style="color:#6A737D"> // Compile the application</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Build complete.'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Security Scan (SAST)'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">'Starting AcmeSecScan SAST scan...'</span></span>
<span class="line"><span style="color:#6A737D">                    // Execute the SAST scan. The tool analyzes the compiled code or source.</span></span>
<span class="line"><span style="color:#6A737D">                    // Assuming acmesecscan is available in the Jenkins agent's PATH</span></span>
<span class="line"><span style="color:#6A737D">                    // Save the report for quality gate check and future reference</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'acmesecscan scan --project-path . --output-format json &gt; scan-results.json'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">'Checking SAST quality gate...'</span></span>
<span class="line"><span style="color:#6A737D">                    // Check if the scan results violate any critical security policies</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> qualityGateResult </span><span style="color:#D73A49">=</span><span style="color:#24292E"> sh(</span><span style="color:#005CC5">script</span><span style="color:#24292E">: </span><span style="color:#032F62">'acmesecscan check-quality-gate --report-file scan-results.json --fail-on-critical true'</span><span style="color:#24292E">, </span><span style="color:#005CC5">returnStatus</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">                    if</span><span style="color:#24292E"> (qualityGateResult </span><span style="color:#D73A49">!=</span><span style="color:#005CC5"> 0</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">                        // If quality gate fails, mark the build as failed</span></span>
<span class="line"><span style="color:#24292E">                        error </span><span style="color:#032F62">'AcmeSecScan detected critical vulnerabilities. Build failed!'</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">'SAST Quality Gate passed. No critical vulnerabilities detected.'</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">                    // Archive the SAST report for auditing and detailed review</span></span>
<span class="line"><span style="color:#24292E">                    archiveArtifacts </span><span style="color:#005CC5">artifacts</span><span style="color:#24292E">: </span><span style="color:#032F62">'scan-results.json'</span><span style="color:#24292E">, </span><span style="color:#005CC5">fingerprint</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Running unit tests...'</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span><span style="color:#6A737D"> // Run unit tests</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Unit tests complete.'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Package Artifact'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Packaging application artifact...'</span></span>
<span class="line"><span style="color:#24292E">                archiveArtifacts </span><span style="color:#005CC5">artifacts</span><span style="color:#24292E">: </span><span style="color:#032F62">'target/*.jar'</span><span style="color:#24292E">, </span><span style="color:#005CC5">fingerprint</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Artifact packaged.'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>Explanation:</strong></p>
<ul>
<li>A new <code>Security Scan (SAST)</code> stage is introduced.</li>
<li>Inside this stage, <code>acmesecscan scan</code> is executed against the project directory. The output is redirected to <code>scan-results.json</code>.</li>
<li>Then, <code>acmesecscan check-quality-gate</code> is run, which analyzes <code>scan-results.json</code>. If it finds critical vulnerabilities (due to <code>--fail-on-critical true</code>), it returns a non-zero exit code.</li>
<li>The Jenkins pipeline <code>script</code> block captures this exit code (<code>returnStatus: true</code>). If <code>qualityGateResult</code> is not 0, the <code>error</code> step fails the Jenkins build immediately.</li>
<li>The <code>scan-results.json</code> artifact is archived, making it accessible from the Jenkins build page for further investigation by developers and security teams.</li>
</ul>
<p>This integration ensures that every code change pushed to the Acme Webshop backend repository will trigger a SAST scan, and the pipeline will halt if critical security vulnerabilities are found, preventing them from progressing further.</p>
<h3>Example of a SAST Finding</h3>
<p>Imagine a developer for the Acme Webshop introduces the following vulnerable code snippet in a new <code>UserAuthService.java</code> class:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">java</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// UserAuthService.java (VULNERABLE CODE)</span></span>
<span class="line"><span style="color:#D73A49">public</span><span style="color:#D73A49"> class</span><span style="color:#6F42C1"> UserAuthService</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#6A737D">    // ... other methods ...</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    public</span><span style="color:#24292E"> String </span><span style="color:#6F42C1">getUserPasswordHash</span><span style="color:#24292E">(String </span><span style="color:#E36209">username</span><span style="color:#24292E">) </span><span style="color:#D73A49">throws</span><span style="color:#24292E"> SQLException {</span></span>
<span class="line"><span style="color:#24292E">        Connection conn </span><span style="color:#D73A49">=</span><span style="color:#24292E"> DriverManager.</span><span style="color:#6F42C1">getConnection</span><span style="color:#24292E">(</span><span style="color:#032F62">"jdbc:mysql://localhost:3306/acme_db"</span><span style="color:#24292E">, </span><span style="color:#032F62">"user"</span><span style="color:#24292E">, </span><span style="color:#032F62">"password"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        Statement stmt </span><span style="color:#D73A49">=</span><span style="color:#24292E"> conn.</span><span style="color:#6F42C1">createStatement</span><span style="color:#24292E">();</span></span>
<span class="line"><span style="color:#6A737D">        // Potential SQL Injection vulnerability here!</span></span>
<span class="line"><span style="color:#24292E">        String sql </span><span style="color:#D73A49">=</span><span style="color:#032F62"> "SELECT password_hash FROM users WHERE username = '"</span><span style="color:#D73A49"> +</span><span style="color:#24292E"> username </span><span style="color:#D73A49">+</span><span style="color:#032F62"> "'"</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">        ResultSet rs </span><span style="color:#D73A49">=</span><span style="color:#24292E"> stmt.</span><span style="color:#6F42C1">executeQuery</span><span style="color:#24292E">(sql);</span></span>
<span class="line"><span style="color:#D73A49">        if</span><span style="color:#24292E"> (rs.</span><span style="color:#6F42C1">next</span><span style="color:#24292E">()) {</span></span>
<span class="line"><span style="color:#D73A49">            return</span><span style="color:#24292E"> rs.</span><span style="color:#6F42C1">getString</span><span style="color:#24292E">(</span><span style="color:#032F62">"password_hash"</span><span style="color:#24292E">);</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#D73A49">        return</span><span style="color:#005CC5"> null</span><span style="color:#24292E">;</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>When the <code>Security Scan (SAST)</code> stage runs, <code>AcmeSecScan</code> would analyze this code. It would likely identify the string concatenation within the SQL query as a high-severity SQL Injection vulnerability. The <code>acmesecscan check-quality-gate</code> command would then detect this critical finding and cause the Jenkins build to fail. The archived <code>scan-results.json</code> would contain details about this specific vulnerability, including the file name, line number, and a description of the issue, enabling the developer to quickly locate and fix it using parameterized queries.</p>
<h2>Exercises</h2>
<ol>
<li>
<p><strong>Modify a Jenkinsfile for SAST Integration:</strong></p>
<ul>
<li>Take the <code>Jenkinsfile</code> from the <code>Acme Webshop</code> case study or any simple Java/Node.js application.</li>
<li>Add a new stage named "SAST Scan" to the pipeline.</li>
<li>Inside this stage, use a placeholder command like <code>echo "Running SAST scan with [Your_Preferred_SAST_Tool_Here]"</code> to simulate the execution of a SAST tool.</li>
<li>Implement a simple quality gate logic: after the <code>echo</code> command, add an <code>if</code> statement that checks a hypothetical environment variable (e.g., <code>SAST_CRITICAL_VULNS_FOUND</code>). If this variable is set to "true", use <code>error 'SAST found critical vulnerabilities!'</code> to fail the build.</li>
</ul>
</li>
<li>
<p><strong>Research SAST Tools:</strong></p>
<ul>
<li>Select two programming languages you are familiar with (e.g., Java, Python, JavaScript, C#).</li>
<li>For each language, research two modern SAST tools that support it (one open-source, one commercial, if possible).</li>
<li>For each tool, identify:
<ul>
<li>How it integrates with a CI/CD pipeline (e.g., Jenkins plugin, CLI).</li>
<li>The types of vulnerabilities it primarily detects.</li>
<li>Its key differentiating features.</li>
</ul>
</li>
<li>Write a brief comparison of your chosen tools, highlighting their pros and cons for integration into a DevOps pipeline.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-5.5">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Understanding Dynamic Application Security Testing (DAST) Principles</h1><p>Dynamic Application Security Testing (DAST) is a black-box security testing methodology that examines an application from the outside, while it is running, to identify vulnerabilities that an attacker could exploit. Unlike Static Application Security Testing (SAST), which analyzes source code, DAST interacts with the application as a user would, probing for weaknesses in authentication, authorization, input validation, and session management, among other areas. It simulates real-world attacks against the deployed application, providing insights into vulnerabilities that manifest at runtime, such as misconfigurations, unpatched libraries, or logical flaws.</p>
<h2>Core Principles of DAST</h2>
<p>DAST operates on several fundamental principles to effectively identify security vulnerabilities in running applications. These principles differentiate it from other security testing methods and highlight its unique value in a DevOps pipeline.</p>
<h3>Black-Box Testing</h3>
<p>DAST is inherently a black-box testing approach. This means it requires no prior knowledge of the application's internal structure, source code, or architecture. It treats the application as an opaque system, focusing solely on its external behavior and responses to various inputs.</p>
<p>For example, when a DAST scanner tests the "Acme Webshop," it doesn't analyze the Java code or the database schema. Instead, it interacts with the web interface, sending HTTP requests to different URLs, submitting forms, and examining the HTTP responses, much like a malicious user would. If the scanner sends a request to <code>/admin</code> without proper authentication and receives an administrative page, it flags a potential access control vulnerability. This black-box nature allows DAST to find vulnerabilities that might arise from the interaction of different components or deployment configurations, which might not be apparent from static code analysis alone.</p>
<p>Another example is testing an API. A DAST tool would send various malformed or malicious API requests, such as SQL injection payloads in parameters or cross-site scripting (XSS) attempts in JSON bodies, to endpoints like <code>/api/products</code> or <code>/api/users</code>. It observes how the API responds, whether with error messages that expose backend details, unexpected data leakage, or successful execution of the injected malicious code on the client side. This external perspective is crucial for identifying flaws that manifest only during live execution.</p>
<h3>Runtime Analysis</h3>
<p>DAST performs its analysis on a running application in a deployed environment (e.g., development, staging, or production). This allows it to identify vulnerabilities that only become apparent when the application is actively processing requests and interacting with its environment, including databases, external services, and operating systems.</p>
<p>Consider the "Acme Webshop" again. A DAST scan might discover that submitting a long string to a specific text field, such as a product review comment, causes a buffer overflow error in the underlying server, even if the application code itself appears to handle string lengths correctly. This could be due to a vulnerable third-party library or an underlying web server misconfiguration. SAST, which analyzes code statically, might not detect this because the vulnerability only emerges when the application is running and interacting with the system's memory.</p>
<p>A different hypothetical scenario involves an application with a complex authentication flow. SAST might verify that each step of the authentication code is correct. However, DAST, by executing the login process repeatedly and trying different session manipulation techniques, might discover a session fixation vulnerability. This occurs if the application does not generate a new session ID after successful authentication, allowing an attacker to reuse a previously captured session ID. This type of vulnerability is inherently a runtime issue, as it depends on the sequence of interactions and how session tokens are managed during active use.</p>
<h3>Attack Simulation</h3>
<p>A core principle of DAST is to simulate real-world attack techniques. DAST scanners employ various payloads and attack vectors commonly used by attackers to probe for vulnerabilities. This includes attempts at SQL injection, Cross-Site Scripting (XSS), Cross-Site Request Forgery (CSRF), Broken Authentication, Insecure Direct Object References, Security Misconfigurations, and many others.</p>
<p>For instance, a DAST tool might attempt to perform a SQL Injection attack on the "Acme Webshop's" product search functionality. It could inject a payload like <code>' OR 1=1; --</code> into the search box. If the application's database query is vulnerable, this payload might bypass intended filters and return all products, or even sensitive database information, indicating a successful injection. This directly simulates how an attacker would try to exploit the system.</p>
<p>Another example involves testing for XSS. The DAST scanner could inject a script like <code>&lt;script&gt;alert('XSS')&lt;/script&gt;</code> into various input fields, such as user profiles or forum posts. If the application does not properly sanitize and encode this input before rendering it back to the user's browser, the script will execute, triggering the alert and confirming an XSS vulnerability. This demonstrates how an attacker could inject malicious client-side scripts to steal session cookies or deface web pages.</p>
<h3>Complementary to SAST</h3>
<p>DAST is not a replacement for SAST but rather a complementary security testing approach. While SAST finds vulnerabilities in the code itself (e.g., insecure coding practices, unhandled exceptions), DAST identifies vulnerabilities that manifest in the running application, often due to configuration issues, environment interactions, or logical flaws that are not detectable by static analysis alone.</p>
<p>Consider the "Acme Webshop." SAST might flag a piece of code that uses an outdated cryptographic algorithm within the source code. However, DAST might identify that the web server hosting the "Acme Webshop" is configured to allow weak SSL/TLS ciphers, even if the application code uses strong ciphers internally for specific operations. Both are security issues, but they are found at different layers and by different methods. SAST looks at what <em>could</em> be exploited in the code, while DAST looks at what <em>can</em> be exploited in the deployed system.</p>
<p>Another practical example: SAST might identify a potential path traversal vulnerability in a file upload function by analyzing how user input is concatenated into file paths. DAST, on the other hand, might test for a different vulnerability related to that file upload: if the application stores uploaded files in a publicly accessible directory without proper access control. An attacker could then browse to the uploaded files directly, even if they didn't have the original upload link. This is a runtime configuration issue, not a flaw in the file path construction code itself, and thus DAST is better suited to find it.</p>
<h2>Practical DAST Implementation and Examples</h2>
<p>Integrating DAST into a DevOps pipeline typically involves automated scanning of applications in staging or pre-production environments. This ensures that security vulnerabilities are identified before the application reaches production, aligning with the "shift-left" security principle.</p>
<h3>Setting Up a DAST Scan Environment</h3>
<p>For effective DAST, a dedicated, representative environment is often preferred. This environment should closely mirror the production environment in terms of infrastructure, configuration, and data, but without exposing sensitive production data or processes to potential risks during scanning.</p>
<p>For the "Acme Webshop," a DAST scan would be performed against a staging instance. This staging environment would have its own database populated with realistic but non-sensitive data, an identical web server configuration (e.g., Nginx or Apache), and the same application code deployed as intended for production. The DAST tool would then be configured to target the URL of this staging instance. This setup ensures that findings are relevant to the production system without risking its integrity or data.</p>
<h3>Types of Vulnerabilities DAST Can Detect</h3>
<p>DAST is highly effective at finding a broad range of web application security vulnerabilities.</p>
<ul>
<li><strong>Injection Flaws (SQL, NoSQL, Command Injection):</strong> DAST actively tries to inject malicious code into application inputs to see if the backend executes it. If an input field in "Acme Webshop" is vulnerable to SQL injection, a DAST scanner might manipulate the input to bypass login, extract data, or even modify database records.</li>
<li><strong>Broken Authentication and Session Management:</strong> DAST attempts to bypass login mechanisms, perform brute-force attacks, or manipulate session tokens to gain unauthorized access. For example, if the "Acme Webshop" uses predictable session IDs, a DAST tool might try to guess valid session IDs to hijack user sessions.</li>
<li><strong>Cross-Site Scripting (XSS):</strong> DAST injects various JavaScript payloads into user-controlled inputs (e.g., product review comments, search queries) and checks if they execute in the browser when viewing the page. If the webshop doesn't properly sanitize user input, an injected script could be stored and executed by other users.</li>
<li><strong>Insecure Direct Object References (IDOR):</strong> DAST tries to access resources by manipulating identifiers in URLs or request parameters. If "Acme Webshop" allows users to view order details by URL like <code>/orders?id=123</code>, a DAST tool might try <code>id=124</code> to see if it can access another user's order without proper authorization.</li>
<li><strong>Security Misconfigurations:</strong> DAST checks for common configuration errors on web servers, application servers, and other components, such as exposed administrative interfaces, default credentials, or directory listings. An example is if the "Acme Webshop" server exposes its <code>/.git</code> directory, revealing source code.</li>
<li><strong>Server-Side Request Forgery (SSRF):</strong> DAST attempts to trick the application into making requests to internal or external resources on behalf of the attacker. For instance, if the "Acme Webshop" has a feature that fetches images from a URL, a DAST tool might provide internal IP addresses to see if it can scan internal network ports or access internal services.</li>
<li><strong>Sensitive Data Exposure:</strong> While DAST cannot directly analyze data at rest, it can detect if sensitive data (e.g., credit card numbers, PII) is transmitted insecurely over HTTP, stored in client-side cookies without proper encryption, or exposed in error messages. A DAST scan might observe that "Acme Webshop" transmits credit card numbers in plaintext during a checkout process.</li>
</ul>
<h3>Tools for DAST</h3>
<p>Several commercial and open-source tools are available for DAST:</p>
<ul>
<li><strong>OWASP ZAP (Zed Attack Proxy):</strong> An open-source, community-supported tool that is widely used for DAST. It includes automated scanners, fuzzers, and manual testing features.</li>
<li><strong>Burp Suite Professional:</strong> A popular commercial tool that offers comprehensive manual and automated testing capabilities, including an advanced web vulnerability scanner.</li>
<li><strong>Acunetix:</strong> A commercial DAST scanner known for its accuracy and ability to detect a wide range of vulnerabilities, including those in complex web applications and APIs.</li>
<li><strong>Invicti (formerly Netsparker):</strong> Another commercial DAST solution that focuses on automatic detection of vulnerabilities with high accuracy and minimal false positives.</li>
</ul>
<p>These tools typically crawl the application, identify all accessible URLs and parameters, and then launch a series of simulated attacks based on known vulnerability patterns. They report findings with details about the vulnerability, its location, and often remediation guidance.</p>
<h2>Exercises and Practice Activities</h2>
<p>These exercises will help you understand how DAST principles apply to real-world scenarios and how DAST tools might operate conceptually.</p>
<ol>
<li>
<p><strong>Vulnerability Identification Scenario:</strong> Imagine the "Acme Webshop" has a password reset functionality.</p>
<ul>
<li><em>Scenario:</em> A user requests a password reset, and the system sends an email with a link like <code>https://acme.com/reset?token=XYZABC123</code>. The token <code>XYZABC123</code> is a simple, incremental number.</li>
<li><em>Task:</em> Describe how a DAST tool, following the principle of attack simulation and runtime analysis, might detect a weakness in this password reset mechanism. What kind of vulnerability would it be looking for, and what specific actions would it take?</li>
<li><em>Hint:</em> Think about predictable tokens and how an attacker might manipulate them.</li>
</ul>
</li>
<li>
<p><strong>DAST vs. SAST Complementarity:</strong> The "Acme Webshop" has a feature where users can upload profile pictures.</p>
<ul>
<li><em>SAST Finding:</em> A SAST tool analyzes the Java code for the upload function and identifies that it uses <code>Runtime.exec()</code> to resize images, which is susceptible to command injection if the filename is not properly sanitized.</li>
<li><em>Your Task:</em> Describe a potential security vulnerability related to the profile picture upload that <em>would likely be missed by SAST but could be identified by DAST</em>. Explain the DAST principle involved and how the DAST tool would perform the test.</li>
<li><em>Hint:</em> Consider runtime environment issues, file storage, or how the application <em>uses</em> the uploaded file after processing.</li>
</ul>
</li>
<li>
<p><strong>Black-Box DAST Interaction:</strong> Consider a simple login form on the "Acme Webshop" with fields for <code>username</code> and <code>password</code>.</p>
<ul>
<li><em>Task:</em> List three distinct types of malicious inputs or requests a DAST tool might send to this login form, adhering strictly to the black-box testing principle. For each input, explain what vulnerability it's trying to exploit and what a successful "exploit" might look like from the DAST tool's perspective (e.g., specific HTTP response, error message, or redirected page).</li>
<li><em>Example 1:</em> SQL Injection: <code>username=' OR 1=1 --</code>, <code>password=any</code>. Successful exploit: Login successful without valid credentials.</li>
<li><em>Example 2:</em> Brute Force: ... (your turn)</li>
<li><em>Example 3:</em> ... (your turn)</li>
</ul>
</li>
</ol>
<h2>Real-World Application</h2>
<p>DAST plays a crucial role in the security strategies of various organizations, especially those dealing with web applications and APIs. Its ability to find runtime vulnerabilities complements other security testing methods, providing a comprehensive view of an application's security posture.</p>
<p>One concrete example is a large financial institution that operates an online banking portal. They use DAST tools as a mandatory step in their staging environment before any major release of their portal. A DAST scan might uncover a critical misconfiguration in their web application firewall (WAF) or an application server that inadvertently exposes internal debugging information in verbose error messages. While their development teams meticulously review code for SAST findings, these configuration issues or runtime information disclosures are often only visible when the application is live and interacting with its environment. The DAST scan identifies these vulnerabilities, allowing the operations and security teams to adjust configurations or patch servers before millions of customers are exposed.</p>
<p>Another example is a SaaS provider offering a customer relationship management (CRM) platform. They integrate DAST scans into their continuous delivery pipeline, specifically targeting their API endpoints and web interface after each major build is deployed to a testing environment. One instance saw a DAST scanner identify an Insecure Direct Object Reference (IDOR) vulnerability where a customer could view other customers' support tickets by simply changing an ID in the URL. This vulnerability was missed by SAST because the code itself seemed to correctly check permissions at the function call level; the flaw was in how the front-end constructed the URL and how the backend API implicitly trusted the identifier without explicitly re-validating the user's authorization for <em>that specific</em> resource ID. The DAST tool, by enumerating IDs, quickly exposed this critical business logic flaw that had gone unnoticed.</p>
<p>A hypothetical scenario involves a gaming company that releases frequent updates to its popular online multiplayer game, which has an associated web portal for account management and in-game purchases. To maintain a fast release cadence while ensuring security, they implement automated DAST scans as part of their nightly build process in a dedicated testing environment. One night, the DAST scan flagged a stored Cross-Site Scripting (XSS) vulnerability in the game's forum section. An attacker could post a malicious script in a forum thread, and any user viewing that thread would have the script execute in their browser. This flaw arose from a recent update to the forum's content management system, which introduced a new sanitization library that wasn't correctly configured. Since DAST interacts with the rendered HTML, it successfully detected the executable script where SAST would only see the new library call in the code. The immediate DAST alert allowed the development team to roll back the configuration change and push a fix before the vulnerability reached production, protecting millions of players from potential account compromises.</p>
  
</div>

<div id="chapter-5.6">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Establishing Feedback Loops for Continuous Improvement and Learning</h1><p>Establishing feedback loops in a DevOps pipeline involves creating mechanisms to gather information at various stages of the development and operations lifecycle, analyze it, and use the insights to continuously improve processes, products, and team learning. This systematic approach ensures that issues are identified early, performance is optimized, and teams can adapt quickly to changing requirements or unexpected problems.</p>
<h2>Types of Feedback Loops</h2>
<p>Feedback loops in DevOps can be broadly categorized based on their focus and the stage of the pipeline they address. These loops are crucial for continuous improvement, as they enable teams to learn from their actions and refine their approaches.</p>
<h3>Technical Feedback Loops</h3>
<p>Technical feedback loops focus on the performance, quality, and security of the application and infrastructure. They leverage automated tools and monitoring systems to provide objective data.</p>
<ul>
<li><strong>Continuous Integration (CI) Feedback:</strong> This loop is the earliest and fastest. It provides immediate feedback on code quality, build status, and automated test results. When a developer commits code, the CI pipeline triggers, compiling the code, running unit and integration tests, and performing static code analysis. If any of these steps fail, the feedback is sent directly back to the developer, often through an email notification, a message in a team chat tool, or a visible status change in the version control system. For example, if a developer for the Acme Webshop commits code that introduces a syntax error, the Jenkins CI pipeline (as configured in Module 2) will fail the build almost immediately. The developer receives an alert, allowing them to fix the issue before it propagates further.</li>
<li><strong>Deployment Feedback:</strong> After a successful build, the application is deployed to a staging or testing environment. This feedback loop involves verifying the deployment process itself and the application's basic functionality in the new environment. Tools might check if all services started correctly, if the application is accessible, and if critical health endpoints respond as expected. If the Acme Webshop's latest feature update fails to deploy correctly to the staging environment because a database migration script has an error, the deployment pipeline halts, and an alert is sent to the deployment team. This prevents the broken deployment from proceeding to production.</li>
<li><strong>Monitoring and Alerting Feedback:</strong> Once an application is in production (or even staging), continuous monitoring (as discussed in previous lessons in this module) provides a constant stream of data about its performance, resource utilization, and error rates. Feedback from this loop comes in the form of alerts when predefined thresholds are breached. For instance, if the response time for the Acme Webshop's checkout API exceeds 500ms for more than 5 minutes, an alert is triggered through a system like Prometheus and Grafana (from Lesson 2 and 3) and sent to the operations team. This proactive notification allows teams to investigate and resolve issues before they significantly impact users.</li>
<li><strong>Security Feedback (Runtime):</strong> Beyond the security scans integrated into the build pipeline (SAST, from Lesson 4), runtime security feedback involves monitoring for active threats, vulnerabilities, and unusual behavior in deployed applications. This can include Web Application Firewalls (WAFs) blocking malicious requests or Intrusion Detection Systems (IDS) flagging suspicious network traffic. If the Acme Webshop experiences a large number of failed login attempts from a single IP address, a security monitoring system can trigger an alert, indicating a potential brute-force attack.</li>
</ul>
<h3>Operational Feedback Loops</h3>
<p>Operational feedback loops focus on the efficiency, stability, and reliability of the operational environment, including infrastructure and services.</p>
<ul>
<li><strong>Incident Management Feedback:</strong> When an incident occurs in production, the process of detecting, responding to, and resolving it generates valuable feedback. Post-incident reviews or "blameless postmortems" are crucial for this loop. Teams analyze what happened, why it happened, how it was resolved, and what steps can be taken to prevent recurrence. This feedback often leads to improvements in monitoring, alerting, runbooks, or even architectural changes. After a critical outage of the Acme Webshop due to a database overload, the team conducts a postmortem. They identify that the database sharding strategy was inadequate for peak traffic, leading to a decision to re-architect the database layer and improve load testing procedures.</li>
<li><strong>Performance Optimization Feedback:</strong> Through continuous monitoring, teams gather data on application and infrastructure performance under various loads. This feedback drives decisions about scaling, resource allocation, and code optimizations. For example, if monitoring shows that the Acme Webshop's image delivery service consistently has high CPU utilization during peak hours, the team might decide to optimize image compression, offload image serving to a CDN, or vertically scale the service's instances.</li>
<li><strong>Infrastructure as Code (IaC) Feedback:</strong> As infrastructure is managed through code (as discussed in Module 3 with Terraform), feedback loops ensure the desired state is maintained and any drift is identified. This can involve periodic audits comparing the actual infrastructure state with the defined IaC configuration. If a manual change is made to the Acme Webshop's production environment, like an unauthorized security group modification, an IaC drift detection tool could flag this discrepancy, prompting a review and correction.</li>
</ul>
<h3>Business and User Feedback Loops</h3>
<p>These loops focus on the value delivered to customers and the overall business impact. They ensure that development efforts align with user needs and business goals.</p>
<ul>
<li><strong>User Feedback and Analytics:</strong> Gathering feedback directly from users through surveys, bug reports, feature requests, and usability testing provides crucial insights into how the application is used and where improvements are needed. Web analytics tools (e.g., Google Analytics, Mixpanel) provide quantitative data on user behavior, conversion rates, and feature usage. If the Acme Webshop introduces a new "one-click checkout" feature, user feedback through support tickets and direct surveys indicates that many users find it confusing. Analytics data might show a drop in conversion rates for users attempting to use this new feature. This feedback prompts the product team to redesign the feature for better usability.</li>
<li><strong>A/B Testing Feedback:</strong> A/B testing allows teams to compare different versions of a feature or UI element with a subset of users and measure which version performs better against specific metrics (e.g., conversion rate, click-through rate). This provides empirical feedback on the effectiveness of changes. For instance, the Acme Webshop team might A/B test two different designs for the product description page. Feedback from the test shows that version B leads to a 5% higher "add to cart" rate, leading them to fully roll out version B.</li>
<li><strong>Business Metric Feedback:</strong> Tracking key business metrics (e.g., revenue, customer retention, churn rate) provides direct feedback on the impact of deployed features and changes. If the Acme Webshop's average order value drops significantly after a new pricing algorithm is deployed, this business metric provides immediate feedback that something is amiss, prompting investigation and potential rollback or adjustment.</li>
</ul>
<h2>Building a Culture of Learning and Continuous Improvement</h2>
<p>Establishing feedback loops is not just about tools and processes; it also requires cultivating a specific organizational culture. This culture emphasizes learning, transparency, and a non-blaming approach to problems.</p>
<h3>Blameless Postmortems</h3>
<p>A cornerstone of a learning culture is the practice of blameless postmortems. When an incident or outage occurs, the focus is not on identifying who made a mistake but on understanding the systemic factors that contributed to the problem and what can be learned to prevent recurrence. The goal is to improve processes, tools, and shared understanding, rather than assigning blame.</p>
<p><strong>Real-world Example:</strong>
Imagine a major service outage at a large cloud provider. Instead of finding the engineer who pushed the faulty configuration, a blameless postmortem would involve a cross-functional team analyzing:</p>
<ol>
<li><strong>What happened?</strong> A specific configuration change was applied to a router.</li>
<li><strong>What was the impact?</strong> Network connectivity for a region was lost for two hours.</li>
<li><strong>Why did it happen?</strong> The configuration change had a typo, and the automated validation system failed to catch it due to an edge case in the regex pattern. The rollout process also lacked a canary deployment strategy for this specific type of infrastructure change.</li>
<li><strong>What did we learn?</strong> The regex for configuration validation needs improvement, and a canary deployment strategy for critical network infrastructure changes should be implemented.</li>
<li><strong>Action items:</strong> Update validation regex, implement canary deployment for router changes, conduct training on new deployment procedures.</li>
</ol>
<p><strong>Hypothetical Scenario (Acme Webshop):</strong>
A critical bug in the Acme Webshop's payment gateway integration causes all transactions to fail for 30 minutes. Instead of reprimanding the developer who committed the change, the team holds a blameless postmortem. They discover that the new integration was deployed without sufficient load testing in a pre-production environment. The "fix" for the bug inadvertently introduced a race condition under high concurrency. The postmortem focuses on:</p>
<ul>
<li>Enhancing the pre-production load testing environment to mirror production conditions more accurately.</li>
<li>Improving the review process for changes to critical integrations.</li>
<li>Implementing more robust error handling and retry mechanisms in the payment service.</li>
<li>Updating the monitoring dashboards to include more specific payment gateway health metrics.</li>
</ul>
<h3>Retrospectives and Continuous Learning</h3>
<p>Beyond incident-driven postmortems, regular team retrospectives provide a structured opportunity for teams to reflect on their work, processes, and interactions. These meetings typically occur at the end of a sprint or project milestone and focus on three key questions:</p>
<ul>
<li><strong>What went well?</strong> (Things to continue doing)</li>
<li><strong>What could be improved?</strong> (Problems or inefficiencies)</li>
<li><strong>What will we commit to changing?</strong> (Specific, actionable improvements for the next iteration)</li>
</ul>
<p>This continuous self-assessment ensures that learning is embedded into the team's ongoing work, fostering a culture of iterative improvement.</p>
<p><strong>Real-world Example:</strong>
A software development team finishes a three-week sprint. In their retrospective, they discuss how the new automated deployment script (from Module 3) significantly reduced deployment time and errors – <em>What went well?</em> However, they also note that the documentation for the new API endpoint was incomplete, leading to confusion for frontend developers – <em>What could be improved?</em> For the next sprint, they commit to dedicating specific time to update API documentation before feature completion – <em>What will we commit to changing?</em></p>
<p><strong>Hypothetical Scenario (Acme Webshop):</strong>
The Acme Webshop team completes the integration of a new third-party analytics tool. During their bi-weekly retrospective, they identify that the monitoring dashboards (from Lesson 2 of this module) provided excellent visibility into application performance during the integration, which was a positive. However, the process for creating new database schemas for the analytics data was manual and prone to errors. They commit to developing a Terraform script (revisiting concepts from Module 3) to automate database schema creation for future integrations, thereby standardizing and securing the process.</p>
<h2>Practical Examples and Demonstrations</h2>
<h3>Implementing Automated Feedback for Code Quality</h3>
<p>We previously discussed integrating static code analysis (SAST) in Module 2, but let's consider how the <em>feedback</em> from such tools is effectively communicated. Using tools like SonarQube or linters, the output needs to be immediately visible to developers.</p>
<p><strong>Example: Jenkins Pipeline Integration with SonarQube</strong></p>
<p>For the Acme Webshop, a developer pushes code. The Jenkins pipeline triggers. After the build and unit tests, a SonarQube analysis step runs.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#005CC5">branch</span><span style="color:#24292E">: </span><span style="color:#032F62">'main'</span><span style="color:#24292E">, </span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme/webshop.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span><span style="color:#6A737D"> // Example for Java application</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Unit Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Static Code Analysis'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                withSonarQubeEnv(</span><span style="color:#032F62">'SonarQubeServer'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// 'SonarQubeServer' is a configured Jenkins credential</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'mvn sonar:sonar'</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            post {</span></span>
<span class="line"><span style="color:#24292E">                failure {</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"SonarQube analysis failed or found critical issues."</span></span>
<span class="line"><span style="color:#6A737D">                    // Optionally, fail the build if quality gate fails</span></span>
<span class="line"><span style="color:#24292E">                    script {</span></span>
<span class="line"><span style="color:#D73A49">                        def</span><span style="color:#24292E"> qualityGate </span><span style="color:#D73A49">=</span><span style="color:#24292E"> waitForQualityGate()</span></span>
<span class="line"><span style="color:#D73A49">                        if</span><span style="color:#24292E"> (qualityGate</span><span style="color:#D73A49">.</span><span style="color:#24292E">status </span><span style="color:#D73A49">!=</span><span style="color:#032F62"> 'OK'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                            error </span><span style="color:#032F62">"SonarQube Quality Gate failed: ${qualityGate.status}"</span></span>
<span class="line"><span style="color:#24292E">                        }</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">                success {</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"SonarQube analysis passed."</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // ... subsequent stages (deployment)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>Explanation:</strong></p>
<ul>
<li>The <code>withSonarQubeEnv</code> step ensures the SonarQube scanner runs.</li>
<li>The <code>post</code> section includes a <code>failure</code> block. If SonarQube detects issues that violate predefined quality gates (e.g., too many critical bugs, low test coverage below a threshold), the build can be failed immediately using <code>error</code>.</li>
<li>The <code>waitForQualityGate()</code> function (provided by the SonarQube Jenkins plugin) explicitly waits for SonarQube to report on the quality gate status. This ensures the feedback loop is closed <em>within</em> the pipeline, providing direct feedback before deployment.</li>
<li>This immediate feedback tells the developer: "Your code has a critical bug/vulnerability/low coverage, fix it now."</li>
</ul>
<h3>Leveraging Observability for Operational Feedback</h3>
<p>Centralized logging and monitoring systems (from previous lessons) are the backbone of operational feedback. Integrating these with alerting ensures that feedback reaches the right people at the right time.</p>
<p><strong>Example: Alerting on Application Errors</strong></p>
<p>Consider the Acme Webshop using Prometheus for metrics and Grafana for dashboards, with Alertmanager for notifications. If the <code>acme-webshop-api</code> service starts returning too many HTTP 500 errors (Internal Server Error), an alert needs to fire.</p>
<p><strong>Prometheus Alert Rule (<code>alert.rules</code>):</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#22863A">groups</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">- </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">AcmeWebshopAlerts</span></span>
<span class="line"><span style="color:#22863A">  rules</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">  - </span><span style="color:#22863A">alert</span><span style="color:#24292E">: </span><span style="color:#032F62">HighAPIErrorRate</span></span>
<span class="line"><span style="color:#22863A">    expr</span><span style="color:#24292E">: </span><span style="color:#032F62">sum(rate(http_requests_total{job="acme-webshop-api", status_code="5xx"}[5m])) by (instance) &gt; 5</span></span>
<span class="line"><span style="color:#22863A">    for</span><span style="color:#24292E">: </span><span style="color:#032F62">5m</span></span>
<span class="line"><span style="color:#22863A">    labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      severity</span><span style="color:#24292E">: </span><span style="color:#032F62">critical</span></span>
<span class="line"><span style="color:#22863A">    annotations</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      summary</span><span style="color:#24292E">: </span><span style="color:#032F62">"High 5xx error rate on {{ $labels.instance }}"</span></span>
<span class="line"><span style="color:#22863A">      description</span><span style="color:#24292E">: </span><span style="color:#032F62">"The API instance {{ $labels.instance }} is experiencing a sustained high rate of 5xx errors ({{ $value }} errors/sec over 5 minutes). This indicates a critical issue impacting users."</span></span></code></pre></div></div></div>
<p><strong>Explanation:</strong></p>
<ul>
<li><code>HighAPIErrorRate</code> is the name of the alert.</li>
<li><code>expr</code> defines the condition: if the sum of 5xx errors per second over 5 minutes (averaged) exceeds 5 for any instance of the <code>acme-webshop-api</code> job.</li>
<li><code>for: 5m</code> means the condition must be true for 5 minutes continuously before the alert fires.</li>
<li><code>labels</code> categorize the alert, e.g., <code>severity: critical</code>.</li>
<li><code>annotations</code> provide human-readable information for the alert, including dynamic values from the expression (<code>{{ $labels.instance }}</code>, <code>{{ $value }}</code>).</li>
</ul>
<p>This alert, once triggered by Prometheus, is sent to Alertmanager, which then dispatches it to configured receivers (e.g., Slack channel, PagerDuty, email) based on routing rules. This provides critical operational feedback directly to the team responsible for the Acme Webshop's reliability, enabling them to investigate and resolve the issue.</p>
<h2>Exercises and Practice Activities</h2>
<ol>
<li>
<p><strong>CI/CD Pipeline Feedback Enhancement:</strong></p>
<ul>
<li><strong>Scenario:</strong> Your Acme Webshop CI pipeline (from Module 2) currently fails the build if unit tests fail. You want to add a new feedback loop for code style. Integrate a linter (e.g., ESLint for JavaScript, Pylint for Python, Checkstyle for Java) into your existing Jenkins pipeline.</li>
<li><strong>Task:</strong> Modify the pipeline to:
<ol>
<li>Run the linter after the build stage.</li>
<li>Configure the linter to output its results in a standard format (e.g., XML or plain text).</li>
<li>Make the Jenkins pipeline fail the build if the linter finds more than 10 warnings or any errors.</li>
<li>Ensure the linter report is archived as a build artifact in Jenkins, providing detailed feedback to the developer.</li>
</ol>
</li>
<li><strong>Hint:</strong> Research Jenkins plugins for specific linters or use <code>sh</code> steps to execute linter commands and parse their exit codes.</li>
</ul>
</li>
<li>
<p><strong>Operational Alerting Refinement:</strong></p>
<ul>
<li><strong>Scenario:</strong> The Acme Webshop's database has been occasionally slow, but it hasn't triggered any alerts. You suspect it's due to high latency on database queries, not necessarily outright failures.</li>
<li><strong>Task:</strong> Assuming you have database latency metrics exposed to Prometheus (e.g., <code>db_query_latency_milliseconds_bucket</code>), create a new Prometheus alert rule.
<ol>
<li>The alert should trigger if the 95th percentile (p95) of database query latency exceeds 200ms for more than 10 minutes.</li>
<li>Set the severity to <code>warning</code>.</li>
<li>Include a summary and description that clearly indicates the database instance and the detected latency.</li>
</ol>
</li>
<li><strong>Hint:</strong> Use Prometheus aggregation functions like <code>histogram_quantile</code> to calculate percentiles.</li>
</ul>
</li>
<li>
<p><strong>Post-Incident Review Simulation:</strong></p>
<ul>
<li><strong>Scenario:</strong> The Acme Webshop experienced an outage last night where the product catalog became inaccessible due to a caching service failure.</li>
<li><strong>Task:</strong> Outline a blameless postmortem agenda for your team. For each agenda item, identify 2-3 specific questions that should be asked.
<ul>
<li><strong>Agenda Items:</strong>
<ul>
<li>Incident Timeline &amp; Detection</li>
<li>Impact Assessment</li>
<li>Root Cause Analysis</li>
<li>Resolution Steps</li>
<li>Lessons Learned</li>
<li>Action Items</li>
</ul>
</li>
</ul>
</li>
<li><strong>Example for "Incident Timeline &amp; Detection":</strong>
<ul>
<li>When was the incident first detected? How?</li>
<li>What were the initial symptoms observed?</li>
<li>How quickly was the appropriate team notified?</li>
</ul>
</li>
</ul>
</li>
</ol>
<h2>Real-World Application</h2>
<h3>Integrating Feedback Loops at "Acme Webshop"</h3>
<p>The Acme Webshop, as it grows, relies heavily on a robust set of feedback loops to maintain its competitive edge and ensure high availability.</p>
<ol>
<li><strong>Early Feedback in Development:</strong> Every pull request for the Acme Webshop automatically triggers a Jenkins pipeline (Module 2). This pipeline runs unit tests, integration tests, and SonarQube analysis. If the code coverage drops below 80% or new critical vulnerabilities are detected by SonarQube (as integrated in Lesson 4), the Quality Gate fails, and the pull request is blocked from merging. The developer receives immediate feedback directly within their Git repository interface (e.g., GitHub or GitLab status checks), ensuring issues are caught and fixed before code even merges to <code>main</code>.</li>
<li><strong>Production Health Monitoring:</strong> Once new features for the Acme Webshop are deployed to production, a suite of monitoring tools (Prometheus, Grafana, ELK Stack – from previous lessons in this module) continuously gathers data.
<ul>
<li><strong>Performance Feedback:</strong> Grafana dashboards display real-time metrics for customer-facing services like checkout response times, product page load speeds, and API error rates. If the checkout response time consistently exceeds 1 second, a Prometheus alert (as configured above) fires to a dedicated Slack channel and PagerDuty, immediately notifying the SRE team.</li>
<li><strong>User Behavior Feedback:</strong> Google Analytics tracks user journeys, conversion rates for different product categories, and abandonment rates at various stages of the checkout process. If a new product recommendation engine is deployed, a drop in "add to cart" rates after viewing recommended products provides direct feedback to the product team, indicating the new feature might be underperforming or even detrimental. This data triggers A/B tests to refine the algorithm.</li>
<li><strong>Business Impact Feedback:</strong> Daily automated reports show the "Acme Webshop's" revenue, average order value, and customer retention metrics. A sudden dip in revenue post-deployment of a new pricing feature provides immediate feedback to the business owners that the feature needs urgent review or a rollback.</li>
</ul>
</li>
<li><strong>Incident Learning and Process Improvement:</strong> After any significant incident, like a database overload causing slow performance or an outage from a misconfigured caching service, the Acme Webshop team conducts a blameless postmortem. For instance, following a 2-hour outage of the search service, the postmortem revealed that a new indexing service introduced a memory leak, exacerbated by an outdated load balancer configuration. Action items included: updating the load balancer configuration via Terraform (Module 3) to include better health checks, implementing chaos engineering experiments to test service resilience, and refining the rollout strategy for core services to include more gradual canary deployments (Module 3). This iterative feedback ensures that the team continuously learns from failures and strengthens the overall system.</li>
</ol>
  
</div>

</div>

<div id="chapter-6">

<div id="chapter-6.1">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Pipeline as Code with Groovy DSL and Complex Shared Libraries</h1><p>Jenkins Pipeline as Code revolutionizes how CI/CD pipelines are defined and managed by moving their configuration from the web UI into version-controlled script files. This approach leverages Groovy DSL (Domain Specific Language) to create declarative or scripted pipelines, enabling robust, repeatable, and traceable CI/CD processes. Integrating complex shared libraries further enhances this by promoting code reuse, standardization, and maintainability across multiple projects, transforming ad-hoc scripts into structured, modular, and enterprise-grade pipeline components.</p>
<h2>Pipeline as Code with Groovy DSL</h2>
<p>Jenkins Pipeline as Code allows the entire CI/CD pipeline to be defined in a <code>Jenkinsfile</code>, typically located at the root of a project's source code repository. This <code>Jenkinsfile</code> is written in Groovy, a powerful, optionally typed, dynamic language for the Java platform. Jenkins provides a specialized Groovy DSL to simplify pipeline definition. There are two main syntaxes for defining pipelines: Declarative and Scripted.</p>
<h3>Declarative Pipeline Syntax</h3>
<p>Declarative Pipeline is a more opinionated and structured way to define pipelines, designed for ease of use and readability. It enforces a hierarchical structure with well-defined sections, making it easier to understand and maintain.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Example: Declarative Pipeline for Acme Webshop</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any </span><span style="color:#6A737D">// Specifies where the pipeline will run. 'any' means on any available agent.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Defines a stage in the pipeline</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span><span style="color:#6A737D"> // Checks out source code from Git</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Building Acme Webshop backend...'</span><span style="color:#6A737D"> // Prints a message to the console</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'./mvnw clean package'</span><span style="color:#6A737D"> // Executes a shell command to build the application</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Running unit tests...'</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'./mvnw test'</span><span style="color:#6A737D"> // Executes unit tests</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy Staging'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when {</span></span>
<span class="line"><span style="color:#24292E">                branch </span><span style="color:#032F62">'main'</span><span style="color:#6A737D"> // This stage only runs if the current branch is 'main'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Deploying to staging environment...'</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'./deploy-staging.sh'</span><span style="color:#6A737D"> // Executes a shell script for deployment</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post { </span><span style="color:#6A737D">// Actions to run after the pipeline completes</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Pipeline finished.'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Pipeline succeeded!'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Pipeline failed!'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this example for the Acme Webshop, the <code>pipeline</code> block is the root element. <code>agent any</code> specifies that any available Jenkins agent can execute the pipeline. The <code>stages</code> block contains individual <code>stage</code> blocks like 'Checkout', 'Build', 'Test', and 'Deploy Staging'. Each <code>stage</code> contains <code>steps</code> which are the actual commands to be executed. The <code>when</code> condition in the 'Deploy Staging' stage demonstrates conditional execution. The <code>post</code> block defines actions to be performed after the pipeline completes, regardless of success or failure.</p>
<h3>Scripted Pipeline Syntax</h3>
<p>Scripted Pipeline is more flexible and powerful, resembling traditional Groovy scripting. It's built on top of the Jenkins Pipeline sub-system (CPS-transformed Groovy) and offers greater control but requires a deeper understanding of Groovy and Jenkins internals.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Example: Scripted Pipeline for Acme Webshop</span></span>
<span class="line"><span style="color:#24292E">node { </span><span style="color:#6A737D">// Allocates an executor (agent) for the entire pipeline</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">"Checking out source code..."</span></span>
<span class="line"><span style="color:#24292E">        git </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">"Building Acme Webshop backend..."</span></span>
<span class="line"><span style="color:#D73A49">        try</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'./mvnw clean package'</span></span>
<span class="line"><span style="color:#24292E">        } </span><span style="color:#D73A49">catch</span><span style="color:#24292E"> (e) {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build failed: ${e}"</span></span>
<span class="line"><span style="color:#24292E">            currentBuild</span><span style="color:#D73A49">.</span><span style="color:#24292E">result </span><span style="color:#D73A49">=</span><span style="color:#032F62"> 'FAILURE'</span><span style="color:#6A737D"> // Mark build as failure</span></span>
<span class="line"><span style="color:#D73A49">            throw</span><span style="color:#24292E"> e </span><span style="color:#6A737D">// Re-throw exception to stop pipeline</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">"Running unit tests..."</span></span>
<span class="line"><span style="color:#24292E">        sh </span><span style="color:#032F62">'./mvnw test'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Conditional deployment example</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">BRANCH_NAME</span><span style="color:#D73A49"> ==</span><span style="color:#032F62"> 'main'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy Production'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Deploying to production environment..."</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'./deploy-production.sh'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Inform Development'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Deployment skipped for non-main branch."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">    // Post-build actions</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (currentBuild</span><span style="color:#D73A49">.</span><span style="color:#24292E">result </span><span style="color:#D73A49">==</span><span style="color:#032F62"> 'FAILURE'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">"Pipeline completed with failure."</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        echo </span><span style="color:#032F62">"Pipeline completed successfully."</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This Scripted Pipeline example uses the <code>node</code> block to execute the entire pipeline on a single agent. Stages are defined using the <code>stage</code> step, and logic like <code>try-catch</code> blocks for error handling and <code>if-else</code> statements for conditional execution are directly integrated using Groovy syntax. The <code>env</code> object provides access to environment variables, and <code>currentBuild</code> gives access to properties of the current build. This offers more fine-grained control over execution flow and error handling compared to Declarative Pipeline.</p>
<h2>Complex Shared Libraries</h2>
<p>Shared Libraries are a powerful feature in Jenkins Pipeline that allow you to define common, reusable functions and steps that can be used across multiple pipelines. This promotes code reuse, reduces duplication, and ensures consistency across an organization's CI/CD practices. Shared Libraries are typically stored in a separate Git repository.</p>
<h3>Structure of a Shared Library</h3>
<p>A Jenkins Shared Library repository has a specific directory structure:</p>
<ul>
<li><strong><code>vars/</code></strong>: Contains Groovy script files that expose functions as global variables in pipelines. Each <code>.groovy</code> file in this directory defines a callable method.</li>
<li><strong><code>src/</code></strong>: Contains traditional Groovy or Java classes that can be imported into pipeline scripts. Useful for complex logic or utility classes.</li>
<li><strong><code>resources/</code></strong>: Contains non-Groovy/Java files that pipelines can access using the <code>libraryResource</code> step. Useful for configuration files, scripts, or templates.</li>
</ul>
<h3>Example: Basic Shared Library</h3>
<p>Let's create a simple Shared Library for the Acme Webshop to standardize common build and deployment steps.</p>
<p><strong><code>vars/acmeBuild.groovy</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// vars/acmeBuild.groovy</span></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> call</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> projectType</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> 'maven'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">    // This function will be called as acmeBuild() in a pipeline</span></span>
<span class="line"><span style="color:#D73A49">    if</span><span style="color:#24292E"> (projectType </span><span style="color:#D73A49">==</span><span style="color:#032F62"> 'maven'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Maven Project'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building Maven project..."</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'./mvnw clean package'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#D73A49"> if</span><span style="color:#24292E"> (projectType </span><span style="color:#D73A49">==</span><span style="color:#032F62"> 'nodejs'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build NodeJS Project'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building NodeJS project..."</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm install'</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm run build'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    } </span><span style="color:#D73A49">else</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#24292E">        error </span><span style="color:#032F62">"Unsupported project type: ${projectType}"</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong><code>vars/acmeDeploy.groovy</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// vars/acmeDeploy.groovy</span></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> call</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> environment</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> deployScript</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#6A737D">    // This function will be called as acmeDeploy('staging', './deploy-staging.sh')</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">"Deploy to ${environment.capitalize()}"</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        steps {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Deploying to ${environment} environment using ${deployScript}..."</span></span>
<span class="line"><span style="color:#24292E">            sh deployScript</span></span>
<span class="line"><span style="color:#6A737D">            // Simulate post-deployment verification</span></span>
<span class="line"><span style="color:#24292E">            sleep </span><span style="color:#005CC5">5</span><span style="color:#6A737D"> // Wait for deployment to settle</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Verification complete for ${environment}."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h3>Using the Shared Library in a Pipeline</h3>
<p>First, the Shared Library needs to be configured in Jenkins (Manage Jenkins &gt; System &gt; Global Pipeline Libraries). You would typically provide the Git repository URL (e.g., <code>https://github.com/your-org/acme-shared-library.git</code>) and a name (e.g., <code>acme-library</code>).</p>
<p>Then, in a <code>Jenkinsfile</code>:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop Backend</span></span>
<span class="line"><span style="color:#D73A49">@Library</span><span style="color:#24292E">(</span><span style="color:#032F62">'acme-library@main'</span><span style="color:#24292E">) _ </span><span style="color:#6A737D">// Loads the 'acme-library' from the 'main' branch</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        acmeBuild(</span><span style="color:#032F62">'maven'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Calls the shared library function</span></span>
<span class="line"><span style="color:#24292E">        acmeDeploy(</span><span style="color:#032F62">'staging'</span><span style="color:#24292E">, </span><span style="color:#032F62">'./scripts/deploy-staging.sh'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Another shared library call</span></span>
<span class="line"><span style="color:#24292E">        acmeDeploy(</span><span style="color:#032F62">'production'</span><span style="color:#24292E">, </span><span style="color:#032F62">'./scripts/deploy-production.sh'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Reusing for production</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Pipeline finished with shared library components.'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>The <code>@Library('acme-library@main') _</code> line explicitly loads the shared library from the <code>main</code> branch. This allows the pipeline to call <code>acmeBuild()</code> and <code>acmeDeploy()</code> as if they were built-in Jenkins steps, abstracting away the underlying Groovy logic. This dramatically reduces the size and complexity of individual <code>Jenkinsfile</code>s and centralizes logic.</p>
<h3>Complex Shared Library: Using <code>src/</code> and <code>resources/</code></h3>
<p>For more complex scenarios, the <code>src/</code> and <code>resources/</code> directories become invaluable.</p>
<p><strong><code>src/org/acme/util/DeploymentManager.groovy</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// src/org/acme/util/DeploymentManager.groovy</span></span>
<span class="line"><span style="color:#D73A49">package</span><span style="color:#24292E"> org.acme.util</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">// A Groovy class to encapsulate deployment logic</span></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> DeploymentManager</span><span style="color:#D73A49"> implements</span><span style="color:#6F42C1"> Serializable</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    def</span><span style="color:#24292E"> script // </span><span style="color:#D73A49">Reference</span><span style="color:#24292E"> to the calling pipeline script for </span><span style="color:#D73A49">Jenkins</span><span style="color:#6F42C1"> steps</span><span style="color:#24292E"> (</span><span style="color:#E36209">sh</span><span style="color:#24292E">, </span><span style="color:#E36209">echo</span><span style="color:#24292E">, </span><span style="color:#E36209">etc</span><span style="color:#24292E">.)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    DeploymentManager</span><span style="color:#24292E">(</span><span style="color:#E36209">script</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#D73A49">.</span><span style="color:#24292E">script </span><span style="color:#D73A49">=</span><span style="color:#24292E"> script</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    def</span><span style="color:#6F42C1"> deploy</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> environment</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> appName</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> version</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> targetScript</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Starting deployment of ${appName} v${version} to ${environment}..."</span></span>
<span class="line"><span style="color:#6A737D">        // Load an environment-specific configuration file from resources</span></span>
<span class="line"><span style="color:#D73A49">        def</span><span style="color:#24292E"> configContent </span><span style="color:#D73A49">=</span><span style="color:#24292E"> script</span><span style="color:#D73A49">.</span><span style="color:#24292E">libraryResource </span><span style="color:#032F62">"org/acme/env/${environment}-config.json"</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Loaded config for ${environment}: ${configContent}"</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">sh targetScript </span><span style="color:#6A737D">// Execute the actual deployment script</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Deployment of ${appName} to ${environment} complete."</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    def</span><span style="color:#6F42C1"> verifyDeployment</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> environment</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> healthCheckUrl</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Verifying deployment in ${environment} via ${healthCheckUrl}..."</span></span>
<span class="line"><span style="color:#6A737D">        // In a real scenario, this would involve API calls or health checks</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">sleep </span><span style="color:#005CC5">10</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Deployment verification for ${environment} passed."</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong><code>resources/org/acme/env/staging-config.json</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">json</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// resources/org/acme/env/staging-config.json</span></span>
<span class="line"><span style="color:#24292E">{</span></span>
<span class="line"><span style="color:#005CC5">  "apiEndpoint"</span><span style="color:#24292E">: </span><span style="color:#032F62">"https://api.staging.acme.com"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">  "database"</span><span style="color:#24292E">: </span><span style="color:#032F62">"acme_staging_db"</span><span style="color:#24292E">,</span></span>
<span class="line"><span style="color:#005CC5">  "replicas"</span><span style="color:#24292E">: </span><span style="color:#005CC5">2</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong><code>vars/acmeFullDeploy.groovy</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// vars/acmeFullDeploy.groovy</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.acme.util.DeploymentManager</span><span style="color:#24292E"> //</span><span style="color:#24292E"> Import</span><span style="color:#24292E"> the</span><span style="color:#24292E"> class</span><span style="color:#24292E"> from</span><span style="color:#24292E"> src/</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> call</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> environment</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> appName</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> version</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> targetScript</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> healthCheckUrl</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">"Advanced Deploy to ${environment.capitalize()}"</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        steps {</span></span>
<span class="line"><span style="color:#D73A49">            def</span><span style="color:#24292E"> deployer </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#D73A49"> DeploymentManager</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Pass the current pipeline script to the class</span></span>
<span class="line"><span style="color:#24292E">            deployer</span><span style="color:#D73A49">.</span><span style="color:#24292E">deploy(environment, appName, version, targetScript)</span></span>
<span class="line"><span style="color:#24292E">            deployer</span><span style="color:#D73A49">.</span><span style="color:#24292E">verifyDeployment(environment, healthCheckUrl)</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>Using the Complex Library in <code>Jenkinsfile</code>:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop Frontend</span></span>
<span class="line"><span style="color:#D73A49">@Library</span><span style="color:#24292E">(</span><span style="color:#032F62">'acme-library@main'</span><span style="color:#24292E">) _</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent { label </span><span style="color:#032F62">'frontend-agent'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Use a specific agent for frontend builds</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout Frontend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/acme-webshop/frontend.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Frontend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Building Acme Webshop frontend...'</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm install &amp;&amp; npm run build'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        acmeFullDeploy(</span><span style="color:#032F62">'staging'</span><span style="color:#24292E">, </span><span style="color:#032F62">'acme-frontend'</span><span style="color:#24292E">, </span><span style="color:#032F62">'1.0.0'</span><span style="color:#24292E">, </span><span style="color:#032F62">'./scripts/deploy-frontend-staging.sh'</span><span style="color:#24292E">, </span><span style="color:#032F62">'https://frontend.staging.acme.com/health'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">        acmeFullDeploy(</span><span style="color:#032F62">'production'</span><span style="color:#24292E">, </span><span style="color:#032F62">'acme-frontend'</span><span style="color:#24292E">, </span><span style="color:#032F62">'1.0.0'</span><span style="color:#24292E">, </span><span style="color:#032F62">'./scripts/deploy-frontend-prod.sh'</span><span style="color:#24292E">, </span><span style="color:#032F62">'https://frontend.acme.com/health'</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This advanced example demonstrates encapsulating complex logic within a Groovy class in <code>src/</code>. The <code>DeploymentManager</code> class handles the details of deployment and verification, making <code>vars/acmeFullDeploy.groovy</code> much cleaner. It also shows how to load configuration from the <code>resources/</code> directory, making pipelines more adaptable to different environments. The <code>this</code> keyword passed to the <code>DeploymentManager</code> constructor allows the class to execute Jenkins steps (like <code>sh</code>, <code>echo</code>, <code>sleep</code>) within its methods.</p>
<h2>Practical Examples and Demonstrations</h2>
<h3>Example 1: Standardized Build and Test with Shared Library</h3>
<p>Consider the Acme Webshop having multiple microservices (e.g., product catalog, order service, payment service). Each service might be a Maven project. Instead of repeating the build and test stages in every <code>Jenkinsfile</code>, a shared library provides a consistent approach.</p>
<p><strong>Shared Library (<code>acme-library</code>)</strong>
<strong><code>vars/mavenBuildTest.groovy</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// vars/mavenBuildTest.groovy</span></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> call</span><span style="color:#24292E">() {</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">'Build Maven Project'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        steps {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Building Maven project..."</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'mvnw clean package -DskipTests'</span><span style="color:#6A737D"> // Build without running tests initially</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">'Run Maven Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        steps {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Running Maven unit and integration tests..."</span></span>
<span class="line"><span style="color:#24292E">            sh </span><span style="color:#032F62">'mvnw test'</span><span style="color:#6A737D"> // Execute tests</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">'Static Code Analysis'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        steps {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Performing SonarQube analysis (if configured)..."</span></span>
<span class="line"><span style="color:#6A737D">            // Placeholder for SonarQube scan, covered in Module 2, Lesson 6</span></span>
<span class="line"><span style="color:#6A737D">            // withMaven {</span></span>
<span class="line"><span style="color:#6A737D">            //     sh "mvnw sonar:sonar"</span></span>
<span class="line"><span style="color:#6A737D">            // }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong><code>Jenkinsfile</code> for Product Catalog Service:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for acme-product-catalog</span></span>
<span class="line"><span style="color:#D73A49">@Library</span><span style="color:#24292E">(</span><span style="color:#032F62">'acme-library@main'</span><span style="color:#24292E">) _</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent { label </span><span style="color:#032F62">'maven-agent'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Dedicated agent for Maven builds</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                git </span><span style="color:#032F62">'https://github.com/acme-webshop/product-catalog.git'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        mavenBuildTest() </span><span style="color:#6A737D">// Calls the standardized build and test pipeline steps</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Package Docker Image'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Specific to this service</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">'Building Docker image for product-catalog...'</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> appVersion </span><span style="color:#D73A49">=</span><span style="color:#24292E"> sh(</span><span style="color:#005CC5">returnStdout</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">, </span><span style="color:#005CC5">script</span><span style="color:#24292E">: </span><span style="color:#032F62">"mvn help:evaluate -Dexpression=project.version -q -DforceStdout"</span><span style="color:#24292E">)</span><span style="color:#D73A49">.</span><span style="color:#24292E">trim()</span></span>
<span class="line"><span style="color:#24292E">                    docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">build(</span><span style="color:#032F62">"acme/product-catalog:${appVersion}"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Push Docker Image'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Specific to this service, references Module 4 concepts</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#D73A49">                    def</span><span style="color:#24292E"> appVersion </span><span style="color:#D73A49">=</span><span style="color:#24292E"> sh(</span><span style="color:#005CC5">returnStdout</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#24292E">, </span><span style="color:#005CC5">script</span><span style="color:#24292E">: </span><span style="color:#032F62">"mvn help:evaluate -Dexpression=project.version -q -DforceStdout"</span><span style="color:#24292E">)</span><span style="color:#D73A49">.</span><span style="color:#24292E">trim()</span></span>
<span class="line"><span style="color:#24292E">                    docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">withRegistry(</span><span style="color:#032F62">'https://your-docker-registry.com'</span><span style="color:#24292E">, </span><span style="color:#032F62">'docker-credentials-id'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                        docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">image(</span><span style="color:#032F62">"acme/product-catalog:${appVersion}"</span><span style="color:#24292E">)</span><span style="color:#D73A49">.</span><span style="color:#24292E">push()</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">'Product Catalog CI Pipeline Finished.'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This example shows how <code>mavenBuildTest()</code> centralizes the common CI steps. Each microservice's <code>Jenkinsfile</code> then only needs to define its unique steps, such as Docker image packaging and pushing, which build upon the artifact created by the shared library. This significantly reduces boilerplate and ensures consistency in how all Maven projects within Acme Webshop are built and tested.</p>
<h3>Example 2: Dynamic Environment Provisioning and Deployment</h3>
<p>Building on concepts from Module 3 (Infrastructure as Code with Terraform) and Module 4 (Kubernetes), a shared library can manage dynamic environment provisioning and application deployment.</p>
<p><strong>Shared Library (<code>acme-library</code>)</strong>
<strong><code>src/org/acme/infra/TerraformManager.groovy</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// src/org/acme/infra/TerraformManager.groovy</span></span>
<span class="line"><span style="color:#D73A49">package</span><span style="color:#24292E"> org.acme.infra</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">class</span><span style="color:#6F42C1"> TerraformManager</span><span style="color:#D73A49"> implements</span><span style="color:#6F42C1"> Serializable</span><span style="color:#24292E"> {</span></span>
<span class="line"><span style="color:#D73A49">    def</span><span style="color:#24292E"> script </span><span style="color:#6A737D">// Reference to pipeline script</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6F42C1">    TerraformManager</span><span style="color:#24292E">(</span><span style="color:#E36209">script</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#005CC5">        this</span><span style="color:#D73A49">.</span><span style="color:#24292E">script </span><span style="color:#D73A49">=</span><span style="color:#24292E"> script</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    def</span><span style="color:#6F42C1"> initAndApply</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> workingDir</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> environment</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">dir(workingDir) {</span></span>
<span class="line"><span style="color:#24292E">            script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Initializing Terraform in ${workingDir} for ${environment}..."</span></span>
<span class="line"><span style="color:#24292E">            script</span><span style="color:#D73A49">.</span><span style="color:#24292E">sh </span><span style="color:#032F62">'terraform init'</span></span>
<span class="line"><span style="color:#24292E">            script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Applying Terraform changes..."</span></span>
<span class="line"><span style="color:#24292E">            script</span><span style="color:#D73A49">.</span><span style="color:#24292E">sh </span><span style="color:#032F62">"terraform apply -auto-approve -var=</span><span style="color:#005CC5">\"</span><span style="color:#032F62">environment=${environment}</span><span style="color:#005CC5">\"</span><span style="color:#032F62">"</span></span>
<span class="line"><span style="color:#24292E">            script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Terraform apply complete."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">    def</span><span style="color:#6F42C1"> destroy</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> workingDir</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> environment</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        script</span><span style="color:#D73A49">.</span><span style="color:#24292E">dir(workingDir) {</span></span>
<span class="line"><span style="color:#24292E">            script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Destroying Terraform resources in ${workingDir} for ${environment}..."</span></span>
<span class="line"><span style="color:#24292E">            script</span><span style="color:#D73A49">.</span><span style="color:#24292E">sh </span><span style="color:#032F62">"terraform destroy -auto-approve -var=</span><span style="color:#005CC5">\"</span><span style="color:#032F62">environment=${environment}</span><span style="color:#005CC5">\"</span><span style="color:#032F62">"</span></span>
<span class="line"><span style="color:#24292E">            script</span><span style="color:#D73A49">.</span><span style="color:#24292E">echo </span><span style="color:#032F62">"Terraform destroy complete."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong><code>vars/provisionEnvironment.groovy</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// vars/provisionEnvironment.groovy</span></span>
<span class="line"><span style="color:#D73A49">import</span><span style="color:#24292E"> org.acme.infra.TerraformManager</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> call</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> environment</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> infraPath</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">"Provision ${environment.capitalize()} Environment"</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        steps {</span></span>
<span class="line"><span style="color:#24292E">            script {</span></span>
<span class="line"><span style="color:#D73A49">                def</span><span style="color:#24292E"> tfManager </span><span style="color:#D73A49">=</span><span style="color:#D73A49"> new</span><span style="color:#D73A49"> TerraformManager</span><span style="color:#24292E">(</span><span style="color:#005CC5">this</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">                tfManager</span><span style="color:#D73A49">.</span><span style="color:#24292E">initAndApply(infraPath, environment)</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong><code>vars/deployAppToK8s.groovy</code></strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// vars/deployAppToK8s.groovy</span></span>
<span class="line"><span style="color:#D73A49">def</span><span style="color:#6F42C1"> call</span><span style="color:#24292E">(</span><span style="color:#D73A49">String</span><span style="color:#E36209"> appName</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> kubeConfig</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> namespace</span><span style="color:#24292E">, </span><span style="color:#D73A49">String</span><span style="color:#E36209"> imageTag</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">    stage(</span><span style="color:#032F62">"Deploy ${appName} to Kubernetes"</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">        steps {</span></span>
<span class="line"><span style="color:#6A737D">            // Using Kubernetes plugin steps, or kubectl directly</span></span>
<span class="line"><span style="color:#24292E">            script {</span></span>
<span class="line"><span style="color:#6A737D">                // Example using kubectl directly for clarity</span></span>
<span class="line"><span style="color:#24292E">                withEnv([</span><span style="color:#032F62">"KUBECONFIG=${kubeConfig}"</span><span style="color:#24292E">]) { </span><span style="color:#6A737D">// Set KUBECONFIG for kubectl</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"kubectl config use-context acme-${namespace}-cluster"</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"kubectl set image deployment/${appName} ${appName}=acme/${appName}:${imageTag} -n ${namespace}"</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">"kubectl rollout status deployment/${appName} -n ${namespace}"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Successfully deployed ${appName} with image ${imageTag} to Kubernetes namespace ${namespace}."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong><code>Jenkinsfile</code> for Acme Webshop - End-to-End Pipeline:</strong></p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for acme-webshop (orchestrating backend and frontend)</span></span>
<span class="line"><span style="color:#D73A49">@Library</span><span style="color:#24292E">(</span><span style="color:#032F62">'acme-library@main'</span><span style="color:#24292E">) _</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    environment {</span></span>
<span class="line"><span style="color:#6A737D">        // Define common environment variables for the pipeline</span></span>
<span class="line"><span style="color:#005CC5">        ACME_VERSION</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "1.0.${BUILD_NUMBER}"</span><span style="color:#6A737D"> // Example versioning</span></span>
<span class="line"><span style="color:#005CC5">        KUBE_CONFIG_STAGING</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "/var/jenkins_home/.kube/config-staging"</span><span style="color:#6A737D"> // Path to kubeconfig</span></span>
<span class="line"><span style="color:#005CC5">        KUBE_CONFIG_PROD</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "/var/jenkins_home/.kube/config-prod"</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout Backend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                checkout </span><span style="color:#005CC5">scm</span><span style="color:#24292E">: [$</span><span style="color:#005CC5">class</span><span style="color:#24292E">: </span><span style="color:#032F62">'GitSCM'</span><span style="color:#24292E">, </span><span style="color:#005CC5">branches</span><span style="color:#24292E">: [[</span><span style="color:#005CC5">name</span><span style="color:#24292E">: </span><span style="color:#032F62">'*/main'</span><span style="color:#24292E">]], </span><span style="color:#005CC5">userRemoteConfigs</span><span style="color:#24292E">: [[</span><span style="color:#005CC5">url</span><span style="color:#24292E">: </span><span style="color:#032F62">'https://github.com/acme-webshop/backend.git'</span><span style="color:#24292E">]]]</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        mavenBuildTest() </span><span style="color:#6A737D">// From shared library</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build &amp; Push Backend Docker'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Backend-specific Docker steps</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">withRegistry(</span><span style="color:#032F62">'https://your-docker-registry.com'</span><span style="color:#24292E">, </span><span style="color:#032F62">'docker-credentials-id'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#D73A49">                        def</span><span style="color:#24292E"> img </span><span style="color:#D73A49">=</span><span style="color:#24292E"> docker</span><span style="color:#D73A49">.</span><span style="color:#24292E">build(</span><span style="color:#032F62">"acme/backend:${env.ACME_VERSION}"</span><span style="color:#24292E">)</span></span>
<span class="line"><span style="color:#24292E">                        img</span><span style="color:#D73A49">.</span><span style="color:#24292E">push()</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        provisionEnvironment(</span><span style="color:#032F62">'staging'</span><span style="color:#24292E">, </span><span style="color:#032F62">'infrastructure/staging'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Provision staging infra with Terraform</span></span>
<span class="line"><span style="color:#24292E">        deployAppToK8s(</span><span style="color:#032F62">'backend'</span><span style="color:#24292E">, env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">KUBE_CONFIG_STAGING</span><span style="color:#24292E">, </span><span style="color:#032F62">'staging'</span><span style="color:#24292E">, env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">ACME_VERSION</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Deploy backend to staging K8s</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Run Integration Tests on Staging'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Running API integration tests against staging environment..."</span></span>
<span class="line"><span style="color:#6A737D">                // Call a test runner (e.g., Newman for Postman collections, or a custom script)</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'./tests/run-api-tests.sh https://api.staging.acme.com'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Approve Production Deployment'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Manual gate, covered in future lessons</span></span>
<span class="line"><span style="color:#24292E">            input {</span></span>
<span class="line"><span style="color:#24292E">                message </span><span style="color:#032F62">"Proceed to Production Deployment?"</span></span>
<span class="line"><span style="color:#24292E">                ok </span><span style="color:#032F62">"Deploy to Production"</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">        provisionEnvironment(</span><span style="color:#032F62">'production'</span><span style="color:#24292E">, </span><span style="color:#032F62">'infrastructure/production'</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Provision production infra with Terraform</span></span>
<span class="line"><span style="color:#24292E">        deployAppToK8s(</span><span style="color:#032F62">'backend'</span><span style="color:#24292E">, env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">KUBE_CONFIG_PROD</span><span style="color:#24292E">, </span><span style="color:#032F62">'production'</span><span style="color:#24292E">, env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">ACME_VERSION</span><span style="color:#24292E">) </span><span style="color:#6A737D">// Deploy backend to production K8s</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Full Acme Webshop deployment pipeline finished."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"ACME Webshop ${env.ACME_VERSION} successfully deployed!"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This comprehensive example demonstrates orchestrating an entire CI/CD process for the Acme Webshop, from building and pushing Docker images (Module 4), to provisioning infrastructure with Terraform (Module 3), and deploying to Kubernetes (Module 4) using a shared library. The <code>provisionEnvironment</code> and <code>deployAppToK8s</code> shared library functions abstract complex operations, making the <code>Jenkinsfile</code> more readable and maintainable. This pipeline also integrates a manual approval gate, which is a common practice for production deployments.</p>
<h2>Exercises</h2>
<ol>
<li>
<p><strong>Refactor an existing Declarative Pipeline to use <code>vars/</code> from a Shared Library:</strong>
Take the initial Declarative Pipeline example for Acme Webshop (Checkout, Build, Test, Deploy Staging). Create a new Shared Library named <code>acme-core-library</code>.</p>
<ul>
<li>Move the <code>Build</code> and <code>Test</code> stages into a <code>vars/commonBuildTest.groovy</code> file within your <code>acme-core-library</code>.</li>
<li>Update the original <code>Jenkinsfile</code> to load <code>acme-core-library</code> and call <code>commonBuildTest()</code>.</li>
<li>Ensure the pipeline still executes successfully.</li>
</ul>
</li>
<li>
<p><strong>Enhance the Shared Library with <code>src/</code> for Environment-Specific Configurations:</strong>
Expand on the <code>acme-core-library</code> from Exercise 1.</p>
<ul>
<li>Create a class <code>src/org/acme/config/EnvConfig.groovy</code> that has a method <code>getEndpoint(String environment)</code> which returns a mock API endpoint string (e.g., "<a href="https://api.staging.acme.com">https://api.staging.acme.com</a>" for "staging", "<a href="https://api.prod.acme.com">https://api.prod.acme.com</a>" for "prod").</li>
<li>Modify <code>vars/acmeDeploy.groovy</code> (or create a new <code>vars/acmeDeployWithConfig.groovy</code>) to use this <code>EnvConfig</code> class to retrieve the API endpoint for post-deployment verification.</li>
<li>Update your <code>Jenkinsfile</code> to call this new deployment function and print the retrieved endpoint during the deployment stage.</li>
</ul>
</li>
<li>
<p><strong>Implement a <code>resources/</code> based deployment script:</strong></p>
<ul>
<li>Create a simple shell script in <code>resources/org/acme/scripts/deploy.sh</code> within your <code>acme-core-library</code>. This script can just <code>echo "Deploying application $1 to $2"</code> where <span class="katex"><span class="katex-mathml"><math xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mi>i</mi><mi>s</mi><mi>a</mi><mi>p</mi><mi>p</mi><mi>l</mi><mi>i</mi><mi>c</mi><mi>a</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>n</mi><mi>a</mi><mi>m</mi><mi>e</mi><mi>a</mi><mi>n</mi><mi>d</mi></mrow><annotation encoding="application/x-tex">1 is application name and </annotation></semantics></math></span><span class="katex-html" aria-hidden="true"><span class="base"><span class="strut" style="height: 0.8889em; vertical-align: -0.1944em;"></span><span class="mord">1</span><span class="mord mathnormal">i</span><span class="mord mathnormal">s</span><span class="mord mathnormal">a</span><span class="mord mathnormal" style="margin-right: 0.01968em;">ppl</span><span class="mord mathnormal">i</span><span class="mord mathnormal">c</span><span class="mord mathnormal">a</span><span class="mord mathnormal">t</span><span class="mord mathnormal">i</span><span class="mord mathnormal">o</span><span class="mord mathnormal">nnam</span><span class="mord mathnormal">e</span><span class="mord mathnormal">an</span><span class="mord mathnormal">d</span></span></span></span>2 is environment.</li>
<li>Modify a <code>vars/genericDeploy.groovy</code> function to use <code>libraryResource</code> to load and execute this <code>deploy.sh</code> script, passing the application name and environment as arguments.</li>
<li>Update your <code>Jenkinsfile</code> to use <code>genericDeploy('AcmeApp', 'test')</code>.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-6.2">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Scaling Jenkins for Enterprise Environments with Distributed Builds</h1><p>When a single Jenkins instance handles all build and deployment tasks for a large organization, it often becomes a performance bottleneck. This bottleneck can lead to long queue times for jobs, slow feedback to developers, and overall inefficiency in the CI/CD pipeline. Scaling Jenkins is crucial for enterprise environments to ensure high throughput, reliability, and responsiveness for numerous concurrent jobs, diverse project requirements, and demanding workloads. Distributed builds address these challenges by offloading build executions to external nodes, allowing the Jenkins controller to manage orchestration while specialized agents perform the heavy lifting.</p>
<h2>Understanding Jenkins Architecture for Scalability</h2>
<p>A standard Jenkins setup consists of a single Jenkins <em>controller</em> (formerly master) that manages all aspects of the CI/CD system, including scheduling jobs, storing configurations, providing the user interface, and executing builds. While this setup works well for smaller teams or fewer projects, it quickly becomes overwhelmed in enterprise scenarios.</p>
<p>To scale Jenkins, a distributed architecture is adopted where the Jenkins controller delegates build execution to one or more <em>agents</em> (formerly slaves or nodes). The controller acts as an orchestrator, handling scheduling, UI, and overall coordination, while agents execute the actual build steps. This separation of concerns allows for parallel execution of jobs and distributes the workload across multiple machines, significantly improving performance and resource utilization.</p>
<h3>Jenkins Controller Role</h3>
<p>The Jenkins controller's primary responsibilities include:</p>
<ul>
<li><strong>Job Scheduling:</strong> Determining when and where jobs should run.</li>
<li><strong>User Interface:</strong> Providing the web interface for users to configure jobs, view build status, and manage Jenkins.</li>
<li><strong>Configuration Management:</strong> Storing all Jenkins job configurations, plugin settings, and system-level configurations.</li>
<li><strong>Agent Management:</strong> Connecting to, monitoring, and managing the lifecycle of agents.</li>
<li><strong>Artifact Archiving:</strong> Storing build artifacts generated by agents (though it's often better to store large artifacts in external repositories).</li>
<li><strong>Reporting:</strong> Aggregating build results and providing status updates.</li>
</ul>
<p>The controller typically does not execute build steps itself in a distributed setup. Its focus is on coordination and management.</p>
<h3>Jenkins Agent Role</h3>
<p>Agents are machines (physical, virtual, or containerized) that connect to the Jenkins controller and execute jobs. Each agent can have specific capabilities, tools, and labels associated with it, allowing the controller to dispatch jobs to agents that meet the required criteria.</p>
<p>Key characteristics of agents:</p>
<ul>
<li><strong>Execution Environment:</strong> Agents provide the runtime environment for builds. This includes operating system, installed tools (e.g., JDK, Maven, Node.js, Docker), and access to necessary resources (e.g., source code repositories).</li>
<li><strong>Resource Isolation:</strong> Each agent can be configured with specific resources (CPU, memory, disk space), preventing resource contention between different jobs running on different agents.</li>
<li><strong>Scalability:</strong> New agents can be easily added or removed to scale the build capacity up or down as needed.</li>
<li><strong>Tooling Diversity:</strong> Different agents can host different toolchains, allowing a single Jenkins instance to support projects with diverse technology stacks (e.g., one agent for Java builds, another for Node.js builds, a third for Docker image builds).</li>
</ul>
<h3>Communication Between Controller and Agents</h3>
<p>The Jenkins controller communicates with agents using various protocols. The most common methods are:</p>
<ul>
<li><strong>SSH:</strong> For Linux/Unix-based agents, the controller can connect via SSH. This involves configuring SSH credentials on the controller and ensuring the agent machine has an SSH server running. Jenkins transfers a small agent program (JAR file) to the agent, which then establishes a persistent connection back to the controller.</li>
<li><strong>JNLP (Java Network Launch Protocol):</strong> This is a Java-based protocol where the agent initiates the connection to the controller. This is often preferred for agents behind firewalls or when the controller cannot directly initiate an SSH connection. The agent downloads the <code>agent.jar</code> file from the controller's URL and runs it.</li>
<li><strong>Containerization (e.g., Docker, Kubernetes):</strong> Modern approaches leverage containers for agents. Jenkins can dynamically provision agents as Docker containers or Kubernetes pods, which automatically connect back to the controller. This provides on-demand, ephemeral agents that are spun up for a job and torn down afterward, offering significant flexibility and resource efficiency.</li>
</ul>
<p><strong>Example Scenario: Acme Webshop Distributed Builds</strong></p>
<p>Recall the Acme Webshop application from earlier lessons. As the development team grows and features are added, the number of builds increases. Currently, the single Jenkins controller is struggling to keep up.</p>
<ul>
<li><strong>Problem:</strong> Java backend builds, Node.js frontend builds, and Docker image builds are all running on the same Jenkins controller. This leads to long build times, resource exhaustion on the controller, and frequent build failures due to environment conflicts (e.g., different Node.js versions required for different projects).</li>
<li><strong>Solution:</strong> Introduce Jenkins agents.
<ul>
<li>A dedicated <strong>Java Agent</strong> will handle all Java backend builds. It will have JDK 11, Maven, and unit testing frameworks installed.</li>
<li>A dedicated <strong>Node.js Agent</strong> will handle all frontend builds. It will have Node.js 16, npm, and required frontend testing tools installed.</li>
<li>A dedicated <strong>Docker Agent</strong> will be responsible for building Docker images for both backend and frontend applications. It will have Docker installed and sufficient resources.</li>
</ul>
</li>
</ul>
<p>This setup ensures that each build type runs in its optimized environment, preventing conflicts and improving build performance.</p>
<h2>Configuring Jenkins Agents</h2>
<p>Setting up agents involves several steps, from provisioning the agent machine to configuring it within Jenkins.</p>
<h3>Agent Provisioning</h3>
<p>The first step is to prepare the machine that will act as an agent. This involves:</p>
<ol>
<li><strong>Operating System:</strong> Install a suitable operating system (e.g., Ubuntu, CentOS, Windows Server).</li>
<li><strong>Java Runtime Environment (JRE):</strong> Install a JRE compatible with your Jenkins controller (typically OpenJDK 11 or later).</li>
<li><strong>Required Tools:</strong> Install all tools necessary for the types of builds that will run on this agent (e.g., Git, Maven, npm, Docker, Python).</li>
<li><strong>Network Connectivity:</strong> Ensure the agent machine can communicate with the Jenkins controller (and vice-versa, depending on the connection method) and access external resources like source code repositories.</li>
</ol>
<h3>Adding an Agent to Jenkins</h3>
<p>Once the agent machine is prepared, it needs to be registered with the Jenkins controller.</p>
<ol>
<li>Navigate to <strong>Manage Jenkins &gt; Nodes</strong>.</li>
<li>Click <strong>New Node</strong>.</li>
<li>Provide a <strong>Node name</strong> (e.g., <code>java-build-agent-01</code>).</li>
<li>Select <strong>Permanent Agent</strong> and click <strong>Create</strong>.</li>
<li>Configure the agent details:
<ul>
<li><strong>Description:</strong> A brief explanation of the agent's purpose (e.g., "Agent for Java backend builds").</li>
<li><strong>Number of executors:</strong> How many concurrent jobs this agent can run. Set this based on the agent's CPU and memory resources. A common practice is 1-2 executors per CPU core.</li>
<li><strong>Remote root directory:</strong> The directory on the agent machine where Jenkins will store workspace data for jobs. (e.g., <code>/var/jenkins_home</code>).</li>
<li><strong>Labels:</strong> Crucial for directing jobs to specific agents. Use descriptive labels (e.g., <code>java</code>, <code>maven</code>, <code>linux</code>). A job can specify which labels it requires.</li>
<li><strong>Usage:</strong>
<ul>
<li><strong>Use this node as much as possible:</strong> Jenkins will prefer this agent if labels match.</li>
<li><strong>Only build jobs with label expressions matching this node:</strong> This agent will only run jobs that explicitly request its labels. This is generally recommended for specialized agents.</li>
</ul>
</li>
<li><strong>Launch Method:</strong> How the controller connects to the agent.
<ul>
<li><strong>Launch agent by connecting it to the controller:</strong> (JNLP) The agent initiates the connection. Jenkins provides instructions to run the <code>agent.jar</code> on the agent machine.</li>
<li><strong>Launch agent via SSH:</strong> The controller initiates the connection using SSH credentials. Requires SSH server on agent and SSH credentials in Jenkins.</li>
</ul>
</li>
<li><strong>Availability:</strong>
<ul>
<li><strong>Keep this agent online as much as possible:</strong> Default for permanent agents.</li>
<li><strong>Bring this agent online when in demand and take it offline when idle:</strong> Useful for cloud-based or dynamic agents to save costs.</li>
</ul>
</li>
</ul>
</li>
</ol>
<h3>Connecting the Agent (SSH Example)</h3>
<p>If using SSH, after configuring the agent details, Jenkins will attempt to connect. Ensure:</p>
<ul>
<li>An SSH server is running on the agent machine.</li>
<li>Jenkins has valid SSH credentials (username/password or SSH key) configured in <strong>Manage Jenkins &gt; Credentials</strong>.</li>
<li>The Jenkins controller's firewall allows outbound SSH connections to the agent on port 22 (or custom port).</li>
<li>The agent machine's firewall allows inbound SSH connections from the controller.</li>
</ul>
<p>Upon successful connection, the agent's status will change to "Online".</p>
<h3>Connecting the Agent (JNLP Example)</h3>
<p>If using JNLP:</p>
<ol>
<li>After configuring the agent, Jenkins will display instructions on the agent configuration page.</li>
<li>These instructions typically include a command like:
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">bash</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6F42C1">java</span><span style="color:#005CC5"> -jar</span><span style="color:#032F62"> agent.jar</span><span style="color:#005CC5"> -jnlpUrl</span><span style="color:#032F62"> http://</span><span style="color:#D73A49">&lt;</span><span style="color:#032F62">jenkins_controller_i</span><span style="color:#24292E">p</span><span style="color:#D73A49">&gt;</span><span style="color:#032F62">:</span><span style="color:#D73A49">&lt;</span><span style="color:#032F62">por</span><span style="color:#24292E">t</span><span style="color:#D73A49">&gt;</span><span style="color:#032F62">/computer/</span><span style="color:#D73A49">&lt;</span><span style="color:#032F62">node_nam</span><span style="color:#24292E">e</span><span style="color:#D73A49">&gt;</span><span style="color:#032F62">/slave-agent.jnlp</span><span style="color:#005CC5"> -secret</span><span style="color:#D73A49"> &lt;</span><span style="color:#032F62">secret_ke</span><span style="color:#24292E">y</span><span style="color:#D73A49">&gt;</span><span style="color:#005CC5"> -workDir</span><span style="color:#032F62"> "/var/jenkins_home"</span></span></code></pre></div></div></div>
</li>
<li>On the agent machine, download the <code>agent.jar</code> file from the Jenkins controller (e.g., <code>http://&lt;jenkins_controller_ip&gt;:&lt;port&gt;/jnlpJars/agent.jar</code>).</li>
<li>Execute the command provided by Jenkins. It's common to run this command in a background process or as a system service for persistent connection.</li>
</ol>
<p><strong>Acme Webshop Example: Agent Configuration</strong></p>
<p>Let's configure the <code>java-build-agent-01</code> for the Acme Webshop:</p>
<ul>
<li><strong>Node name:</strong> <code>java-build-agent-01</code></li>
<li><strong>Description:</strong> "Linux agent for Java backend applications, runs Maven builds."</li>
<li><strong>Number of executors:</strong> 2</li>
<li><strong>Remote root directory:</strong> <code>/var/jenkins_home/java</code></li>
<li><strong>Labels:</strong> <code>java maven linux</code></li>
<li><strong>Usage:</strong> "Only build jobs with label expressions matching this node"</li>
<li><strong>Launch Method:</strong> "Launch agent via SSH" (assuming SSH is set up)</li>
</ul>
<p>After configuration, a pipeline stage for the Acme backend could specify:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent {</span></span>
<span class="line"><span style="color:#24292E">        label </span><span style="color:#032F62">'java &amp;&amp; maven'</span><span style="color:#6A737D"> // Ensure job runs on an agent with both labels</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Java Backend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This ensures the backend build runs exclusively on the <code>java-build-agent-01</code> (or any other agent matching these labels), utilizing its specialized environment.</p>
<h2>Leveraging Labels for Efficient Job Distribution</h2>
<p>Labels are a fundamental mechanism in Jenkins for controlling where jobs run. They allow you to categorize agents based on their capabilities, installed software, operating system, or any other relevant characteristic.</p>
<h3>How Labels Work</h3>
<p>When defining an agent, you assign one or more labels to it. For example, an agent installed on a Linux machine with Maven and JDK 11 might have labels <code>linux</code>, <code>maven</code>, <code>jdk11</code>.</p>
<p>In a Jenkins Pipeline, you specify the <code>agent</code> directive with a <code>label</code> expression. Jenkins then dynamically selects an available agent that satisfies the label expression.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent { label </span><span style="color:#032F62">'linux &amp;&amp; maven'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Requires an agent with both 'linux' AND 'maven' labels</span></span>
<span class="line"><span style="color:#6A737D">    // ... stages</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<h3>Best Practices for Labels</h3>
<ol>
<li>
<p><strong>Granularity:</strong> Use labels that are specific enough to distinguish between different agent capabilities but not so specific that they become unmanageable.</p>
<ul>
<li><em>Good:</em> <code>linux</code>, <code>windows</code>, <code>docker</code>, <code>java11</code>, <code>node16</code>, <code>maven</code>, <code>gradle</code></li>
<li><em>Less good:</em> <code>my-specific-server-java-11</code>, <code>build-server-2-for-project-x</code> (too specific, hard to generalize)</li>
</ul>
</li>
<li>
<p><strong>Combine Labels with Operators:</strong></p>
<ul>
<li><strong>AND (<code>&amp;&amp;</code>):</strong> Requires an agent to have <em>all</em> specified labels.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">agent { label </span><span style="color:#032F62">'linux &amp;&amp; docker'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Agent must be Linux AND have Docker</span></span></code></pre></div></div></div>
</li>
<li><strong>OR (<code>||</code>):</strong> Requires an agent to have <em>at least one</em> of the specified labels.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">agent { label </span><span style="color:#032F62">'windows || linux'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Agent can be Windows OR Linux</span></span></code></pre></div></div></div>
</li>
<li><strong>NOT (<code>!</code>):</strong> Excludes agents with a specific label.
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">agent { label </span><span style="color:#032F62">'docker &amp;&amp; !windows'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Agent must have Docker AND not be Windows</span></span></code></pre></div></div></div>
</li>
</ul>
</li>
<li>
<p><strong>Default Agents vs. Specialized Agents:</strong></p>
<ul>
<li>You can have a few general-purpose agents without specific labels for common tasks.</li>
<li>Most enterprise environments benefit from specialized agents with unique labels for specific toolchains (e.g., <code>gpu</code> for machine learning builds, <code>ios</code> for iOS mobile builds, <code>selenium</code> for UI testing).</li>
<li>Always set "Usage" to "Only build jobs with label expressions matching this node" for specialized agents to prevent unintended job execution.</li>
</ul>
</li>
</ol>
<p><strong>Acme Webshop Example: Labeling Strategy</strong></p>
<p>For the Acme Webshop, a clear labeling strategy would be:</p>
<ul>
<li><strong>Agent 1: <code>java-backend-agent</code></strong>
<ul>
<li>Labels: <code>linux</code>, <code>java11</code>, <code>maven</code>, <code>backend</code></li>
<li>Used for: Building the Java backend, running unit tests, packaging JARs.</li>
</ul>
</li>
<li><strong>Agent 2: <code>nodejs-frontend-agent</code></strong>
<ul>
<li>Labels: <code>linux</code>, <code>node16</code>, <code>npm</code>, <code>frontend</code></li>
<li>Used for: Building the Node.js frontend, running E2E tests, packaging static assets.</li>
</ul>
</li>
<li><strong>Agent 3: <code>docker-builder-agent</code></strong>
<ul>
<li>Labels: <code>linux</code>, <code>docker</code>, <code>container</code></li>
<li>Used for: Building Docker images for both backend and frontend, pushing to registry.</li>
</ul>
</li>
</ul>
<p>Now, pipeline stages can precisely target the correct environment:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent none </span><span style="color:#6A737D">// Overall pipeline doesn't have a default agent</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Backend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent { label </span><span style="color:#032F62">'backend &amp;&amp; java11'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Runs on java-backend-agent</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Frontend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent { label </span><span style="color:#032F62">'frontend &amp;&amp; node16'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Runs on nodejs-frontend-agent</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm install &amp;&amp; npm run build'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Docker Images'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent { label </span><span style="color:#032F62">'docker &amp;&amp; linux'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Runs on docker-builder-agent</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                dir(</span><span style="color:#032F62">'backend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'docker build -t acme/backend:$(GIT_COMMIT) .'</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">                dir(</span><span style="color:#032F62">'frontend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'docker build -t acme/frontend:$(GIT_COMMIT) .'</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Staging'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent { label </span><span style="color:#032F62">'docker &amp;&amp; linux'</span><span style="color:#24292E"> } </span><span style="color:#6A737D">// Can also use docker-builder-agent for deployment</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'kubectl apply -f k8s/staging/'</span><span style="color:#6A737D"> // Assumes kubectl is also on docker agent</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This demonstrates how <code>agent none</code> at the <code>pipeline</code> level allows individual <code>stage</code> blocks to define their own <code>agent</code> directives, providing granular control over where each part of the pipeline executes.</p>
<h2>Dynamic Agents with Cloud Providers and Containers</h2>
<p>While permanent agents are suitable for stable, long-running workloads, they can be inefficient for bursty or highly variable demands. Dynamic agents address this by provisioning agents on-demand, scaling up when needed and scaling down when idle. This approach is highly cost-effective and provides elastic scalability.</p>
<h3>Cloud Agents (e.g., AWS EC2, Azure VMs, Google Compute Engine)</h3>
<p>Jenkins integrates with various cloud providers to dynamically provision virtual machines as agents. Plugins like Amazon EC2 Plugin, Azure VM Agents Plugin, or Google Compute Engine Plugin allow Jenkins to:</p>
<ol>
<li><strong>Define Image Templates:</strong> Configure a base VM image (AMI for EC2, VHD for Azure) with Jenkins agent software and necessary build tools pre-installed.</li>
<li><strong>Spin Up On-Demand:</strong> When a job requires an agent, and no suitable existing agent is available, Jenkins requests a new VM instance from the cloud provider based on a predefined template.</li>
<li><strong>Connect:</strong> The newly provisioned VM boots up, installs the Jenkins agent, and connects to the controller (often via JNLP or SSH).</li>
<li><strong>Execute Job:</strong> The job runs on this temporary agent.</li>
<li><strong>Terminate:</strong> After a period of inactivity or completion of the job(s), Jenkins automatically terminates the VM instance, saving costs.</li>
</ol>
<p><strong>Real-World Example: AWS EC2 Agents</strong></p>
<p>A company running its CI/CD on AWS uses the EC2 plugin. They configure an EC2 AMI with Java, Maven, and Docker installed, labeled <code>aws-java-docker</code>. When a new Java project build is triggered, and all existing <code>aws-java-docker</code> agents are busy, Jenkins launches a new EC2 instance from the AMI, connects it as an agent, runs the build, and then terminates it after a configurable idle timeout (e.g., 10 minutes). This prevents idle resource consumption.</p>
<h3>Containerized Agents (Docker and Kubernetes)</h3>
<p>Containerized agents are arguably the most modern and flexible approach to distributed builds.</p>
<h4>Docker Agents</h4>
<p>With the Jenkins Docker plugin, Jenkins can:</p>
<ol>
<li><strong>Define Docker Images as Agent Templates:</strong> Instead of VM images, you specify Docker images that contain your build tools.</li>
<li><strong>Launch Containers:</strong> When a job needs an agent, Jenkins launches a new Docker container from the specified image.</li>
<li><strong>Connect:</strong> The container-agent automatically connects to the Jenkins controller.</li>
<li><strong>Execute Job:</strong> The job runs inside the isolated container.</li>
<li><strong>Remove Container:</strong> After the job, the container is removed.</li>
</ol>
<p><strong>Advantages of Docker Agents:</strong></p>
<ul>
<li><strong>Fast Provisioning:</strong> Containers start up much faster than VMs.</li>
<li><strong>Resource Efficiency:</strong> Lighter weight than VMs, allowing more agents on a single host.</li>
<li><strong>Environment Consistency:</strong> Ensures identical build environments for every job.</li>
<li><strong>Immutable Infrastructure:</strong> Agents are transient and disposable.</li>
</ul>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Example Jenkins Pipeline with a Docker agent for a stage</span></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent none </span><span style="color:#6A737D">// No default agent for the whole pipeline</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build in Maven Docker container'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent {</span></span>
<span class="line"><span style="color:#24292E">                docker {</span></span>
<span class="line"><span style="color:#24292E">                    image </span><span style="color:#032F62">'maven:3.8.7-openjdk-11'</span><span style="color:#6A737D"> // Use a specific Maven image</span></span>
<span class="line"><span style="color:#24292E">                    args </span><span style="color:#032F62">'-u root:root'</span><span style="color:#6A737D"> // Run as root inside the container if needed</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install'</span><span style="color:#6A737D"> // Maven command runs inside the container</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Run Node.js Tests'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            agent {</span></span>
<span class="line"><span style="color:#24292E">                docker {</span></span>
<span class="line"><span style="color:#24292E">                    image </span><span style="color:#032F62">'node:16-alpine'</span><span style="color:#6A737D"> // Use a Node.js image</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'npm install &amp;&amp; npm test'</span><span style="color:#6A737D"> // Node.js commands run inside the container</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this example, each stage dynamically pulls a specific Docker image, creates a container, runs the steps, and then cleans up the container. This provides isolated, consistent environments for each part of the pipeline.</p>
<h4>Kubernetes Agents</h4>
<p>The Kubernetes Plugin takes dynamic agents a step further. Instead of individual Docker containers on a single host, Jenkins can launch agents as Kubernetes pods within a Kubernetes cluster.</p>
<ol>
<li><strong>Pod Templates:</strong> Define Kubernetes Pod templates in Jenkins, specifying containers, volumes, resource limits, and labels. Each container within the pod can represent a different tool (e.g., one container for <code>maven</code>, another for <code>kubectl</code>).</li>
<li><strong>Dynamic Pod Creation:</strong> When a job with a matching label expression is triggered, Jenkins creates a new Pod in the Kubernetes cluster.</li>
<li><strong>Container Execution:</strong> The Jenkins agent runs as a container within this Pod (usually the <code>jnlp</code> container), connecting to the controller. Build steps execute in other specified containers within the same pod or within the agent container itself.</li>
<li><strong>Pod Deletion:</strong> After the job finishes or the pod idles, Jenkins deletes the Pod from the cluster.</li>
</ol>
<p><strong>Advantages of Kubernetes Agents:</strong></p>
<ul>
<li><strong>Unmatched Scalability:</strong> Kubernetes handles the provisioning and scheduling of pods across the cluster.</li>
<li><strong>Resource Management:</strong> Leverages Kubernetes' resource limits and quotas.</li>
<li><strong>Multi-Container Pods (Sidecars):</strong> A single agent pod can have multiple containers, allowing different tools to be available in the same isolated environment for a job (e.g., a <code>maven</code> container and a <code>docker-in-docker</code> container in the same pod).</li>
<li><strong>Cloud Native:</strong> Integrates seamlessly with cloud-based Kubernetes services (EKS, GKE, AKS).</li>
</ul>
<p><strong>Acme Webshop Example: Kubernetes Agent (Hypothetical Scenario)</strong></p>
<p>The Acme Webshop team expands globally, requiring massive build capacity. They migrate their Jenkins setup to run on Kubernetes.</p>
<ol>
<li><strong>Jenkins Controller:</strong> Runs as a deployment in a Kubernetes cluster.</li>
<li><strong>Agent Pod Templates:</strong>
<ul>
<li><strong><code>maven-build-pod</code>:</strong> Defines a Pod with a <code>maven:3.8.7-openjdk-11</code> container and a <code>jnlp</code> agent container. Labels: <code>k8s-maven</code>, <code>java11</code>.</li>
<li><strong><code>nodejs-build-pod</code>:</strong> Defines a Pod with a <code>node:16-alpine</code> container and a <code>jnlp</code> agent container. Labels: <code>k8s-node</code>, <code>node16</code>.</li>
<li><strong><code>docker-build-pod</code>:</strong> Defines a Pod with a <code>docker:dind</code> (Docker-in-Docker) container for building images, a <code>kubectl</code> container for deployments, and a <code>jnlp</code> agent container. Labels: <code>k8s-docker</code>, <code>deploy</code>.</li>
</ul>
</li>
</ol>
<p>Now, a pipeline stage for building a Docker image might look like this:</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent {</span></span>
<span class="line"><span style="color:#24292E">        kubernetes {</span></span>
<span class="line"><span style="color:#24292E">            cloud </span><span style="color:#032F62">'kubernetes'</span><span style="color:#6A737D"> // Refers to the Kubernetes cloud definition in Jenkins</span></span>
<span class="line"><span style="color:#24292E">            yaml </span><span style="color:#032F62">'''</span></span>
<span class="line"><span style="color:#032F62">                apiVersion: v1</span></span>
<span class="line"><span style="color:#032F62">                kind: Pod</span></span>
<span class="line"><span style="color:#032F62">                metadata:</span></span>
<span class="line"><span style="color:#032F62">                  labels:</span></span>
<span class="line"><span style="color:#032F62">                    build: docker</span></span>
<span class="line"><span style="color:#032F62">                spec:</span></span>
<span class="line"><span style="color:#032F62">                  containers:</span></span>
<span class="line"><span style="color:#032F62">                  - name: docker</span></span>
<span class="line"><span style="color:#032F62">                    image: docker:dind</span></span>
<span class="line"><span style="color:#032F62">                    command:</span></span>
<span class="line"><span style="color:#032F62">                    - cat</span></span>
<span class="line"><span style="color:#032F62">                    tty: true</span></span>
<span class="line"><span style="color:#032F62">                    resources:</span></span>
<span class="line"><span style="color:#032F62">                      requests:</span></span>
<span class="line"><span style="color:#032F62">                        memory: "512Mi"</span></span>
<span class="line"><span style="color:#032F62">                        cpu: "250m"</span></span>
<span class="line"><span style="color:#032F62">                      limits:</span></span>
<span class="line"><span style="color:#032F62">                        memory: "1Gi"</span></span>
<span class="line"><span style="color:#032F62">                        cpu: "1"</span></span>
<span class="line"><span style="color:#032F62">                    securityContext:</span></span>
<span class="line"><span style="color:#032F62">                      privileged: true</span></span>
<span class="line"><span style="color:#032F62">                    volumeMounts:</span></span>
<span class="line"><span style="color:#032F62">                    - name: docker-graph-storage</span></span>
<span class="line"><span style="color:#032F62">                      mountPath: /var/lib/docker</span></span>
<span class="line"><span style="color:#032F62">                  - name: kubectl</span></span>
<span class="line"><span style="color:#032F62">                    image: bitnami/kubectl:1.24.10</span></span>
<span class="line"><span style="color:#032F62">                    command:</span></span>
<span class="line"><span style="color:#032F62">                    - cat</span></span>
<span class="line"><span style="color:#032F62">                    tty: true</span></span>
<span class="line"><span style="color:#032F62">                  volumes:</span></span>
<span class="line"><span style="color:#032F62">                  - name: docker-graph-storage</span></span>
<span class="line"><span style="color:#032F62">                    emptyDir: {}</span></span>
<span class="line"><span style="color:#032F62">            '''</span></span>
<span class="line"><span style="color:#6A737D">            // Alternative: use predefined podTemplate via label</span></span>
<span class="line"><span style="color:#6A737D">            // label 'k8s-docker'</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build Docker Image'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            container(</span><span style="color:#032F62">'docker'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Execute steps in the 'docker' container within the pod</span></span>
<span class="line"><span style="color:#24292E">                steps {</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'dockerd-entrypoint.sh &amp;'</span><span style="color:#6A737D"> // Start Docker daemon in DIND container</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'sleep 10'</span><span style="color:#6A737D"> // Give it time to start</span></span>
<span class="line"><span style="color:#24292E">                    dir(</span><span style="color:#032F62">'backend'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">                        sh </span><span style="color:#032F62">'docker build -t acme/backend:$(GIT_COMMIT) .'</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Kubernetes'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            container(</span><span style="color:#032F62">'kubectl'</span><span style="color:#24292E">) { </span><span style="color:#6A737D">// Execute steps in the 'kubectl' container</span></span>
<span class="line"><span style="color:#24292E">                steps {</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'kubectl config use-context my-cluster'</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'kubectl apply -f k8s/production/'</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This pipeline defines a dynamic Kubernetes pod containing both a <code>docker</code> and a <code>kubectl</code> container. The <code>container('name')</code> directive ensures specific steps run within the designated container, providing extreme isolation and flexibility.</p>
<h2>Best Practices for Scaling Jenkins</h2>
<ol>
<li><strong>Separate Controller and Agents:</strong> Never run builds on the Jenkins controller itself in an enterprise environment. The controller should be dedicated to orchestration.</li>
<li><strong>Immutable Agents:</strong> Treat agents as disposable. If an agent becomes corrupted or requires updates, replace it rather than trying to fix it in place. Dynamic agents (Docker, Kubernetes) inherently support this.</li>
<li><strong>Agent Templates and Automation:</strong> Use configuration management tools (Ansible, Puppet) or cloud images/Dockerfiles to automate agent provisioning and ensure consistency.</li>
<li><strong>Leverage Labels Effectively:</strong> Design a clear labeling strategy that reflects agent capabilities and use labels judiciously in your pipelines to route jobs.</li>
<li><strong>Monitor Agent Health:</strong> Implement monitoring for agents (CPU, memory, disk usage) to identify bottlenecks and ensure they are healthy. Jenkins itself provides basic agent monitoring.</li>
<li><strong>Offload Artifact Storage:</strong> Do not store large build artifacts on the Jenkins controller. Use external artifact repositories (e.g., Nexus, Artifactory, S3) for build outputs. This reduces controller load and provides better artifact management.</li>
<li><strong>Optimize Pipeline Stages:</strong> Break down complex pipelines into smaller, independent stages that can leverage different specialized agents. Use <code>agent none</code> at the pipeline level and specific <code>agent</code> directives at the stage level.</li>
<li><strong>Resource Allocation:</strong> Correctly size agents for their expected workload. Too few executors or insufficient resources will lead to queues and slow builds.</li>
<li><strong>Security:</strong> Secure agent connections (SSH keys, JNLP secrets). Ensure agents only have necessary permissions and access to resources required for their tasks.</li>
<li><strong>Centralized Log Management:</strong> Integrate agent logs into a centralized logging system (ELK stack, Splunk) for easier troubleshooting across a distributed environment.</li>
</ol>
<h2>Exercises</h2>
<ol>
<li>
<p><strong>Configure a Permanent Agent:</strong></p>
<ul>
<li>Set up a new virtual machine (e.g., using VirtualBox, VMware, or a cloud free tier).</li>
<li>Install OpenJDK 11, Git, and Maven on this VM.</li>
<li>Add this VM as a "Permanent Agent" to your Jenkins controller using the SSH launch method.</li>
<li>Assign labels <code>linux</code>, <code>java11</code>, <code>maven</code> to this agent.</li>
<li>Create a simple Jenkins Declarative Pipeline job that uses <code>agent { label 'linux &amp;&amp; java11' }</code> and executes <code>mvn --version</code>. Confirm the job runs on your new agent.</li>
</ul>
</li>
<li>
<p><strong>Modify Acme Webshop Pipeline for Labeled Agents:</strong></p>
<ul>
<li>Assume you have three agents configured with the following labels:
<ul>
<li><code>backend-builder</code> (labels: <code>linux</code>, <code>java11</code>, <code>maven</code>)</li>
<li><code>frontend-builder</code> (labels: <code>linux</code>, <code>node16</code>, <code>npm</code>)</li>
<li><code>docker-host</code> (labels: <code>linux</code>, <code>docker</code>)</li>
</ul>
</li>
<li>Modify the <code>Acme Webshop</code> pipeline (from previous lessons) to distribute its stages across these agents:
<ul>
<li><code>Build Backend</code> stage should run on <code>backend-builder</code>.</li>
<li><code>Build Frontend</code> stage should run on <code>frontend-builder</code>.</li>
<li><code>Build Docker Images</code> stage (for both backend and frontend) should run on <code>docker-host</code>.</li>
</ul>
</li>
<li>Ensure the overall pipeline uses <code>agent none</code> and individual stages specify their agents using labels.</li>
</ul>
</li>
<li>
<p><strong>Explore Dynamic Docker Agents (Optional, Advanced):</strong></p>
<ul>
<li>Install the "CloudBees Docker Build and Publish" plugin (or the standard Docker plugin if available for your Jenkins version) on your Jenkins controller.</li>
<li>Configure a Docker Cloud provider in Jenkins, pointing to a Docker host (can be the Jenkins controller's host if Docker is installed there, or a remote Docker daemon).</li>
<li>Define a Docker Agent template using the <code>maven:3.8.7-openjdk-11</code> image.</li>
<li>Create a new pipeline job that uses <code>agent { docker { image 'maven:3.8.7-openjdk-11' } }</code> for a build stage and runs <code>mvn clean verify</code>. Observe how Jenkins dynamically launches a Docker container to execute the build.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-6.3">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Implementing Multi-Branch and Pull Request-Driven Pipelines</h1><p>Multi-branch and Pull Request (PR)-driven pipelines are critical for managing complex development workflows in modern DevOps environments. These pipeline strategies enable teams to automate CI/CD processes directly from their version control system, ensuring that every code change, regardless of its origin branch or whether it's part of a pull request, triggers the necessary checks and deployments. This approach facilitates rapid feedback, improves code quality, and streamlines the integration of features while maintaining the stability of the main codebase.</p>
<h2>Understanding Multi-Branch Pipelines</h2>
<p>Multi-branch pipelines automate the creation and management of Jenkins pipelines based on the branches discovered in a source code repository. Instead of defining a separate Jenkinsfile for each branch manually, a single Jenkinsfile stored within the repository itself dictates the pipeline behavior for all branches. When a new branch matching specific criteria is pushed to the repository, Jenkins automatically detects it, creates a corresponding pipeline, and executes it. This eliminates the overhead of manual pipeline configuration and ensures that all branches follow the same CI/CD standards.</p>
<h3>How Multi-Branch Pipelines Work</h3>
<p>A multi-branch pipeline project in Jenkins periodically scans a specified SCM (Source Code Management) repository (e.g., Git). Upon scanning, it identifies branches that contain a <code>Jenkinsfile</code>. For each identified branch, Jenkins dynamically creates a new pipeline item. The configuration for this pipeline item is extracted directly from the <code>Jenkinsfile</code> present in that specific branch. This means that if <code>feature-branch-A</code> has a <code>Jenkinsfile</code> and <code>feature-branch-B</code> has a different <code>Jenkinsfile</code>, they will each get their own distinct pipeline definitions and executions.</p>
<p><strong>Example 1: Basic Multi-Branch Configuration</strong></p>
<p>Consider the "Acme Webshop" application. The development team uses a Git repository with various feature branches, development branches, and the main branch. A multi-branch pipeline can be configured to automatically build and test code on every branch.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop</span></span>
<span class="line"><span style="color:#6A737D">// Located at the root of the repository</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Checkout the current branch's code</span></span>
<span class="line"><span style="color:#24292E">                checkout scm</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building Acme Webshop for branch: ${env.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#6A737D">                // For a Java application, this might be:</span></span>
<span class="line"><span style="color:#6A737D">                // sh 'mvn clean install'</span></span>
<span class="line"><span style="color:#6A737D">                // For a Node.js application:</span></span>
<span class="line"><span style="color:#6A737D">                // sh 'npm install'</span></span>
<span class="line"><span style="color:#6A737D">                // sh 'npm run build'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Running tests for Acme Webshop on branch: ${env.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#6A737D">                // For a Java application:</span></span>
<span class="line"><span style="color:#6A737D">                // sh 'mvn test'</span></span>
<span class="line"><span style="color:#6A737D">                // For a Node.js application:</span></span>
<span class="line"><span style="color:#6A737D">                // sh 'npm test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Pipeline finished for branch: ${env.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#6A737D">            // Optionally clean up workspace or publish results</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build and tests passed successfully."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build or tests failed."</span></span>
<span class="line"><span style="color:#6A737D">            // Add notification logic, e.g., email or Slack</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this example, every time a new branch is pushed to the Git repository containing this <code>Jenkinsfile</code>, Jenkins will automatically create a new pipeline job for that branch. Each job will then execute the build and test stages according to the <code>Jenkinsfile</code> in <em>that specific branch</em>. This ensures consistency while allowing for branch-specific pipeline logic if needed.</p>
<p><strong>Example 2: Branch-Specific Deployments in Multi-Branch</strong></p>
<p>Different branches might require different deployment targets or additional stages. For instance, <code>main</code> might deploy to production, <code>develop</code> to staging, and feature branches might just build and run tests without deployment.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop with conditional deployment</span></span>
<span class="line"><span style="color:#6A737D">// Located at the root of the repository</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                checkout scm</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building Acme Webshop for branch: ${env.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean install -DskipTests'</span><span style="color:#6A737D"> // Build without running tests here</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Running tests for Acme Webshop on branch: ${env.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Staging'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when {</span></span>
<span class="line"><span style="color:#24292E">                branch </span><span style="color:#032F62">'develop'</span><span style="color:#6A737D"> // This stage only runs for the 'develop' branch</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Deploying to Staging environment from develop branch..."</span></span>
<span class="line"><span style="color:#6A737D">                // Call a shared library function for deployment or run a script</span></span>
<span class="line"><span style="color:#6A737D">                // deployToEnvironment 'staging'</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'./scripts/deploy-staging.sh'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Production'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when {</span></span>
<span class="line"><span style="color:#24292E">                branch </span><span style="color:#032F62">'main'</span><span style="color:#6A737D"> // This stage only runs for the 'main' branch</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Deploying to Production environment from main branch..."</span></span>
<span class="line"><span style="color:#6A737D">                // This would typically involve a manual approval step or specific credentials</span></span>
<span class="line"><span style="color:#6A737D">                // deployToEnvironment 'production'</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'./scripts/deploy-production.sh'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Pipeline finished for branch: ${env.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build and tests passed successfully."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build or tests failed. See logs for details."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>This <code>Jenkinsfile</code> illustrates how to use the <code>when</code> directive to define conditions for stages. The <code>develop</code> branch will execute all stages up to "Deploy to Staging", while the <code>main</code> branch will run "Build", "Test", and then "Deploy to Production". Other feature branches would only execute "Build" and "Test".</p>
<h2>Implementing Pull Request (PR)-Driven Pipelines</h2>
<p>Pull Request-driven pipelines are an extension of multi-branch pipelines, specifically designed to automate the CI/CD process for proposed code changes. When a developer creates a pull request (or merge request in GitLab) to merge a feature branch into a target branch (e.g., <code>main</code> or <code>develop</code>), the PR-driven pipeline automatically triggers. This pipeline typically builds the proposed changes, runs tests, performs static code analysis, and ensures that the new code integrates cleanly with the target branch <em>before</em> it is merged.</p>
<h3>Benefits of PR-Driven Pipelines</h3>
<ul>
<li><strong>Early Feedback:</strong> Developers receive immediate feedback on the quality and correctness of their code changes.</li>
<li><strong>Prevent Breaking Changes:</strong> Automated checks identify issues before code is merged into a stable branch, preventing regressions.</li>
<li><strong>Improved Code Quality:</strong> Integration with tools like static code analysis (SAST) and code coverage ensures higher standards.</li>
<li><strong>Streamlined Code Review:</strong> Reviewers can rely on automated checks, focusing their attention on logic and design rather than basic errors.</li>
<li><strong>Enhanced Collaboration:</strong> Promotes a culture of quality and shared responsibility for the codebase.</li>
</ul>
<h3>How PR-Driven Pipelines Work</h3>
<p>Many CI/CD tools, including Jenkins, integrate with SCM platforms like GitHub, GitLab, and Bitbucket to automatically detect pull request events. When a PR is opened or updated, the CI/CD system:</p>
<ol>
<li><strong>Clones the PR's merge commit:</strong> Often, the pipeline builds the <em>merged result</em> of the source branch into the target branch, not just the source branch itself. This helps catch integration issues early.</li>
<li><strong>Executes defined pipeline stages:</strong> This typically includes building the application, running unit and integration tests, performing linting, static analysis, and potentially even spinning up a temporary environment for review.</li>
<li><strong>Reports status back to the SCM:</strong> The pipeline's status (success/failure) is reported back to the pull request interface, often as commit statuses or checks. This allows developers and reviewers to see at a glance if the changes passed all automated checks.</li>
</ol>
<p><strong>Example 3: Jenkins Declarative Pipeline for PRs (GitHub Integration)</strong></p>
<p>To implement PR-driven pipelines in Jenkins, you typically configure a "Multibranch Pipeline" job and ensure Jenkins has proper integration with your Git repository (e.g., GitHub Branch Source Plugin). The <code>Jenkinsfile</code> itself will then define how PRs are handled.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Jenkinsfile for Acme Webshop with PR-driven logic</span></span>
<span class="line"><span style="color:#6A737D">// Located at the root of the repository</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    tools {</span></span>
<span class="line"><span style="color:#6A737D">        // Specify tools like Maven, Node.js, etc.</span></span>
<span class="line"><span style="color:#6A737D">        // For example:</span></span>
<span class="line"><span style="color:#6A737D">        // maven 'Maven 3.8.6'</span></span>
<span class="line"><span style="color:#6A737D">        // nodejs 'Node.js 16.14.2'</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Checkout the current branch or PR merge commit</span></span>
<span class="line"><span style="color:#24292E">                checkout scm</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Install Dependencies'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#6A737D">                // Assuming a Java Spring Boot application for Acme Webshop</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn dependency:resolve'</span></span>
<span class="line"><span style="color:#6A737D">                // For a frontend part, if applicable</span></span>
<span class="line"><span style="color:#6A737D">                // sh 'npm install'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building Acme Webshop for branch/PR: ${env.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean package -DskipTests'</span><span style="color:#6A737D"> // Build the application</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Running unit and integration tests."</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span><span style="color:#6A737D"> // Run tests</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Static Code Analysis'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when {</span></span>
<span class="line"><span style="color:#6A737D">                // Only run static analysis for feature branches and PRs</span></span>
<span class="line"><span style="color:#6A737D">                // Not for main or develop, as they might have dedicated analysis</span></span>
<span class="line"><span style="color:#6A737D">                // This condition can be refined based on specific needs</span></span>
<span class="line"><span style="color:#24292E">                expression { env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">CHANGE_ID</span><span style="color:#D73A49"> !=</span><span style="color:#005CC5"> null</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">BRANCH_NAME</span><span style="color:#D73A49"> !=</span><span style="color:#032F62"> 'main'</span><span style="color:#D73A49"> &amp;&amp;</span><span style="color:#24292E"> env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">BRANCH_NAME</span><span style="color:#D73A49"> !=</span><span style="color:#032F62"> 'develop'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Running SonarQube analysis..."</span></span>
<span class="line"><span style="color:#6A737D">                // Assumes SonarQube Scanner is configured globally in Jenkins</span></span>
<span class="line"><span style="color:#6A737D">                // with SonarQube analysis for 'Acme Webshop'</span></span>
<span class="line"><span style="color:#6A737D">                // For full example, you would configure `withSonarQubeEnv` block</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn sonar:sonar -Dsonar.projectKey=AcmeWebshop'</span></span>
<span class="line"><span style="color:#6A737D">                // Example for JavaScript:</span></span>
<span class="line"><span style="color:#6A737D">                // sh 'npx eslint .'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy Preview Environment'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when {</span></span>
<span class="line"><span style="color:#6A737D">                // This stage runs only for Pull Requests</span></span>
<span class="line"><span style="color:#6A737D">                // env.CHANGE_ID is set by Jenkins when processing a PR</span></span>
<span class="line"><span style="color:#24292E">                expression { env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">CHANGE_ID</span><span style="color:#D73A49"> !=</span><span style="color:#005CC5"> null</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Deploying preview environment for Pull Request #${env.CHANGE_ID}..."</span></span>
<span class="line"><span style="color:#6A737D">                // This could deploy to a temporary Kubernetes namespace or</span></span>
<span class="line"><span style="color:#6A737D">                // spin up a Docker container with the changes for review.</span></span>
<span class="line"><span style="color:#6A737D">                // Using a shared library function for cleaner code:</span></span>
<span class="line"><span style="color:#6A737D">                // deployPreviewEnvironment(env.CHANGE_ID)</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">"./scripts/deploy-preview.sh ${env.CHANGE_ID}"</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            post {</span></span>
<span class="line"><span style="color:#24292E">                always {</span></span>
<span class="line"><span style="color:#6A737D">                    // Add comments to the PR with the preview URL</span></span>
<span class="line"><span style="color:#6A737D">                    // Or clean up the environment after PR closure</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Preview environment for PR #${env.CHANGE_ID} is available."</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Pipeline finished for ${env.BRANCH_NAME} / PR #${env.CHANGE_ID ?: 'N/A'}"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build, tests, and analysis passed."</span></span>
<span class="line"><span style="color:#6A737D">            // Optionally update PR status in SCM</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Pipeline failed. Review logs and commit messages."</span></span>
<span class="line"><span style="color:#6A737D">            // Optionally update PR status to failed</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p>In this <code>Jenkinsfile</code>:</p>
<ul>
<li><code>env.CHANGE_ID</code> is a special environment variable automatically set by Jenkins for Pull Request jobs. It allows for conditional logic specific to PRs.</li>
<li>The "Static Code Analysis" stage might be conditional to avoid redundant scans on main integration branches.</li>
<li>The "Deploy Preview Environment" stage demonstrates a common practice for PRs: deploying the changes to a temporary, isolated environment for manual testing or stakeholder review <em>before</em> merging. This is extremely valuable for "Acme Webshop" as it allows product owners to see new features in action without impacting main environments.</li>
</ul>
<h3>Hybrid Scenario: "Acme Webshop" PR-Driven Development</h3>
<p>For the "Acme Webshop", a typical workflow using PR-driven pipelines would be:</p>
<ol>
<li>Developer creates a feature branch (<code>feature/new-checkout-flow</code>) from <code>develop</code>.</li>
<li>Developer makes changes and pushes to <code>feature/new-checkout-flow</code>.</li>
<li>Developer creates a Pull Request from <code>feature/new-checkout-flow</code> to <code>develop</code>.</li>
<li>Jenkins automatically detects the PR, triggers a pipeline:
<ul>
<li>It checks out the merged code (feature branch + <code>develop</code>).</li>
<li>Builds the application.</li>
<li>Runs all unit and integration tests.</li>
<li>Performs static code analysis (e.g., SonarQube).</li>
<li>Deploys a temporary preview environment for manual review.</li>
</ul>
</li>
<li>If all automated checks pass, the status is reported back to GitHub/GitLab.</li>
<li>Product owners, QAs, and other developers can review the changes in the preview environment and provide feedback.</li>
<li>Once approved, the PR is merged into <code>develop</code>.</li>
<li>The pipeline for the <code>develop</code> branch (which is a multi-branch job) triggers, deploying the updated <code>develop</code> branch to the staging environment.</li>
</ol>
<p>This complete cycle ensures that code quality is maintained, features are properly tested, and feedback is incorporated early in the development process for the "Acme Webshop".</p>
<h2>Practical Examples and Demonstrations</h2>
<h3>Setting up a Multi-Branch Pipeline in Jenkins</h3>
<ol>
<li><strong>Install SCM Plugins:</strong> Ensure you have the necessary Jenkins plugins for your SCM (e.g., GitHub Branch Source Plugin, GitLab Plugin, Bitbucket Plugin).</li>
<li><strong>Create a New Item:</strong> In Jenkins, click "New Item".</li>
<li><strong>Select "Multibranch Pipeline":</strong> Give your project a name (e.g., <code>acme-webshop-multibranch</code>).</li>
<li><strong>Configure SCM:</strong>
<ul>
<li>In the project configuration, under "Branch Sources", click "Add source" and select your SCM (e.g., "Git").</li>
<li>Enter the repository URL (e.g., <code>https://github.com/your-org/acme-webshop.git</code>).</li>
<li>Add appropriate credentials if your repository is private.</li>
<li><strong>Behavior:</strong> Leave the default "Discover branches" and "Discover Pull Requests" (if using GitHub/Bitbucket plugins) or equivalent for GitLab. These options ensure Jenkins automatically finds branches and PRs.</li>
</ul>
</li>
<li><strong>Scan Repository Triggers:</strong> Under "Build Configuration", set up periodic scanning (e.g., "Scan Multibranch Pipeline Triggers" with an interval like <code>H/5 * * * *</code> for every 5 minutes). This ensures Jenkins detects new branches or updates to existing ones.</li>
<li><strong><code>Jenkinsfile</code> Location:</strong> Ensure "Mode" is set to "by Jenkinsfile" and the "Script Path" is <code>Jenkinsfile</code> (default, usually at the root of your repository).</li>
<li><strong>Save:</strong> Save the job. Jenkins will immediately start scanning your repository, creating pipeline jobs for each branch and PR it finds containing a <code>Jenkinsfile</code>.</li>
</ol>
<h3>Exercise: Extending Acme Webshop PR Pipeline with Security Scan</h3>
<p>Building on the <code>Jenkinsfile</code> from Example 3, extend the Pull Request-driven pipeline for the "Acme Webshop" to include a Dynamic Application Security Testing (DAST) scan specifically for the preview environment.</p>
<p><strong>Scenario:</strong> When a PR is opened, after the preview environment is deployed, a DAST scan should run against that preview environment URL. The results should then be included in the PR comments or marked as a check. Assume you have a DAST tool (like OWASP ZAP or a commercial scanner) that can be triggered via a script.</p>
<p><strong>Task:</strong></p>
<ol>
<li>Modify the <code>Jenkinsfile</code> to add a new stage <em>after</em> the <code>Deploy Preview Environment</code> stage.</li>
<li>This new stage, <code>DAST Scan Preview</code>, should <em>only</em> execute for Pull Requests.</li>
<li>Inside this stage, simulate a DAST scan against a dynamic URL derived from the <code>CHANGE_ID</code>. For simplicity, you can just <code>echo</code> a message indicating the scan is running and what URL it's targeting.</li>
<li>Consider how the DAST results would ideally be reported back to the PR. For this exercise, an <code>echo</code> statement is sufficient, but in a real scenario, you would integrate with the SCM's API to post comments.</li>
</ol>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D">// Partially completed Jenkinsfile for Acme Webshop - your task is to fill in the DAST stage</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    tools {</span></span>
<span class="line"><span style="color:#6A737D">        // ... (existing tools)</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Checkout'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                checkout scm</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Install Dependencies'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn dependency:resolve'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Building Acme Webshop for branch/PR: ${env.BRANCH_NAME}"</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn clean package -DskipTests'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Test'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Running unit and integration tests."</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn test'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Static Code Analysis'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when {</span></span>
<span class="line"><span style="color:#24292E">                expression { env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">CHANGE_ID</span><span style="color:#D73A49"> !=</span><span style="color:#005CC5"> null</span><span style="color:#D73A49"> ||</span><span style="color:#24292E"> env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">BRANCH_NAME</span><span style="color:#D73A49"> !=</span><span style="color:#032F62"> 'main'</span><span style="color:#D73A49"> &amp;&amp;</span><span style="color:#24292E"> env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">BRANCH_NAME</span><span style="color:#D73A49"> !=</span><span style="color:#032F62"> 'develop'</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Running SonarQube analysis..."</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">'mvn sonar:sonar -Dsonar.projectKey=AcmeWebshop'</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy Preview Environment'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            when {</span></span>
<span class="line"><span style="color:#24292E">                expression { env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">CHANGE_ID</span><span style="color:#D73A49"> !=</span><span style="color:#005CC5"> null</span><span style="color:#24292E"> }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                echo </span><span style="color:#032F62">"Deploying preview environment for Pull Request #${env.CHANGE_ID}..."</span></span>
<span class="line"><span style="color:#6A737D">                // In a real scenario, this script would output the URL</span></span>
<span class="line"><span style="color:#24292E">                sh </span><span style="color:#032F62">"./scripts/deploy-preview.sh ${env.CHANGE_ID}"</span></span>
<span class="line"><span style="color:#6A737D">                // Store the preview URL in an environment variable for later use</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    env</span><span style="color:#D73A49">.</span><span style="color:#005CC5">PREVIEW_URL</span><span style="color:#D73A49"> =</span><span style="color:#032F62"> "http://preview-${env.CHANGE_ID}.acme-webshop.example.com"</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Preview URL: ${env.PREVIEW_URL}"</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#6A737D">        // =========================================================</span></span>
<span class="line"><span style="color:#6A737D">        // YOUR TASK: ADD THE 'DAST Scan Preview' STAGE HERE</span></span>
<span class="line"><span style="color:#6A737D">        // It should only run for PRs and use env.PREVIEW_URL</span></span>
<span class="line"><span style="color:#6A737D">        // =========================================================</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">    post {</span></span>
<span class="line"><span style="color:#24292E">        always {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Pipeline finished for ${env.BRANCH_NAME} / PR #${env.CHANGE_ID ?: 'N/A'}"</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        success {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Build, tests, and analysis passed."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        failure {</span></span>
<span class="line"><span style="color:#24292E">            echo </span><span style="color:#032F62">"Pipeline failed. Review logs and commit messages."</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>Solution Hint:</strong></p>
<ul>
<li>Use another <code>when</code> block with <code>expression { env.CHANGE_ID != null }</code>.</li>
<li>Reference <code>env.PREVIEW_URL</code> in your DAST command.</li>
<li>Consider using a <code>try-catch</code> block if the DAST scan failure should not necessarily fail the entire pipeline but rather just report a status.</li>
</ul>
<h2>Next Steps and Future Learning Directions</h2>
<p>Multi-branch and PR-driven pipelines significantly enhance development velocity and code quality by integrating CI/CD directly into your branching workflow. Mastering these concepts is crucial for managing diverse development streams effectively. As you progress, consider exploring more advanced topics in this module, such as:</p>
<ul>
<li><strong>Advanced Deployment Automation:</strong> How to automate releases using multi-branch pipelines, including promoting artifacts between environments.</li>
<li><strong>Pipeline as Code with Groovy DSL and Shared Libraries:</strong> Further optimizing your <code>Jenkinsfile</code> by abstracting common pipeline logic into reusable shared libraries, which can simplify complex multi-branch and PR pipelines.</li>
<li><strong>Securing the CI/CD Pipeline End-to-End:</strong> Implementing robust security measures within your pipelines, including credential management, secret scanning, and integrating more advanced security tools, which is particularly relevant when deploying preview environments.</li>
</ul>
  
</div>

<div id="chapter-6.4">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Advanced Deployment Automation and Release Management Techniques</h1><p>Advanced deployment automation and release management techniques move beyond basic continuous delivery to encompass sophisticated strategies for deploying applications with minimal risk, maximizing efficiency, and ensuring high availability. This includes adopting mature deployment patterns, optimizing the release process, and employing specialized tooling to manage the entire lifecycle of software releases.</p>
<h2>Advanced Deployment Strategies</h2>
<p>Building on fundamental concepts like blue/green and canary deployments, advanced strategies focus on finer-grained control, automated decision-making, and rapid recovery. These methods aim to reduce the blast radius of potential issues and enable faster iteration cycles.</p>
<h3>Rolling Deployments</h3>
<p>Rolling deployments update instances of an application incrementally, replacing old versions with new ones one by one or in small batches. This approach ensures that a portion of the application remains available throughout the deployment process, preventing downtime. If issues arise, the rollout can be paused or rolled back without affecting the entire fleet.</p>
<p>Consider the "Acme Webshop" application, which runs on multiple servers. A rolling deployment would update one server at a time. The load balancer would remove a server running the old version, deploy the new version, verify its health, and then add it back to the rotation before proceeding to the next server. This ensures continuous availability for users, as there are always servers serving requests.</p>
<p><em>Real-world example:</em> A large e-commerce platform uses rolling deployments for its backend microservices. When a new version of the product catalog service is released, it's deployed to a subset of servers. Automated health checks monitor the new instances. If metrics like error rates or latency spike, the deployment is automatically halted, and the previous version is restored on the affected servers. This minimizes impact on user experience.</p>
<p><em>Hypothetical scenario:</em> Imagine a critical financial trading application that cannot tolerate any downtime. A rolling deployment strategy is ideal here. Instead of taking all trading servers offline, new versions of the trading engine are deployed one by one. Each new instance is thoroughly tested with synthetic transactions before receiving live traffic. If any discrepancies are found, the faulty instance is immediately isolated and reverted.</p>
<h3>Blue/Green Deployments with Advanced Traffic Management</h3>
<p>Blue/Green deployments involve running two identical production environments: "Blue" (the current live version) and "Green" (the new version). Traffic is switched from Blue to Green once the new version is verified. Advanced techniques enhance this by using sophisticated traffic management tools to perform the switch with greater control and finer granularity.</p>
<p>Instead of a simple DNS swap or load balancer reconfiguration, advanced blue/green uses application-aware proxies or service meshes (like Istio or Linkerd in a Kubernetes context) to shift traffic. This allows for partial traffic shifts, header-based routing for internal testing, or gradual cutovers.</p>
<p>For the "Acme Webshop," a basic blue/green deployment might involve creating a completely new set of servers for the "Green" environment, deploying the updated webshop, and then switching the load balancer to point to Green. An advanced approach would involve a service mesh that could, for instance, route 10% of specific user types (e.g., internal testers, users from a particular region) to the Green environment for a period, before a full cutover. This provides a soft launch capability.</p>
<p><em>Real-world example:</em> Netflix uses advanced blue/green deployments for many of its services. They leverage sophisticated traffic routing capabilities to direct internal teams to new versions for testing before exposing them to general users. This allows them to validate new features and bug fixes in a production-like environment with real traffic patterns without impacting the entire user base.</p>
<p><em>Hypothetical scenario:</em> A healthcare provider's patient portal application needs an update with critical new features. Instead of a hard switch, they set up a green environment. For two weeks, internal staff and a small group of opt-in beta users are routed to the green environment. They provide feedback and validate functionality. Once stable, the traffic management system smoothly transitions all users to the green environment over a period of hours, ensuring a seamless experience.</p>
<h3>Canary Deployments with Automated Rollback</h3>
<p>Canary deployments gradually expose a new version of an application to a small subset of users, monitoring its performance and behavior before rolling it out to the entire user base. Advanced canary deployments automate the decision-making process for increasing traffic to the new version or performing an automatic rollback based on predefined metrics and thresholds.</p>
<p>For the "Acme Webshop," a canary deployment would mean deploying the new version to a single server or a small percentage of instances, and routing a small percentage of user traffic to it. Automated monitoring tools would then compare metrics (e.g., error rates, response times, CPU utilization) between the canary and the stable versions. If the canary environment shows significant degradation, an automated system would immediately divert traffic back to the stable version and mark the deployment as failed.</p>
<p><em>Real-world example:</em> Google frequently uses canary deployments for its search engine and other critical services. New features or infrastructure changes are rolled out to a small fraction of users (the "canaries"). Extensive monitoring and A/B testing frameworks analyze user behavior and system performance. If any negative impact is detected, the change is instantly rolled back, minimizing exposure to a small group.</p>
<p><em>Hypothetical scenario:</em> A popular social media platform wants to introduce a new algorithm for its news feed. They deploy the new algorithm to 1% of their users (the canary group). An automated system continuously monitors user engagement metrics (likes, shares, comments) and server performance (latency, error rates) for this group. If engagement drops below a certain threshold or server errors increase, the system automatically reverts the 1% of users back to the old algorithm and alerts the engineering team.</p>
<h2>Release Orchestration and Management</h2>
<p>Beyond just deploying code, effective release management encompasses coordinating the entire release process, from planning to post-deployment verification, across various environments and teams. Release orchestration tools automate and visualize this complex workflow.</p>
<h3>Release Trains</h3>
<p>A release train is a time-boxed approach to managing releases, where multiple teams contribute features to a shared release schedule. Like a physical train, it departs on a fixed schedule, carrying all ready-to-be-released features. This contrasts with "feature-driven" releases that happen only when a specific feature is complete.</p>
<p>For the "Acme Webshop," adopting a release train model means that every two weeks (or on another fixed cadence), a new version of the webshop, along with any related backend services, is released to production, regardless of whether every planned feature is 100% complete. Features that are not ready are simply deferred to the next train, often using feature flags to disable incomplete functionality. This ensures predictable release cycles and reduces coordination overhead.</p>
<p><em>Real-world example:</em> SAFe (Scaled Agile Framework) often utilizes release trains for large enterprises with many interdependent teams. All teams synchronize their development efforts to contribute to Program Increments (PIs), which are released on a fixed cadence (e.g., every 8-12 weeks). This provides predictability and alignment across multiple development streams.</p>
<p><em>Hypothetical scenario:</em> A large software company developing an ERP system has several modules (accounting, inventory, HR) maintained by different teams. They implement a monthly release train. Every first Friday of the month, a new release goes out, containing all features that have been tested and approved. If the HR team's new leave management module isn't quite ready by the cut-off date, it will simply be included in the next month's train.</p>
<h3>Progressive Delivery</h3>
<p>Progressive delivery extends canary deployments by adding more granular control and automated experimentation capabilities during the deployment process. It focuses on gradually exposing new features or application versions to users based on various criteria (geography, user segments, device type, internal groups) and continuously validating their impact using real-time data. This often involves feature flags, A/B testing, and advanced traffic routing.</p>
<p>For the "Acme Webshop," progressive delivery could mean enabling a new payment gateway only for users in a specific geographical region, or only for users on a particular mobile device. The system would then monitor conversion rates, transaction success rates, and error logs for these segments. If the new payment gateway performs better or equally well without issues, it can be progressively rolled out to more user segments.</p>
<p><em>Real-world example:</em> Facebook uses progressive delivery extensively. New features are often rolled out to a small percentage of users, often starting with internal employees, then expanding to specific regions or user groups. They continuously collect data on user interaction and performance, which informs whether to proceed with a broader rollout or to pull the feature back for further refinement.</p>
<p><em>Hypothetical scenario:</em> A popular mobile gaming company wants to introduce a new in-game currency system. They use progressive delivery to roll it out. First, it's enabled for internal testers. Then, it's enabled for 5% of users in specific test markets. They monitor player engagement, in-app purchases, and bug reports. If the metrics are positive, they gradually increase the rollout percentage over several weeks, carefully observing the impact at each stage.</p>
<h3>Release Gates and Approval Workflows</h3>
<p>Release gates are automated or manual checkpoints within the CI/CD pipeline that must be satisfied before a release can progress to the next stage. Approval workflows define the sequence of approvals required from different stakeholders (e.g., QA, security, product management, legal) at various points in the release process. These mechanisms ensure compliance, quality, and adherence to policies.</p>
<p>For the "Acme Webshop," a release gate might be configured to check for successful completion of all integration tests and a static code analysis scan with zero critical vulnerabilities before the application can be deployed to the staging environment. Before deploying to production, an approval workflow could require sign-offs from the QA lead and the Product Owner, ensuring that all functional requirements are met and business impact is understood.</p>
<p><em>Real-world example:</em> Financial institutions operate under strict regulatory compliance. Their CI/CD pipelines incorporate numerous release gates, including automated security scans (SAST, DAST), compliance checks against industry standards (e.g., PCI DSS), and mandatory manual approvals from legal and compliance officers before any new software release can reach production.</p>
<p><em>Hypothetical scenario:</em> A medical device software company must adhere to stringent quality and safety regulations. Their deployment pipeline includes a gate that requires all software components to pass a battery of hardware compatibility tests in a dedicated lab environment. Additionally, before a firmware update is pushed to devices, it requires a digital signature from the Head of Engineering, the Quality Assurance Director, and a regulatory affairs specialist, managed through an automated approval workflow.</p>
<h2>Tools and Technologies for Advanced Deployment Automation</h2>
<p>The implementation of advanced deployment and release management techniques relies heavily on specialized tools that integrate seamlessly into the CI/CD pipeline.</p>
<h3>Feature Flags (Feature Toggles)</h3>
<p>Feature flags are techniques that allow developers to turn functionality on or off at runtime without deploying new code. They decouple code deployment from feature release. This enables progressive delivery, A/B testing, and the ability to instantly disable problematic features in production.</p>
<p>For the "Acme Webshop," if a new payment method is implemented, it can be wrapped in a feature flag. Initially, the flag is off. Once deployed to production, the flag can be turned on for a small group of users, then progressively for all users. If issues arise, the flag can be instantly toggled off without a rollback or new deployment.</p>
<p><em>Real-world example:</em> Microsoft uses feature flags extensively in Windows and Office 365. New features are often shipped "dark" (disabled by default) and then gradually enabled for different user groups, allowing them to gather telemetry and feedback before a wide release. This minimizes disruption and enables rapid iteration.</p>
<p><em>Hypothetical scenario:</em> A popular mobile app developer wants to test a new "dark mode" interface. They implement it using a feature flag. Initially, it's off for all users. They can then enable it for users whose device language is set to Spanish, or for users who have participated in beta programs, and collect feedback before rolling it out globally.</p>
<h3>Service Mesh (e.g., Istio, Linkerd)</h3>
<p>Service meshes provide a dedicated infrastructure layer for managing service-to-service communication. They offer advanced traffic management capabilities (routing, retries, circuit breakers), observability (metrics, logging, tracing), and security (authentication, authorization) without requiring changes to application code. They are particularly powerful for microservices architectures in containerized environments like Kubernetes.</p>
<p>For the "Acme Webshop" running on Kubernetes, an Istio service mesh could be used to implement advanced blue/green or canary deployments. It allows defining rules to send 10% of traffic to version 2 of the "Product Service" and 90% to version 1. It can also inject fault tolerance by automatically retrying failed requests or applying circuit breakers if a service becomes unhealthy, enhancing the resilience of deployments.</p>
<p><em>Real-world example:</em> Airbnb uses a service mesh to manage its complex microservices architecture. This allows them to perform granular traffic routing for A/B tests, observe performance of individual services, and enforce security policies across their distributed applications, all transparently to the application developers.</p>
<p><em>Hypothetical scenario:</em> A large online gaming platform uses a service mesh (e.g., Linkerd) within its Kubernetes cluster. When deploying an update to their "Matchmaking Service," they configure the service mesh to route 5% of traffic from players in non-peak regions to the new version. The mesh automatically monitors latency and error rates for both old and new versions. If the new version shows increased latency, the mesh automatically reroutes all traffic back to the stable version, preventing poor player experiences.</p>
<h3>Release Orchestration Platforms (e.g., Spinnaker, Harness)</h3>
<p>Release orchestration platforms are specialized tools that provide end-to-end management of the release process across multiple environments. They visualize the pipeline, manage complex deployment strategies (blue/green, canary), integrate with various CI/CD tools, and enforce release gates and approvals.</p>
<p>For the "Acme Webshop," a platform like Spinnaker could be used to define a multi-stage deployment pipeline. It could orchestrate the deployment of the webshop to a staging environment, run automated tests, wait for manual approval, then trigger a canary deployment to production, automatically monitoring key metrics, and performing an automated rollback if necessary. This centralizes and automates the entire release flow.</p>
<p><em>Real-world example:</em> Target, the retail giant, uses Spinnaker to manage deployments for many of its applications. Spinnaker helps them standardize their deployment processes, automate complex blue/green and canary rollouts, and gain visibility into the status of all releases across their large organization.</p>
<p><em>Hypothetical scenario:</em> A global logistics company uses Harness for its complex enterprise application releases. Harness automates the deployment of various interdependent microservices to multiple cloud regions. It also incorporates automated health checks, verifies infrastructure as code changes, and provides granular control over approvals from different teams (development, operations, security) at various stages before production deployment.</p>
<h2>Exercises and Practice Activities</h2>
<ol>
<li>
<p><strong>Canary Deployment Simulation for Acme Webshop:</strong>
Imagine the "Acme Webshop" is deployed on a Kubernetes cluster. You've introduced a new feature in the <code>checkout-service</code> that has potential performance implications.</p>
<ul>
<li><strong>Task:</strong> Describe how you would configure a canary deployment for this new <code>checkout-service</code> version using a service mesh (e.g., Istio). Specify the steps for routing 10% of traffic to the new version, the metrics you would monitor (e.g., HTTP error rate, latency), and the conditions under which an automated rollback would be triggered.</li>
<li><strong>Output:</strong> A detailed plan outlining the Istio <code>VirtualService</code> and <code>DestinationRule</code> configurations, monitoring thresholds, and the automated rollback logic.</li>
</ul>
</li>
<li>
<p><strong>Feature Flag Implementation for Acme Webshop:</strong>
The "Acme Webshop" is planning a major UI redesign for its product display pages. The development team wants to release the code to production but only enable the new UI for internal staff initially, then progressively to external beta users.</p>
<ul>
<li><strong>Task:</strong> Outline how you would implement this using a feature flag solution (e.g., LaunchDarkly, Optimizely, or a home-grown solution). Describe:
<ul>
<li>How the feature flag would be defined and controlled.</li>
<li>How the application code would conditionally display the old or new UI based on the flag.</li>
<li>The sequence of steps to progressively enable the feature for internal users, then beta users, and finally all users, without redeploying the application.</li>
</ul>
</li>
<li><strong>Output:</strong> A conceptual design for the feature flag implementation, including code logic snippets (pseudo-code is acceptable if a specific language isn't assumed) and a rollout strategy.</li>
</ul>
</li>
<li>
<p><strong>Release Gate Workflow for Acme Webshop:</strong>
The "Acme Webshop" requires enhanced quality and security before any release goes to production.</p>
<ul>
<li><strong>Task:</strong> Design a release gate and approval workflow for the "Acme Webshop" that includes the following stages:
<ul>
<li>Automated unit and integration tests completion.</li>
<li>Successful static application security testing (SAST) with no critical vulnerabilities.</li>
<li>Manual sign-off from the QA lead after testing in the staging environment.</li>
<li>Manual sign-off from the Product Owner before production deployment.</li>
</ul>
</li>
<li><strong>Output:</strong> A flowchart or step-by-step description of the release pipeline, indicating where each gate and approval step occurs, and what criteria must be met for progression.</li>
</ul>
</li>
</ol>
  
</div>

<div id="chapter-6.5">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Securing the CI/CD Pipeline End-to-End</h1><p>Securing the CI/CD pipeline end-to-end involves implementing robust security measures across all stages, from source code management to deployment and runtime. This holistic approach ensures that vulnerabilities are identified and mitigated early, reducing the attack surface and maintaining the integrity and confidentiality of the entire development and deployment process.</p>
<h2>Supply Chain Security in CI/CD</h2>
<p>Supply chain security in the context of CI/CD refers to the protection of all components, dependencies, and processes involved in building and deploying an application. This includes the source code, third-party libraries, build tools, container images, and the CI/CD platform itself. A compromise at any point in this chain can introduce vulnerabilities or backdoors into the final product.</p>
<p>One real-world example of a supply chain attack is the SolarWinds incident. Attackers compromised SolarWinds' software build system and injected malicious code into legitimate software updates. When customers installed these updates, they unwittingly deployed malware within their own networks. This highlighted the criticality of securing the build process and ensuring the integrity of distributed software. Another example is the compromise of a popular open-source JavaScript library, event-stream, where a malicious actor gained control of the package and inserted malware. This malware targeted cryptocurrency wallets, affecting a wide range of applications that depended on the compromised library.</p>
<p>Consider a hypothetical scenario for Acme Webshop. Acme relies on numerous open-source libraries for its payment gateway, user authentication, and product catalog features. If one of these open-source libraries, pulled during the build process, is compromised with malicious code, the resulting Acme Webshop application would also be compromised. This could lead to data breaches, unauthorized access, or denial of service for Acme's customers.</p>
<p>To mitigate such risks, organizations implement several controls:</p>
<ul>
<li><strong>Dependency Scanning:</strong> Regularly scan all third-party dependencies for known vulnerabilities using tools like OWASP Dependency-Check, Snyk, or Trivy.</li>
<li><strong>Software Bill of Materials (SBOM):</strong> Generate and maintain an SBOM for every build, listing all components and their versions. This allows for rapid identification of affected applications when new vulnerabilities are disclosed.</li>
<li><strong>Source Code Integrity:</strong> Implement code signing and tamper detection for source code and build artifacts. Utilize Git commit signing to verify the authenticity of code contributions.</li>
<li><strong>Vetting Third-Party Components:</strong> Establish policies for vetting and approving third-party libraries and tools before they are integrated into the pipeline.</li>
</ul>
<h2>Secrets Management</h2>
<p>Secrets are sensitive pieces of information like API keys, database credentials, encryption keys, and tokens required by applications and services within the CI/CD pipeline. Improper secrets management can lead to severe security breaches, as compromised secrets can grant attackers access to critical systems and data. Storing secrets directly in source code or configuration files is a common anti-pattern that must be avoided.</p>
<p>For example, a developer might hardcode a database password directly into a Jenkinsfile or a configuration file in a repository. If this repository is ever exposed, even internally, the database credentials become publicly accessible. A real-world incident involved a company accidentally exposing AWS access keys in a public GitHub repository, leading to unauthorized access and significant cloud billing charges. Another instance involved an attacker scanning public Docker images for embedded API keys, which were then used to access various cloud services.</p>
<p>Consider the Acme Webshop application. To deploy Acme's application to a Kubernetes cluster, the CI/CD pipeline needs credentials to access the Docker registry (e.g., Docker Hub, AWS ECR) to pull the application's container image. It also requires Kubernetes cluster credentials to manage deployments. Furthermore, the application itself needs database connection strings and payment gateway API keys to function. Storing these directly in the Jenkins pipeline script or within the application's source code would expose them.</p>
<p>Modern secrets management involves using dedicated tools and practices:</p>
<ul>
<li><strong>Secret Management Tools:</strong> Utilize solutions like HashiCorp Vault, AWS Secrets Manager, Azure Key Vault, or Kubernetes Secrets. These tools securely store, encrypt, and tightly control access to secrets.</li>
<li><strong>Environment Variables:</strong> Inject secrets into the build or deployment environment as environment variables, rather than hardcoding them. However, ensure these variables are only accessible to the specific processes that need them and are not logged.</li>
<li><strong>Role-Based Access Control (RBAC):</strong> Implement granular RBAC to ensure that only authorized users and services can access specific secrets. For instance, the deployment service account should only have access to deployment-related secrets, not database credentials.</li>
<li><strong>Principle of Least Privilege:</strong> Grant services and users only the minimum necessary permissions to perform their tasks.</li>
<li><strong>Auditing:</strong> Log all access attempts and modifications to secrets to maintain an audit trail and detect suspicious activity.</li>
</ul>
<p>When integrating secrets management with Jenkins, for example, you would configure Jenkins to fetch secrets from a secret management tool at runtime, rather than storing them in Jenkins credentials directly or, worse, in the pipeline script.</p>
<h2>Secure Configuration Management</h2>
<p>Secure configuration management ensures that all components within the CI/CD pipeline and the deployed applications are configured securely, following established best practices and compliance requirements. Misconfigurations are a significant source of vulnerabilities, often due to default settings, unpatched systems, or incorrect access controls.</p>
<p>For example, leaving default administrative credentials on a newly installed CI/CD server like Jenkins provides an immediate entry point for attackers. Another common misconfiguration is publicly exposing services or ports that should only be accessible internally, such as a database server or an internal API endpoint. A well-known example is the misconfiguration of AWS S3 buckets, where sensitive data was unintentionally made public due to incorrect access policies. Similarly, many data breaches have occurred because databases or message queues were deployed with default, easily guessable passwords or were left unauthenticated entirely.</p>
<p>For the Acme Webshop, secure configuration management applies to several layers:</p>
<ul>
<li><strong>Jenkins Configuration:</strong> Ensuring Jenkins itself is configured securely, including disabling unnecessary plugins, enabling robust authentication (e.g., LDAP, OAuth), applying security updates, and enforcing least privilege for Jenkins agents.</li>
<li><strong>Build Server Configuration:</strong> Hardening the operating system of build agents (e.g., minimizing installed software, regularly patching, firewall rules) to reduce the attack surface.</li>
<li><strong>Infrastructure as Code (IaC) Templates:</strong> Defining secure configurations within Terraform or Ansible playbooks. This means ensuring that security groups are restrictive, network ACLs are properly configured, and sensitive ports are not unnecessarily open when defining Acme's staging or production environments. For instance, a Terraform configuration for an AWS EC2 instance should specify security groups that only allow ingress traffic on ports 80 and 443 (for web traffic) and restrict SSH access to specific trusted IP ranges.</li>
<li><strong>Application Configuration:</strong> Ensuring that the application's runtime configuration (e.g., database connection pooling, logging levels, session management settings) is secure and does not expose sensitive information or create vulnerabilities.</li>
</ul>
<p>Key aspects of secure configuration management include:</p>
<ul>
<li><strong>Baseline Security Standards:</strong> Define and enforce security baselines for all servers, containers, and applications.</li>
<li><strong>Automated Configuration Auditing:</strong> Use tools (e.g., CIS-CAT, OpenSCAP) to automatically scan configurations for deviations from baselines and identify misconfigurations.</li>
<li><strong>Immutable Infrastructure:</strong> Favor immutable infrastructure patterns where components are replaced rather than modified in place. This reduces configuration drift and ensures consistency.</li>
<li><strong>Principle of Least Privilege:</strong> Configure all services, users, and roles with the minimum necessary permissions.</li>
<li><strong>Regular Patching and Updates:</strong> Maintain an aggressive patching schedule for all operating systems, applications, and dependencies within the CI/CD environment and deployed systems.</li>
</ul>
<h2>Secure Communication within the Pipeline</h2>
<p>Secure communication ensures that all data transmitted between different components of the CI/CD pipeline is encrypted and authenticated. This prevents eavesdropping, tampering, and man-in-the-middle attacks. Communication channels often include connections between source code repositories, CI servers, artifact repositories, container registries, and deployment targets.</p>
<p>Consider a scenario where the Jenkins build server communicates with a remote artifact repository to store build outputs. If this communication is unencrypted, an attacker could intercept the artifacts, potentially inject malicious code, or steal sensitive intellectual property. Similarly, when Jenkins deploys to a Kubernetes cluster, the API calls must be secured to prevent unauthorized cluster manipulation. A real-world example of compromised communication occurred when an attacker gained access to an internal network and intercepted unencrypted traffic between microservices, leading to data exfiltration. Another common scenario involves using HTTP instead of HTTPS for communication between a CI server and a Git repository, allowing credentials to be sniffed if the network is compromised.</p>
<p>For Acme Webshop, secure communication is critical at several points:</p>
<ul>
<li><strong>Git Repository to Jenkins:</strong> The connection between Acme's Git repository (e.g., GitHub, GitLab) and Jenkins must use HTTPS or SSH with proper authentication (e.g., SSH keys, personal access tokens) to pull source code.</li>
<li><strong>Jenkins to Artifact Repository:</strong> When Jenkins pushes or pulls build artifacts (e.g., JAR files, NuGet packages) from a repository like Nexus or Artifactory, the communication must be over HTTPS, often with client certificate authentication for added security.</li>
<li><strong>Jenkins to Container Registry:</strong> When Jenkins pushes Docker images to a container registry (e.g., Docker Hub, AWS ECR), HTTPS must be used, and authentication credentials (e.g., token, username/password) must be handled securely via secrets management.</li>
<li><strong>Jenkins to Deployment Targets (Kubernetes):</strong> Communication with the Kubernetes API server for deploying Acme's application must use HTTPS and authenticated via service accounts and RBAC.</li>
</ul>
<p>To ensure secure communication:</p>
<ul>
<li><strong>TLS/SSL Encryption:</strong> Enforce TLS/SSL for all network communication between CI/CD components. This includes Git, build tools, artifact repositories, container registries, and deployment targets.</li>
<li><strong>Strong Authentication:</strong> Implement strong authentication mechanisms, such as mutual TLS, client certificates, OAuth, or personal access tokens, rather than relying solely on username/password.</li>
<li><strong>Network Segmentation:</strong> Isolate CI/CD infrastructure from other networks and implement strict firewall rules to control traffic flow. For example, build agents should only be able to reach necessary internal services and external package repositories.</li>
<li><strong>VPNs/Private Connections:</strong> Utilize Virtual Private Networks (VPNs) or private network links (e.g., AWS PrivateLink, Azure Private Link) for sensitive communications, especially when connecting to cloud resources or remote infrastructure.</li>
</ul>
<h2>Runtime Security for Deployed Applications</h2>
<p>Runtime security focuses on protecting applications once they are deployed and operational. While CI/CD pipelines secure the build and deployment process, runtime security addresses threats that emerge when the application is actively serving users. This includes protecting against exploits, unauthorized access, and data breaches.</p>
<p>A common runtime attack is a SQL injection, where malicious SQL code is inserted into input fields, allowing an attacker to manipulate the database. Another example is a Cross-Site Scripting (XSS) attack, where malicious scripts are injected into web pages viewed by other users. The Equifax data breach, for instance, was attributed to a known vulnerability in the Apache Struts framework that was exploited at runtime. Many companies experience breaches due to unpatched runtime environments or exposed administrative interfaces.</p>
<p>For the Acme Webshop, runtime security involves:</p>
<ul>
<li><strong>Web Application Firewalls (WAFs):</strong> Deploying a WAF (e.g., AWS WAF, Cloudflare, NGINX App Protect) in front of the Acme Webshop to filter and block malicious traffic like SQL injection attempts, XSS attacks, and denial-of-service (DoS) attacks.</li>
<li><strong>Runtime Application Self-Protection (RASP):</strong> Integrating RASP agents directly into the application's runtime environment. RASP instruments the application to detect and prevent attacks from within, offering protection against zero-day exploits and specific application vulnerabilities.</li>
<li><strong>Container Runtime Security:</strong> Using tools like Falco or Twistlock (Palo Alto Networks Prisma Cloud) to monitor container behavior, detect anomalous activities, and enforce security policies within the Kubernetes cluster where Acme's application runs. This can detect if a container tries to execute an unexpected process or access sensitive files.</li>
<li><strong>Regular Patching and Updates:</strong> Continuously patching the underlying operating systems, container images, and application frameworks used by the Acme Webshop.</li>
<li><strong>Intrusion Detection/Prevention Systems (IDS/IPS):</strong> Deploying IDS/IPS solutions to monitor network traffic for suspicious patterns and block known attack signatures.</li>
<li><strong>Least Privilege for Application Processes:</strong> Ensuring the application runs with the minimum necessary permissions within its operating environment. For example, a web server should not run as the root user.</li>
<li><strong>Secure API Gateways:</strong> If Acme's webshop exposes APIs, using an API gateway to enforce authentication, authorization, rate limiting, and other security policies.</li>
</ul>
<p>Runtime security complements CI/CD pipeline security by providing a final layer of defense for actively running applications, catching threats that may have bypassed earlier security checks or emerged due to new attack vectors.</p>
<h2>Exercises</h2>
<h3>Exercise 1: Identifying Secrets in a Jenkinsfile</h3>
<p><strong>Scenario:</strong> Acme Webshop is updating its CI/CD pipeline. A junior developer has created a Jenkinsfile that deploys to a new staging environment but might have inadvertently included sensitive information.</p>
<p><strong>Task:</strong> Examine the following hypothetical Jenkinsfile snippet. Identify any potential secrets or sensitive information that should <em>not</em> be hardcoded or directly present, and explain why. Suggest how these should be managed using a secrets management solution like HashiCorp Vault or Kubernetes Secrets (which Jenkins can integrate with).</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">groovy</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#24292E">pipeline {</span></span>
<span class="line"><span style="color:#24292E">    agent any</span></span>
<span class="line"><span style="color:#24292E">    stages {</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Build'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#24292E">                    echo </span><span style="color:#032F62">"Building Acme Webshop..."</span></span>
<span class="line"><span style="color:#24292E">                    sh </span><span style="color:#032F62">'mvn clean install'</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">        stage(</span><span style="color:#032F62">'Deploy to Staging'</span><span style="color:#24292E">) {</span></span>
<span class="line"><span style="color:#24292E">            steps {</span></span>
<span class="line"><span style="color:#24292E">                script {</span></span>
<span class="line"><span style="color:#6A737D">                    // Hardcoded AWS credentials - PROBLEM</span></span>
<span class="line"><span style="color:#24292E">                    withEnv([</span><span style="color:#032F62">"AWS_ACCESS_KEY_ID=AKIAIOSFODNN7EXAMPLE"</span><span style="color:#24292E">, </span><span style="color:#032F62">"AWS_SECRET_ACCESS_KEY=wJalrXUtnFEMI/K7MDENG/bPxRfiCYEXAMPLEKEY"</span><span style="color:#24292E">]) {</span></span>
<span class="line"><span style="color:#24292E">                        echo </span><span style="color:#032F62">"Deploying to AWS Staging..."</span></span>
<span class="line"><span style="color:#24292E">                        sh </span><span style="color:#032F62">'aws s3 cp target/acme-webshop.jar s3://acme-staging-artifacts/'</span></span>
<span class="line"><span style="color:#24292E">                        sh </span><span style="color:#032F62">'kubectl config set-context --current --namespace=acme-staging'</span></span>
<span class="line"><span style="color:#6A737D">                        // Hardcoded Kubernetes token - PROBLEM</span></span>
<span class="line"><span style="color:#24292E">                        sh </span><span style="color:#032F62">'kubectl --token="eyJhbGciOiJIUzI1NiI..." apply -f kubernetes/deployment.yaml'</span></span>
<span class="line"><span style="color:#6A737D">                        // Database password directly in script - PROBLEM</span></span>
<span class="line"><span style="color:#24292E">                        sh </span><span style="color:#032F62">'echo "UPDATE users SET status=</span><span style="color:#005CC5">\'</span><span style="color:#032F62">active</span><span style="color:#005CC5">\'</span><span style="color:#032F62"> WHERE id=1;" | mysql -h acme-db-staging -u admin -pMySecretDbPassword'</span></span>
<span class="line"><span style="color:#24292E">                    }</span></span>
<span class="line"><span style="color:#24292E">                }</span></span>
<span class="line"><span style="color:#24292E">            }</span></span>
<span class="line"><span style="color:#24292E">        }</span></span>
<span class="line"><span style="color:#24292E">    }</span></span>
<span class="line"><span style="color:#24292E">}</span></span></code></pre></div></div></div>
<p><strong>Instructions:</strong></p>
<ol>
<li>Pinpoint each specific line or section where a secret is improperly handled.</li>
<li>For each identified secret, explain the security risk it poses.</li>
<li>Describe how you would refactor the Jenkinsfile to retrieve these secrets from a secure secret management system, rather than hardcoding them. Assume Jenkins has already been configured to integrate with your chosen secret manager.</li>
</ol>
<h3>Exercise 2: Secure Configuration Review for Acme Webshop Kubernetes Deployment</h3>
<p><strong>Scenario:</strong> The Acme Webshop application is deployed to a Kubernetes cluster. You've been tasked with reviewing a <code>deployment.yaml</code> and <code>service.yaml</code> for secure configuration best practices related to runtime security and least privilege.</p>
<p><strong>Task:</strong> Review the following Kubernetes manifests. Identify potential security misconfigurations or areas where runtime security could be improved. Suggest specific changes to enhance the security posture.</p>
<div class="not-prose my-6 max-w-full overflow-hidden rounded-lg border border-gray-200 has-[code:empty]:hidden"><div class="flex items-center justify-between gap-2 border-b border-gray-200 bg-gray-50 px-3 py-2"><span class="text-sm text-gray-600">yaml</span><div class="flex items-center gap-2"><button class="flex size-6 items-center justify-center gap-2 rounded-md text-gray-400 hover:bg-zinc-200 hover:text-black focus:outline-none"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-copy size-3.5" aria-hidden="true"><rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect><path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path></svg></button></div></div><div class="mt-0 text-sm [&amp;_pre]:py-0 [&amp;_pre]:grid [&amp;_code]:py-4 [&amp;_code]:w-full [&amp;_code]:grid [&amp;_code]:overflow-x-auto [&amp;_code]:no-scrollbar [&amp;_code]:bg-transparent [&amp;_.line]:px-3 [&amp;_.line]:w-full [&amp;_.line]:relative [&amp;_.line]:min-h-5"><div><pre class="shiki github-light" style="background-color:#fff;color:#24292e" tabindex="0"><code><span class="line"><span style="color:#6A737D"># kubernetes/deployment.yaml</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">apps/v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Deployment</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">  labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  replicas</span><span style="color:#24292E">: </span><span style="color:#005CC5">3</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    matchLabels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">  template</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      labels</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">        app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">    spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">      containers</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">      - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">webshop-app</span></span>
<span class="line"><span style="color:#22863A">        image</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-registry/acme-webshop:1.0.0</span></span>
<span class="line"><span style="color:#22863A">        ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">containerPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">8080</span></span>
<span class="line"><span style="color:#22863A">        env</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">DB_HOST</span></span>
<span class="line"><span style="color:#22863A">          value</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-db.internal</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">DB_USER</span></span>
<span class="line"><span style="color:#22863A">          value</span><span style="color:#24292E">: </span><span style="color:#032F62">admin</span></span>
<span class="line"><span style="color:#24292E">        - </span><span style="color:#22863A">name</span><span style="color:#24292E">: </span><span style="color:#032F62">DB_PASSWORD</span><span style="color:#6A737D"> # Hardcoded in manifest - PROBLEM</span></span>
<span class="line"><span style="color:#22863A">          value</span><span style="color:#24292E">: </span><span style="color:#032F62">supersecretpassword123</span></span>
<span class="line"><span style="color:#22863A">        securityContext</span><span style="color:#24292E">: </span><span style="color:#6A737D"># Missing security context - PROBLEM</span></span>
<span class="line"><span style="color:#6A737D">          # Not configured for least privilege</span></span>
<span class="line"><span style="color:#22863A">          runAsUser</span><span style="color:#24292E">: </span><span style="color:#005CC5">0</span><span style="color:#6A737D"> # Runs as root - PROBLEM</span></span>
<span class="line"><span style="color:#22863A">          allowPrivilegeEscalation</span><span style="color:#24292E">: </span><span style="color:#005CC5">true</span><span style="color:#6A737D"> # Allows privilege escalation - PROBLEM</span></span>
<span class="line"><span style="color:#22863A">        livenessProbe</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">          httpGet</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">            path</span><span style="color:#24292E">: </span><span style="color:#032F62">/health</span></span>
<span class="line"><span style="color:#22863A">            port</span><span style="color:#24292E">: </span><span style="color:#005CC5">8080</span></span>
<span class="line"><span style="color:#22863A">          initialDelaySeconds</span><span style="color:#24292E">: </span><span style="color:#005CC5">30</span></span>
<span class="line"><span style="color:#22863A">          periodSeconds</span><span style="color:#24292E">: </span><span style="color:#005CC5">10</span></span>
<span class="line"><span style="color:#22863A">        readinessProbe</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">          httpGet</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">            path</span><span style="color:#24292E">: </span><span style="color:#032F62">/ready</span></span>
<span class="line"><span style="color:#22863A">            port</span><span style="color:#24292E">: </span><span style="color:#005CC5">8080</span></span>
<span class="line"><span style="color:#22863A">          initialDelaySeconds</span><span style="color:#24292E">: </span><span style="color:#005CC5">30</span></span>
<span class="line"><span style="color:#22863A">          periodSeconds</span><span style="color:#24292E">: </span><span style="color:#005CC5">10</span></span>
<span class="line"><span style="color:#22863A">      serviceAccountName</span><span style="color:#24292E">: </span><span style="color:#032F62">default</span><span style="color:#6A737D"> # Using default service account - PROBLEM</span></span>
<span class="line"><span style="color:#6F42C1">---</span></span>
<span class="line"><span style="color:#6A737D"># kubernetes/service.yaml</span></span>
<span class="line"><span style="color:#22863A">apiVersion</span><span style="color:#24292E">: </span><span style="color:#032F62">v1</span></span>
<span class="line"><span style="color:#22863A">kind</span><span style="color:#24292E">: </span><span style="color:#032F62">Service</span></span>
<span class="line"><span style="color:#22863A">metadata</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  name</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop-service</span></span>
<span class="line"><span style="color:#22863A">spec</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">  selector</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#22863A">    app</span><span style="color:#24292E">: </span><span style="color:#032F62">acme-webshop</span></span>
<span class="line"><span style="color:#22863A">  ports</span><span style="color:#24292E">:</span></span>
<span class="line"><span style="color:#24292E">    - </span><span style="color:#22863A">protocol</span><span style="color:#24292E">: </span><span style="color:#032F62">TCP</span></span>
<span class="line"><span style="color:#22863A">      port</span><span style="color:#24292E">: </span><span style="color:#005CC5">80</span></span>
<span class="line"><span style="color:#22863A">      targetPort</span><span style="color:#24292E">: </span><span style="color:#005CC5">8080</span></span>
<span class="line"><span style="color:#22863A">  type</span><span style="color:#24292E">: </span><span style="color:#032F62">LoadBalancer</span><span style="color:#6A737D"> # Publicly exposes service - PROBLEM</span></span></code></pre></div></div></div>
<p><strong>Instructions:</strong></p>
<ol>
<li>List each security concern you find in the <code>deployment.yaml</code> and <code>service.yaml</code>.</li>
<li>For each concern, explain the potential vulnerability it introduces.</li>
<li>Propose specific modifications to the YAML files to address these concerns, referencing Kubernetes security best practices (e.g., <code>securityContext</code>, <code>serviceAccount</code>, <code>imagePullSecrets</code>, proper secret references).</li>
</ol>
<h2>Real-World Application</h2>
<p>Securing the CI/CD pipeline end-to-end is not merely a theoretical exercise but a critical necessity for any organization deploying software. For example, a major financial institution implemented a secure CI/CD pipeline after a series of minor incidents where developers accidentally exposed API keys in logs or misconfigured database access. Their new pipeline integrated a dedicated secrets management solution (HashiCorp Vault), enforced multi-factor authentication for all CI/CD platform access, and incorporated static application security testing (SAST) and software composition analysis (SCA) early in the development cycle. They also established automated configuration auditing for all deployed infrastructure, ensuring that compliance with security baselines was continuously maintained. This comprehensive approach significantly reduced their risk posture, leading to fewer security incidents and greater confidence in their software delivery process.</p>
<p>Another example involves a global e-commerce platform that faced constant threats from sophisticated attackers. They adopted container runtime security solutions like Falco to monitor their Kubernetes clusters in real-time for suspicious activities, such as attempts to access sensitive files from within a container or unusual network connections. Coupled with a robust Web Application Firewall (WAF) to protect their public-facing applications and a strict policy for regular image scanning and patching, they managed to detect and prevent several advanced persistent threats (APTs) that targeted their runtime environment. This layered security strategy, integrating both pipeline security and runtime protection, proved instrumental in protecting customer data and maintaining service availability.</p>
  
</div>

<div id="chapter-6.6">

<h1 class="mb-6 text-3xl font-semibold text-balance max-lg:mb-3 max-lg:text-xl">Disaster Recovery and High Availability for Your CI/CD System</h1><p>Ensuring the continuous availability and resilience of a CI/CD system is crucial for maintaining development velocity and deployment reliability. An outage in the CI/CD pipeline can halt development, delay releases, and significantly impact business operations. This lesson explores strategies and implementations for disaster recovery and high availability within a CI/CD environment, focusing on preventing downtime, minimizing data loss, and enabling swift recovery from unforeseen incidents.</p>
<h2>Understanding High Availability (HA) in CI/CD</h2>
<p>High Availability (HA) refers to systems that are designed to operate continuously without failure for long periods. For CI/CD systems, HA means ensuring that core components like the Jenkins controller, build agents, artifact repositories, and version control systems remain accessible and functional even if individual components fail. The primary goal of HA is to eliminate single points of failure and provide redundancy.</p>
<p>Consider the "Acme Webshop" case study. If the Jenkins controller for Acme goes down during a critical release cycle, developers cannot merge code, run tests, or deploy updates. This directly impacts the ability to deliver new features or bug fixes to customers. An HA setup would ensure that even if one Jenkins instance fails, another immediately takes over, allowing the CI/CD process to continue uninterrupted.</p>
<h3>Key Principles of High Availability</h3>
<ul>
<li><strong>Redundancy:</strong> Having duplicate components or systems that can take over if the primary one fails. This applies to hardware (servers, network cards), software (application instances), and data (replicated databases).</li>
<li><strong>Failover:</strong> The automatic process of switching to a redundant or standby system upon the failure or abnormal termination of the previously active system. This process should ideally be transparent to users and minimize disruption.</li>
<li><strong>Load Balancing:</strong> Distributing incoming network traffic across multiple servers or resources to ensure no single server is overburdened and to improve overall responsiveness and availability. This also helps in directing traffic away from unhealthy instances.</li>
<li><strong>Monitoring and Alerting:</strong> Continuously observing the health and performance of all CI/CD components and automatically notifying administrators of any issues or potential failures, enabling proactive intervention.</li>
</ul>
<h3>HA for Jenkins</h3>
<p>For Jenkins, HA typically involves strategies to ensure the Jenkins controller (master) and its configuration, job data, and build history are highly available.</p>
<p><strong>Example 1: Shared Storage for Jenkins Configuration</strong></p>
<p>A common HA pattern for Jenkins is to use shared storage (like NFS, Amazon EFS, Azure Files, or Google Filestore) for the <code>JENKINS_HOME</code> directory. Multiple Jenkins controller instances can be configured to access this shared storage.</p>
<p><em>Hypothetical Scenario:</em> Acme Webshop decides to implement HA for their Jenkins environment. Instead of a single Jenkins instance storing <code>JENKINS_HOME</code> locally, they provision an Amazon EFS share.</p>
<ul>
<li>Two EC2 instances are launched, each running a Jenkins controller.</li>
<li>Both Jenkins instances mount the same EFS share as their <code>JENKINS_HOME</code>.</li>
<li>A load balancer (e.g., AWS ELB) sits in front of these instances.</li>
<li>If one Jenkins instance fails, the load balancer detects it and routes traffic to the healthy instance. Since both instances access the same <code>JENKINS_HOME</code> on EFS, the configuration, jobs, and history are immediately available to the surviving instance.</li>
</ul>
<p><em>Considerations:</em> This setup ensures that only one Jenkins controller is active at a time to prevent file corruption issues if two instances try to write to the same files simultaneously (split-brain scenario). Orchestration tools or fencing mechanisms are often used to ensure only one instance is truly "active." Alternatively, solutions like <strong>CloudBees CI</strong> offer more robust HA out-of-the-box by managing active/passive configurations and state replication.</p>
<p><strong>Example 2: Kubernetes for Jenkins HA</strong></p>
<p>Deploying Jenkins on Kubernetes inherently provides a degree of HA due to Kubernetes' self-healing capabilities.</p>
<ul>
<li>The Jenkins controller can run as a Deployment with multiple replicas.</li>
<li>A persistent volume (PV) and persistent volume claim (PVC) are used to store <code>JENKINS_HOME</code>. This PV typically uses network-attached storage that can be accessed by any node.</li>
<li>A Kubernetes Service exposes the Jenkins controller.</li>
<li>If a Jenkins pod crashes or the node it runs on fails, Kubernetes automatically reschedules a new pod on a healthy node. The new pod mounts the same PV, restoring the Jenkins state.</li>
</ul>
<p><em>Real-world Example:</em> A large financial institution uses Kubernetes to host their CI/CD platform. Their Jenkins controllers are deployed as Kubernetes Deployments with three replicas. The <code>JENKINS_HOME</code> is stored on a highly available NFS-backed Persistent Volume. If a Kubernetes node hosting a Jenkins pod experiences an issue, Kubernetes automatically moves the pod to another healthy node. Because the <code>JENKINS_HOME</code> is mounted from shared storage, the Jenkins instance quickly recovers with all its configuration and build history intact. The load balancer (Kubernetes Service) seamlessly directs traffic to the available Jenkins pods.</p>
<h2>Disaster Recovery (DR) for CI/CD Systems</h2>
<p>Disaster Recovery (DR) focuses on recovering from major events that lead to significant data loss or widespread system outages, such as regional data center failures, cyberattacks, or large-scale hardware malfunctions. DR strategies for CI/CD aim to restore the CI/CD system to an operational state with minimal data loss (Recovery Point Objective - RPO) and within an acceptable timeframe (Recovery Time Objective - RTO).</p>
<p>The "Acme Webshop" relies heavily on its CI/CD system for daily operations. If their primary data center housing Jenkins, GitLab, and Artifactory suffers a catastrophic failure, Acme needs a plan to bring these systems back online in a different location. Without a DR plan, they could face weeks or months of downtime, severely impacting their business.</p>
<h3>Key Principles of Disaster Recovery</h3>
<ul>
<li><strong>Backups and Restoration:</strong> Regularly taking copies of critical data and configurations, and having a tested process to restore them.</li>
<li><strong>Offsite Storage:</strong> Storing backups in a geographically separate location to protect against regional disasters.</li>
<li><strong>Replication:</strong> Continuously copying data from a primary system to a secondary system, often in a different region, to minimize data loss.</li>
<li><strong>DR Site/Region:</strong> Having a secondary infrastructure environment prepared to take over operations in case of a disaster affecting the primary environment.</li>
<li><strong>Recovery Playbook:</strong> Documented procedures for responding to a disaster, including roles, responsibilities, and step-by-step recovery actions.</li>
</ul>
<h3>DR Strategies for CI/CD Components</h3>
<h4>1. Jenkins Controller Backups</h4>
<p>Regular backups of the <code>JENKINS_HOME</code> directory are paramount. This directory contains all job configurations, build history, plugins, and user data.</p>
<ul>
<li><strong>Scheduled Backups:</strong> Implement automated cron jobs or scripts to compress and copy <code>JENKINS_HOME</code> to secure, offsite storage (e.g., S3, Azure Blob Storage, Google Cloud Storage).</li>
<li><strong>Configuration as Code (CasC):</strong> As covered in earlier modules, defining Jenkins configuration using CasC (e.g., JCasC plugin) allows rebuilding a Jenkins instance from code. While CasC handles configuration, job definitions (Pipelines as Code) and build history still need backup.</li>
<li><strong>Plugin Backup:</strong> Ensure that installed plugins are also captured either by backing up the <code>plugins/</code> directory within <code>JENKINS_HOME</code> or by listing them in a <code>plugins.txt</code> file and automating their reinstallation.</li>
</ul>
<p><em>Practical Example:</em> Acme Webshop's Jenkins instance runs on a virtual machine. They configure a daily cron job that performs the following steps:</p>
<ol>
<li>Stops the Jenkins service briefly (or uses a quiesce mode if available) to ensure data consistency.</li>
<li>Compresses the entire <code>/var/lib/jenkins</code> directory (the <code>JENKINS_HOME</code>).</li>
<li>Uploads the compressed archive to an Amazon S3 bucket in a different AWS region.</li>
<li>Restarts the Jenkins service.</li>
<li>Retention policies are applied to the S3 bucket to keep backups for a specified period (e.g., 30 days).</li>
</ol>
<p>In case of a disaster, a new Jenkins instance would be provisioned in the DR region, the latest backup would be downloaded from S3, restored to <code>JENKINS_HOME</code>, and the Jenkins service would be started.</p>
<h4>2. Version Control System (VCS) Disaster Recovery</h4>
<p>The VCS (e.g., Git, GitLab, GitHub, Bitbucket) is the single source of truth for all code and pipeline definitions. Its availability and recoverability are critical.</p>
<ul>
<li><strong>Geo-replication:</strong> For self-hosted VCS solutions like GitLab Enterprise, geo-replication allows asynchronous replication of repositories, databases, and other data to a secondary site. In a disaster, the secondary site can be promoted to primary.</li>
<li><strong>Cloud-based VCS:</strong> Using managed services like GitHub, GitLab.com, or Bitbucket Cloud offloads the DR responsibility to the provider, as they typically offer built-in HA and DR capabilities across multiple regions.</li>
</ul>
<p><em>Real-world Example:</em> A software company uses GitLab Self-Managed for their monorepo. They implement GitLab's Geo-replication feature, setting up a primary GitLab instance in their main data center and a secondary, read-only instance in a geographically distinct data center. All changes to the primary are asynchronously replicated to the secondary. In a major disaster affecting the primary data center, the secondary instance can be quickly promoted to a read/write primary, minimizing RPO and RTO for their source code.</p>
<h4>3. Artifact Repository DR</h4>
<p>Artifact repositories (e.g., Nexus, Artifactory) store compiled binaries, Docker images, and other build artifacts. Losing these can mean being unable to deploy existing versions or rollback.</p>
<ul>
<li><strong>Replication:</strong> Configure the artifact repository to replicate its data to a secondary instance or storage in another region.</li>
<li><strong>Cloud Object Storage:</strong> Many artifact repositories can be configured to store their binaries in cloud object storage (S3, Azure Blob, GCS). These services inherently offer high durability and often geo-replication capabilities, simplifying DR.</li>
</ul>
<p><em>Hypothetical Scenario:</em> The Acme Webshop uses Artifactory OSS for managing their Maven artifacts and Docker images. To implement DR:</p>
<ul>
<li>The Artifactory application data is configured to use a network file share (NFS) that is regularly backed up to offsite storage.</li>
<li>Alternatively, if running Artifactory Enterprise, they could use its built-in replication features to synchronize repositories between two instances in different regions.</li>
<li>For Docker images, they configure Artifactory to store the actual layers in an S3 bucket with cross-region replication enabled. The metadata is still handled by Artifactory's database, which would also be part of the backup strategy.</li>
</ul>
<h4>4. Build Agent Resiliency</h4>
<p>While build agents are often ephemeral, their ability to be quickly provisioned and connected is part of a robust DR strategy.</p>
<ul>
<li><strong>Dynamic Provisioning:</strong> Use cloud agents (EC2, Azure VMs, GCP instances) or Kubernetes pods that can be spun up on demand. In a DR scenario, new agents can be provisioned in the recovery region.</li>
<li><strong>Agent Configuration as Code:</strong> Store agent configurations (e.g., labels, tools, JVM options) in a version-controlled repository, allowing for quick recreation.</li>
</ul>
<h2>Implementing DR and HA in Practice</h2>
<p>Integrating DR and HA requires careful planning and testing.</p>
<h3>Network and Infrastructure Considerations</h3>
<ul>
<li><strong>Multi-Region Deployment:</strong> For robust DR, deploy CI/CD components across multiple cloud regions or physical data centers. This protects against region-wide outages.</li>
<li><strong>DNS Failover:</strong> Use DNS services with health checks (e.g., AWS Route 53, Azure DNS) to automatically redirect traffic to healthy instances or DR sites in case of a primary site failure.</li>
<li><strong>Infrastructure as Code (IaC):</strong> As learned in Module 3, use Terraform or CloudFormation to define and provision your entire CI/CD infrastructure (Jenkins instances, load balancers, shared storage) in both primary and DR regions. This enables rapid and consistent recovery.</li>
</ul>
<h3>CI/CD Pipeline Configuration for HA/DR</h3>
<ul>
<li><strong>Pipeline as Code (Module 6, Lesson 1):</strong> Storing pipeline definitions in your VCS is a fundamental DR practice. If your Jenkins controller is lost, you can restore its configuration and all pipelines are immediately available from the VCS.</li>
<li><strong>Shared Libraries (Module 6, Lesson 1):</strong> Centralizing reusable pipeline logic in shared libraries ensures that common steps are consistent and can be restored easily.</li>
<li><strong>Immutable Infrastructure:</strong> Build agent images should be immutable. If an agent goes down, a new one is launched from a pristine image, rather than attempting to repair a faulty one.</li>
</ul>
<h3>Testing Your DR/HA Strategy</h3>
<p>A DR plan is only as good as its last test.</p>
<ul>
<li><strong>Regular DR Drills:</strong> Periodically simulate disaster scenarios (e.g., "primary data center outage") and execute your recovery playbook. This identifies gaps and ensures the team is proficient.</li>
<li><strong>Automated Validation:</strong> Implement automated tests to verify the health and functionality of your HA setup (e.g., regularly fail over Jenkins instances).</li>
<li><strong>RPO/RTO Validation:</strong> Measure the actual RPO (how much data was lost) and RTO (how long it took to recover) during drills to ensure they meet business requirements.</li>
</ul>
<h2>Exercises</h2>
<ol>
<li>
<p><strong>Jenkins Backup and Restore Simulation:</strong></p>
<ul>
<li>Set up a simple Jenkins instance (e.g., on a local VM or Docker container).</li>
<li>Create a few dummy jobs and configure some basic settings (e.g., user accounts).</li>
<li>Write a script (Bash or PowerShell) to:
<ol>
<li>Stop the Jenkins service.</li>
<li>Create a compressed archive of the <code>JENKINS_HOME</code> directory.</li>
<li>Start the Jenkins service.</li>
</ol>
</li>
<li>Simulate a disaster: Delete the <code>JENKINS_HOME</code> directory.</li>
<li>Restore Jenkins: Create a new empty <code>JENKINS_HOME</code> directory, extract your backup into it, and restart Jenkins.</li>
<li>Verify that all jobs, configurations, and user accounts are restored. Document your RPO and RTO for this process.</li>
</ul>
</li>
<li>
<p><strong>Shared Storage for Jenkins HA (Conceptual):</strong></p>
<ul>
<li>Research how you would set up shared storage for a Jenkins <code>JENKINS_HOME</code> on a cloud provider you are familiar with (e.g., AWS EFS, Azure Files, Google Filestore).</li>
<li>Describe the steps you would take to configure two Jenkins instances to use this shared storage.</li>
<li>Explain how you would prevent a split-brain scenario if both instances tried to write to <code>JENKINS_HOME</code> simultaneously without an HA solution managing them. What additional tools or configurations would be needed?</li>
</ul>
</li>
<li>
<p><strong>VCS and Artifact Repository DR Planning:</strong></p>
<ul>
<li>Assume Acme Webshop uses a self-hosted GitLab instance and a self-hosted Nexus repository.</li>
<li>Outline a detailed disaster recovery plan for both systems, considering data replication, backup frequency, offsite storage, and potential failover procedures to a secondary region.</li>
<li>Specify the RPO and RTO you would aim for each system and justify your choices.</li>
</ul>
</li>
</ol>
  
</div>

</div>
